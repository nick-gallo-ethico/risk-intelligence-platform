---
phase: 11.1-frontend-navigation-and-ui-fixes
plan: 03
completed: 2026-02-05
duration: 8 min
subsystem: frontend
tags: [react, case-detail, messages, files, react-query]

dependency-graph:
  requires:
    - 11.1-01 (sidebar navigation)
  provides:
    - Messages tab with real API data
    - Files tab with grid view
    - Case messages API client
    - Case files hooks
    - Reusable EmptyState component
  affects:
    - Case detail page functionality
    - Future message threading features

tech-stack:
  added: []
  patterns:
    - React Query hooks for data fetching
    - Reusable EmptyState component pattern
    - Chat-style message thread UI

key-files:
  created:
    - apps/frontend/src/types/message.ts
    - apps/frontend/src/lib/messages-api.ts
    - apps/frontend/src/hooks/use-case-messages.ts
    - apps/frontend/src/components/common/empty-state.tsx
    - apps/frontend/src/components/common/index.ts
    - apps/frontend/src/components/cases/messages-tab.tsx
    - apps/frontend/src/hooks/use-case-files.ts
    - apps/frontend/src/components/cases/files-tab.tsx
  modified:
    - apps/frontend/src/components/cases/case-tabs.tsx

decisions:
  - id: chat-style-messages
    description: "Messages displayed in chat bubble style (left/right aligned by direction)"
    rationale: "Familiar messaging UI pattern, clear visual distinction between inbound/outbound"
  - id: file-grid-layout
    description: "Files displayed in responsive grid (3/2/1 columns)"
    rationale: "Maximizes thumbnail visibility, responsive design for different screens"

metrics:
  files_created: 8
  files_modified: 1
  lines_added: ~1000
  commits: 4
---

# Phase 11.1 Plan 03: Case Detail Messages and Files Tabs Summary

Wire the Messages and Files tabs on case detail page to fetch and display real data from backend APIs.

## What Was Built

### Messages Tab Implementation
- Created `messagesApi` client with endpoints for getForCase, send, getUnreadCount, checkPii
- Created `useCaseMessages`, `useSendMessage`, `useUnreadCount` React Query hooks
- Built `MessagesTab` component with:
  - Chronological message thread
  - Inbound messages (from reporter): left-aligned, gray background
  - Outbound messages (to reporter): right-aligned, blue background
  - Send message form with Ctrl+Enter shortcut
  - PII detection warning with acknowledge/dismiss workflow
  - Anonymous reporter badge indicator
  - Loading skeleton and empty state

### Files Tab Implementation
- Created `useCaseFiles` hook using existing `attachmentsApi`
- Built `FilesTab` component with:
  - Responsive grid layout (3 columns desktop, 2 tablet, 1 mobile)
  - Thumbnail preview for image files
  - File type icons for non-images (PDF, document, video, audio)
  - Hover overlay with download and delete actions
  - Evidence badge indicator
  - Upload dialog using existing `FileUpload` component
  - Delete confirmation dialog
  - Loading skeleton and empty state

### Reusable EmptyState Component
- Created HubSpot-style `EmptyState` component
- Centered layout with icon, title, description, optional action button
- Exported from `components/common/index.ts` barrel

## Commits

| Hash | Description |
|------|-------------|
| ac9d73c | feat(11.1-03): add messages API client and hooks |
| 3a6762c | feat(11.1-03): add reusable EmptyState component |
| 62d8d54 | feat(11.1-03): implement Messages tab with real data |
| 33b0a0b | feat(11.1-03): implement Files tab with grid view |

## Technical Details

### API Integration
```typescript
// Messages API endpoints
GET  /case-messages/:caseId        -> MessagesListResponse
POST /case-messages/:caseId/send   -> CaseMessage
GET  /case-messages/:caseId/unread-count -> UnreadCountResponse
POST /case-messages/check-pii      -> PiiCheckResult

// Files use existing attachments API
attachmentsApi.getForEntity('CASE', caseId)
```

### React Query Configuration
- Messages: 30s stale time, 60s auto-refresh for real-time updates
- Files: 60s stale time, manual refresh on upload/delete

## Deviations from Plan

None - plan executed exactly as written.

## Verification

- [x] Messages tab displays real messages from API
- [x] Messages show direction styling (inbound/outbound)
- [x] Send message form present and functional
- [x] Files tab displays real attachments in grid
- [x] File cards show thumbnails/icons, names, sizes
- [x] Empty states render for both tabs when no data
- [x] ESLint passes (only pre-existing warnings)
- [x] TypeScript compiles (only pre-existing Next.js 15 issues)

## Next Phase Readiness

Ready for next plan. Case detail page Messages and Files tabs are now fully functional with real data.
