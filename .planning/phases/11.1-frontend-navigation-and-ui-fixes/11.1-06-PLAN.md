---
phase: 11.1-frontend-navigation-and-ui-fixes
plan: 06
type: execute
wave: 3
depends_on: ["11.1-01", "11.1-02"]
files_modified:
  - apps/frontend/src/lib/analytics-api.ts
  - apps/frontend/src/hooks/use-dashboards.ts
  - apps/frontend/src/types/analytics.ts
  - apps/frontend/src/app/(authenticated)/analytics/page.tsx
  - apps/frontend/src/components/analytics/dashboards-list.tsx
  - apps/frontend/src/components/analytics/reports-list.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to /analytics and see analytics page"
    - "Page has tabs: Dashboards and Reports"
    - "Dashboards tab shows list of dashboards with favorites"
    - "Reports tab shows list of reports with favorites"
    - "Create Dashboard button shows template picker (placeholder)"
  artifacts:
    - path: "apps/frontend/src/app/(authenticated)/analytics/page.tsx"
      provides: "Analytics page with tabs"
      min_lines: 60
    - path: "apps/frontend/src/components/analytics/dashboards-list.tsx"
      provides: "Dashboards list component"
      min_lines: 50
    - path: "apps/frontend/src/lib/analytics-api.ts"
      provides: "Analytics API client"
      exports: ["analyticsApi"]
  key_links:
    - from: "apps/frontend/src/app/(authenticated)/analytics/page.tsx"
      to: "/api/v1/dashboards"
      via: "React Query hook"
      pattern: "useDashboards"
    - from: "dashboards-list.tsx"
      to: "Star icon"
      via: "favorite toggle"
      pattern: "onToggleFavorite"
---

<objective>
Create the Analytics page (/analytics) with Dashboards and Reports tabs.

Purpose: Analytics page is missing; users need access to dashboards and reports.
Output: Working analytics page with tab navigation, dashboard/report lists, and favorites.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11.1-frontend-navigation-and-ui-fixes/11.1-CONTEXT.md
@.planning/phases/11.1-frontend-navigation-and-ui-fixes/11.1-RESEARCH.md
@apps/backend/src/modules/analytics/dashboards/dashboard.controller.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Analytics Types and API Client</name>
  <files>
    apps/frontend/src/types/analytics.ts
    apps/frontend/src/lib/analytics-api.ts
    apps/frontend/src/hooks/use-dashboards.ts
  </files>
  <action>
1. Create types/analytics.ts:
   ```typescript
   export interface Dashboard {
     id: string;
     organizationId: string;
     name: string;
     description?: string;
     isSystem: boolean;
     ownerId?: string;
     ownerName?: string;
     lastViewedAt?: string;
     isFavorite?: boolean;
     createdAt: string;
     updatedAt: string;
   }

   export interface DashboardListResponse {
     data: Dashboard[];
     total: number;
   }

   export interface Report {
     id: string;
     organizationId: string;
     name: string;
     description?: string;
     templateId?: string;
     ownerId?: string;
     ownerName?: string;
     viewCount: number;
     tags: string[];
     lastUpdatedAt: string;
     isFavorite?: boolean;
     createdAt: string;
   }

   export interface ReportListResponse {
     data: Report[];
     total: number;
   }

   export interface DashboardTemplate {
     id: string;
     name: string;
     description: string;
     thumbnail?: string;
     category: string;
   }
   ```

2. Create analytics-api.ts:
   - Import apiClient from ./api
   - Endpoints:
     - listDashboards(): GET /dashboards
     - getDashboard(id): GET /dashboards/:id
     - getDashboardTemplates(): GET /dashboards/templates
     - createDashboard(dto): POST /dashboards
     - toggleFavorite(id): POST /dashboards/:id/favorite
     - listReports(): GET /reports (may not exist yet - handle gracefully)
     - toggleReportFavorite(id): POST /reports/:id/favorite

3. Create use-dashboards.ts hook:
   - useDashboards(): useQuery for dashboard list
   - useDashboardTemplates(): useQuery for templates
   - useToggleDashboardFavorite(): useMutation, invalidates dashboards on success
   - useReports(): useQuery for reports (handle 404 gracefully - return empty array)
  </action>
  <verify>
- `grep "listDashboards" apps/frontend/src/lib/analytics-api.ts` shows endpoint
- `grep "useDashboards" apps/frontend/src/hooks/use-dashboards.ts` shows hook
- TypeScript compiles: `cd apps/frontend && npx tsc --noEmit`
  </verify>
  <done>
- Analytics types defined (Dashboard, Report, DashboardTemplate)
- analyticsApi exports dashboard and report operations
- useDashboards hook provides data with loading/error states
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Dashboard and Report List Components</name>
  <files>
    apps/frontend/src/components/analytics/dashboards-list.tsx
    apps/frontend/src/components/analytics/reports-list.tsx
    apps/frontend/src/components/analytics/dashboard-template-picker.tsx
  </files>
  <action>
1. Create dashboards-list.tsx:
   - Props: dashboards (Dashboard[]), isLoading, onToggleFavorite, onSelect
   - Table/list layout with columns: Name, Owner, Last Viewed, Actions
   - Each row:
     - Star icon (filled if favorite, outline if not) - clickable to toggle
     - Dashboard name (link to /analytics/dashboards/[id])
     - Owner name or "System" for isSystem dashboards
     - Last viewed date (relative time: "2 hours ago")
     - Actions: View, Edit (dropdown)
   - Pre-built dashboards section at top:
     - Compliance Overview
     - Risk Summary
     - Campaign Performance
   - Loading: Skeleton rows
   - Empty: "No dashboards yet" with Create button

2. Create reports-list.tsx:
   - Props: reports (Report[]), isLoading, onToggleFavorite, onSelect
   - Left sidebar: Favorites section (starred reports)
   - Main area: Report list table
   - Columns: Name, Owner, Views, Tags, Last Updated
   - Star icon for favorites
   - Loading: Skeleton
   - Empty: "No reports yet"

3. Create dashboard-template-picker.tsx (dialog):
   - Props: open, onOpenChange, onSelect
   - Dialog with grid of template cards
   - Pre-built templates:
     - Blank Dashboard
     - Compliance Overview Template
     - Risk Summary Template
     - Campaign Performance Template
   - Each card: thumbnail/icon, name, description
   - Click to select and call onSelect(templateId)
  </action>
  <verify>
- `grep "onToggleFavorite" apps/frontend/src/components/analytics/dashboards-list.tsx` shows prop
- Components render lists correctly
- Template picker shows grid of options
  </verify>
  <done>
- DashboardsList shows dashboards with favorites and last viewed
- ReportsList shows reports with sidebar favorites
- DashboardTemplatePicker shows template grid in dialog
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Analytics Page</name>
  <files>
    apps/frontend/src/app/(authenticated)/analytics/page.tsx
  </files>
  <action>
1. Create analytics/page.tsx:
   - Page header: "Analytics" title, context-aware action buttons
   - Tab navigation: Dashboards | Reports
   - Tab content switches between DashboardsList and ReportsList
   - Sync tab state with URL query param (?tab=dashboards|reports)

2. State management:
   - Use useDashboards() for dashboard data
   - Use useReports() for reports data (handle gracefully if endpoint missing)
   - Use useDashboardTemplates() for template picker
   - Track selected tab in URL

3. Layout structure:
   ```tsx
   <div className="space-y-6">
     {/* Header */}
     <div className="flex items-center justify-between">
       <div>
         <h1 className="text-2xl font-bold">Analytics</h1>
         <p className="text-muted-foreground">View dashboards and reports</p>
       </div>
       {activeTab === 'dashboards' && (
         <Button onClick={() => setTemplatePickerOpen(true)}>
           <Plus className="mr-2 h-4 w-4" />
           Create Dashboard
         </Button>
       )}
       {activeTab === 'reports' && (
         <Button onClick={handleCreateReport}>
           <Plus className="mr-2 h-4 w-4" />
           Create Report
         </Button>
       )}
     </div>

     {/* Tabs */}
     <Tabs value={activeTab} onValueChange={handleTabChange}>
       <TabsList>
         <TabsTrigger value="dashboards">Dashboards</TabsTrigger>
         <TabsTrigger value="reports">Reports</TabsTrigger>
       </TabsList>

       <TabsContent value="dashboards">
         <DashboardsList
           dashboards={dashboards}
           isLoading={dashboardsLoading}
           onToggleFavorite={handleToggleFavorite}
           onSelect={(id) => router.push(`/analytics/dashboards/${id}`)}
         />
       </TabsContent>

       <TabsContent value="reports">
         <ReportsList
           reports={reports}
           isLoading={reportsLoading}
           onToggleFavorite={handleToggleReportFavorite}
           onSelect={(id) => router.push(`/analytics/reports/${id}`)}
         />
       </TabsContent>
     </Tabs>

     {/* Template Picker Dialog */}
     <DashboardTemplatePicker
       open={templatePickerOpen}
       onOpenChange={setTemplatePickerOpen}
       onSelect={handleTemplateSelect}
     />
   </div>
   ```

4. Placeholder handling:
   - If reports endpoint doesn't exist, show message: "Reports coming soon"
   - Create Report button shows toast: "Report builder coming soon"
   - Dashboard detail pages are placeholders (just show name)
  </action>
  <verify>
- Navigate to /analytics from sidebar
- See page with Dashboards and Reports tabs
- Dashboards tab shows list (may be empty)
- Reports tab shows list or "coming soon"
- Create Dashboard opens template picker
  </verify>
  <done>
- /analytics page renders with tabs
- Dashboards tab shows list with pre-built dashboards noted
- Reports tab shows list or placeholder
- Create Dashboard shows template picker
- Tab state synced with URL
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Navigate to /analytics from sidebar
2. Verify Dashboards tab:
   - Shows dashboard list (may be empty or have pre-built)
   - Favorites star works (visual toggle)
   - Create Dashboard opens template picker
3. Verify Reports tab:
   - Shows report list or "coming soon" message
4. Switch tabs and verify URL updates
5. Run: `cd apps/frontend && npm run lint`
6. Run: `cd apps/frontend && npx tsc --noEmit`
</verification>

<success_criteria>
- /analytics page accessible from navigation
- Tab navigation works (Dashboards / Reports)
- Dashboards list shows available dashboards
- Favorites toggle works (star icon)
- Template picker dialog appears for Create Dashboard
- Reports section shows list or placeholder
- Tab state persisted in URL
- No TypeScript or ESLint errors
</success_criteria>

<output>
After completion, create `.planning/phases/11.1-frontend-navigation-and-ui-fixes/11.1-06-SUMMARY.md`
</output>
