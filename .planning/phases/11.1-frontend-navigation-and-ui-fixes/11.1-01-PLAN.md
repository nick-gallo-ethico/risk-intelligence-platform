---
phase: 11.1-frontend-navigation-and-ui-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/src/components/ui/sidebar.tsx
  - apps/frontend/src/components/layout/app-sidebar.tsx
  - apps/frontend/src/components/layout/nav-main.tsx
  - apps/frontend/src/components/layout/nav-admin.tsx
  - apps/frontend/src/app/(authenticated)/layout.tsx
  - apps/frontend/src/lib/navigation.ts
autonomous: true

must_haves:
  truths:
    - "Authenticated users see icon rail sidebar on left side of screen"
    - "Sidebar expands on hover/click to show flyout menus"
    - "Admin menu items only visible to SYSTEM_ADMIN and COMPLIANCE_OFFICER roles"
    - "Current route highlighted in sidebar"
  artifacts:
    - path: "apps/frontend/src/components/ui/sidebar.tsx"
      provides: "shadcn/ui sidebar primitives"
      min_lines: 100
    - path: "apps/frontend/src/components/layout/app-sidebar.tsx"
      provides: "Main application sidebar"
      exports: ["AppSidebar"]
    - path: "apps/frontend/src/app/(authenticated)/layout.tsx"
      provides: "Authenticated route group layout with SidebarProvider"
      min_lines: 20
  key_links:
    - from: "apps/frontend/src/app/(authenticated)/layout.tsx"
      to: "SidebarProvider"
      via: "wraps children with sidebar context"
      pattern: "SidebarProvider"
    - from: "apps/frontend/src/components/layout/app-sidebar.tsx"
      to: "useAuth"
      via: "role-based navigation filtering"
      pattern: "user\\.role"
---

<objective>
Install shadcn/ui sidebar component and create the main navigation sidebar with icon rail + flyout pattern.

Purpose: Establish the core navigation infrastructure that all authenticated pages will use.
Output: Working sidebar with icon rail mode, flyout menus, and role-based admin visibility.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11.1-frontend-navigation-and-ui-fixes/11.1-CONTEXT.md
@.planning/phases/11.1-frontend-navigation-and-ui-fixes/11.1-RESEARCH.md
@apps/frontend/src/app/layout.tsx
@apps/frontend/src/contexts/auth-context.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn/ui Sidebar and Create Primitives</name>
  <files>
    apps/frontend/src/components/ui/sidebar.tsx
    apps/frontend/src/lib/navigation.ts
  </files>
  <action>
1. Run `npx shadcn@latest add sidebar` in apps/frontend directory to install the sidebar component
2. Create navigation.ts with navigation configuration:
   - Define navigation items array with: Home (/dashboard), Cases (/cases), Investigations (/investigations), Disclosures (/disclosures), Policies (/policies), Projects (/projects), Analytics (/analytics)
   - Define admin items array with: Users (/settings/users), Roles (/settings/roles), Settings (/settings/organization), Audit Log (/settings/audit), Integrations (/settings/integrations)
   - Export NavItem type with: title, url, icon (LucideIcon), items? (sub-items), requiredRoles? (UserRole[])
   - Use Lucide icons: Home, Briefcase, Search, FileWarning, FileText, FolderKanban, BarChart3, Users, Shield, Settings, ClipboardList, Plug
  </action>
  <verify>
- `ls apps/frontend/src/components/ui/sidebar.tsx` exists
- `grep "SidebarProvider" apps/frontend/src/components/ui/sidebar.tsx` shows component
- TypeScript compiles without errors: `cd apps/frontend && npx tsc --noEmit`
  </verify>
  <done>
- sidebar.tsx exists with SidebarProvider, Sidebar, SidebarContent, SidebarHeader, SidebarFooter, SidebarRail, SidebarMenu exports
- navigation.ts exports navigationItems and adminItems arrays
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AppSidebar Component with Icon Rail</name>
  <files>
    apps/frontend/src/components/layout/app-sidebar.tsx
    apps/frontend/src/components/layout/nav-main.tsx
    apps/frontend/src/components/layout/nav-admin.tsx
  </files>
  <action>
1. Create app-sidebar.tsx:
   - Use Sidebar with collapsible="icon" prop for icon rail mode
   - SidebarHeader: Logo icon that links to /dashboard
   - SidebarContent: NavMain component for main navigation, NavAdmin for admin section
   - SidebarFooter: AI button (Sparkles icon) that will trigger AI panel, collapse/expand toggle button
   - SidebarRail for resize handle
   - Get user from useAuth() for role checking

2. Create nav-main.tsx:
   - Import navigationItems from lib/navigation
   - Use SidebarMenu, SidebarMenuItem, SidebarMenuButton
   - For items with sub-items, use Collapsible with SidebarMenuSub
   - Show SidebarMenuButton tooltip with item title (shows on hover when collapsed)
   - Highlight active item based on current pathname (usePathname)
   - Use Link from next/link for navigation

3. Create nav-admin.tsx:
   - Import adminItems from lib/navigation
   - Filter items based on user.role:
     - SYSTEM_ADMIN sees all items
     - COMPLIANCE_OFFICER sees Audit Log, Settings (view only)
     - Other roles: return null (hide entire admin section)
   - Same structure as NavMain with Collapsible for sub-items
   - Add visual separator (SidebarSeparator) above admin section
  </action>
  <verify>
- `grep "collapsible=\"icon\"" apps/frontend/src/components/layout/app-sidebar.tsx` shows icon mode
- `grep "useAuth" apps/frontend/src/components/layout/app-sidebar.tsx` shows auth context usage
- `grep "SYSTEM_ADMIN" apps/frontend/src/components/layout/nav-admin.tsx` shows role filtering
  </verify>
  <done>
- AppSidebar renders with icon rail mode
- NavMain shows main navigation items with active highlighting
- NavAdmin only visible to authorized roles
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Authenticated Layout with SidebarProvider</name>
  <files>
    apps/frontend/src/app/(authenticated)/layout.tsx
  </files>
  <action>
1. Create (authenticated)/layout.tsx route group layout:
   - Import SidebarProvider from @/components/ui/sidebar
   - Import AppSidebar from @/components/layout/app-sidebar
   - Import cookies from next/headers for SSR-safe state
   - Read sidebar state from cookie: sidebar:state (default: true for expanded)
   - Wrap children with SidebarProvider defaultOpen={sidebarOpen}
   - Layout structure:
     ```tsx
     <SidebarProvider defaultOpen={defaultOpen}>
       <AppSidebar />
       <main className="flex-1 overflow-auto">
         <SidebarTrigger className="md:hidden" /> {/* Mobile only */}
         {children}
       </main>
     </SidebarProvider>
     ```

2. Move existing authenticated pages to (authenticated) route group:
   - Move /dashboard/page.tsx to /(authenticated)/dashboard/page.tsx
   - Move /cases/page.tsx to /(authenticated)/cases/page.tsx
   - Move /cases/[id]/page.tsx to /(authenticated)/cases/[id]/page.tsx
   - Move /cases/new/page.tsx to /(authenticated)/cases/new/page.tsx
   - Move /investigations/[id]/page.tsx to /(authenticated)/investigations/[id]/page.tsx
   - Move /policies/page.tsx to /(authenticated)/policies/page.tsx

3. Update moved pages to remove inline headers/navigation (now provided by layout):
   - dashboard/page.tsx: Remove the header section with logout button, keep main content
   - case detail page: Keep CaseDetailHeader but remove duplicate auth checks (layout handles it)
  </action>
  <verify>
- `ls apps/frontend/src/app/\(authenticated\)/layout.tsx` exists
- `ls apps/frontend/src/app/\(authenticated\)/dashboard/page.tsx` exists
- Navigate to /dashboard and see sidebar on left
- Navigate to /cases and see same sidebar (consistent across routes)
  </verify>
  <done>
- Authenticated layout wraps all authenticated routes with sidebar
- Sidebar state persisted in cookie for SSR compatibility
- Existing pages moved to route group and working
- Dashboard no longer has its own header (using sidebar for navigation)
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Start frontend dev server: `cd apps/frontend && npm run dev`
2. Login and navigate to /dashboard
3. Verify sidebar appears on left in icon rail mode
4. Hover over icons to see flyout menus
5. Click navigation items to navigate
6. Verify Admin section only visible for SYSTEM_ADMIN role
7. Test collapse/expand toggle
8. Run: `cd apps/frontend && npm run lint`
9. Run: `cd apps/frontend && npx tsc --noEmit`
</verification>

<success_criteria>
- Sidebar visible on all authenticated routes
- Icon rail mode works (collapsed by default)
- Flyout menus appear on hover
- Navigation items clickable and navigate correctly
- Admin menu items role-filtered
- Active route highlighted
- No TypeScript errors
- No ESLint errors
</success_criteria>

<output>
After completion, create `.planning/phases/11.1-frontend-navigation-and-ui-fixes/11.1-01-SUMMARY.md`
</output>
