---
phase: 11.1-frontend-navigation-and-ui-fixes
plan: 04
subsystem: frontend-cases
tags: [remediation, drag-and-drop, react-query, dnd-kit]
completed: 2026-02-05
duration: 8 min
dependency-graph:
  requires: [11.1-01]
  provides: [remediation-api-client, remediation-hooks, remediation-tab]
  affects: []
tech-stack:
  added: []
  patterns: [dnd-kit-sortable, react-query-mutations, collapsible-cards]
key-files:
  created:
    - apps/frontend/src/types/remediation.ts
    - apps/frontend/src/lib/remediation-api.ts
    - apps/frontend/src/hooks/use-case-remediation.ts
    - apps/frontend/src/components/cases/remediation-step-card.tsx
    - apps/frontend/src/components/cases/remediation-tab.tsx
  modified:
    - apps/frontend/src/components/cases/case-tabs.tsx
decisions:
  - id: drag-reorder-local-state
    choice: Local state with optimistic updates
    rationale: Better UX - immediate visual feedback, mutation syncs to server
---

# Phase 11.1 Plan 04: Remediation Tab with Drag-Reorder Summary

Wired the Remediation tab on case detail page to fetch and display real remediation plans with drag-reorder capability using @dnd-kit.

## What Was Built

### 1. Remediation Types and API Client
- Created `types/remediation.ts` with `RemediationPlan`, `RemediationStep`, and status types
- Created `lib/remediation-api.ts` with full CRUD operations:
  - Plans: getByCase, getById, create, update, activate, complete, cancel
  - Steps: create, update, complete, skip, delete, reorder
- Exported `remediationApi` object for consistent pattern

### 2. React Query Hooks
- Created `hooks/use-case-remediation.ts` with:
  - `useCaseRemediation(caseId)` - fetch plans by case
  - `useRemediationPlan(planId)` - fetch single plan
  - `useCreateRemediationPlan()` - create new plan
  - `useReorderSteps(planId, caseId)` - reorder steps with cache invalidation
  - `useCompleteStep()` / `useSkipStep()` - step actions

### 3. Draggable Step Card Component
- Created `remediation-step-card.tsx` (265 lines)
- Uses `useSortable` from @dnd-kit for drag handle
- Status badge color-coded: gray=PENDING, blue=IN_PROGRESS, green=COMPLETED, amber=SKIPPED, purple=AWAITING_APPROVAL
- Shows assignee avatar, due date with overdue/due-soon styling
- Action dropdown for complete/skip

### 4. Remediation Tab Component
- Created `remediation-tab.tsx` (424 lines)
- Fetches plans via `useCaseRemediation` hook
- Plans displayed as collapsible cards with:
  - Status badge and progress bar
  - Activate button for DRAFT plans
  - View Details link
- Steps within each plan are sortable via DndContext
- Empty state with ClipboardCheck icon and "Create Plan" button

### 5. Integration with Case Tabs
- Updated `case-tabs.tsx` to import and use real `RemediationTab`
- Removed placeholder function
- Passes `caseId` prop instead of `caseData`

## Technical Decisions

### Drag-Reorder Implementation
- Used @dnd-kit/sortable with local state for optimistic updates
- `arrayMove` from @dnd-kit to reorder array
- Mutation sends new order to backend after local state update
- Cache invalidation on success refreshes from server

### Plan Card Expansion
- Collapsible component from Radix for expand/collapse
- First plan auto-expanded on load
- Multiple plans can be expanded simultaneously

## Commits

| Hash | Type | Description |
|------|------|-------------|
| 7923232 | feat | Add remediation API client and React Query hooks |
| c84aef1 | feat | Create draggable remediation step card component |
| c38b38c | feat | Implement Remediation tab with drag-reorder capability |

## Verification Results

- TypeScript: No errors in new files
- ESLint: No errors (pre-existing warnings only)
- Line counts: remediation-tab.tsx=424, remediation-step-card.tsx=265 (exceeds minimums)

## Deviations from Plan

None - plan executed exactly as written.
