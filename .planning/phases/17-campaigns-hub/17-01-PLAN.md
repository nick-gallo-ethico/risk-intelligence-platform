---
phase: 17-campaigns-hub
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/backend/src/modules/campaigns/campaigns.controller.ts
  - apps/frontend/src/lib/navigation.ts
  - apps/frontend/src/app/(authenticated)/campaigns/new/page.tsx
  - apps/frontend/src/app/(authenticated)/campaigns/page.tsx
autonomous: true

must_haves:
  truths:
    - "Campaigns and Forms appear in the sidebar navigation"
    - "Clicking 'Create Campaign' navigates to /campaigns/new which renders the CampaignBuilder wizard"
    - "GET /api/v1/campaigns/dashboard/stats returns dashboard statistics"
    - "GET /api/v1/campaigns/dashboard/overdue returns overdue campaigns"
    - "GET /api/v1/campaigns/dashboard/upcoming returns upcoming deadline campaigns"
    - "POST /api/v1/campaigns/:id/remind triggers reminder sending"
  artifacts:
    - path: "apps/backend/src/modules/campaigns/campaigns.controller.ts"
      provides: "Dashboard controller endpoints"
      contains: "dashboard/stats"
    - path: "apps/frontend/src/lib/navigation.ts"
      provides: "Campaigns and Forms nav entries"
      contains: "Campaigns"
    - path: "apps/frontend/src/app/(authenticated)/campaigns/new/page.tsx"
      provides: "Campaign creation page"
      contains: "CampaignBuilder"
  key_links:
    - from: "apps/frontend/src/lib/campaigns-api.ts"
      to: "/api/v1/campaigns/dashboard/stats"
      via: "campaignsApi.getStats()"
      pattern: "campaigns/dashboard/stats"
    - from: "apps/frontend/src/lib/navigation.ts"
      to: "/campaigns"
      via: "navigationItems array"
      pattern: "Campaigns"
---

<objective>
Wire backend dashboard endpoints, add sidebar navigation entries for Campaigns and Forms, and create the campaign creation page.

Purpose: Fill the backend API gap (dashboard service exists but has no controller routes), make campaigns discoverable in the sidebar, and restore the deleted /campaigns/new route so users can create campaigns from the hub.

Output: 4 backend endpoints wired to existing services, sidebar entries for Campaigns and Forms, and a working /campaigns/new page wrapping CampaignBuilder.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-campaigns-hub/17-RESEARCH.md
@apps/backend/src/modules/campaigns/campaigns.controller.ts
@apps/backend/src/modules/campaigns/campaign-dashboard.service.ts
@apps/backend/src/modules/campaigns/campaign-reminder.service.ts
@apps/backend/src/modules/campaigns/campaigns.module.ts
@apps/frontend/src/lib/navigation.ts
@apps/frontend/src/lib/campaigns-api.ts
@apps/frontend/src/hooks/use-campaigns.ts
@apps/frontend/src/components/campaigns/index.ts
@apps/frontend/src/app/(authenticated)/campaigns/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire backend dashboard + reminder controller endpoints</name>
  <files>apps/backend/src/modules/campaigns/campaigns.controller.ts</files>
  <action>
Add CampaignDashboardService and CampaignReminderService to the controller constructor injection.

Add 4 new endpoints to CampaignsController:

1. `GET dashboard/stats` - calls `this.dashboardService.getDashboardStats(TEMP_ORG_ID)`. Returns DashboardStats. IMPORTANT: This route MUST be registered BEFORE the `:id` route (NestJS evaluates routes top-down; `dashboard` would match `:id` if placed after). Place these dashboard routes in a new section between the Campaign Endpoints header and the `:id` GET route.

2. `GET dashboard/overdue` - calls `this.dashboardService.getOverdueCampaigns(TEMP_ORG_ID)`. Accepts optional `@Query('limit')` param (default 10).

3. `GET dashboard/upcoming` - calls `this.dashboardService.getUpcomingDeadlines(TEMP_ORG_ID)`. Accepts optional `@Query('days')` and `@Query('limit')` params (defaults 7 and 10).

4. `POST :id/remind` - calls `this.reminderService.sendReminders(id, TEMP_ORG_ID)` (or the appropriate method from CampaignReminderService). HttpCode 200. Uses `@Param('id', ParseUUIDPipe)`.

Add `ApiOperation` and `ApiResponse` decorators to each new endpoint following the existing pattern in the controller.

Import CampaignDashboardService from './campaign-dashboard.service' and CampaignReminderService from './campaign-reminder.service'.

Do NOT modify existing endpoints. Add the new endpoints only.
</action>
<verify>
Run `cd apps/backend && npx tsc --noEmit 2>&1 | head -20` to verify TypeScript compilation. Check that no type errors exist in the modified controller.
</verify>
<done>Four new controller endpoints exist and compile. GET dashboard/stats, GET dashboard/overdue, GET dashboard/upcoming, POST :id/remind are all wired to existing service methods.</done>
</task>

<task type="auto">
  <name>Task 2: Add Campaigns and Forms to sidebar navigation and create /campaigns/new page</name>
  <files>
apps/frontend/src/lib/navigation.ts
apps/frontend/src/app/(authenticated)/campaigns/new/page.tsx
apps/frontend/src/app/(authenticated)/campaigns/page.tsx
  </files>
  <action>
**Navigation (navigation.ts):**

Add two entries to the `navigationItems` array. Insert them after the 'Policies' entry and before 'Projects':

```typescript
import { Megaphone, FileInput } from 'lucide-react';

// Add after Policies:
{
  title: 'Campaigns',
  url: '/campaigns',
  icon: Megaphone,
},
{
  title: 'Forms',
  url: '/forms',
  icon: FileInput,
},
```

Add `Megaphone` and `FileInput` to the lucide-react import at the top.

**Create Campaign Page (/campaigns/new/page.tsx):**

Create `apps/frontend/src/app/(authenticated)/campaigns/new/page.tsx`:

- 'use client' directive
- Import CampaignBuilder from '@/components/campaigns'
- Import useCreateCampaign, useLaunchCampaign from '@/hooks/use-campaigns'
- Import useRouter from 'next/navigation'
- Import toast from sonner (or the project's toast utility)
- Import ArrowLeft from lucide-react, Button and Link components

Page structure:

- Header with back link to /campaigns and title "Create Campaign"
- CampaignBuilder component with onSave and onLaunch handlers:
  - onSave: calls createCampaign mutation, shows success toast, navigates to /campaigns/[newId]
  - onLaunch: calls createCampaign then launchCampaign mutations, shows success toast, navigates to /campaigns/[newId]

**Enhance Campaigns List Page (campaigns/page.tsx):**

Add a "Manage Forms" button next to "Create Campaign" in the header:

```tsx
<Button variant="outline" onClick={() => router.push("/forms")}>
  <FileInput className="mr-2 h-4 w-4" />
  Manage Forms
</Button>
```

Import FileInput from lucide-react.
</action>
<verify>
Run `cd apps/frontend && npx tsc --noEmit 2>&1 | head -30` to verify TypeScript compilation. Verify the new page file exists with `ls apps/frontend/src/app/(authenticated)/campaigns/new/page.tsx`.
</verify>
<done>Sidebar shows Campaigns and Forms entries. /campaigns/new page renders CampaignBuilder wizard with save/launch wired to API. Campaigns list page has "Manage Forms" button linking to /forms.</done>
</task>

</tasks>

<verification>
- Backend TypeScript compiles without errors
- Frontend TypeScript compiles without errors
- Navigation items array contains Campaigns and Forms entries
- /campaigns/new/page.tsx exists and imports CampaignBuilder
- campaigns.controller.ts has dashboard/stats, dashboard/overdue, dashboard/upcoming, and :id/remind routes
- Dashboard routes are placed BEFORE the :id route to avoid route matching conflicts
</verification>

<success_criteria>

1. GET /api/v1/campaigns/dashboard/stats returns dashboard statistics JSON
2. Campaigns and Forms appear in sidebar navigation between Policies and Projects
3. /campaigns/new page renders CampaignBuilder wizard
4. Campaigns list page includes "Manage Forms" link to /forms
   </success_criteria>

<output>
After completion, create `.planning/phases/17-campaigns-hub/17-01-SUMMARY.md`
</output>
