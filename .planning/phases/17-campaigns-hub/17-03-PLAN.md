---
phase: 17-campaigns-hub
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/src/app/(authenticated)/forms/page.tsx
  - apps/frontend/src/app/(authenticated)/forms/new/page.tsx
  - apps/frontend/src/app/(authenticated)/forms/[id]/page.tsx
  - apps/frontend/src/components/forms/forms-list.tsx
  - apps/frontend/src/hooks/use-forms.ts
  - apps/frontend/src/lib/forms-api.ts
autonomous: true

must_haves:
  truths:
    - "/forms page shows all form definitions grouped by type"
    - "Users can filter forms by type (Disclosure, Attestation, Survey, Intake, Custom)"
    - "Users can create a new form from /forms/new using the existing FormBuilder"
    - "Users can edit an existing form at /forms/:id using FormBuilder with initialData"
    - "Forms list shows form name, type, status (draft/published), version, and last updated"
  artifacts:
    - path: "apps/frontend/src/app/(authenticated)/forms/page.tsx"
      provides: "Forms hub page"
      contains: "FormsList"
    - path: "apps/frontend/src/app/(authenticated)/forms/new/page.tsx"
      provides: "New form creation page"
      contains: "FormBuilder"
    - path: "apps/frontend/src/app/(authenticated)/forms/[id]/page.tsx"
      provides: "Form edit page"
      contains: "FormBuilder"
    - path: "apps/frontend/src/components/forms/forms-list.tsx"
      provides: "Forms list component with type filtering"
      min_lines: 80
    - path: "apps/frontend/src/hooks/use-forms.ts"
      provides: "React Query hooks for form definitions"
      exports:
        [
          "useForms",
          "useForm",
          "useCreateForm",
          "useUpdateForm",
          "usePublishForm",
          "useCloneForm",
        ]
    - path: "apps/frontend/src/lib/forms-api.ts"
      provides: "Typed API client for form definitions"
      contains: "formsApi"
  key_links:
    - from: "apps/frontend/src/lib/forms-api.ts"
      to: "/api/v1/forms/definitions"
      via: "apiClient.get/post/patch"
      pattern: "forms/definitions"
    - from: "apps/frontend/src/app/(authenticated)/forms/new/page.tsx"
      to: "components/disclosures/form-builder/FormBuilder"
      via: "import"
      pattern: "FormBuilder"
---

<objective>
Create the Forms hub with list page, creation page, and edit page, backed by a new forms API client and React Query hooks.

Purpose: Users need a centralized place to view and manage all form definitions (disclosures, attestations, surveys, intake, custom). The FormBuilder component already exists in components/disclosures/form-builder/ -- we just need pages that wrap it and a data layer to fetch form definitions.

Output: /forms page with filterable list, /forms/new wrapping FormBuilder for creation, /forms/[id] wrapping FormBuilder for editing. Plus forms-api.ts and use-forms.ts data layer.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-campaigns-hub/17-RESEARCH.md
@apps/backend/src/modules/forms/forms.controller.ts
@apps/frontend/src/components/disclosures/form-builder/FormBuilder.tsx
@apps/frontend/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create forms API client and React Query hooks</name>
  <files>
apps/frontend/src/lib/forms-api.ts
apps/frontend/src/hooks/use-forms.ts
  </files>
  <action>
**forms-api.ts:**

Create `apps/frontend/src/lib/forms-api.ts`:

Import apiClient from './api'. Define types inline or reference existing FormType from Prisma:

```typescript
export interface FormDefinition {
  id: string;
  organizationId: string;
  name: string;
  description?: string;
  type: FormType;
  status: "DRAFT" | "PUBLISHED" | "ARCHIVED";
  version: number;
  schema?: any; // JSON schema
  createdAt: string;
  updatedAt: string;
  publishedAt?: string;
  createdById?: string;
}

export type FormType =
  | "INTAKE"
  | "DISCLOSURE"
  | "ATTESTATION"
  | "SURVEY"
  | "WORKFLOW_TASK"
  | "CUSTOM";

export interface FormListResponse {
  data: FormDefinition[];
  total: number;
}

export interface CreateFormDto {
  name: string;
  description?: string;
  type: FormType;
  schema?: any;
}

export interface UpdateFormDto {
  name?: string;
  description?: string;
  schema?: any;
}
```

API methods:

1. `list(params?: { type?: FormType; skip?: number; take?: number })` - GET `/forms/definitions` with query params. Returns FormListResponse.
2. `getById(id: string)` - GET `/forms/definitions/${id}`. Returns FormDefinition.
3. `create(dto: CreateFormDto)` - POST `/forms/definitions`. Returns FormDefinition.
4. `update(id: string, dto: UpdateFormDto)` - PATCH `/forms/definitions/${id}`. Returns FormDefinition.
5. `publish(id: string)` - POST `/forms/definitions/${id}/publish`. Returns FormDefinition.
6. `clone(id: string)` - POST `/forms/definitions/${id}/clone`. Returns FormDefinition.

**use-forms.ts:**

Create `apps/frontend/src/hooks/use-forms.ts`:

Query keys:

```typescript
export const formQueryKeys = {
  all: ["forms"] as const,
  lists: () => [...formQueryKeys.all, "list"] as const,
  list: (params?: any) => [...formQueryKeys.lists(), params] as const,
  details: () => [...formQueryKeys.all, "detail"] as const,
  detail: (id: string) => [...formQueryKeys.details(), id] as const,
};
```

Hooks:

1. `useForms(params?)` - useQuery fetching form list with 30s staleTime
2. `useForm(id: string)` - useQuery fetching single form, enabled only when id is truthy
3. `useCreateForm()` - useMutation, invalidates lists on success
4. `useUpdateForm()` - useMutation({ id, dto }), updates cache entry + invalidates lists
5. `usePublishForm()` - useMutation(id), invalidates detail + lists
6. `useCloneForm()` - useMutation(id), invalidates lists

Follow exact same patterns as use-campaigns.ts (query/mutation structure, cache invalidation, queryClient usage).
</action>
<verify>Run `cd apps/frontend && npx tsc --noEmit 2>&1 | head -20` to verify no type errors.</verify>
<done>forms-api.ts provides typed API client for all form CRUD operations. use-forms.ts provides React Query hooks with proper cache invalidation.</done>
</task>

<task type="auto">
  <name>Task 2: Create Forms hub page, new form page, and edit form page</name>
  <files>
apps/frontend/src/app/(authenticated)/forms/page.tsx
apps/frontend/src/app/(authenticated)/forms/new/page.tsx
apps/frontend/src/app/(authenticated)/forms/[id]/page.tsx
apps/frontend/src/components/forms/forms-list.tsx
  </files>
  <action>
**forms-list.tsx component:**

Create `apps/frontend/src/components/forms/forms-list.tsx`:

Props: `{ forms: FormDefinition[]; isLoading: boolean; onTypeFilter: (type?: FormType) => void; activeType?: FormType }`

Layout:

- Filter bar with type buttons/tabs: All, Disclosures, Attestations, Surveys, Intake, Custom (use Tabs or ToggleGroup from shadcn/ui)
- Table with columns: Name, Type (Badge), Status (Badge: DRAFT=gray, PUBLISHED=green, ARCHIVED=red), Version, Updated (formatted date)
- Each row clickable, navigates to /forms/[id]
- Empty state message when no forms found for selected type
- Status badges: PUBLISHED=green ("Published"), DRAFT=amber ("Draft"), ARCHIVED=gray ("Archived")
- Type labels: DISCLOSURE="Disclosure", ATTESTATION="Attestation", SURVEY="Survey", INTAKE="Intake Form", WORKFLOW_TASK="Workflow", CUSTOM="Custom"

**Forms hub page (/forms/page.tsx):**

Create `apps/frontend/src/app/(authenticated)/forms/page.tsx`:

- 'use client' directive
- Wrap in Suspense
- Header: "Forms" title with description "Manage form templates for campaigns and submissions"
- "Create Form" button (Plus icon) linking to /forms/new
- Quick links section with Cards for each RIU type hub (per success criteria 6):
  - Disclosures card -> /disclosures
  - Intake Forms card -> /intake-forms
    These are links to existing pages, NOT new pages. Use Card with title, description, and arrow icon.
- FormsList component below with useForms() data
- Type filter state in URL search params (using useSearchParams)

**New form page (/forms/new/page.tsx):**

Create `apps/frontend/src/app/(authenticated)/forms/new/page.tsx`:

- 'use client' directive
- Import FormBuilder from '@/components/disclosures/form-builder/FormBuilder'
- Import useCreateForm from '@/hooks/use-forms'
- Header with back link to /forms, title "Create Form"
- Type selector (Select component) to choose form type before entering builder
- FormBuilder component with onSave handler that:
  1. Calls createForm mutation with { name, type, schema }
  2. Shows success toast
  3. Navigates to /forms/[newId]

Note: Check the FormBuilder component's props interface. If it expects specific props for save/load, adapt accordingly. The FormBuilder is at `components/disclosures/form-builder/FormBuilder.tsx` and was built for disclosure forms but is generic. It may have its own internal save logic -- if so, provide the appropriate callbacks. If FormBuilder manages its own API calls (using apiClient directly), then the page just needs to mount it with the right context.

**Edit form page (/forms/[id]/page.tsx):**

Create `apps/frontend/src/app/(authenticated)/forms/[id]/page.tsx`:

- 'use client' directive
- Extract id from useParams()
- Use useForm(id) hook to load existing form definition
- Header with back link to /forms, title showing form name
- Action buttons: "Publish" (if DRAFT, using usePublishForm), "Clone" (using useCloneForm)
- FormBuilder component with initialData from loaded form definition (pass form.schema)
- Loading skeleton while fetching
- 404 handling if form not found

After creating FormBuilder pages, verify the FormBuilder import path works. The component is exported from `components/disclosures/form-builder/FormBuilder.tsx`. If it has a barrel export (index.ts), use that.
</action>
<verify>
Run `cd apps/frontend && npx tsc --noEmit 2>&1 | head -20`. Verify all pages exist:

- `ls apps/frontend/src/app/(authenticated)/forms/page.tsx`
- `ls apps/frontend/src/app/(authenticated)/forms/new/page.tsx`
- `ls apps/frontend/src/app/(authenticated)/forms/[id]/page.tsx`
- `ls apps/frontend/src/components/forms/forms-list.tsx`
  </verify>
  <done>/forms page shows all form definitions with type filters and quick links to disclosures/intake-forms. /forms/new renders FormBuilder with type selector. /forms/[id] loads existing form in FormBuilder with publish/clone actions.</done>
  </task>

</tasks>

<verification>
- Frontend TypeScript compiles without errors
- All 4 new files exist (3 pages + 1 component)
- forms-api.ts has typed methods for all form CRUD operations
- use-forms.ts has React Query hooks with proper cache management
- Forms list page filters by type
- FormBuilder is imported from existing disclosures location (not rebuilt)
- Quick links to /disclosures and /intake-forms present on forms page
</verification>

<success_criteria>

1. /forms page lists all form definitions with type filter tabs
2. /forms/new page renders FormBuilder with form type selector
3. /forms/:id page loads existing form into FormBuilder for editing
4. Publish and Clone actions work from form detail page
5. Quick links to existing Disclosures and Intake Forms pages present
6. Forms data layer (API client + hooks) follows same patterns as campaigns
   </success_criteria>

<output>
After completion, create `.planning/phases/17-campaigns-hub/17-03-SUMMARY.md`
</output>
