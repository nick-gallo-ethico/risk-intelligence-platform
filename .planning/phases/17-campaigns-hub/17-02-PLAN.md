---
phase: 17-campaigns-hub
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/src/components/campaigns/campaign-detail.tsx
  - apps/frontend/src/app/(authenticated)/campaigns/[id]/page.tsx
  - apps/frontend/src/lib/campaigns-api.ts
  - apps/frontend/src/hooks/use-campaigns.ts
autonomous: true

must_haves:
  truths:
    - "Navigating to /campaigns/:id shows campaign overview with stats, status, and type"
    - "Campaign detail page shows assignments list with status indicators"
    - "Users can launch/pause/resume/cancel campaigns from the detail page based on current status"
    - "Campaign completion rate is visible as a progress bar"
    - "Campaign detail page links back to campaigns list"
  artifacts:
    - path: "apps/frontend/src/components/campaigns/campaign-detail.tsx"
      provides: "Campaign detail view component"
      min_lines: 150
    - path: "apps/frontend/src/app/(authenticated)/campaigns/[id]/page.tsx"
      provides: "Campaign detail route page"
      contains: "CampaignDetail"
  key_links:
    - from: "apps/frontend/src/app/(authenticated)/campaigns/[id]/page.tsx"
      to: "/api/v1/campaigns/:id"
      via: "useCampaign hook"
      pattern: "useCampaign"
    - from: "apps/frontend/src/components/campaigns/campaign-detail.tsx"
      to: "useLaunchCampaign|usePauseCampaign|useResumeCampaign|useCancelCampaign"
      via: "mutation hooks"
      pattern: "useLaunchCampaign|usePauseCampaign"
---

<objective>
Create the campaign detail page at /campaigns/[id] with a tabbed layout showing overview, assignments, and settings.

Purpose: Users need to view campaign progress, manage lifecycle (launch/pause/resume/cancel), and see assignment breakdown. This is the primary management view for individual campaigns.

Output: A campaign-detail.tsx component and a /campaigns/[id]/page.tsx route that compose existing hooks and UI primitives.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-campaigns-hub/17-RESEARCH.md
@apps/frontend/src/hooks/use-campaigns.ts
@apps/frontend/src/lib/campaigns-api.ts
@apps/frontend/src/types/campaign.ts
@apps/frontend/src/components/campaigns/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend campaigns API client and hooks for assignments and dashboard detail</name>
  <files>
apps/frontend/src/lib/campaigns-api.ts
apps/frontend/src/hooks/use-campaigns.ts
  </files>
  <action>
**campaigns-api.ts additions:**

Add these methods to the campaignsApi object:

1. `getAssignments` - GET `/campaigns/${id}/assignments` with optional status, skip, take params. Returns `{ data: CampaignAssignment[]; total: number }`.

2. `getOverdueCampaigns` - GET `/campaigns/dashboard/overdue` with optional limit. Returns `CampaignSummary[]`.

3. `getUpcomingDeadlines` - GET `/campaigns/dashboard/upcoming` with optional days and limit. Returns `CampaignSummary[]`.

4. `sendReminders` - POST `/campaigns/${id}/remind`. Returns void.

Add these types to `types/campaign.ts` (or inline in campaigns-api.ts):

```typescript
export interface CampaignAssignment {
  id: string;
  campaignId: string;
  employeeId: string;
  status: string;
  assignedAt: string;
  completedAt?: string;
  employeeSnapshot?: {
    firstName?: string;
    lastName?: string;
    email?: string;
    department?: string;
    location?: string;
  };
}

export interface CampaignSummary {
  id: string;
  name: string;
  type: string;
  status: string;
  dueDate: string;
  totalAssignments: number;
  completedAssignments: number;
  overdueAssignments: number;
  completionPercentage: number;
  launchedAt?: string;
}
```

**use-campaigns.ts additions:**

Add query key entries:

```typescript
assignments: (id: string) => [...campaignQueryKeys.all, 'assignments', id] as const,
overdue: () => [...campaignQueryKeys.all, 'overdue'] as const,
upcoming: () => [...campaignQueryKeys.all, 'upcoming'] as const,
```

Add hooks:

1. `useCampaignAssignments(id: string, params?)` - fetches assignments for a campaign
2. `useOverdueCampaigns()` - fetches overdue campaigns
3. `useUpcomingDeadlines()` - fetches upcoming deadlines
4. `useSendReminders()` - mutation to send campaign reminders, invalidates detail + stats on success
   </action>
   <verify>Run `cd apps/frontend && npx tsc --noEmit 2>&1 | head -20` to verify no type errors.</verify>
   <done>API client has getAssignments, getOverdueCampaigns, getUpcomingDeadlines, sendReminders methods. Hooks exist for all four operations.</done>
   </task>

<task type="auto">
  <name>Task 2: Create campaign-detail component and /campaigns/[id] page</name>
  <files>
apps/frontend/src/components/campaigns/campaign-detail.tsx
apps/frontend/src/app/(authenticated)/campaigns/[id]/page.tsx
apps/frontend/src/components/campaigns/index.ts
  </files>
  <action>
**campaign-detail.tsx component:**

Create `apps/frontend/src/components/campaigns/campaign-detail.tsx`:

Props: `{ campaign: Campaign; isLoading?: boolean }`

Layout with shadcn/ui Tabs component (Overview, Assignments, Settings):

**Header section:**

- Back link to /campaigns
- Campaign name as h1
- Status Badge using CAMPAIGN_STATUS_COLORS from types/campaign.ts
- Type Badge using CAMPAIGN_TYPE_COLORS
- Action buttons (conditionally rendered based on campaign.status):
  - DRAFT: "Launch" button (primary) using useLaunchCampaign
  - ACTIVE: "Pause" button (warning), "Cancel" button (destructive) using usePauseCampaign, useCancelCampaign
  - PAUSED: "Resume" button (primary), "Cancel" button using useResumeCampaign, useCancelCampaign
  - SCHEDULED: "Cancel" button
  - COMPLETED/CANCELLED: No action buttons
- "Send Reminders" button for ACTIVE campaigns using useSendReminders

**Overview Tab:**

- Summary cards row (4 cards): Total Assignments, Completed, Overdue, Completion Rate (use Progress component from shadcn/ui)
- Campaign info section: Description, Due Date (formatted with date-fns), Start Date, Launched At, Created At
- Progress bar showing completionPercentage

**Assignments Tab:**

- Use useCampaignAssignments(campaign.id) to fetch assignments
- Table with columns: Employee Name, Email, Department, Status (with colored Badge), Assigned At, Completed At
- Use existing Table component pattern from shadcn/ui
- Status badges: COMPLETED=green, OVERDUE=red, IN_PROGRESS=blue, PENDING=gray, NOTIFIED=yellow, SKIPPED=purple

**Settings Tab:**

- Show campaign configuration in read-only mode for non-DRAFT campaigns
- For DRAFT campaigns, show "Edit Campaign" button linking to /campaigns/new?edit=true&id={campaign.id} (or inline editing if CampaignBuilder supports initialData prop -- it does! Pass initialData)
- Show: Type, Due Date, Description, Reminder config

Use toast (sonner) for success/error notifications on lifecycle actions. Show confirmation Dialog before Launch, Cancel operations.

**Page (/campaigns/[id]/page.tsx):**

Create `apps/frontend/src/app/(authenticated)/campaigns/[id]/page.tsx`:

- 'use client' directive
- Extract id from useParams()
- Use useCampaign(id) hook
- Handle loading state with skeleton
- Handle not found (campaign is null)
- Render CampaignDetail component with campaign data
- Wrap in Suspense

**Update index.ts:**

Add export for CampaignDetail in `components/campaigns/index.ts`:

```typescript
export { CampaignDetail } from "./campaign-detail";
```

  </action>
  <verify>
Run `cd apps/frontend && npx tsc --noEmit 2>&1 | head -20`. Verify files exist: `ls apps/frontend/src/app/(authenticated)/campaigns/[id]/page.tsx` and `ls apps/frontend/src/components/campaigns/campaign-detail.tsx`.
  </verify>
  <done>Campaign detail page renders at /campaigns/[id] with overview stats, assignments table, settings view, and lifecycle action buttons (launch/pause/resume/cancel/remind). All actions wired to API via mutation hooks.</done>
</task>

</tasks>

<verification>
- Frontend TypeScript compiles without errors
- /campaigns/[id]/page.tsx exists and uses useCampaign hook
- campaign-detail.tsx has Overview, Assignments, Settings tabs
- Lifecycle buttons conditionally render based on campaign status
- Assignments tab fetches and displays campaign assignments
- campaigns/index.ts exports CampaignDetail
</verification>

<success_criteria>

1. /campaigns/:id renders campaign overview with name, status, type, description
2. Overview tab shows assignment summary cards and completion progress bar
3. Assignments tab lists employees with status badges
4. Launch/Pause/Resume/Cancel buttons appear based on campaign status and trigger API calls
5. Send Reminders button available on active campaigns
   </success_criteria>

<output>
After completion, create `.planning/phases/17-campaigns-hub/17-02-SUMMARY.md`
</output>
