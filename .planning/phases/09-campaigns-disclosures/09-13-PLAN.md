---
phase: 09-campaigns-disclosures
plan: 13
type: execute
wave: 2
depends_on: ["09-06", "09-07", "09-08", "09-09", "09-10"]
files_modified:
  - apps/backend/src/modules/campaigns/campaign-enhanced.controller.ts
  - apps/backend/src/modules/campaigns/campaign-dashboard.service.ts
autonomous: true

must_haves:
  truths:
    - "Campaign CRUD includes scheduling, targeting, translations"
    - "Dashboard shows completion rates, overdue counts"
    - "Launch triggers assignment creation for audience"
  artifacts:
    - path: "apps/backend/src/modules/campaigns/campaign-enhanced.controller.ts"
      provides: "Enhanced campaign REST endpoints"
      exports: ["CampaignEnhancedController"]
    - path: "apps/backend/src/modules/campaigns/campaign-dashboard.service.ts"
      provides: "Dashboard statistics"
      exports: ["CampaignDashboardService"]
  key_links:
    - from: "apps/backend/src/modules/campaigns/campaign-enhanced.controller.ts"
      to: "apps/backend/src/modules/campaigns/campaigns.service.ts"
      via: "service injection"
      pattern: "constructor.*CampaignsService"
---

<objective>
Create enhanced campaign controller integrating all 9B services (targeting, scheduling, reminders, translations) and the campaign dashboard service per RS.55.

Purpose: Expose the complete campaign management API that ties together audience targeting, scheduled rollout, reminder sequences, and translations. This completes the Phase 9B Campaign Engine backend.

Output:
- CampaignEnhancedController with full campaign lifecycle endpoints
- CampaignDashboardService for completion tracking and statistics
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-campaigns-disclosures/09-CONTEXT.md
@.planning/phases/09-campaigns-disclosures/09-07-SUMMARY.md
@.planning/phases/09-campaigns-disclosures/09-08-SUMMARY.md
@.planning/phases/09-campaigns-disclosures/09-09-SUMMARY.md
@.planning/phases/09-campaigns-disclosures/09-10-SUMMARY.md

# Existing campaign service
@apps/backend/src/modules/campaigns/campaigns.service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CampaignDashboardService</name>
  <files>apps/backend/src/modules/campaigns/campaign-dashboard.service.ts</files>
  <action>
Create dashboard service per RS.55:

1. getDashboardStats(organizationId): DashboardStats
   - totalCampaigns, activeCampaigns, completedCampaigns
   - overallCompletionRate (from denormalized Campaign fields)
   - totalAssignments, completedAssignments, overdueAssignments
   - assignmentsByStatus breakdown

2. getOverdueCampaigns(organizationId, limit): CampaignSummary[]
   - Campaigns with overdueAssignments > 0
   - Sorted by overdue count desc

3. getUpcomingDeadlines(organizationId, days, limit): CampaignSummary[]
   - Active campaigns with deadline within N days

4. getWeeklyCompletionTrend(organizationId, weeks): WeeklyCompletion[]
   - Completions by week for trend chart

5. getCampaignDetails(campaignId, organizationId): DetailedCampaignStats
   - Breakdown by department, location
   - Response time distribution
   - Non-responder list
   - Conflict summary

6. getNonResponderReport(organizationId): NonResponderReport
   - Repeat non-responders across all campaigns
   - Group by department/manager

Statistics leverage denormalized fields on Campaign model:
- totalAssignments, completedAssignments, overdueAssignments, completionPercentage
  </action>
  <verify>cd apps/backend && npx tsc --noEmit</verify>
  <done>CampaignDashboardService compiles with all dashboard statistics methods.</done>
</task>

<task type="auto">
  <name>Task 2: Create enhanced campaign controller</name>
  <files>apps/backend/src/modules/campaigns/campaign-enhanced.controller.ts</files>
  <action>
Create controller integrating all 9B services per spec API:

# Core CRUD (delegate to existing CampaignsService)
POST /api/v1/campaigns - Create campaign
GET /api/v1/campaigns - List campaigns
GET /api/v1/campaigns/:id - Get campaign details
PUT /api/v1/campaigns/:id - Update campaign (draft)

# Targeting (use CampaignTargetingService)
GET /api/v1/campaigns/:id/audience - Preview audience
POST /api/v1/campaigns/:id/audience/preview - Preview with criteria changes

# Scheduling (use CampaignSchedulingService)
POST /api/v1/campaigns/:id/schedule - Schedule for future launch
GET /api/v1/campaigns/:id/waves - Get wave configuration
POST /api/v1/campaigns/:id/launch - Launch immediately or first wave

# Progress (use CampaignDashboardService)
GET /api/v1/campaigns/:id/progress - Get completion stats
GET /api/v1/campaigns/:id/assignments - List assignments with status

# Reminders (use CampaignReminderService)
POST /api/v1/campaigns/:id/remind - Send reminders now
PUT /api/v1/campaigns/:id/reminders - Configure reminder sequence

# Translations (use CampaignTranslationService)
GET /api/v1/campaigns/:id/translations - Get translation status
POST /api/v1/campaigns/:id/translations - Create translation

# Dashboard
GET /api/v1/campaigns/dashboard - Overall dashboard stats
GET /api/v1/campaigns/overdue - Overdue campaigns list
GET /api/v1/campaigns/non-responders - Non-responder report

Roles: SYSTEM_ADMIN, COMPLIANCE_OFFICER for mutations, broader read access
  </action>
  <verify>cd apps/backend && npx tsc --noEmit</verify>
  <done>CampaignEnhancedController compiles with all campaign lifecycle endpoints.</done>
</task>

<task type="auto">
  <name>Task 3: Update CampaignsModule with all services</name>
  <files>apps/backend/src/modules/campaigns/campaigns.module.ts</files>
  <action>
Update CampaignsModule to include all 9B services:

Providers:
- CampaignsService (existing)
- CampaignTargetingService (09-07)
- CampaignSchedulingService (09-08)
- CampaignReminderService (09-09)
- CampaignTranslationService (09-10)
- CampaignDashboardService (09-13)
- CampaignSchedulingProcessor

Controllers:
- CampaignsController (existing, basic CRUD)
- CampaignEnhancedController (new, full lifecycle)

Exports:
- All services for use by other modules
  </action>
  <verify>cd apps/backend && npx tsc --noEmit</verify>
  <done>CampaignsModule includes all Phase 9B services and controllers.</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. Dashboard returns accurate completion stats
3. Campaign launch creates assignments
4. All 9B services accessible via controller
5. Module exports all services
</verification>

<success_criteria>
1. Full campaign lifecycle manageable via API
2. Dashboard shows real-time completion rates
3. Overdue and non-responder reports functional
4. All 9B services integrated
</success_criteria>

<output>
After completion, create `.planning/phases/09-campaigns-disclosures/09-13-SUMMARY.md`
</output>
