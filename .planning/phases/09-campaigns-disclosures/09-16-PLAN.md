---
phase: 09-campaigns-disclosures
plan: 16
type: execute
wave: 4
depends_on: ["09-06"]
files_modified:
  - apps/frontend/src/components/disclosures/DisclosureForm.tsx
  - apps/frontend/src/components/disclosures/DraftIndicator.tsx
  - apps/frontend/src/pages/employee/disclosures/[id].tsx
autonomous: true

must_haves:
  truths:
    - "Employees can complete multi-step disclosure forms"
    - "Draft saves automatically and can be resumed"
    - "Form validates before final submission"
  artifacts:
    - path: "apps/frontend/src/components/disclosures/DisclosureForm.tsx"
      provides: "Multi-step disclosure form wizard"
      exports: ["DisclosureForm"]
    - path: "apps/frontend/src/components/disclosures/DraftIndicator.tsx"
      provides: "Auto-save status indicator"
      exports: ["DraftIndicator"]
  key_links:
    - from: "apps/frontend/src/components/disclosures/DisclosureForm.tsx"
      to: "/api/v1/disclosures"
      via: "API calls"
      pattern: "fetch.*disclosures"
---

<objective>
Create the disclosure submission UI for employees per RS.24 - multi-step form completion with draft save/resume and attachment upload.

Purpose: Enable employees to complete disclosure forms from their assigned campaigns with automatic draft saving to prevent data loss. This is the 09-D3 work item from the spec.

Output:
- DisclosureForm multi-step wizard component
- DraftIndicator showing auto-save status
- Employee disclosure page
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-campaigns-disclosures/09-CONTEXT.md
@.planning/phases/09-campaigns-disclosures/09-06-SUMMARY.md

# Form rendering patterns
@apps/frontend/src/components/forms
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DisclosureForm wizard</name>
  <files>apps/frontend/src/components/disclosures/DisclosureForm.tsx</files>
  <action>
Create multi-step disclosure form:

Props:
- formTemplate: FormTemplate (defines fields, sections)
- assignmentId?: string (if from campaign)
- draftData?: Record<string, unknown> (resume from draft)
- onSubmit: (data) => Promise<void>
- onSaveDraft: (data) => Promise<void>

Structure:
- Render sections as steps
- Each section is a wizard step
- Progress indicator at top

Field rendering:
- Map field types to appropriate inputs
- Support compliance field types (Relationship Mapper, etc.)
- Conditional field visibility based on rules
- Validation per field and cross-field

Repeater sections:
- Add/remove items dynamically
- Show item count
- Collapse/expand items
- Nested repeaters supported

Auto-save:
- Save draft on step navigation
- Save draft every 30 seconds if dirty
- Show DraftIndicator status

Final step:
- Review all entered data
- Attestation checkbox
- Submit button

Form state with react-hook-form + Ajv validation.
  </action>
  <verify>cd apps/frontend && npx tsc --noEmit</verify>
  <done>DisclosureForm compiles with multi-step wizard, field rendering, and auto-save.</done>
</task>

<task type="auto">
  <name>Task 2: Create DraftIndicator and attachment upload</name>
  <files>apps/frontend/src/components/disclosures/DraftIndicator.tsx</files>
  <action>
DraftIndicator component:
- Shows: "Saved just now", "Saving...", "All changes saved", "Unsaved changes"
- Small indicator, non-intrusive
- Updates on save events

Attachment upload component (use existing upload patterns):
- Drag-and-drop zone
- File type validation
- Progress indicator
- Preview for images
- Link to specific form fields
- Upload to /api/v1/attachments endpoint

Evidence chain display:
- Show upload timestamp
- Show original filename
- Show hash (truncated)
- Version indicator if replaced
  </action>
  <verify>cd apps/frontend && npx tsc --noEmit</verify>
  <done>DraftIndicator and attachment handling compile.</done>
</task>

<task type="auto">
  <name>Task 3: Create employee disclosure page</name>
  <files>apps/frontend/src/pages/employee/disclosures/[id].tsx</files>
  <action>
Employee disclosure page:

Route: /employee/disclosures/[assignmentId]

Page flow:
1. Load assignment and form template
2. Check for existing draft
3. Resume from draft if exists
4. Render DisclosureForm component

Header shows:
- Campaign name
- Deadline (with countdown)
- Progress (X of Y sections completed)

On submit:
- POST /api/v1/disclosures/:id/submit
- Show success message with any conflict alerts
- Redirect to employee dashboard

Error handling:
- Form validation errors inline
- API errors in toast
- Network errors with retry option

Mobile responsive:
- Single column on mobile
- Full width inputs
- Touch-friendly controls
  </action>
  <verify>cd apps/frontend && npx tsc --noEmit</verify>
  <done>Employee disclosure page compiles with full submission flow.</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. Form renders correctly from template
3. Draft saves and resumes work
4. Validation prevents invalid submission
5. Attachments upload successfully
</verification>

<success_criteria>
1. Multi-step wizard navigates smoothly
2. Auto-save prevents data loss
3. Resume from draft loads previous data
4. Attestation required for submit
5. Mobile-friendly layout
</success_criteria>

<output>
After completion, create `.planning/phases/09-campaigns-disclosures/09-16-SUMMARY.md`
</output>
