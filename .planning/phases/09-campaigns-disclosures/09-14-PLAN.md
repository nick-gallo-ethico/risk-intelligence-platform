---
phase: 09-campaigns-disclosures
plan: 14
type: execute
wave: 4
depends_on: ["09-02"]
files_modified:
  - apps/frontend/src/components/disclosures/form-builder/FormBuilder.tsx
  - apps/frontend/src/components/disclosures/form-builder/FieldPalette.tsx
  - apps/frontend/src/components/disclosures/form-builder/FormPreview.tsx
  - apps/frontend/src/pages/disclosures/form-builder.tsx
autonomous: true

must_haves:
  truths:
    - "Compliance officers can visually design disclosure forms"
    - "All compliance field types available in palette"
    - "Live preview shows form as employee will see it"
  artifacts:
    - path: "apps/frontend/src/components/disclosures/form-builder/FormBuilder.tsx"
      provides: "Visual form designer"
      exports: ["FormBuilder"]
    - path: "apps/frontend/src/components/disclosures/form-builder/FieldPalette.tsx"
      provides: "Draggable field type palette"
      exports: ["FieldPalette"]
    - path: "apps/frontend/src/components/disclosures/form-builder/FormPreview.tsx"
      provides: "Live form preview"
      exports: ["FormPreview"]
  key_links:
    - from: "apps/frontend/src/components/disclosures/form-builder/FormBuilder.tsx"
      to: "/api/v1/disclosure-forms"
      via: "API calls"
      pattern: "fetch.*disclosure-forms"
---

<objective>
Create the visual form builder UI per RS.22-RS.31 - drag-and-drop field placement, configuration panels, and live preview mode.

Purpose: Enable compliance officers to create disclosure form templates without technical knowledge using an intuitive visual builder. This is the 09-D1 work item from the spec.

Output:
- FormBuilder component with drag-and-drop sections
- FieldPalette with all compliance field types
- FormPreview showing live form rendering
- Form builder page
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-campaigns-disclosures/09-CONTEXT.md
@.planning/phases/09-campaigns-disclosures/09-02-SUMMARY.md

# UI patterns
@apps/frontend/src/components/ui
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FieldPalette component</name>
  <files>apps/frontend/src/components/disclosures/form-builder/FieldPalette.tsx</files>
  <action>
Create draggable field palette with all compliance field types:

Groups:
- Basic: Text, Textarea, Number, Date, Dropdown, Multi-select, Checkbox, Radio
- Compliance: Relationship Mapper, Dollar Threshold, Recurring Date, Entity Lookup, Signature
- Advanced: File Upload, Calculated Field

Each field type shows:
- Icon
- Name
- Brief description on hover

Use @dnd-kit/core for drag functionality.
Fields drag from palette to FormBuilder canvas.

Include search/filter for field types.
  </action>
  <verify>cd apps/frontend && npx tsc --noEmit</verify>
  <done>FieldPalette compiles with all compliance field types organized by group.</done>
</task>

<task type="auto">
  <name>Task 2: Create FormBuilder canvas component</name>
  <files>apps/frontend/src/components/disclosures/form-builder/FormBuilder.tsx</files>
  <action>
Create main form builder with sections and fields:

Layout:
- Left: FieldPalette (collapsible)
- Center: Form canvas with sections
- Right: Field configuration panel (when field selected)

Canvas features:
- Sections as containers (add, rename, delete, reorder)
- Fields drop into sections
- Drag to reorder fields within/between sections
- Click field to select and configure

Field configuration panel:
- Label, description, placeholder
- Required toggle
- Validation rules (min, max, pattern)
- Conditional logic builder
- Type-specific settings (dropdown options, etc.)

Section configuration:
- Repeater toggle
- Min/max items
- Nested repeater config (max 2 levels)

State management with useReducer for complex form state.
Auto-save draft every 30 seconds.
  </action>
  <verify>cd apps/frontend && npx tsc --noEmit</verify>
  <done>FormBuilder compiles with drag-drop sections, field configuration, and auto-save.</done>
</task>

<task type="auto">
  <name>Task 3: Create FormPreview and builder page</name>
  <files>
apps/frontend/src/components/disclosures/form-builder/FormPreview.tsx
apps/frontend/src/pages/disclosures/form-builder.tsx
  </files>
  <action>
FormPreview component:
- Render form as employee will see it
- Use same form rendering logic as submission UI
- Toggle between preview and builder modes
- Responsive preview (desktop/tablet/mobile)

form-builder.tsx page:
- Route: /disclosures/forms/builder?id=xxx or /disclosures/forms/new
- Load existing template if ID provided
- Create new if no ID
- Header with: Template name (editable), Save draft, Preview toggle, Publish button
- Show version info if editing existing

API integration:
- GET /api/v1/disclosure-forms/:id - Load template
- POST /api/v1/disclosure-forms - Create new
- PUT /api/v1/disclosure-forms/:id - Update draft
- POST /api/v1/disclosure-forms/:id/publish - Publish

Publish confirmation dialog: "Publishing will make this form available for campaigns. Are you sure?"
  </action>
  <verify>cd apps/frontend && npx tsc --noEmit</verify>
  <done>FormPreview and form-builder page compile with full builder workflow.</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. Fields drag from palette to canvas
3. Field configuration panel updates selected field
4. Preview shows accurate form rendering
5. Save and publish work via API
</verification>

<success_criteria>
1. All compliance field types in palette
2. Drag-drop reordering works
3. Nested repeaters configurable (max 2 levels)
4. Auto-save prevents data loss
5. Publish creates immutable version
</success_criteria>

<output>
After completion, create `.planning/phases/09-campaigns-disclosures/09-14-SUMMARY.md`
</output>
