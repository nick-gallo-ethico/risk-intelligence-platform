---
phase: 09-campaigns-disclosures
plan: 05
type: execute
wave: 1
depends_on: ["09-04"]
files_modified:
  - apps/backend/src/modules/disclosures/conflict.controller.ts
  - apps/backend/src/modules/disclosures/disclosures.module.ts
autonomous: true

must_haves:
  truths:
    - "Conflicts can be listed with filtering by status, type, severity"
    - "Individual conflicts can be dismissed with category and reason"
    - "Entity timeline shows all historical activity"
  artifacts:
    - path: "apps/backend/src/modules/disclosures/conflict.controller.ts"
      provides: "REST endpoints for conflicts"
      exports: ["ConflictController"]
  key_links:
    - from: "apps/backend/src/modules/disclosures/conflict.controller.ts"
      to: "apps/backend/src/modules/disclosures/conflict-detection.service.ts"
      via: "DI injection"
      pattern: "constructor.*ConflictDetectionService"
---

<objective>
Create the conflict surfacing and dismissal API endpoints per RS.42-RS.43 and RS.49 entity timeline.

Purpose: Enable compliance reviewers to view detected conflicts, dismiss false positives with categorization, manage the exclusion list, and view entity history timelines. This is the 09-A5 work item from the spec.

Output:
- ConflictController with REST endpoints for conflict management
- Module registration updates
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-campaigns-disclosures/09-CONTEXT.md
@.planning/phases/09-campaigns-disclosures/09-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ConflictController with REST endpoints</name>
  <files>apps/backend/src/modules/disclosures/conflict.controller.ts</files>
  <action>
Create REST controller with endpoints matching spec section 10:
- GET /api/v1/conflicts - List conflicts with query filters (status, type, severity, search)
- GET /api/v1/conflicts/:id - Get single conflict with full context
- POST /api/v1/conflicts/:id/dismiss - Dismiss conflict with category, reason, optional exclusion
- POST /api/v1/conflicts/:id/escalate - Escalate to case (creates case, links conflict)
- GET /api/v1/conflicts/entity/:name - Entity timeline history
- POST /api/v1/conflicts/exclusions - Create exclusion rule directly
- GET /api/v1/conflicts/exclusions - List active exclusions
- DELETE /api/v1/conflicts/exclusions/:id - Deactivate exclusion

All endpoints require JwtAuthGuard and RolesGuard. Roles: SYSTEM_ADMIN, COMPLIANCE_OFFICER for mutations, INVESTIGATOR for read-only.
  </action>
  <verify>cd apps/backend && npx tsc --noEmit</verify>
  <done>ConflictController compiles with all REST endpoints for conflict management per spec API section.</done>
</task>

<task type="auto">
  <name>Task 2: Update DisclosuresModule with conflict providers</name>
  <files>apps/backend/src/modules/disclosures/disclosures.module.ts</files>
  <action>
Add ConflictDetectionService and ConflictController to DisclosuresModule:
- Import ConflictDetectionService as provider
- Add ConflictController to controllers array
- Export ConflictDetectionService for use by other modules (e.g., RIU submission flow)
  </action>
  <verify>cd apps/backend && npx tsc --noEmit</verify>
  <done>DisclosuresModule includes ConflictDetectionService and ConflictController.</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. All spec API endpoints implemented
3. Proper role guards on all endpoints
4. Module exports ConflictDetectionService
</verification>

<success_criteria>
1. GET /api/v1/conflicts returns paginated list with filters
2. POST /api/v1/conflicts/:id/dismiss creates exclusion when requested
3. GET /api/v1/conflicts/entity/:name returns timeline
4. Exclusion CRUD endpoints functional
</success_criteria>

<output>
After completion, create `.planning/phases/09-campaigns-disclosures/09-05-SUMMARY.md`
</output>
