---
phase: 13-hubspot-style-saved-views-system
plan: 10
type: execute
wave: 3
depends_on: ["13-02", "13-03"]
files_modified:
  - apps/frontend/src/components/views/BoardView.tsx
  - apps/frontend/src/components/views/BoardColumn.tsx
  - apps/frontend/src/components/views/BoardCard.tsx
  - apps/frontend/src/components/views/index.ts
autonomous: true

must_haves:
  truths:
    - "Board displays records as cards in vertical lanes grouped by status/stage"
    - "Cards are draggable between lanes using @dnd-kit"
    - "Dropping a card in a new lane updates the record's status"
    - "Cards show summary of key fields (name, owner, priority, date)"
    - "Filters and search apply to board view same as table view"
  artifacts:
    - path: "apps/frontend/src/components/views/BoardView.tsx"
      provides: "Kanban-style board with draggable lanes"
      contains: "DndContext"
    - path: "apps/frontend/src/components/views/BoardCard.tsx"
      provides: "Individual record card for board view"
      contains: "useDraggable"
  key_links:
    - from: "BoardView"
      to: "SavedViewContext"
      via: "useSavedViewContext"
      pattern: "boardGroupBy"
---

<objective>
Create the BoardView component as an alternative to table view with Kanban-style cards.

Purpose: Some users prefer a Kanban-style board for visualizing records by status or stage. Cards can be dragged between lanes to update status, providing a more visual workflow.

Output: BoardView with draggable cards, status lanes, and card summary display.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/hubspot-view-system-spec.md
@apps/frontend/src/components/views/SavedViewProvider.tsx
@apps/frontend/src/lib/views/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BoardCard component</name>
  <files>apps/frontend/src/components/views/BoardCard.tsx</files>
  <action>
Create a draggable board card:

```typescript
'use client';

import React from 'react';
import { useDraggable } from '@dnd-kit/core';
import { CSS } from '@dnd-kit/utilities';
import { GripVertical, Calendar, User } from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { BoardCardConfig } from '@/lib/views/types';
import { cn } from '@/lib/utils';
import { format } from 'date-fns';

interface BoardCardProps<T> {
  record: T;
  cardConfig: BoardCardConfig;
  onClick?: (record: T) => void;
  getRecordId: (record: T) => string;
}

export function BoardCard<T extends Record<string, unknown>>({
  record,
  cardConfig,
  onClick,
  getRecordId,
}: BoardCardProps<T>) {
  const id = getRecordId(record);

  const { attributes, listeners, setNodeRef, transform, isDragging } = useDraggable({
    id,
    data: { record },
  });

  const style = {
    transform: CSS.Translate.toString(transform),
  };

  const getValue = (field: string) => record[field];

  const title = getValue(cardConfig.titleField) as string;
  const subtitle = cardConfig.subtitleField
    ? (getValue(cardConfig.subtitleField) as string)
    : undefined;

  return (
    <Card
      ref={setNodeRef}
      style={style}
      className={cn(
        'cursor-grab active:cursor-grabbing transition-shadow hover:shadow-md',
        isDragging && 'opacity-50 shadow-lg ring-2 ring-primary'
      )}
      onClick={() => onClick?.(record)}
    >
      <CardHeader className="p-3 pb-2">
        <div className="flex items-start gap-2">
          {/* Drag handle */}
          <button
            className="mt-0.5 cursor-grab active:cursor-grabbing"
            {...attributes}
            {...listeners}
          >
            <GripVertical className="h-4 w-4 text-muted-foreground" />
          </button>

          <div className="flex-1 min-w-0">
            <CardTitle className="text-sm font-medium truncate">{title}</CardTitle>
            {subtitle && (
              <p className="text-xs text-muted-foreground truncate mt-0.5">
                {subtitle}
              </p>
            )}
          </div>

          {/* Priority badge if configured */}
          {cardConfig.priorityField && getValue(cardConfig.priorityField) && (
            <Badge
              variant="outline"
              className={cn(
                'text-xs',
                getPriorityColor(getValue(cardConfig.priorityField) as string)
              )}
            >
              {getValue(cardConfig.priorityField) as string}
            </Badge>
          )}
        </div>
      </CardHeader>

      <CardContent className="p-3 pt-0 space-y-2">
        {/* Additional fields */}
        {cardConfig.displayFields?.map((field) => {
          const value = getValue(field.key);
          if (!value) return null;

          return (
            <div key={field.key} className="flex items-center gap-2 text-xs">
              {field.icon && <field.icon className="h-3 w-3 text-muted-foreground" />}
              <span className="text-muted-foreground truncate">
                {formatValue(value, field.type)}
              </span>
            </div>
          );
        })}

        {/* Owner/assignee if configured */}
        {cardConfig.ownerField && getValue(cardConfig.ownerField) && (
          <div className="flex items-center gap-2 pt-1">
            <Avatar className="h-5 w-5">
              <AvatarImage src={getValue(`${cardConfig.ownerField}Avatar`) as string} />
              <AvatarFallback className="text-[10px]">
                {getInitials(getValue(cardConfig.ownerField) as string)}
              </AvatarFallback>
            </Avatar>
            <span className="text-xs text-muted-foreground truncate">
              {getValue(cardConfig.ownerField) as string}
            </span>
          </div>
        )}

        {/* Date if configured */}
        {cardConfig.dateField && getValue(cardConfig.dateField) && (
          <div className="flex items-center gap-2 text-xs text-muted-foreground">
            <Calendar className="h-3 w-3" />
            {format(new Date(getValue(cardConfig.dateField) as string), 'MMM d, yyyy')}
          </div>
        )}
      </CardContent>
    </Card>
  );
}

// Helper functions
function getPriorityColor(priority: string): string {
  const lower = priority.toLowerCase();
  if (lower === 'high' || lower === 'critical') return 'border-red-500 text-red-600';
  if (lower === 'medium') return 'border-yellow-500 text-yellow-600';
  if (lower === 'low') return 'border-green-500 text-green-600';
  return '';
}

function getInitials(name: string): string {
  return name
    .split(' ')
    .map((n) => n[0])
    .join('')
    .toUpperCase()
    .slice(0, 2);
}

function formatValue(value: unknown, type?: string): string {
  if (type === 'date' && value) {
    return format(new Date(value as string), 'MMM d');
  }
  return String(value);
}
```

  </action>
  <verify>npm run typecheck passes</verify>
  <done>BoardCard component with drag handle and summary fields</done>
</task>

<task type="auto">
  <name>Task 2: Create BoardColumn component</name>
  <files>apps/frontend/src/components/views/BoardColumn.tsx</files>
  <action>
Create a droppable board column/lane:

```typescript
'use client';

import React from 'react';
import { useDroppable } from '@dnd-kit/core';
import { SortableContext, verticalListSortingStrategy } from '@dnd-kit/sortable';
import { Badge } from '@/components/ui/badge';
import { ScrollArea } from '@/components/ui/scroll-area';
import { BoardCard } from './BoardCard';
import { BoardCardConfig, BoardColumnConfig } from '@/lib/views/types';
import { cn } from '@/lib/utils';

interface BoardColumnProps<T> {
  column: BoardColumnConfig;
  records: T[];
  cardConfig: BoardCardConfig;
  onCardClick?: (record: T) => void;
  getRecordId: (record: T) => string;
}

export function BoardColumn<T extends Record<string, unknown>>({
  column,
  records,
  cardConfig,
  onCardClick,
  getRecordId,
}: BoardColumnProps<T>) {
  const { setNodeRef, isOver } = useDroppable({
    id: column.id,
    data: { column },
  });

  const recordIds = records.map(getRecordId);

  return (
    <div
      className={cn(
        'flex flex-col min-w-[300px] max-w-[300px] bg-muted/30 rounded-lg border',
        isOver && 'ring-2 ring-primary ring-offset-2'
      )}
    >
      {/* Column header */}
      <div
        className="flex items-center justify-between p-3 border-b"
        style={{
          borderLeftColor: column.color,
          borderLeftWidth: column.color ? '4px' : undefined,
        }}
      >
        <div className="flex items-center gap-2">
          <span className="font-medium text-sm">{column.label}</span>
          <Badge variant="secondary" className="text-xs">
            {records.length}
          </Badge>
        </div>
      </div>

      {/* Cards container */}
      <ScrollArea className="flex-1 p-2">
        <div
          ref={setNodeRef}
          className={cn(
            'space-y-2 min-h-[100px]',
            records.length === 0 && 'flex items-center justify-center'
          )}
        >
          <SortableContext items={recordIds} strategy={verticalListSortingStrategy}>
            {records.length === 0 ? (
              <p className="text-xs text-muted-foreground">No records</p>
            ) : (
              records.map((record) => (
                <BoardCard
                  key={getRecordId(record)}
                  record={record}
                  cardConfig={cardConfig}
                  onClick={onCardClick}
                  getRecordId={getRecordId}
                />
              ))
            )}
          </SortableContext>
        </div>
      </ScrollArea>

      {/* Column footer with count */}
      <div className="p-2 border-t text-xs text-muted-foreground text-center">
        {records.length} {records.length === 1 ? 'record' : 'records'}
      </div>
    </div>
  );
}
```

  </action>
  <verify>npm run typecheck passes</verify>
  <done>BoardColumn with droppable area and card list</done>
</task>

<task type="auto">
  <name>Task 3: Create BoardView component</name>
  <files>apps/frontend/src/components/views/BoardView.tsx</files>
  <action>
Create the main BoardView component:

```typescript
'use client';

import React, { useMemo, useCallback } from 'react';
import {
  DndContext,
  DragOverlay,
  closestCorners,
  KeyboardSensor,
  PointerSensor,
  useSensor,
  useSensors,
  DragStartEvent,
  DragEndEvent,
  DragOverEvent,
} from '@dnd-kit/core';
import { useSavedViewContext } from '@/hooks/views/useSavedViewContext';
import { BoardColumn } from './BoardColumn';
import { BoardCard } from './BoardCard';
import { BoardColumnConfig } from '@/lib/views/types';
import { Skeleton } from '@/components/ui/skeleton';
import { ScrollArea, ScrollBar } from '@/components/ui/scroll-area';

interface BoardViewProps<T> {
  data: T[];
  isLoading?: boolean;
  onRecordClick?: (record: T) => void;
  onStatusChange?: (recordId: string, newStatus: string) => void;
  getRecordId: (record: T) => string;
  emptyMessage?: string;
}

export function BoardView<T extends Record<string, unknown>>({
  data,
  isLoading = false,
  onRecordClick,
  onStatusChange,
  getRecordId,
  emptyMessage = 'No records found',
}: BoardViewProps<T>) {
  const { config, boardGroupBy } = useSavedViewContext();

  const [activeRecord, setActiveRecord] = React.useState<T | null>(null);

  const sensors = useSensors(
    useSensor(PointerSensor, {
      activationConstraint: {
        distance: 8, // Require 8px drag before activating
      },
    }),
    useSensor(KeyboardSensor)
  );

  // Get board configuration
  const boardConfig = config.boardConfig;
  const cardConfig = boardConfig?.cardConfig;
  const columns = boardConfig?.columns || [];

  // Group records by the groupBy field
  const groupedRecords = useMemo(() => {
    const groupField = boardGroupBy || boardConfig?.defaultGroupBy;
    if (!groupField) return new Map<string, T[]>();

    const grouped = new Map<string, T[]>();

    // Initialize all columns with empty arrays
    columns.forEach((col) => {
      grouped.set(col.id, []);
    });

    // Group records
    data.forEach((record) => {
      const groupValue = record[groupField] as string;
      const existing = grouped.get(groupValue) || [];
      grouped.set(groupValue, [...existing, record]);
    });

    return grouped;
  }, [data, boardGroupBy, boardConfig?.defaultGroupBy, columns]);

  const handleDragStart = useCallback((event: DragStartEvent) => {
    const record = event.active.data.current?.record as T | undefined;
    if (record) {
      setActiveRecord(record);
    }
  }, []);

  const handleDragEnd = useCallback(
    (event: DragEndEvent) => {
      const { active, over } = event;
      setActiveRecord(null);

      if (!over) return;

      const recordId = active.id as string;
      const newStatus = over.id as string;

      // Check if dropped on a different column
      const record = data.find((r) => getRecordId(r) === recordId);
      const groupField = boardGroupBy || boardConfig?.defaultGroupBy;

      if (record && groupField) {
        const currentStatus = record[groupField] as string;
        if (currentStatus !== newStatus) {
          onStatusChange?.(recordId, newStatus);
        }
      }
    },
    [data, getRecordId, boardGroupBy, boardConfig?.defaultGroupBy, onStatusChange]
  );

  if (!boardConfig || !cardConfig) {
    return (
      <div className="flex items-center justify-center h-full">
        <p className="text-muted-foreground">
          Board view is not configured for this module.
        </p>
      </div>
    );
  }

  if (isLoading) {
    return (
      <div className="flex gap-4 p-4 overflow-x-auto">
        {columns.map((col) => (
          <div key={col.id} className="min-w-[300px] space-y-2">
            <Skeleton className="h-10 w-full rounded-lg" />
            <Skeleton className="h-32 w-full rounded-lg" />
            <Skeleton className="h-32 w-full rounded-lg" />
          </div>
        ))}
      </div>
    );
  }

  if (data.length === 0) {
    return (
      <div className="flex items-center justify-center h-full">
        <div className="text-center">
          <p className="text-muted-foreground">{emptyMessage}</p>
          <p className="text-sm text-muted-foreground mt-1">
            Try adjusting your filters or search criteria.
          </p>
        </div>
      </div>
    );
  }

  return (
    <DndContext
      sensors={sensors}
      collisionDetection={closestCorners}
      onDragStart={handleDragStart}
      onDragEnd={handleDragEnd}
    >
      <ScrollArea className="h-full">
        <div className="flex gap-4 p-4 min-h-full">
          {columns.map((column) => (
            <BoardColumn
              key={column.id}
              column={column}
              records={groupedRecords.get(column.id) || []}
              cardConfig={cardConfig}
              onCardClick={onRecordClick}
              getRecordId={getRecordId}
            />
          ))}
        </div>
        <ScrollBar orientation="horizontal" />
      </ScrollArea>

      {/* Drag overlay for smooth dragging */}
      <DragOverlay>
        {activeRecord && cardConfig && (
          <BoardCard
            record={activeRecord}
            cardConfig={cardConfig}
            getRecordId={getRecordId}
          />
        )}
      </DragOverlay>
    </DndContext>
  );
}
```

Update exports:

```typescript
// apps/frontend/src/components/views/index.ts - add these exports
export { BoardView } from "./BoardView";
export { BoardColumn } from "./BoardColumn";
export { BoardCard } from "./BoardCard";
```

  </action>
  <verify>npm run typecheck passes; npm run lint passes</verify>
  <done>BoardView with drag-and-drop between status lanes</done>
</task>

</tasks>

<verification>
```bash
cd apps/frontend
npm run typecheck
npm run lint
```
</verification>

<success_criteria>

- BoardView displays records as cards in vertical status lanes
- Cards show title, subtitle, priority badge, owner, and date
- Cards are draggable between lanes using @dnd-kit
- Dropping a card on a different lane triggers onStatusChange callback
- Columns show record count badge in header
- DragOverlay provides smooth visual feedback during drag
- Empty columns show "No records" placeholder
- Loading state shows skeleton columns
- Board respects the same filters as table view
  </success_criteria>

<output>
After completion, create `.planning/phases/13-hubspot-style-saved-views-system/13-10-SUMMARY.md`
</output>
