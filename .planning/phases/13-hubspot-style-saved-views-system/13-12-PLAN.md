---
phase: 13-hubspot-style-saved-views-system
plan: 12
type: execute
wave: 4
depends_on: ["13-11"]
files_modified:
  - apps/frontend/src/lib/views/configs/investigations.config.ts
  - apps/frontend/src/lib/views/configs/policies.config.ts
  - apps/frontend/src/app/(authenticated)/investigations/page.tsx
  - apps/frontend/src/app/(authenticated)/policies/page.tsx
  - apps/frontend/src/hooks/views/useInvestigationsView.ts
  - apps/frontend/src/hooks/views/usePoliciesView.ts
autonomous: true

must_haves:
  truths:
    - "Investigations page uses saved views system"
    - "Policies page uses saved views system"
    - "Each module has unique columns, filters, and bulk actions"
    - "Investigations board groups by investigation stage"
    - "Policies board groups by policy status"
  artifacts:
    - path: "apps/frontend/src/lib/views/configs/investigations.config.ts"
      provides: "ModuleViewConfig for Investigations"
      contains: "INVESTIGATIONS_VIEW_CONFIG"
    - path: "apps/frontend/src/lib/views/configs/policies.config.ts"
      provides: "ModuleViewConfig for Policies"
      contains: "POLICIES_VIEW_CONFIG"
  key_links:
    - from: "InvestigationsPage"
      to: "SavedViewProvider"
      via: "INVESTIGATIONS_VIEW_CONFIG"
      pattern: "moduleType: 'investigations'"
---

<objective>
Integrate saved views into Investigations and Policies modules.

Purpose: After Cases, Investigations and Policies are the next priority modules. Each needs its own view configuration with appropriate columns, filters, and board grouping.

Output: Investigations and Policies pages with full saved views functionality.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/hubspot-view-system-spec.md
@apps/frontend/src/lib/views/configs/cases.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Investigations view configuration</name>
  <files>apps/frontend/src/lib/views/configs/investigations.config.ts</files>
  <action>
Create the Investigations module view configuration:

```typescript
import {
  Calendar,
  User,
  FileText,
  AlertCircle,
  Clock,
  CheckCircle,
} from "lucide-react";
import {
  ModuleViewConfig,
  ColumnConfig,
  PropertyGroup,
  BulkAction,
} from "../types";

const INVESTIGATION_STAGES = [
  { value: "planning", label: "Planning", color: "#6366F1" },
  {
    value: "evidence_gathering",
    label: "Evidence Gathering",
    color: "#3B82F6",
  },
  { value: "interviews", label: "Interviews", color: "#8B5CF6" },
  { value: "analysis", label: "Analysis", color: "#F59E0B" },
  { value: "findings", label: "Findings", color: "#EC4899" },
  { value: "remediation", label: "Remediation", color: "#10B981" },
  { value: "closed", label: "Closed", color: "#6B7280" },
];

const INVESTIGATION_TYPES = [
  { value: "internal", label: "Internal Investigation" },
  { value: "external", label: "External Investigation" },
  { value: "regulatory", label: "Regulatory Investigation" },
  { value: "audit", label: "Audit Follow-up" },
];

const INVESTIGATION_OUTCOMES = [
  { value: "substantiated", label: "Substantiated" },
  { value: "unsubstantiated", label: "Unsubstantiated" },
  { value: "inconclusive", label: "Inconclusive" },
  { value: "pending", label: "Pending" },
];

const INVESTIGATIONS_COLUMNS: ColumnConfig[] = [
  {
    id: "investigationNumber",
    accessorKey: "investigationNumber",
    header: "Investigation #",
    type: "link",
    group: "core",
    sortable: true,
    filterable: true,
    quickFilterable: false,
    width: 140,
  },
  {
    id: "title",
    accessorKey: "title",
    header: "Title",
    type: "text",
    group: "core",
    sortable: true,
    filterable: true,
    quickFilterable: false,
    width: 250,
  },
  {
    id: "stage",
    accessorKey: "stage",
    header: "Stage",
    type: "select",
    group: "core",
    sortable: true,
    filterable: true,
    quickFilterable: true,
    options: INVESTIGATION_STAGES,
    width: 150,
  },
  {
    id: "type",
    accessorKey: "type",
    header: "Type",
    type: "select",
    group: "core",
    sortable: true,
    filterable: true,
    quickFilterable: true,
    options: INVESTIGATION_TYPES,
    width: 150,
  },
  {
    id: "outcome",
    accessorKey: "outcome",
    header: "Outcome",
    type: "select",
    group: "core",
    sortable: true,
    filterable: true,
    quickFilterable: true,
    options: INVESTIGATION_OUTCOMES,
    width: 130,
  },
  {
    id: "leadInvestigator",
    accessorKey: "leadInvestigator.name",
    header: "Lead Investigator",
    type: "user",
    group: "assignment",
    sortable: true,
    filterable: true,
    quickFilterable: true,
    options: [],
    width: 150,
  },
  {
    id: "caseNumber",
    accessorKey: "case.caseNumber",
    header: "Related Case",
    type: "link",
    group: "associations",
    sortable: true,
    filterable: true,
    quickFilterable: false,
    width: 120,
  },
  {
    id: "startedAt",
    accessorKey: "startedAt",
    header: "Start Date",
    type: "date",
    group: "dates",
    sortable: true,
    filterable: true,
    quickFilterable: true,
    width: 120,
  },
  {
    id: "targetEndDate",
    accessorKey: "targetEndDate",
    header: "Target End Date",
    type: "date",
    group: "dates",
    sortable: true,
    filterable: true,
    quickFilterable: false,
    width: 130,
  },
  {
    id: "completedAt",
    accessorKey: "completedAt",
    header: "Completed Date",
    type: "date",
    group: "dates",
    sortable: true,
    filterable: true,
    quickFilterable: false,
    width: 130,
  },
  {
    id: "interviewCount",
    accessorKey: "interviewCount",
    header: "Interviews",
    type: "number",
    group: "progress",
    sortable: true,
    filterable: false,
    quickFilterable: false,
    width: 100,
  },
  {
    id: "checklistProgress",
    accessorKey: "checklistProgress",
    header: "Checklist %",
    type: "number",
    group: "progress",
    sortable: true,
    filterable: false,
    quickFilterable: false,
    width: 100,
  },
];

const INVESTIGATIONS_PROPERTY_GROUPS: PropertyGroup[] = [
  { id: "core", label: "Core Fields" },
  { id: "assignment", label: "Assignment" },
  { id: "associations", label: "Associations" },
  { id: "dates", label: "Dates" },
  { id: "progress", label: "Progress" },
];

const INVESTIGATIONS_BULK_ACTIONS: BulkAction[] = [
  {
    id: "assign",
    label: "Assign",
    children: [],
  },
  {
    id: "stage",
    label: "Change Stage",
    children: INVESTIGATION_STAGES.map((s) => ({
      id: `stage-${s.value}`,
      label: s.label,
    })),
  },
  {
    id: "merge",
    label: "Merge",
  },
  {
    id: "export",
    label: "Export Selected",
  },
  {
    id: "delete",
    label: "Delete",
    destructive: true,
  },
];

export const INVESTIGATIONS_VIEW_CONFIG: ModuleViewConfig = {
  moduleType: "investigations",
  entityName: {
    singular: "Investigation",
    plural: "Investigations",
  },
  columns: INVESTIGATIONS_COLUMNS,
  propertyGroups: INVESTIGATIONS_PROPERTY_GROUPS,
  defaultColumns: [
    "investigationNumber",
    "title",
    "stage",
    "type",
    "leadInvestigator",
    "startedAt",
  ],
  defaultQuickFilters: ["stage", "type", "leadInvestigator", "startedAt"],
  bulkActions: INVESTIGATIONS_BULK_ACTIONS,
  defaultViews: [
    {
      name: "All Investigations",
      columns: [
        "investigationNumber",
        "title",
        "stage",
        "type",
        "outcome",
        "leadInvestigator",
        "startedAt",
      ],
      filters: [],
      sort: { column: "startedAt", direction: "desc" as const },
    },
    {
      name: "My Investigations",
      columns: [
        "investigationNumber",
        "title",
        "stage",
        "targetEndDate",
        "checklistProgress",
      ],
      filters: [
        {
          id: "my-investigations",
          conditions: [
            {
              id: "1",
              propertyId: "leadInvestigator",
              operator: "is" as const,
              value: "{{currentUserId}}",
            },
          ],
        },
      ],
      sort: { column: "targetEndDate", direction: "asc" as const },
    },
    {
      name: "Active Investigations",
      columns: [
        "investigationNumber",
        "title",
        "stage",
        "leadInvestigator",
        "targetEndDate",
      ],
      filters: [
        {
          id: "active",
          conditions: [
            {
              id: "1",
              propertyId: "stage",
              operator: "is_none_of" as const,
              value: ["closed"],
            },
          ],
        },
      ],
      sort: { column: "stage", direction: "asc" as const },
    },
  ],
  endpoints: {
    list: "/api/investigations",
    export: "/api/investigations/export",
    bulk: "/api/investigations/bulk",
  },
  boardConfig: {
    defaultGroupBy: "stage",
    columns: INVESTIGATION_STAGES.map((s) => ({
      id: s.value,
      label: s.label,
      color: s.color,
    })),
    cardConfig: {
      titleField: "title",
      subtitleField: "investigationNumber",
      ownerField: "leadInvestigator.name",
      dateField: "startedAt",
      displayFields: [
        { key: "type", type: "text", icon: FileText },
        { key: "caseNumber", type: "link", icon: AlertCircle },
      ],
    },
  },
};
```

  </action>
  <verify>npm run typecheck passes</verify>
  <done>Investigations view configuration complete</done>
</task>

<task type="auto">
  <name>Task 2: Create Policies view configuration</name>
  <files>apps/frontend/src/lib/views/configs/policies.config.ts</files>
  <action>
Create the Policies module view configuration:

```typescript
import { FileText, User, Calendar, Globe, Eye, Shield } from "lucide-react";
import {
  ModuleViewConfig,
  ColumnConfig,
  PropertyGroup,
  BulkAction,
} from "../types";

const POLICY_STATUSES = [
  { value: "draft", label: "Draft", color: "#6B7280" },
  { value: "pending_review", label: "Pending Review", color: "#F59E0B" },
  { value: "pending_approval", label: "Pending Approval", color: "#8B5CF6" },
  { value: "approved", label: "Approved", color: "#3B82F6" },
  { value: "published", label: "Published", color: "#10B981" },
  { value: "archived", label: "Archived", color: "#9CA3AF" },
];

const POLICY_CATEGORIES = [
  { value: "code_of_conduct", label: "Code of Conduct" },
  { value: "anti_harassment", label: "Anti-Harassment" },
  { value: "data_privacy", label: "Data Privacy" },
  { value: "conflict_of_interest", label: "Conflict of Interest" },
  { value: "gifts_entertainment", label: "Gifts & Entertainment" },
  { value: "whistleblower", label: "Whistleblower" },
  { value: "information_security", label: "Information Security" },
  { value: "hr", label: "HR Policy" },
];

const POLICIES_COLUMNS: ColumnConfig[] = [
  {
    id: "policyNumber",
    accessorKey: "policyNumber",
    header: "Policy #",
    type: "link",
    group: "core",
    sortable: true,
    filterable: true,
    quickFilterable: false,
    width: 120,
  },
  {
    id: "title",
    accessorKey: "title",
    header: "Title",
    type: "text",
    group: "core",
    sortable: true,
    filterable: true,
    quickFilterable: false,
    width: 300,
  },
  {
    id: "status",
    accessorKey: "status",
    header: "Status",
    type: "select",
    group: "core",
    sortable: true,
    filterable: true,
    quickFilterable: true,
    options: POLICY_STATUSES,
    width: 140,
  },
  {
    id: "category",
    accessorKey: "category",
    header: "Category",
    type: "select",
    group: "core",
    sortable: true,
    filterable: true,
    quickFilterable: true,
    options: POLICY_CATEGORIES,
    width: 160,
  },
  {
    id: "version",
    accessorKey: "version",
    header: "Version",
    type: "text",
    group: "core",
    sortable: true,
    filterable: false,
    quickFilterable: false,
    width: 80,
  },
  {
    id: "owner",
    accessorKey: "owner.name",
    header: "Owner",
    type: "user",
    group: "ownership",
    sortable: true,
    filterable: true,
    quickFilterable: true,
    options: [],
    width: 150,
  },
  {
    id: "department",
    accessorKey: "department.name",
    header: "Department",
    type: "select",
    group: "ownership",
    sortable: true,
    filterable: true,
    quickFilterable: false,
    options: [],
    width: 150,
  },
  {
    id: "effectiveDate",
    accessorKey: "effectiveDate",
    header: "Effective Date",
    type: "date",
    group: "dates",
    sortable: true,
    filterable: true,
    quickFilterable: true,
    width: 120,
  },
  {
    id: "lastReviewDate",
    accessorKey: "lastReviewDate",
    header: "Last Review",
    type: "date",
    group: "dates",
    sortable: true,
    filterable: true,
    quickFilterable: false,
    width: 120,
  },
  {
    id: "nextReviewDate",
    accessorKey: "nextReviewDate",
    header: "Next Review",
    type: "date",
    group: "dates",
    sortable: true,
    filterable: true,
    quickFilterable: true,
    width: 120,
  },
  {
    id: "publishedAt",
    accessorKey: "publishedAt",
    header: "Published Date",
    type: "datetime",
    group: "dates",
    sortable: true,
    filterable: true,
    quickFilterable: false,
    width: 150,
  },
  {
    id: "attestationRate",
    accessorKey: "attestationRate",
    header: "Attestation %",
    type: "number",
    group: "attestation",
    sortable: true,
    filterable: true,
    quickFilterable: false,
    width: 110,
  },
  {
    id: "totalAttestations",
    accessorKey: "totalAttestations",
    header: "Total Attestations",
    type: "number",
    group: "attestation",
    sortable: true,
    filterable: false,
    quickFilterable: false,
    width: 130,
  },
  {
    id: "translationsCount",
    accessorKey: "translationsCount",
    header: "Translations",
    type: "number",
    group: "content",
    sortable: true,
    filterable: false,
    quickFilterable: false,
    width: 100,
  },
];

const POLICIES_PROPERTY_GROUPS: PropertyGroup[] = [
  { id: "core", label: "Core Fields" },
  { id: "ownership", label: "Ownership" },
  { id: "dates", label: "Dates" },
  { id: "attestation", label: "Attestation" },
  { id: "content", label: "Content" },
];

const POLICIES_BULK_ACTIONS: BulkAction[] = [
  {
    id: "assign",
    label: "Assign Owner",
    children: [],
  },
  {
    id: "status",
    label: "Change Status",
    children: POLICY_STATUSES.map((s) => ({
      id: `status-${s.value}`,
      label: s.label,
    })),
  },
  {
    id: "publish",
    label: "Publish",
  },
  {
    id: "archive",
    label: "Archive",
  },
  {
    id: "export",
    label: "Export Selected",
  },
  {
    id: "delete",
    label: "Delete",
    destructive: true,
  },
];

export const POLICIES_VIEW_CONFIG: ModuleViewConfig = {
  moduleType: "policies",
  entityName: {
    singular: "Policy",
    plural: "Policies",
  },
  columns: POLICIES_COLUMNS,
  propertyGroups: POLICIES_PROPERTY_GROUPS,
  defaultColumns: [
    "policyNumber",
    "title",
    "status",
    "category",
    "owner",
    "effectiveDate",
  ],
  defaultQuickFilters: ["status", "category", "owner", "effectiveDate"],
  bulkActions: POLICIES_BULK_ACTIONS,
  defaultViews: [
    {
      name: "All Policies",
      columns: [
        "policyNumber",
        "title",
        "status",
        "category",
        "owner",
        "effectiveDate",
        "version",
      ],
      filters: [],
      sort: { column: "title", direction: "asc" as const },
    },
    {
      name: "Published Policies",
      columns: [
        "policyNumber",
        "title",
        "category",
        "owner",
        "publishedAt",
        "attestationRate",
      ],
      filters: [
        {
          id: "published",
          conditions: [
            {
              id: "1",
              propertyId: "status",
              operator: "is" as const,
              value: "published",
            },
          ],
        },
      ],
      sort: { column: "publishedAt", direction: "desc" as const },
    },
    {
      name: "Review Needed",
      columns: [
        "policyNumber",
        "title",
        "category",
        "owner",
        "nextReviewDate",
        "lastReviewDate",
      ],
      filters: [
        {
          id: "review-needed",
          conditions: [
            {
              id: "1",
              propertyId: "nextReviewDate",
              operator: "is_less_than_n_ago" as const,
              value: 30,
              unit: "day" as const,
            },
          ],
        },
      ],
      sort: { column: "nextReviewDate", direction: "asc" as const },
    },
    {
      name: "Drafts",
      columns: [
        "policyNumber",
        "title",
        "category",
        "owner",
        "createdAt",
        "updatedAt",
      ],
      filters: [
        {
          id: "drafts",
          conditions: [
            {
              id: "1",
              propertyId: "status",
              operator: "is" as const,
              value: "draft",
            },
          ],
        },
      ],
      sort: { column: "updatedAt", direction: "desc" as const },
    },
  ],
  endpoints: {
    list: "/api/policies",
    export: "/api/policies/export",
    bulk: "/api/policies/bulk",
  },
  boardConfig: {
    defaultGroupBy: "status",
    columns: POLICY_STATUSES.map((s) => ({
      id: s.value,
      label: s.label,
      color: s.color,
    })),
    cardConfig: {
      titleField: "title",
      subtitleField: "policyNumber",
      ownerField: "owner.name",
      dateField: "effectiveDate",
      displayFields: [
        { key: "category", type: "text", icon: FileText },
        { key: "version", type: "text", icon: Shield },
      ],
    },
  },
};
```

  </action>
  <verify>npm run typecheck passes</verify>
  <done>Policies view configuration complete</done>
</task>

<task type="auto">
  <name>Task 3: Update Investigations page</name>
  <files>apps/frontend/src/app/(authenticated)/investigations/page.tsx, apps/frontend/src/hooks/views/useInvestigationsView.ts</files>
  <action>
Create useInvestigationsView hook and update page (following Cases pattern):

```typescript
// apps/frontend/src/hooks/views/useInvestigationsView.ts
import { useMemo, useCallback } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { api } from "@/lib/api";
import { INVESTIGATIONS_VIEW_CONFIG } from "@/lib/views/configs/investigations.config";
import { useSavedViewContext } from "./useSavedViewContext";
import { toast } from "sonner";

export function useInvestigationsView() {
  const queryClient = useQueryClient();
  const { filters, quickFilters, searchQuery, sortBy, sortOrder } =
    useSavedViewContext();

  const queryParams = useMemo(() => {
    const params: Record<string, unknown> = {};
    if (searchQuery) params.search = searchQuery;
    if (sortBy) {
      params.sortBy = sortBy;
      params.sortOrder = sortOrder;
    }
    const allConditions = [
      ...filters.flatMap((g) => g.conditions),
      ...quickFilters.filter((qf) => qf.condition).map((qf) => qf.condition!),
    ];
    if (allConditions.length > 0) {
      params.filters = JSON.stringify(allConditions);
    }
    return params;
  }, [filters, quickFilters, searchQuery, sortBy, sortOrder]);

  const { data, isLoading, error, refetch } = useQuery({
    queryKey: ["investigations", queryParams],
    queryFn: async () => {
      const response = await api.get("/api/investigations", {
        params: queryParams,
      });
      return response.data;
    },
  });

  const stageMutation = useMutation({
    mutationFn: async ({ ids, stage }: { ids: string[]; stage: string }) => {
      await api.post("/api/investigations/bulk", {
        action: "stage",
        ids,
        data: { stage },
      });
    },
    onSuccess: () => {
      toast.success("Investigations updated");
      queryClient.invalidateQueries({ queryKey: ["investigations"] });
    },
  });

  const handleBulkAction = useCallback(
    (actionId: string, selectedIds: string[]) => {
      if (actionId === "export") {
        window.open(
          `/api/investigations/export?ids=${selectedIds.join(",")}`,
          "_blank",
        );
        return;
      }
      if (actionId.startsWith("stage-")) {
        const stage = actionId.replace("stage-", "");
        stageMutation.mutate({ ids: selectedIds, stage });
      }
    },
    [stageMutation],
  );

  const handleStageChange = useCallback(
    (id: string, newStage: string) => {
      stageMutation.mutate({ ids: [id], stage: newStage });
    },
    [stageMutation],
  );

  return {
    config: INVESTIGATIONS_VIEW_CONFIG,
    investigations: data?.data || [],
    totalRecords: data?.total || 0,
    isLoading,
    error,
    refetch,
    handleBulkAction,
    handleStageChange,
  };
}
```

```typescript
// apps/frontend/src/app/(authenticated)/investigations/page.tsx
'use client';

import React, { useState, useCallback } from 'react';
import { useRouter } from 'next/navigation';
import {
  SavedViewProvider,
  ViewTabsBar,
  ViewToolbar,
  QuickFiltersRow,
  ColumnSelectionModal,
  AdvancedFiltersPanel,
  DataTable,
  BoardView,
} from '@/components/views';
import { INVESTIGATIONS_VIEW_CONFIG } from '@/lib/views/configs/investigations.config';
import { useInvestigationsView } from '@/hooks/views/useInvestigationsView';
import { useSavedViewContext } from '@/hooks/views/useSavedViewContext';

function InvestigationsPageContent() {
  const router = useRouter();
  const { investigations, totalRecords, isLoading, handleBulkAction, handleStageChange } = useInvestigationsView();
  const { viewMode, filters, quickFilters } = useSavedViewContext();

  const [showFilters, setShowFilters] = useState(false);
  const [showColumnModal, setShowColumnModal] = useState(false);
  const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(25);

  const quickFilterCount = quickFilters.filter((qf) => qf.condition).length;
  const advancedFilterCount = filters.reduce((sum, g) => sum + g.conditions.length, 0);

  const handleRowClick = useCallback((record: (typeof investigations)[0]) => {
    router.push(`/investigations/${record.id}`);
  }, [router]);

  return (
    <div className="flex flex-col h-full">
      <ViewTabsBar />
      <ViewToolbar
        onEditColumnsClick={() => setShowColumnModal(true)}
        onFilterClick={() => setShowFilters(!showFilters)}
        filterCount={quickFilterCount + advancedFilterCount}
        showFilters={showFilters}
      />
      {showFilters && (
        <QuickFiltersRow
          onAdvancedFiltersClick={() => setShowAdvancedFilters(true)}
          advancedFilterCount={advancedFilterCount}
        />
      )}
      <div className="flex-1 min-h-0">
        {viewMode === 'table' ? (
          <DataTable
            data={investigations}
            isLoading={isLoading}
            totalRecords={totalRecords}
            currentPage={currentPage}
            pageSize={pageSize}
            onPageChange={setCurrentPage}
            onPageSizeChange={(size) => { setPageSize(size); setCurrentPage(1); }}
            onRowClick={handleRowClick}
            onBulkAction={handleBulkAction}
            getRowId={(row) => row.id}
            emptyMessage="No investigations match your current filters"
          />
        ) : (
          <BoardView
            data={investigations}
            isLoading={isLoading}
            onRecordClick={handleRowClick}
            onStatusChange={handleStageChange}
            getRecordId={(row) => row.id}
            emptyMessage="No investigations match your current filters"
          />
        )}
      </div>
      <ColumnSelectionModal open={showColumnModal} onOpenChange={setShowColumnModal} />
      <AdvancedFiltersPanel open={showAdvancedFilters} onOpenChange={setShowAdvancedFilters} />
    </div>
  );
}

export default function InvestigationsPage() {
  return (
    <SavedViewProvider moduleType="investigations" config={INVESTIGATIONS_VIEW_CONFIG}>
      <InvestigationsPageContent />
    </SavedViewProvider>
  );
}
```

  </action>
  <verify>npm run typecheck passes</verify>
  <done>Investigations page with saved views integration</done>
</task>

<task type="auto">
  <name>Task 4: Update Policies page</name>
  <files>apps/frontend/src/app/(authenticated)/policies/page.tsx, apps/frontend/src/hooks/views/usePoliciesView.ts</files>
  <action>
Create usePoliciesView hook and update page (following same pattern):

```typescript
// apps/frontend/src/hooks/views/usePoliciesView.ts
import { useMemo, useCallback } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { api } from "@/lib/api";
import { POLICIES_VIEW_CONFIG } from "@/lib/views/configs/policies.config";
import { useSavedViewContext } from "./useSavedViewContext";
import { toast } from "sonner";

export function usePoliciesView() {
  const queryClient = useQueryClient();
  const { filters, quickFilters, searchQuery, sortBy, sortOrder } =
    useSavedViewContext();

  const queryParams = useMemo(() => {
    const params: Record<string, unknown> = {};
    if (searchQuery) params.search = searchQuery;
    if (sortBy) {
      params.sortBy = sortBy;
      params.sortOrder = sortOrder;
    }
    const allConditions = [
      ...filters.flatMap((g) => g.conditions),
      ...quickFilters.filter((qf) => qf.condition).map((qf) => qf.condition!),
    ];
    if (allConditions.length > 0) {
      params.filters = JSON.stringify(allConditions);
    }
    return params;
  }, [filters, quickFilters, searchQuery, sortBy, sortOrder]);

  const { data, isLoading, error, refetch } = useQuery({
    queryKey: ["policies", queryParams],
    queryFn: async () => {
      const response = await api.get("/api/policies", { params: queryParams });
      return response.data;
    },
  });

  const statusMutation = useMutation({
    mutationFn: async ({ ids, status }: { ids: string[]; status: string }) => {
      await api.post("/api/policies/bulk", {
        action: "status",
        ids,
        data: { status },
      });
    },
    onSuccess: () => {
      toast.success("Policies updated");
      queryClient.invalidateQueries({ queryKey: ["policies"] });
    },
  });

  const handleBulkAction = useCallback(
    (actionId: string, selectedIds: string[]) => {
      if (actionId === "export") {
        window.open(
          `/api/policies/export?ids=${selectedIds.join(",")}`,
          "_blank",
        );
        return;
      }
      if (actionId === "publish") {
        statusMutation.mutate({ ids: selectedIds, status: "published" });
        return;
      }
      if (actionId === "archive") {
        statusMutation.mutate({ ids: selectedIds, status: "archived" });
        return;
      }
      if (actionId.startsWith("status-")) {
        const status = actionId.replace("status-", "");
        statusMutation.mutate({ ids: selectedIds, status });
      }
    },
    [statusMutation],
  );

  const handleStatusChange = useCallback(
    (id: string, newStatus: string) => {
      statusMutation.mutate({ ids: [id], status: newStatus });
    },
    [statusMutation],
  );

  return {
    config: POLICIES_VIEW_CONFIG,
    policies: data?.data || [],
    totalRecords: data?.total || 0,
    isLoading,
    error,
    refetch,
    handleBulkAction,
    handleStatusChange,
  };
}
```

Update Policies page following same pattern as Investigations.
</action>
<verify>npm run typecheck passes; npm run lint passes</verify>
<done>Policies page with saved views integration</done>
</task>

</tasks>

<verification>
```bash
cd apps/frontend
npm run typecheck
npm run lint
```
</verification>

<success_criteria>

- Investigations page uses SavedViewProvider with investigations config
- Policies page uses SavedViewProvider with policies config
- Both have unique columns, filters, and bulk actions
- Investigations board groups by stage (Planning, Evidence, Interviews, etc.)
- Policies board groups by status (Draft, Pending, Published, etc.)
- All view components work correctly with each module's configuration
  </success_criteria>

<output>
After completion, create `.planning/phases/13-hubspot-style-saved-views-system/13-12-SUMMARY.md`
</output>
