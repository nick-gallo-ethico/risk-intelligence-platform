---
phase: 13-hubspot-style-saved-views-system
plan: 15
type: checkpoint
wave: 5
depends_on:
  [
    "13-01",
    "13-02",
    "13-03",
    "13-04",
    "13-05",
    "13-06",
    "13-07",
    "13-08",
    "13-09",
    "13-10",
    "13-11",
    "13-12",
    "13-13",
    "13-14",
  ]
files_modified:
  - apps/backend/prisma/seeders/saved-views.seeder.ts
  - apps/backend/prisma/seed.ts
autonomous: false

must_haves:
  truths:
    - "Demo data includes default saved views for all 5 modules"
    - "Each module has at least 3 default views with realistic filters"
    - "All Phase 13 components render without errors"
    - "Table and board views work for all modules"
    - "Filters, sorting, and column selection work"
  artifacts:
    - path: "apps/backend/prisma/seeders/saved-views.seeder.ts"
      provides: "Seeder for default saved views"
      contains: "seedSavedViews"
    - path: ".planning/phases/13-hubspot-style-saved-views-system/13-VERIFICATION.md"
      provides: "Verification checklist and results"
      contains: "Phase 13 Verification"
  key_links:
    - from: "SavedViews seeder"
      to: "Prisma seed"
      via: "seed.ts import"
      pattern: "seedSavedViews"
---

<objective>
Create demo data for saved views and perform final verification of Phase 13.

Purpose: Demo data ensures the saved views system is populated with realistic examples. Verification confirms all components work correctly before marking the phase complete.

Output: Saved views seeder with default views for all modules, verification checklist with results.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/hubspot-view-system-spec.md
@apps/frontend/src/lib/views/configs/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create saved views seeder</name>
  <files>apps/backend/prisma/seeders/saved-views.seeder.ts</files>
  <action>
Create a seeder that populates default saved views for all modules:

```typescript
import { PrismaClient } from "@prisma/client";

interface DefaultView {
  name: string;
  moduleType: string;
  columns: string[];
  frozenColumnCount: number;
  filters: object[];
  sort?: { column: string; direction: "asc" | "desc" };
  viewMode: "table" | "board";
  visibility: "everyone" | "team" | "private";
  isDefault: boolean;
}

const DEFAULT_VIEWS: DefaultView[] = [
  // Cases views
  {
    name: "All Cases",
    moduleType: "cases",
    columns: [
      "caseNumber",
      "title",
      "status",
      "priority",
      "category",
      "assignee",
      "createdAt",
    ],
    frozenColumnCount: 1,
    filters: [],
    sort: { column: "createdAt", direction: "desc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: true,
  },
  {
    name: "Open Cases",
    moduleType: "cases",
    columns: [
      "caseNumber",
      "title",
      "priority",
      "category",
      "assignee",
      "dueDate",
    ],
    frozenColumnCount: 1,
    filters: [
      {
        id: "open-filter",
        conditions: [
          {
            id: "1",
            propertyId: "status",
            operator: "is_any_of",
            value: ["open", "in_progress"],
          },
        ],
      },
    ],
    sort: { column: "priority", direction: "desc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: false,
  },
  {
    name: "High Priority Cases",
    moduleType: "cases",
    columns: [
      "caseNumber",
      "title",
      "status",
      "assignee",
      "createdAt",
      "dueDate",
    ],
    frozenColumnCount: 1,
    filters: [
      {
        id: "high-priority",
        conditions: [
          {
            id: "1",
            propertyId: "priority",
            operator: "is_any_of",
            value: ["high", "critical"],
          },
        ],
      },
    ],
    sort: { column: "createdAt", direction: "desc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: false,
  },
  {
    name: "Case Pipeline",
    moduleType: "cases",
    columns: ["caseNumber", "title", "priority", "assignee"],
    frozenColumnCount: 0,
    filters: [],
    sort: { column: "status", direction: "asc" },
    viewMode: "board",
    visibility: "everyone",
    isDefault: false,
  },

  // Investigations views
  {
    name: "All Investigations",
    moduleType: "investigations",
    columns: [
      "investigationNumber",
      "title",
      "stage",
      "type",
      "leadInvestigator",
      "startedAt",
    ],
    frozenColumnCount: 1,
    filters: [],
    sort: { column: "startedAt", direction: "desc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: true,
  },
  {
    name: "Active Investigations",
    moduleType: "investigations",
    columns: [
      "investigationNumber",
      "title",
      "stage",
      "leadInvestigator",
      "targetEndDate",
      "checklistProgress",
    ],
    frozenColumnCount: 1,
    filters: [
      {
        id: "active",
        conditions: [
          {
            id: "1",
            propertyId: "stage",
            operator: "is_none_of",
            value: ["closed"],
          },
        ],
      },
    ],
    sort: { column: "targetEndDate", direction: "asc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: false,
  },
  {
    name: "Investigation Board",
    moduleType: "investigations",
    columns: ["investigationNumber", "title", "leadInvestigator"],
    frozenColumnCount: 0,
    filters: [],
    viewMode: "board",
    visibility: "everyone",
    isDefault: false,
  },

  // Policies views
  {
    name: "All Policies",
    moduleType: "policies",
    columns: [
      "policyNumber",
      "title",
      "status",
      "category",
      "owner",
      "effectiveDate",
      "version",
    ],
    frozenColumnCount: 1,
    filters: [],
    sort: { column: "title", direction: "asc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: true,
  },
  {
    name: "Published Policies",
    moduleType: "policies",
    columns: [
      "policyNumber",
      "title",
      "category",
      "owner",
      "publishedAt",
      "attestationRate",
    ],
    frozenColumnCount: 1,
    filters: [
      {
        id: "published",
        conditions: [
          { id: "1", propertyId: "status", operator: "is", value: "published" },
        ],
      },
    ],
    sort: { column: "publishedAt", direction: "desc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: false,
  },
  {
    name: "Review Needed",
    moduleType: "policies",
    columns: [
      "policyNumber",
      "title",
      "category",
      "owner",
      "nextReviewDate",
      "lastReviewDate",
    ],
    frozenColumnCount: 1,
    filters: [
      {
        id: "review-needed",
        conditions: [
          {
            id: "1",
            propertyId: "nextReviewDate",
            operator: "is_less_than_n_ago",
            value: 30,
            unit: "day",
          },
        ],
      },
    ],
    sort: { column: "nextReviewDate", direction: "asc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: false,
  },

  // Disclosures views
  {
    name: "All Disclosures",
    moduleType: "disclosures",
    columns: [
      "disclosureNumber",
      "type",
      "status",
      "riskLevel",
      "submitter",
      "submittedAt",
    ],
    frozenColumnCount: 1,
    filters: [],
    sort: { column: "submittedAt", direction: "desc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: true,
  },
  {
    name: "Pending Review",
    moduleType: "disclosures",
    columns: [
      "disclosureNumber",
      "type",
      "riskLevel",
      "submitter",
      "submittedAt",
    ],
    frozenColumnCount: 1,
    filters: [
      {
        id: "pending",
        conditions: [
          {
            id: "1",
            propertyId: "status",
            operator: "is",
            value: "pending_review",
          },
        ],
      },
    ],
    sort: { column: "riskLevel", direction: "desc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: false,
  },
  {
    name: "High Risk Disclosures",
    moduleType: "disclosures",
    columns: [
      "disclosureNumber",
      "type",
      "status",
      "submitter",
      "thirdParty",
      "giftValue",
    ],
    frozenColumnCount: 1,
    filters: [
      {
        id: "high-risk",
        conditions: [
          { id: "1", propertyId: "riskLevel", operator: "is", value: "high" },
        ],
      },
    ],
    sort: { column: "submittedAt", direction: "desc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: false,
  },

  // Intake Forms views
  {
    name: "All Submissions",
    moduleType: "intake-forms",
    columns: [
      "submissionId",
      "formName",
      "formType",
      "status",
      "submitter",
      "submittedAt",
    ],
    frozenColumnCount: 1,
    filters: [],
    sort: { column: "submittedAt", direction: "desc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: true,
  },
  {
    name: "Pending Review",
    moduleType: "intake-forms",
    columns: [
      "submissionId",
      "formName",
      "formType",
      "submitter",
      "submittedAt",
      "assignee",
    ],
    frozenColumnCount: 1,
    filters: [
      {
        id: "pending",
        conditions: [
          {
            id: "1",
            propertyId: "status",
            operator: "is_any_of",
            value: ["submitted", "in_review"],
          },
        ],
      },
    ],
    sort: { column: "submittedAt", direction: "asc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: false,
  },
  {
    name: "Anonymous Reports",
    moduleType: "intake-forms",
    columns: [
      "submissionId",
      "formType",
      "status",
      "submittedAt",
      "aiCategory",
      "aiPriority",
    ],
    frozenColumnCount: 1,
    filters: [
      {
        id: "anonymous",
        conditions: [
          { id: "1", propertyId: "isAnonymous", operator: "is_true" },
        ],
      },
    ],
    sort: { column: "submittedAt", direction: "desc" },
    viewMode: "table",
    visibility: "everyone",
    isDefault: false,
  },
];

export async function seedSavedViews(
  prisma: PrismaClient,
  organizationId: string,
) {
  console.log("Seeding default saved views...");

  // Get a system user for created_by (use first admin or create system user)
  const systemUser = await prisma.user.findFirst({
    where: { organizationId, role: "SYSTEM_ADMIN" },
  });

  if (!systemUser) {
    console.log("No system admin found, skipping saved views seeding");
    return;
  }

  let displayOrder = 0;

  for (const view of DEFAULT_VIEWS) {
    const existingView = await prisma.savedView.findFirst({
      where: {
        organizationId,
        moduleType: view.moduleType,
        name: view.name,
      },
    });

    if (!existingView) {
      await prisma.savedView.create({
        data: {
          organizationId,
          moduleType: view.moduleType,
          name: view.name,
          createdById: systemUser.id,
          visibility: view.visibility,
          columns: view.columns,
          frozenColumnCount: view.frozenColumnCount,
          filters: view.filters,
          sort: view.sort || null,
          viewMode: view.viewMode,
          displayOrder: displayOrder++,
          isDefault: view.isDefault,
        },
      });
      console.log(`  Created view: ${view.name} (${view.moduleType})`);
    } else {
      console.log(`  View already exists: ${view.name} (${view.moduleType})`);
    }
  }

  console.log(`Seeded ${DEFAULT_VIEWS.length} default saved views`);
}
```

  </action>
  <verify>npm run typecheck passes</verify>
  <done>Saved views seeder with default views for all 5 modules</done>
</task>

<task type="auto">
  <name>Task 2: Add seeder to main seed file</name>
  <files>apps/backend/prisma/seed.ts</files>
  <action>
Add the saved views seeder to the main seed file:

```typescript
// Add to imports at top of seed.ts
import { seedSavedViews } from "./seeders/saved-views.seeder";

// Add to the main seed function, after organization and user seeding:
// Inside the seed() function, after seedAcmeDemoData or equivalent:

// Seed saved views for demo organization
await seedSavedViews(prisma, demoOrganizationId);
```

  </action>
  <verify>npx prisma db seed runs without errors</verify>
  <done>Saved views seeder integrated into main seed</done>
</task>

<task type="human-verification">
  <name>Task 3: Verify Phase 13 Implementation</name>
  <files>.planning/phases/13-hubspot-style-saved-views-system/13-VERIFICATION.md</files>
  <action>
Create verification checklist and test all Phase 13 functionality:

```markdown
# Phase 13 Verification Checklist

## Backend API Verification

### SavedView Model

- [ ] SavedView model has frozenColumnCount field
- [ ] SavedView model has viewMode field (table/board)
- [ ] SavedView model has boardGroupBy field
- [ ] SavedView model has recordCount and recordCountAt fields
- [ ] Prisma generate succeeds

### SavedViews API

- [ ] GET /api/views returns list with recordCount
- [ ] POST /api/views creates new view
- [ ] PUT /api/views/:id updates view
- [ ] DELETE /api/views/:id deletes view
- [ ] POST /api/views/:id/clone duplicates view
- [ ] PUT /api/views/reorder updates display order

## Frontend Component Verification

### Zone 1 - View Tabs Bar

- [ ] Tabs render horizontally
- [ ] Active tab is visually distinct
- [ ] Tabs are draggable for reordering
- [ ] Context menu shows on three-dot click
- [ ] Rename, Clone, Delete work from menu
- [ ] Add view (+) button creates new view

### Zone 2 - Toolbar

- [ ] Search box filters data
- [ ] View mode toggle switches table/board
- [ ] Edit columns opens modal
- [ ] Filter button toggles quick filters row
- [ ] Sort button opens sort popover
- [ ] Export downloads file
- [ ] Save button enabled when changes exist

### Zone 3 - Quick Filters Row

- [ ] Date filters show presets and custom picker
- [ ] Multi-select filters show searchable checkboxes
- [ ] More button adds additional quick filters
- [ ] Advanced filters button opens slide-out
- [ ] Clear all removes all filters

### Zone 4a - Data Table

- [ ] Table renders with correct columns
- [ ] Column headers sort on click
- [ ] Frozen columns remain fixed on scroll
- [ ] Checkbox column enables selection
- [ ] Bulk actions bar appears when rows selected
- [ ] Pagination shows page numbers
- [ ] Page size dropdown works

### Zone 4b - Board View

- [ ] Board renders cards in status lanes
- [ ] Cards are draggable between lanes
- [ ] Dropping card updates status
- [ ] Cards show correct summary fields

### Advanced Filters Panel

- [ ] Panel slides out from right
- [ ] Filter groups show with OR separator
- [ ] Conditions show with AND separator
- [ ] Property dropdown shows all filterable properties
- [ ] Operators change based on property type
- [ ] Value inputs adapt to operator
- [ ] Filters apply in real-time

### Column Selection Modal

- [ ] Modal shows two-panel layout
- [ ] Available columns grouped by category
- [ ] Search filters available columns
- [ ] Selected columns are drag-reorderable
- [ ] Frozen columns dropdown works (0-3)
- [ ] First column is locked

## Module Integration Verification

### Cases Module

- [ ] Cases page uses SavedViewProvider
- [ ] All Cases, My Cases, Open Cases views work
- [ ] Table and board views functional
- [ ] Bulk actions work (assign, status, export)

### Investigations Module

- [ ] Investigations page uses SavedViewProvider
- [ ] Default views load correctly
- [ ] Board groups by investigation stage

### Policies Module

- [ ] Policies page uses SavedViewProvider
- [ ] Default views load correctly
- [ ] Board groups by policy status

### Disclosures Module

- [ ] Disclosures page uses SavedViewProvider
- [ ] COI-specific columns available
- [ ] Gift value filtering works

### Intake Forms Module

- [ ] Intake Forms page uses SavedViewProvider
- [ ] Anonymous filter works
- [ ] Form type filtering works

## URL State Verification

- [ ] View ID reflected in URL (?view=xxx)
- [ ] Filters encoded in URL
- [ ] Sort state in URL
- [ ] Search query in URL
- [ ] Shared link loads correct state
- [ ] Browser back/forward works

## Demo Data Verification

- [ ] npm run db:seed succeeds
- [ ] Default views created for all modules
- [ ] Views have correct filters pre-applied

## Performance Verification

- [ ] Page loads in <2 seconds
- [ ] View switching is instant
- [ ] Filters apply without lag
- [ ] Large datasets paginate correctly
```

Test each item and update the checkboxes. Document any issues found.
</action>
<verify>All checklist items pass</verify>
<done>Phase 13 verification complete with all checks passing</done>
</task>

</tasks>

<verification>
```bash
# Backend
cd apps/backend
npx prisma generate
npm run typecheck
npm run lint
npx prisma db seed

# Frontend

cd apps/frontend
npm run typecheck
npm run lint
npm run build

```
</verification>

<success_criteria>
- Demo data seeder creates default views for all 5 modules
- Each module has at least 3 default views (All, filtered variant, board)
- All Phase 13 components render without TypeScript errors
- Frontend builds successfully
- Backend type checks and lints pass
- Manual verification confirms all features work
- Verification checklist document created with results
</success_criteria>

<output>
After completion, create `.planning/phases/13-hubspot-style-saved-views-system/13-15-SUMMARY.md`

Also update:
- `.planning/STATE.md` to mark Phase 13 as complete
- `.planning/ROADMAP.md` if needed
</output>
```
