---
phase: 15-case-detail-page-overhaul
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/src/components/cases/log-interview-modal.tsx
  - apps/frontend/src/components/cases/attach-document-modal.tsx
  - apps/frontend/src/components/cases/create-task-modal.tsx
  - apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Log Interview button opens a functional modal"
    - "Attach Document button opens a functional modal"
    - "Create Task button opens a functional modal"
  artifacts:
    - path: "apps/frontend/src/components/cases/log-interview-modal.tsx"
      provides: "Interview logging modal"
      min_lines: 80
    - path: "apps/frontend/src/components/cases/attach-document-modal.tsx"
      provides: "Document attachment modal"
      min_lines: 60
    - path: "apps/frontend/src/components/cases/create-task-modal.tsx"
      provides: "Task creation modal"
      min_lines: 80
  key_links:
    - from: "page.tsx handleAction"
      to: "Log/Attach/Create modals"
      via: "modal open state setters"
      pattern: "setInterviewModalOpen|setDocumentModalOpen|setTaskModalOpen"
---

<objective>
Implement the three placeholder quick action modals: Log Interview, Attach Document, and Create Task.

Purpose: Close Gap 4 from Phase 15 verification - the three console.log placeholders in quick actions need real modal implementations.

Output: Three new modal components wired into the case detail page.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-case-detail-page-overhaul/15-VERIFICATION.md

# Existing modal patterns to follow

@apps/frontend/src/components/cases/add-note-modal.tsx
@apps/frontend/src/components/cases/email-log-modal.tsx

# Backend interview endpoint exists

@apps/backend/src/modules/investigations/interviews/interview.controller.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LogInterviewModal component</name>
  <files>apps/frontend/src/components/cases/log-interview-modal.tsx</files>
  <action>
Create a LogInterviewModal component for scheduling/logging interviews from case context.

Follow the pattern in add-note-modal.tsx and email-log-modal.tsx.

Fields:

- Interviewee: text input (name of person being interviewed)
- Interviewee Type: select (Person in System, External, Anonymous)
- Scheduled Date: date picker
- Notes: textarea for pre-interview notes
- Optional: Investigation select if case has multiple investigations

**API Endpoint: POST /investigation-interviews** (existing backend endpoint)

- Requires investigationId - for MVP, if case has investigations, use first one
- If no investigations on case, show warning message and fall back to logging as a case activity:
  - Fallback: POST /cases/:id/activity with action: 'interview_logged' and metadata containing interview details

Form structure:

```typescript
interface LogInterviewFormData {
  intervieweeName: string;
  intervieweeType: "PERSON" | "EXTERNAL" | "ANONYMOUS";
  scheduledAt: string; // ISO date
  notes?: string;
  investigationId?: string;
}
```

Use existing Dialog, Input, Select, Textarea, Button components from shadcn/ui.
Include loading state, error handling, and success callback.
</action>
<verify>
Component file exists and exports LogInterviewModal.
TypeScript compiles without errors: `cd apps/frontend && npx tsc --noEmit`
</verify>
<done>LogInterviewModal can be opened, displays form fields, and handles submission</done>
</task>

<task type="auto">
  <name>Task 2: Create AttachDocumentModal component</name>
  <files>apps/frontend/src/components/cases/attach-document-modal.tsx</files>
  <action>
Create an AttachDocumentModal for uploading/attaching files to a case.

Follow the pattern in add-note-modal.tsx for dialog structure.

Fields:

- File upload: drag-and-drop or click to select
- Document Title: auto-filled from filename, editable
- Description: optional textarea
- Document Type: select (Evidence, Report, Correspondence, Other)

For file upload, use a simple input type="file" for MVP. The backend storage service exists.

**API Endpoint: POST /cases/:id/activity** with action: 'document_attached'

For MVP, log the attachment intent as an activity (similar to email logging). Full file upload integration with Azure Blob is complex - for now, log metadata only.

Form structure:

```typescript
interface AttachDocumentFormData {
  title: string;
  description?: string;
  documentType: "EVIDENCE" | "REPORT" | "CORRESPONDENCE" | "OTHER";
  fileName: string;
  fileSize?: number;
}
```

Note: This is a "log attachment" modal similar to email logging. Full upload integration deferred.
</action>
<verify>
Component file exists and exports AttachDocumentModal.
TypeScript compiles without errors: `cd apps/frontend && npx tsc --noEmit`
</verify>
<done>AttachDocumentModal can be opened, displays form, and logs document attachment to activity</done>
</task>

<task type="auto">
  <name>Task 3: Create CreateTaskModal and wire all modals to page</name>
  <files>
apps/frontend/src/components/cases/create-task-modal.tsx
apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx
  </files>
  <action>
1. Create CreateTaskModal for creating tasks from case context:

Fields:

- Title: required text input
- Description: optional textarea
- Assignee: user select (fetch from users API)
- Due Date: date picker
- Priority: select (LOW, MEDIUM, HIGH)

**API Endpoint: POST /cases/:id/activity** with action: 'task_created'

For MVP, log task creation as a case activity since there's no dedicated Case Task model.
Include task details in metadata: { title, description, assigneeId, dueDate, priority }

Note: Full task management integration with My Work requires Case Task model (Phase 21).

2. Update page.tsx to:

- Add three new modal open states: interviewModalOpen, documentModalOpen, taskModalOpen
- Import and render all three modals (after EmailLogModal)
- Update handleAction switch cases to set modal open states instead of console.log

Replace:

```typescript
case "interview":
  console.log("Interview - coming soon");
  break;
case "document":
  console.log("Document - coming soon");
  break;
case "task":
  console.log("Task - coming soon");
  break;
```

With:

```typescript
case "interview":
  setInterviewModalOpen(true);
  break;
case "document":
  setDocumentModalOpen(true);
  break;
case "task":
  setTaskModalOpen(true);
  break;
```

  </action>
  <verify>
All three modal files exist.
Page imports all modals.
TypeScript compiles: `cd apps/frontend && npx tsc --noEmit`
No console.log placeholders remain in handleAction.
  </verify>
  <done>All three quick action buttons open functional modals, no console.log placeholders remain</done>
</task>

</tasks>

<verification>
Run after all tasks:
```bash
cd apps/frontend && npx tsc --noEmit
grep -r "console.log.*coming soon" apps/frontend/src/app/\(authenticated\)/cases/\[id\]/page.tsx
# Should return no matches
```
</verification>

<success_criteria>

1. Log Interview button opens LogInterviewModal with form fields
2. Attach Document button opens AttachDocumentModal with file/metadata form
3. Create Task button opens CreateTaskModal with task form
4. All three modals log their actions to case activity
5. No console.log placeholders remain in the quick action handler
   </success_criteria>

<output>
After completion, create `.planning/phases/15-case-detail-page-overhaul/15-08-SUMMARY.md`
</output>
