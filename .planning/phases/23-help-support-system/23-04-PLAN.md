---
phase: 23-help-support-system
plan: 04
type: execute
wave: 3
depends_on: ["23-01", "23-02"]
files_modified:
  - apps/frontend/src/app/(authenticated)/help/tickets/page.tsx
  - apps/frontend/src/app/(authenticated)/help/tickets/new/page.tsx
  - apps/frontend/src/components/help/ticket-form.tsx
  - apps/frontend/src/components/help/ticket-list.tsx
  - apps/backend/src/modules/notifications/templates/support/ticket-confirmation.hbs
autonomous: true

must_haves:
  truths:
    - "Users can navigate to /help/tickets/new and submit a support ticket with subject, description, and priority"
    - "Ticket submission shows success toast with ticket number"
    - "Users can view their submitted tickets at /help/tickets with status badges"
    - "Ticket creation triggers a confirmation email via the notification system"
  artifacts:
    - path: "apps/frontend/src/app/(authenticated)/help/tickets/new/page.tsx"
      provides: "Ticket submission page"
      min_lines: 20
    - path: "apps/frontend/src/app/(authenticated)/help/tickets/page.tsx"
      provides: "My tickets list page"
      min_lines: 20
    - path: "apps/frontend/src/components/help/ticket-form.tsx"
      provides: "Ticket submission form with validation"
      exports: ["TicketForm"]
    - path: "apps/frontend/src/components/help/ticket-list.tsx"
      provides: "User's ticket list with status badges"
      exports: ["TicketList"]
  key_links:
    - from: "apps/frontend/src/components/help/ticket-form.tsx"
      to: "apps/frontend/src/services/help.service.ts"
      via: "useMutation with helpApi.createTicket"
      pattern: "createTicket"
    - from: "apps/frontend/src/components/help/ticket-list.tsx"
      to: "apps/frontend/src/services/help.service.ts"
      via: "useQuery with helpApi.getMyTickets"
      pattern: "getMyTickets"
    - from: "apps/frontend/src/components/help/ticket-form.tsx"
      to: "sonner toast"
      via: "toast.success on mutation success"
      pattern: "toast\\.success"
---

<objective>
Build the support ticket frontend: ticket submission form with validation and the user's ticket history page.

Purpose: Users need to file support tickets from within the platform (not via email) and track their status. This closes the feedback loop that makes the help system complete.
Output: Working /help/tickets/new (submission) and /help/tickets (my tickets) pages with form validation, success feedback, and status tracking.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-help-support-system/23-RESEARCH.md
@.planning/phases/23-help-support-system/23-01-SUMMARY.md
@.planning/phases/23-help-support-system/23-02-SUMMARY.md

# Key reference files for form patterns

@apps/frontend/src/services/help.service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Ticket submission form and page</name>
  <files>
    apps/frontend/src/app/(authenticated)/help/tickets/new/page.tsx
    apps/frontend/src/components/help/ticket-form.tsx
  </files>
  <action>
**ticket-form.tsx** — `TicketForm` component:

Use react-hook-form with zod validation (existing pattern throughout the codebase):

```typescript
const ticketSchema = z.object({
  subject: z.string().min(5, "Subject must be at least 5 characters").max(200),
  description: z
    .string()
    .min(20, "Please provide more detail (at least 20 characters)")
    .max(5000),
  priority: z.enum(["LOW", "MEDIUM", "HIGH", "URGENT"]).default("MEDIUM"),
  category: z.string().optional(),
});
```

Form fields:

1. **Subject** — Input field with label "Subject" and placeholder "Brief summary of your issue"
2. **Description** — Textarea field (min 4 rows) with label "Description" and placeholder "Please describe your issue in detail..."
3. **Priority** — Select dropdown with options: Low, Medium (default), High, Urgent. Use shadcn/ui Select component. Use `value || undefined` pattern to avoid Radix empty string error (per Phase 14 fix).
4. **Category** — Optional Select dropdown with options: General, Bug Report, Feature Request, Account Issue, Billing, Other. Use the same `value || undefined` pattern.

Submit button: "Submit Ticket" — disabled while submitting, shows loading spinner.

Use `useMutation` from @tanstack/react-query to call `helpApi.createTicket(data)`.

On success:

- Show `toast.success` from sonner: "Ticket {ticketNumber} submitted successfully! You'll receive a confirmation email."
- Redirect to `/help/tickets` using `useRouter().push('/help/tickets')`

On error:

- Show `toast.error`: "Failed to submit ticket. Please try again."

**tickets/new/page.tsx:**

- `'use client'` directive
- Breadcrumb: Help & Support > My Tickets > Submit a Ticket
- Heading: "Submit a Support Ticket"
- Subheading: "Our team will review your request and respond as soon as possible."
- Render `<TicketForm />`
- Max width container (max-w-2xl) centered
  </action>
  <verify>Run `cd apps/frontend && npx tsc --noEmit` to confirm compilation. Verify react-hook-form and zod imports resolve.</verify>
  <done>Ticket submission page at /help/tickets/new shows a validated form. On submission, a success toast appears with the ticket number and user is redirected to the tickets list.</done>
  </task>

<task type="auto">
  <name>Task 2: My tickets list page and email template</name>
  <files>
    apps/frontend/src/app/(authenticated)/help/tickets/page.tsx
    apps/frontend/src/components/help/ticket-list.tsx
    apps/backend/src/modules/notifications/templates/support/ticket-confirmation.hbs
  </files>
  <action>
**ticket-list.tsx** — `TicketList` component:

- Uses `useQuery` to call `helpApi.getMyTickets(statusFilter)`
- Filter tabs at top: All, Open, In Progress, Resolved, Closed (using shadcn/ui Tabs or Button group)
- Table or card list showing each ticket:
  - Ticket number (TICKET-XXXX) — styled as monospace or bold
  - Subject — primary text
  - Status badge — color-coded: OPEN (blue), IN_PROGRESS (yellow/amber), WAITING_ON_CUSTOMER (orange), RESOLVED (green), CLOSED (gray)
  - Priority badge — LOW (gray), MEDIUM (blue), HIGH (orange), URGENT (red)
  - Created date — formatted with date-fns `format` or `formatDistanceToNow`
- Empty state: "You haven't submitted any tickets yet." with link to /help/tickets/new

Badge color mapping:

```typescript
const STATUS_COLORS: Record<string, string> = {
  OPEN: "bg-blue-100 text-blue-800",
  IN_PROGRESS: "bg-yellow-100 text-yellow-800",
  WAITING_ON_CUSTOMER: "bg-orange-100 text-orange-800",
  RESOLVED: "bg-green-100 text-green-800",
  CLOSED: "bg-gray-100 text-gray-800",
};

const PRIORITY_COLORS: Record<string, string> = {
  LOW: "bg-gray-100 text-gray-600",
  MEDIUM: "bg-blue-100 text-blue-600",
  HIGH: "bg-orange-100 text-orange-600",
  URGENT: "bg-red-100 text-red-600",
};
```

**tickets/page.tsx:**

- `'use client'` directive
- Breadcrumb: Help & Support > My Tickets
- Heading: "My Support Tickets"
- "Submit New Ticket" button (top right) linking to /help/tickets/new
- Render `<TicketList />`

**ticket-confirmation.hbs** — Handlebars email template for ticket confirmation:
Create at `apps/backend/src/modules/notifications/templates/support/ticket-confirmation.hbs` following the existing email template pattern (check what exists in the templates directory).

The template should contain:

- Subject line: "Support Ticket {{ticket.ticketNumber}} Received"
- Body: Greeting with user name, confirmation that ticket was received, ticket details (number, subject, priority), statement about response time, link back to view tickets in the platform
- If the templates use MJML, wrap in MJML structure. If plain Handlebars, use the existing base template structure.

If the notification templates directory structure doesn't clearly support new subdirectories, create the template inline as a string constant in the ticket listener instead. The key is that ticket creation produces a notification — the exact template mechanism should match whatever the existing codebase uses.
</action>
<verify>Run `cd apps/frontend && npx tsc --noEmit` to confirm compilation. Check that the ticket-list component exports correctly.</verify>
<done>My Tickets page at /help/tickets shows user's tickets with status/priority badges and filter tabs. Email template exists for ticket confirmation. TypeScript compiles without errors.</done>
</task>

</tasks>

<verification>
1. `cd apps/frontend && npx tsc --noEmit` compiles without errors
2. /help/tickets/new page renders ticket form with validation
3. /help/tickets page renders ticket list with status badges
4. Form uses react-hook-form + zod pattern
5. Submit mutation calls helpApi.createTicket and shows toast
6. Ticket list uses useQuery with helpApi.getMyTickets
7. Email template file exists (or inline template in listener)
</verification>

<success_criteria>

- Users can submit tickets with validated form (subject min 5 chars, description min 20 chars)
- Success toast shows ticket number after submission
- Users redirected to ticket list after submission
- Ticket list shows all user tickets with color-coded status and priority badges
- Filter tabs allow filtering by ticket status
- Empty state shown when no tickets exist
- Confirmation email template exists for the notification pipeline
  </success_criteria>

<output>
After completion, create `.planning/phases/23-help-support-system/23-04-SUMMARY.md`
</output>
