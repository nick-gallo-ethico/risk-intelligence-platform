---
phase: 02-demo-tenant-seed-data
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/backend/prisma/seeders/category.seeder.ts
  - apps/backend/prisma/seed.ts
autonomous: true

must_haves:
  truths:
    - "Categories exist for CASE module with hierarchical structure (parent/child)"
    - "Categories include standard compliance categories: harassment, fraud, safety, conflicts, retaliation"
    - "Each category has severity defaults and SLA days configured"
  artifacts:
    - path: "apps/backend/prisma/seeders/category.seeder.ts"
      provides: "Category seeder with hierarchical taxonomy"
      exports: ["seedCategories"]
    - path: "apps/backend/prisma/seed.ts"
      provides: "Updated seed entry point"
      contains: "seedCategories"
  key_links:
    - from: "apps/backend/prisma/seeders/category.seeder.ts"
      to: "prisma.category.createMany"
      via: "Prisma batch insert"
      pattern: "prisma\\.category\\.createMany"
---

<objective>
Create the category seeder that establishes the hierarchical taxonomy for case classification.

Purpose: Categories are required for RIU and Case seeding - they provide the classification structure. This must run before any case data is generated.

Output: Category seeder that creates standard compliance categories (harassment, fraud, safety, etc.) with parent-child hierarchy, severity defaults, and SLA configurations.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-demo-tenant-seed-data/02-RESEARCH.md
@apps/backend/prisma/schema.prisma (Category model)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create category seeder with compliance taxonomy</name>
  <files>apps/backend/prisma/seeders/category.seeder.ts</files>
  <action>
Create category.seeder.ts that populates the demo tenant with standard compliance categories.

**Category hierarchy to create:**
```
HARASSMENT (HIGH severity, 14 SLA days)
├── Sexual Harassment
├── Discriminatory Harassment
├── Bullying/Hostile Work Environment
└── Retaliation

FRAUD & FINANCIAL (HIGH severity, 21 SLA days)
├── Financial Fraud
├── Expense Fraud
├── Vendor/Supplier Fraud
└── Time & Attendance Fraud

CONFLICTS OF INTEREST (MEDIUM severity, 30 SLA days)
├── Personal Relationships
├── Outside Business Interests
├── Gifts & Entertainment
└── Board Memberships

SAFETY & HEALTH (HIGH severity, 7 SLA days)
├── Workplace Safety Violations
├── Environmental Violations
├── Product Safety Concerns
└── COVID-19/Infectious Disease

DATA & PRIVACY (MEDIUM severity, 21 SLA days)
├── Data Breach
├── Unauthorized Access
├── HIPAA Violations
├── Privacy Concerns

POLICY VIOLATIONS (LOW severity, 30 SLA days)
├── HR Policy Violations
├── IT Policy Violations
├── Travel & Expense Violations
└── General Misconduct

REQUEST FOR INFORMATION (LOW severity, 14 SLA days)
└── General RFI
```

**Implementation:**
- Export async function seedCategories(prisma: PrismaClient, organizationId: string): Promise<Map<string, string>>
- Use faker.seed(SEED_CONFIG.masterSeed + 100) for reproducibility
- Create parent categories first, then children using parent IDs
- Set module: 'CASE', isActive: true, isSystem: false
- Generate code from category name (e.g., "HAR" for Harassment)
- Return Map of category name to category ID for later use

**Each category should have:**
- id (UUID)
- organizationId
- name, code, description
- parentCategoryId (null for top-level)
- level (0 for top-level, 1 for children)
- path (materialized path like "/harassment/sexual-harassment")
- module: CategoryModule.CASE
- severityDefault
- slaDays
- requiresInvestigation: true (except RFI)
- sortOrder
  </action>
  <verify>
TypeScript check: `cd apps/backend && npx tsc --noEmit apps/backend/prisma/seeders/category.seeder.ts`
  </verify>
  <done>
Category seeder created with 7 parent categories and 23 child categories, each with severity defaults and SLA days configured.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate category seeder into main seed script</name>
  <files>apps/backend/prisma/seed.ts</files>
  <action>
Update the existing seed.ts to call the category seeder after organization creation.

**Modifications:**
1. Import { seedCategories } from './seeders/category.seeder'
2. After organization creation and before user creation, call:
   ```typescript
   const categoryMap = await seedCategories(prisma, organization.id);
   console.log(`Created ${categoryMap.size} categories`);
   ```

**Keep all existing functionality** (org creation, user creation) - just add category seeding between them.

The seed.ts order should now be:
1. Create/upsert organization
2. Seed categories
3. Create/upsert users
  </action>
  <verify>
Run: `cd apps/backend && npx prisma db seed --preview-feature` (or just test TypeScript compilation if DB not available)
TypeScript check: `cd apps/backend && npx tsc --noEmit apps/backend/prisma/seed.ts`
  </verify>
  <done>
seed.ts updated to import and call seedCategories, maintaining existing organization and user seeding while adding category taxonomy.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd apps/backend && npx tsc --noEmit`
2. Category seeder exports seedCategories function
3. seed.ts imports and calls seedCategories
4. 30+ categories defined (7 parents + 23+ children)
5. Each category has severityDefault and slaDays
</verification>

<success_criteria>
- Category seeder creates hierarchical taxonomy with parent-child relationships
- All compliance category types from research are represented
- Categories have appropriate severity defaults (HIGH for harassment/fraud, MEDIUM for conflicts, LOW for policy violations)
- SLA days configured per category type
- seed.ts successfully calls category seeder
</success_criteria>

<output>
After completion, create `.planning/phases/02-demo-tenant-seed-data/02-02-SUMMARY.md`
</output>
