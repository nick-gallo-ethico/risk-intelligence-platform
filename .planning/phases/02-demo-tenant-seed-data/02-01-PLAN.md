---
phase: 02-demo-tenant-seed-data
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/backend/prisma/seeders/config.ts
  - apps/backend/prisma/seeders/utils/temporal.ts
  - apps/backend/prisma/seeders/utils/weighted-random.ts
  - apps/backend/prisma/seeders/utils/progress.ts
  - apps/backend/prisma/seeders/utils/index.ts
  - apps/backend/prisma/seeders/index.ts
  - apps/backend/package.json
autonomous: true

must_haves:
  truths:
    - "faker.seed(CONSTANT) produces identical data across multiple runs"
    - "generateHistoricalDate() produces dates within 3-year window with recency bias"
    - "weightedRandom() selects items according to configured probability weights"
  artifacts:
    - path: "apps/backend/prisma/seeders/config.ts"
      provides: "Seed configuration with volumes, dates, organization structure, distribution weights, case timing, and search config"
      exports: ["SEED_CONFIG"]
    - path: "apps/backend/prisma/seeders/utils/temporal.ts"
      provides: "Date distribution utilities with case timing support"
      exports: ["generateHistoricalDate", "generateCaseTimeline", "generateTimezoneAwareDate", "DEMO_CURRENT_DATE"]
    - path: "apps/backend/prisma/seeders/utils/weighted-random.ts"
      provides: "Weighted random selection"
      exports: ["weightedRandom"]
    - path: "apps/backend/prisma/seeders/utils/progress.ts"
      provides: "CLI progress bar wrapper"
      exports: ["createProgressBar", "BatchProgress"]
  key_links:
    - from: "apps/backend/prisma/seeders/utils/temporal.ts"
      to: "date-fns"
      via: "import { subDays, addDays }"
      pattern: "import.*from.*date-fns"
    - from: "apps/backend/prisma/seeders/utils/progress.ts"
      to: "cli-progress"
      via: "import cliProgress"
      pattern: "import.*cliProgress"
---

<objective>
Install seed data dependencies and create the foundational utilities for deterministic, realistic demo data generation.

Purpose: Enable all subsequent seeders to use consistent configuration, deterministic random data, temporal distribution, and progress tracking. This is the infrastructure layer for seed generation.

Output: Package dependencies installed, configuration file with seed volumes/distributions, and utility functions for temporal distribution, weighted selection, and progress bars.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-demo-tenant-seed-data/02-RESEARCH.md
@.planning/phases/02-demo-tenant-seed-data/02-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install seed data dependencies</name>
  <files>apps/backend/package.json</files>
  <action>
Install the following npm packages for seed data generation:
- @faker-js/faker (^9.x) - deterministic fake data generation
- date-fns (^3.x) - date manipulation utilities
- cli-progress (^3.x) - progress bars for long-running operations
- chalk (^5.x) - CLI output coloring

Also install dev dependency:
- @types/cli-progress

Run: `cd apps/backend && npm install @faker-js/faker date-fns cli-progress chalk && npm install --save-dev @types/cli-progress`

Verify the packages are added to package.json dependencies section.
  </action>
  <verify>
Verify installation: `cd apps/backend && npm ls @faker-js/faker date-fns cli-progress chalk`
All packages should show installed versions without UNMET errors.
  </verify>
  <done>
Four dependencies added to package.json: @faker-js/faker, date-fns, cli-progress, chalk. Dev dependency @types/cli-progress installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create seed configuration and utility functions</name>
  <files>
apps/backend/prisma/seeders/config.ts
apps/backend/prisma/seeders/utils/temporal.ts
apps/backend/prisma/seeders/utils/weighted-random.ts
apps/backend/prisma/seeders/utils/progress.ts
apps/backend/prisma/seeders/utils/index.ts
  </files>
  <action>
Create the seeders directory structure with core configuration and utilities.

**config.ts:**
- SEED_CONFIG object with:
  - masterSeed: 20260202 (for reproducibility)
  - currentDate: new Date('2026-02-02') (reference date for all historical data)
  - historyYears: 3
  - preIndexSearch: true (Elasticsearch indices pre-built for demos)

  - volumes: {
      employees: 20000,
      rius: 5000,
      cases: 4500,
      campaigns: 20,
      policies: 50,
      openCaseRatio: 0.10
    }

  - organization: {
      divisions: [
        { name: 'Healthcare', weight: 0.50 },
        { name: 'Technology', weight: 0.20 },
        { name: 'Retail', weight: 0.20 },
        { name: 'Energy', weight: 0.10 }
      ],
      regions: ['US', 'EMEA', 'APAC'],
      locationCount: 50,  // 50+ global locations
      locationTemplates: [
        // US locations (majority)
        { region: 'US', cities: ['New York', 'Chicago', 'Los Angeles', 'Houston', 'Phoenix', 'Charlotte', 'Dallas', 'San Francisco', 'Seattle', 'Denver', 'Atlanta', 'Boston', 'Miami'] },
        // EMEA locations
        { region: 'EMEA', cities: ['London', 'Paris', 'Frankfurt', 'Amsterdam', 'Dublin', 'Madrid', 'Milan', 'Stockholm', 'Warsaw', 'Zurich'] },
        // APAC locations
        { region: 'APAC', cities: ['Tokyo', 'Singapore', 'Hong Kong', 'Sydney', 'Mumbai', 'Shanghai', 'Seoul', 'Bangalore', 'Melbourne', 'Manila'] }
      ],
      jobLevels: [
        { level: 'IC', name: 'Individual Contributor', weight: 0.70 },
        { level: 'Manager', name: 'Manager', weight: 0.15 },
        { level: 'Director', name: 'Director', weight: 0.08 },
        { level: 'VP', name: 'Vice President', weight: 0.04 },
        { level: 'SVP', name: 'Senior Vice President', weight: 0.02 },
        { level: 'C-Suite', name: 'C-Suite Executive', weight: 0.01 }
      ],
      hierarchy: ['Division', 'Business Unit', 'Department', 'Team']
    }

  - caseTiming: {
      simpleDaysRange: [2, 4],       // Simple cases: 2-4 days
      complexMonthsRange: [1, 3],    // Complex cases: 1-3 months
      targetAverageDays: 22          // Aggregate average under 20-22 days
    }

  - channelDistribution: { phone: 0.60, web: 0.30, other: 0.10 }
  - anonymityDistribution: { anonymous: 0.40, identified: 0.60 }

  - distributions: weighted percentages for riuTypes, caseSeverity, caseStatus, investigationOutcome (as documented in context)
  - demoUsers array with 9 users: admin, cco, triage, investigator1, investigator2, policy, reviewer, manager, employee

**temporal.ts:**
- DEMO_CURRENT_DATE constant (exported for tests)
- generateHistoricalDate(options?: { recentBias?: number, businessDaysOnly?: boolean }): Date
  - Uses exponential distribution with recentBias (default 0.3)
  - Distributes dates within HISTORY_YEARS window
  - Optionally skips weekends
- generateCaseTimeline(intakeDate: Date, isComplex: boolean): { createdAt, assignedAt, investigationStartedAt, closedAt? }
  - Returns realistic timeline with 90% closed cases (10% open per CONTEXT.md)
  - Simple cases: 2-4 days duration
  - Complex cases: 1-3 months duration
  - Targets aggregate average of ~20-22 days closure time
- generateTimezoneAwareDate(region: 'US' | 'EMEA' | 'APAC', date: Date): Date
  - Adjusts time to be within business hours for the region (demo realism)

**weighted-random.ts:**
- weightedRandom<T>(options: Array<{ value: T; weight: number }>): T
  - Generic weighted random selection function
  - Normalizes weights and selects based on probability

**progress.ts:**
- createProgressBar(format: string, total: number): cliProgress.SingleBar
  - Factory for consistent progress bars
- BatchProgress class with start(), increment(), stop() methods
  - Wraps cli-progress for batch operations

**index.ts:**
- Barrel export for all utilities

Reference research patterns:
- Use faker.seed(CONSTANT) pattern at start of each seeder
- Use date-fns subDays, addDays for temporal calculations
  </action>
  <verify>
TypeScript compilation: `cd apps/backend && npx tsc --noEmit apps/backend/prisma/seeders/config.ts apps/backend/prisma/seeders/utils/*.ts`
Should complete with no errors.
  </verify>
  <done>
Seeders directory created with config.ts defining volumes/distributions and utils/ containing temporal.ts, weighted-random.ts, progress.ts, and index.ts.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create seeder orchestrator scaffold</name>
  <files>apps/backend/prisma/seeders/index.ts</files>
  <action>
Create the main seeder orchestrator that will coordinate all seeders.

**seeders/index.ts:**
- Import PrismaClient
- Import SEED_CONFIG
- Import faker from @faker-js/faker
- Define seedDemoTenant async function:
  - Initialize faker with SEED_CONFIG.masterSeed
  - Set faker.setDefaultRefDate(SEED_CONFIG.currentDate)
  - Log "Initializing demo tenant seed with seed: {SEED_CONFIG.masterSeed}"
  - (Placeholder comments for future seeder calls)
  - Log "Demo seed complete!"
- Export { seedDemoTenant }

This is a scaffold - future plans will add actual seeder imports and calls.

Add a simple test to verify deterministic seeding:
- Call faker.seed(20260202) twice
- Generate same 3 names and verify they match
  </action>
  <verify>
Run TypeScript check: `cd apps/backend && npx tsc --noEmit apps/backend/prisma/seeders/index.ts`
  </verify>
  <done>
Seeder orchestrator scaffold created in seeders/index.ts with faker initialization and placeholder structure for future seeder calls.
  </done>
</task>

</tasks>

<verification>
1. All npm packages installed: `npm ls @faker-js/faker date-fns cli-progress chalk`
2. TypeScript compiles: `cd apps/backend && npx tsc --noEmit`
3. Files exist:
   - apps/backend/prisma/seeders/config.ts
   - apps/backend/prisma/seeders/utils/temporal.ts
   - apps/backend/prisma/seeders/utils/weighted-random.ts
   - apps/backend/prisma/seeders/utils/progress.ts
   - apps/backend/prisma/seeders/utils/index.ts
   - apps/backend/prisma/seeders/index.ts
</verification>

<success_criteria>
- SEED_CONFIG exports all volume targets (employees: 20000, rius: 5000, cases: 4500, campaigns: 20, policies: 50)
- SEED_CONFIG exports organization structure (4 divisions, 50+ locations, 6 job levels)
- SEED_CONFIG exports distribution weights (channels: 60/30/10, anonymity: 40/60, open cases: 10%)
- SEED_CONFIG exports caseTiming config (simple: 2-4 days, complex: 1-3 months, average: ~22 days)
- SEED_CONFIG.preIndexSearch = true for demo-ready Elasticsearch
- generateHistoricalDate returns dates within 3-year window
- generateCaseTimeline produces timelines matching caseTiming config
- weightedRandom correctly selects based on probability weights
- faker.seed() produces deterministic output (same seed = same data)
- All TypeScript files compile without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-demo-tenant-seed-data/02-01-SUMMARY.md`
</output>
