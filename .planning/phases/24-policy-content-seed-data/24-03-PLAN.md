---
phase: 24-policy-content-seed-data
plan: 03
type: execute
wave: 2
depends_on: ["24-01", "24-02"]
files_modified:
  - apps/backend/prisma/seeders/index.ts
  - apps/backend/prisma/seeders/verify-demo-data.ts
autonomous: true

must_haves:
  truths:
    - "Policy seeder call is enabled (uncommented) in index.ts"
    - "Verification script checks policy content length and variety"
    - "Verification script checks case description and summary lengths"
    - "Seed script is idempotent - running again updates without duplicating"
  artifacts:
    - path: "apps/backend/prisma/seeders/index.ts"
      provides: "Policy seeder call enabled in orchestrator"
      contains: "seedPolicies"
    - path: "apps/backend/prisma/seeders/verify-demo-data.ts"
      provides: "Phase 24 verification checks"
      contains: "verifyPhase24"
  key_links:
    - from: "apps/backend/prisma/seeders/index.ts"
      to: "apps/backend/prisma/seeders/policy.seeder.ts"
      via: "import and function call"
      pattern: "seedPolicies"
    - from: "apps/backend/prisma/seeders/verify-demo-data.ts"
      to: "prisma.policy"
      via: "Prisma queries for content verification"
      pattern: "prisma\\.policy"
---

<objective>
Enable the policy seeder in the seed orchestrator, and add Phase 24 verification checks for policy content quality and case data lengths.

Purpose: The policy seeder call is commented out in index.ts (line 130). Without enabling it, policy seed data never gets created. The verification script needs Phase 24 checks to confirm content meets length and quality requirements.

Output: Updated index.ts with policy seeder enabled, updated verify-demo-data.ts with Phase 24 checks.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@apps/backend/prisma/seeders/index.ts
@apps/backend/prisma/seeders/verify-demo-data.ts
@.planning/phases/24-policy-content-seed-data/24-01-SUMMARY.md
@.planning/phases/24-policy-content-seed-data/24-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enable policy seeder in index.ts and add Phase 24 verification</name>
  <files>apps/backend/prisma/seeders/index.ts, apps/backend/prisma/seeders/verify-demo-data.ts</files>
  <action>
**Part A: Enable policy seeder in index.ts**

1. Find the commented-out policy seeder call at approximately line 130:

   ```typescript
   // Plan 02-05: Policies
   // await seedPolicies(prisma);
   ```

2. Uncomment it:

   ```typescript
   // Plan 02-05: Policies
   await seedPolicies(prisma, organizationId, ccoUserId);
   ```

   IMPORTANT: The `seedPolicies` function signature requires `(prisma, organizationId, ownerId)`. Check how the index.ts gets the organizationId and ownerId. If these variables are not yet available at that point in the function:
   - Look at how other seeder calls get these values (e.g., how case seeder gets orgId)
   - The Acme Corp organization is fetched by slug 'acme-corp'
   - The owner should be the demo CCO user (email: 'demo-cco@acme.local')
   - Add the necessary lookups if they don't already exist

3. Add the import at the top of the file:

   ```typescript
   import { seedPolicies } from "./policy.seeder";
   ```

   Check if this import already exists. If it does, just uncomment it.

**Part B: Add Phase 24 verification checks to verify-demo-data.ts**

Add a new `verifyPhase24Content` function that checks:

1. **Policy content quality:**
   - Count policies with content length > 500 chars (plain text, stripping HTML). Expect 45+ of 50.
   - Count distinct policy types used. Expect 8+ (not all OTHER).
   - Count policies with status DRAFT. Expect 3-6.
   - Count policies with status RETIRED. Expect 3-6.
   - Check that effectiveDate values span at least 2 different years.

2. **Case description lengths (from V1-ISSUES-AND-GAPS requirement 15.6):**
   - Sample 10 flagship cases (by referenceNumber prefix pattern). Check each has details >= 200 words.
   - Sample 50 regular cases. Calculate average word count. Expect avg >= 150 words.

3. **Case summary lengths:**
   - Sample 10 flagship cases. Check each has aiSummary >= 50 words.
   - Sample 50 regular cases with aiSummary. Calculate average word count. Expect avg >= 40 words.

Add helper function for word counting:

```typescript
function countWords(text: string | null): number {
  if (!text) return 0;
  return text
    .trim()
    .split(/\s+/)
    .filter((w) => w.length > 0).length;
}
```

Wire the new function into the main verification flow. Add it after the existing `verifyPolicies` call:

```typescript
await verifyPhase24Content(orgId);
```

Use the existing `check()` helper for all assertions, using category 'Phase 24' to group them in the results output.
</action>
<verify>

- TypeScript compiles: `cd apps/backend && npx tsc --noEmit --skipLibCheck 2>&1 | head -20`
- Grep for seedPolicies in index.ts: should be uncommented (no leading //)
- Grep for verifyPhase24Content in verify-demo-data.ts: function exists and is called
- The import for seedPolicies exists in index.ts
  </verify>
  <done>
- Policy seeder call enabled (uncommented) in index.ts with correct arguments
- Import for seedPolicies present in index.ts
- verify-demo-data.ts has verifyPhase24Content function with 8+ checks
- Verification checks policy content length, type variety, status variety, date range
- Verification checks case description word count (flagship 200+, regular avg 150+)
- Verification checks case summary word count (flagship 50+, regular avg 40+)
- TypeScript compiles without errors
  </done>
  </task>

</tasks>

<verification>
1. `cd apps/backend && npx tsc --noEmit --skipLibCheck` compiles without errors
2. `seedPolicies` call is uncommented in index.ts
3. verify-demo-data.ts includes Phase 24 checks for content quality and length
4. Word count helper function exists and is used
</verification>

<success_criteria>

- Policy seeder enabled in seed orchestrator
- Verification script validates Phase 24 requirements: policy content length/variety, case description lengths, case summary lengths
- All changes compile without TypeScript errors
- Verification uses existing check() pattern and 'Phase 24' category grouping
  </success_criteria>

<output>
After completion, create `.planning/phases/24-policy-content-seed-data/24-03-SUMMARY.md`
</output>
