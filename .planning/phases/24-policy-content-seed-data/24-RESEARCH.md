# Phase 24 Research: Policy Content & Seed Data

## RESEARCH COMPLETE

### 1. Policy Seeder Current State

**File:** `apps/backend/prisma/seeders/policy.seeder.ts` (1,196 lines)

**Inventory:**
| Category | Count | Content Quality | Avg Content |
|----------|-------|-----------------|-------------|
| CORE_POLICIES | 11 | Excellent (multi-section, 400-550 lines HTML) | Substantial |
| ADDITIONAL_POLICIES | 13 | Good (3-4 sections, 220-350 lines) | Adequate |
| generateAdditionalPolicies() | 26 | Minimal (identical 7-line template) | Boilerplate |
| **TOTAL** | **50** | **52% boilerplate** | |

**Critical Gap:** 26 policies (52%) use identical template:
```html
<h1>{Topic} Policy</h1>
<h2>Purpose</h2><p>...guidelines for {topic}...</p>
<h2>Scope</h2><p>...all employees and contractors.</p>
<h2>Policy</h2><p>...follow established procedures...</p>
<h2>Responsibilities</h2><ul>3 generic items</ul>
<h2>Exceptions</h2><p>...written approval from department head.</p>
```

**PolicyType Enum Coverage:**
- 12 values: CODE_OF_CONDUCT, ANTI_HARASSMENT, ANTI_BRIBERY, DATA_PRIVACY, INFORMATION_SECURITY, GIFT_ENTERTAINMENT, CONFLICTS_OF_INTEREST, TRAVEL_EXPENSE, WHISTLEBLOWER, SOCIAL_MEDIA, ACCEPTABLE_USE, OTHER
- 26 policies use generic 'OTHER' type

**Additional Issues:**
- Policy seeder is COMMENTED OUT in `prisma/seeders/index.ts` (line 130) - not being called!
- All 50 policies use identical version pattern (v1 2024-01-15, v2 2026-01-15)
- All PUBLISHED status (no DRAFT, PENDING_APPROVAL, RETIRED)
- Translations use [LANG] markers, not actual translated text
- No draft policies exist (draftContent always null)

### 2. Case Seeder Current State

**Files:**
- `apps/backend/prisma/seeders/case.seeder.ts`
- `apps/backend/prisma/seeders/patterns/flagship-cases.ts`
- `apps/backend/prisma/seeders/data/narrative-templates.ts`

**Case Content Fields (Prisma Schema):**
- `Case.details` (String, required) - Full case narrative
- `Case.summary` (String?, optional) - Brief summary
- `Case.aiSummary` on RIU (String?) - AI-generated summary
- `Case.addendum` (String?, optional) - Additional notes

**Flagship Cases (10 total) - ALL TOO SHORT:**

| Case | Current Words | Target | Gap |
|------|---------------|--------|-----|
| Chicago Warehouse Incident | 132 | 200-400 | -68 |
| Q3 Financial Irregularities | 163 | 200-400 | -37 |
| Executive Expense Report | 134 | 200-400 | -66 |
| Manufacturing Safety Incident | 162 | 200-400 | -38 |
| Healthcare Data Breach | 146 | 200-400 | -54 |
| Systematic Discrimination | 172 | 200-400 | -28 |
| Vendor Kickback Scheme | 148 | 200-400 | -52 |
| Workplace Violence Threat | 151 | 200-400 | -49 |
| COI Disclosure - Board | 130 | 200-400 | -70 |
| Retaliation After Safety | 144 | 200-400 | -56 |

**AI Summary word counts: 24-35 words (target: 50-75)**

**Regular Cases (~4,490):**
- `details` field: Copied from RIU, 150-250 words (variable, often below 200)
- `summary` field: Character-truncated at 197 chars (~30-40 words) or null
- AI summary: Generated by `generateAiSummary()`, 24-35 words consistently

**Narrative Templates:** 13 categories with 3-5 variants each, typical output 150-250 words

### 3. Seed Infrastructure

**Orchestration:** `prisma/seeders/index.ts` with `seedDemoTenant()` function
- Deterministic: masterSeed 20260202, reference date 2026-02-02
- Phase-specific seeders: `acme-phase-09.ts`, `acme-phase-12.ts`
- Naming convention: `acme-phase-24.ts` with `seedAcmePhase24()` export
- Phase seed value: `20260224`

**Idempotency Patterns:**
1. Check-first (singleton): findUnique → skip if exists
2. Upsert with unique constraint (assignments)
3. Count-based recreation (time-series data)
4. Policy seeder uses pattern #1: `findUnique by organizationId_slug → skip if exists`

**Verification:** `verify-demo-data.ts` with structured pass/warn/fail checks

### 4. Key Schema Constraints

**Policy:**
- `@@unique([organizationId, slug])` - slug unique per org
- PolicyVersion: `@@unique([policyId, version])` - version unique per policy
- PolicyVersionTranslation: `@@unique([policyVersionId, languageCode])`
- Required fields: organizationId, title, slug, policyType, ownerId, createdById

**Case:**
- `details` (String, required) - main narrative content
- `summary` (String?, optional) - brief overview
- No word count validation at schema level

**RIU:**
- Immutable after creation (NO updatedAt field)
- `details` (String, required) - intake narrative
- `aiSummary` (String?, optional) - AI-generated summary

### 5. Scope for Phase 24

**Policy Work:**
1. Replace 26 generated policies with real, substantial content (each needs unique 300+ word HTML documents with proper sections)
2. Enhance 13 ADDITIONAL_POLICIES with more content (they're adequate but short)
3. Enable policy seeder call in index.ts (currently commented out)
4. Add variety: some DRAFT, some RETIRED, varied version counts
5. Consider varied effective dates and review cycles

**Case Work:**
1. Expand 10 flagship case narratives to 200-400 words each
2. Expand 10 flagship AI summaries to 50-75 words each
3. Rewrite `generateAiSummary()` function to produce 50-75 word summaries
4. Change `summary` generation from character-truncation to word-based extraction (50-75 words)
5. Possibly enhance narrative templates to ensure >200 words minimum

**Files to Modify:**
- `apps/backend/prisma/seeders/policy.seeder.ts` - Policy content
- `apps/backend/prisma/seeders/patterns/flagship-cases.ts` - Flagship narratives
- `apps/backend/prisma/seeders/case.seeder.ts` - Summary generation logic
- `apps/backend/prisma/seeders/data/narrative-templates.ts` - Template lengths
- `apps/backend/prisma/seeders/index.ts` - Uncomment policy seeder call
- NEW: `apps/backend/prisma/seeders/acme-phase-24.ts` - Phase-specific seeder
- `apps/backend/prisma/seeders/verify-demo-data.ts` - Add Phase 24 verification
