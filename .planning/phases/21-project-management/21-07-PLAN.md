---
phase: 21-project-management
plan: 07
type: execute
wave: 6
depends_on: ["21-01", "21-04"]
files_modified:
  - apps/frontend/src/components/projects/ColumnCenterDialog.tsx
  - apps/frontend/src/components/projects/ColumnConfigPanel.tsx
  - apps/frontend/src/components/projects/DynamicColumnCell.tsx
  - apps/frontend/src/components/projects/ProjectTaskTable.tsx
  - apps/frontend/src/hooks/use-project-detail.ts
autonomous: true

must_haves:
  truths:
    - "Column center dialog lets users add, remove, and reorder columns"
    - "15 column types are supported matching Monday.com's essential set"
    - "Each column type has a configuration panel with type-specific settings"
    - "Dynamic column cells render appropriate UI based on column type"
    - "Column headers are draggable to reorder"
    - "Column width is resizable"
  artifacts:
    - path: "apps/frontend/src/components/projects/ColumnCenterDialog.tsx"
      provides: "Column management dialog for adding/removing/configuring columns"
    - path: "apps/frontend/src/components/projects/DynamicColumnCell.tsx"
      provides: "Renders appropriate cell UI based on column type"
  key_links:
    - from: "ColumnCenterDialog.tsx"
      to: "use-project-detail.ts"
      via: "useCreateColumn, useUpdateColumn, useDeleteColumn hooks"
      pattern: "useCreateColumn|useUpdateColumn|useDeleteColumn"
    - from: "DynamicColumnCell.tsx"
      to: "ProjectTaskTable.tsx"
      via: "Rendered inside table rows for each custom column"
      pattern: "DynamicColumnCell"
---

<objective>
Build the column configuration UI — Monday.com's "Column Center" where users customize which fields appear on their project board. Supports 15 column types (status, people, date, timeline, text, long text, numbers, dropdown, checkbox, link, tags, files, dependency, connected entity, progress). Each column type has a configuration panel with type-specific settings.

Purpose: Column flexibility is what makes Monday.com feel powerful. Users need to customize their project views with the fields that matter to their workflow.
Output: Column center dialog, column config panels, and dynamic cell rendering for all 15 column types.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-project-management/21-06-SUMMARY.md
@apps/frontend/src/components/projects/ProjectTaskTable.tsx
@apps/frontend/src/hooks/use-project-detail.ts
@apps/frontend/src/types/project.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build ColumnCenterDialog and ColumnConfigPanel</name>
  <files>
    apps/frontend/src/components/projects/ColumnCenterDialog.tsx
    apps/frontend/src/components/projects/ColumnConfigPanel.tsx
    apps/frontend/src/hooks/use-project-detail.ts
  </files>
  <action>
**Add hooks to `use-project-detail.ts`** (if not already present from Plan 04):

- `useProjectColumns(projectId)`: Fetches `GET /projects/${projectId}/columns`
- `useCreateColumn(projectId)`: Mutation for `POST /projects/${projectId}/columns`
- `useUpdateColumn(projectId)`: Mutation for `PUT /projects/${projectId}/columns/${columnId}`
- `useDeleteColumn(projectId)`: Mutation for `DELETE /projects/${projectId}/columns/${columnId}`
- `useReorderColumns(projectId)`: Mutation for `PUT /projects/${projectId}/columns/reorder`

**ColumnCenterDialog.tsx** — Monday.com's "Column Center":

A modal dialog triggered by a "+" button on the table header row. Contains:

- **Left sidebar**: Column type categories:
  - "Essentials" — STATUS, PERSON, DATE, TIMELINE, TEXT, NUMBER
  - "More Columns" — LONG_TEXT, DROPDOWN, CHECKBOX, LINK, TAGS, FILES
  - "Connections" — DEPENDENCY, CONNECTED_ENTITY, PROGRESS

- **Main area**: Grid of column type cards:
  - Each card shows: icon, name, short description
  - Click to add that column type to the project
  - On click: creates column via `useCreateColumn` with default name (e.g., "Status 1", "Date 1")
  - After creation, opens ColumnConfigPanel for the new column

- **Existing columns section** (at top or as a tab):
  - Lists all columns currently on the project
  - Each shows: drag handle (for reorder), column name, column type icon, settings gear, delete (trash icon)
  - Drag-to-reorder using @dnd-kit SortableContext
  - Delete shows confirmation dialog
  - Settings gear opens ColumnConfigPanel

- Search bar at top to filter column types

**ColumnConfigPanel.tsx** — Type-specific column settings:

A slide-out panel or modal that shows configuration options based on column type:

- **All types**: Column name (text input), Column description (optional textarea), Is Required toggle

- **STATUS**:
  - Label editor: list of status labels with color picker for each
  - Default labels: "Working on it" (orange), "Done" (green), "Stuck" (red), "Not Started" (gray)
  - Add/remove labels
  - Default value selector

- **PERSON**:
  - Allow multiple toggle (single assignee vs. multiple)
  - Default value: none or specific user

- **DATE**:
  - Date format selector (MM/DD/YYYY, DD/MM/YYYY, YYYY-MM-DD)
  - Include time toggle
  - Default to today toggle

- **TIMELINE**:
  - Default duration (days)
  - Show on Gantt toggle

- **TEXT**:
  - Max length setting
  - Placeholder text

- **LONG_TEXT**:
  - Enable rich text toggle
  - Max length setting

- **NUMBER**:
  - Unit label (e.g., "$", "%", "hrs")
  - Unit position (prefix/suffix)
  - Decimal places (0, 1, 2)
  - Number format (comma separated, none)

- **DROPDOWN**:
  - Options list editor: add/remove/reorder options
  - Each option has label + color
  - Allow multiple selection toggle
  - Default value selector

- **CHECKBOX**:
  - Default checked toggle

- **LINK**:
  - Placeholder URL text

- **TAGS**:
  - Available tags list (or auto-create on type)
  - Color for each tag

- **FILES**:
  - Allowed file types (all, images only, documents only, custom)
  - Max file size

- **DEPENDENCY**:
  - Dependency types allowed (FS, SS, FF, SF toggles)
  - Default type

- **CONNECTED_ENTITY**:
  - Entity type selector: Case, Investigation, Campaign, Policy, Person
  - Display field (which field from connected entity to show)

- **PROGRESS**:
  - Auto-calculate from subtasks toggle
  - Manual override allowed toggle

Save button applies changes via `useUpdateColumn` mutation.
</action>
<verify>
`cd apps/frontend && npx tsc --noEmit` passes.
ColumnCenterDialog opens and shows column type grid.
ColumnConfigPanel shows type-specific settings.
</verify>
<done>Column center with 15 column types in 3 categories. Config panel with type-specific settings for each column type. Columns can be added, configured, reordered, and deleted.</done>
</task>

<task type="auto">
  <name>Task 2: Build DynamicColumnCell and integrate into ProjectTaskTable</name>
  <files>
    apps/frontend/src/components/projects/DynamicColumnCell.tsx
    apps/frontend/src/components/projects/ProjectTaskTable.tsx
  </files>
  <action>
**DynamicColumnCell.tsx** — Renders the appropriate cell UI based on column type:

A switch component that renders different cell types based on the column's `type` field:

```typescript
interface DynamicColumnCellProps {
  column: ProjectColumn;
  task: ProjectTask;
  value: unknown;
  onUpdate: (value: unknown) => void;
  isEditing: boolean;
}
```

Rendering by type:

- **STATUS**: Colored badge (matching configured labels/colors). Click opens a dropdown of configured status options. Selection calls onUpdate.

- **PERSON**: Avatar + name. Click opens user picker popover (same as assignee picker). Supports single or multiple based on column settings.

- **DATE**: Formatted date text. Click opens Calendar popover (shadcn/ui Calendar). Applies configured date format.

- **TIMELINE**: Date range shown as "Mar 1 - Mar 15". Click opens dual-date picker. Renders as a mini bar if space allows.

- **TEXT**: Text display. Click to edit inline (Input). Enter to save, Escape to cancel.

- **LONG_TEXT**: Truncated text with expand on click. Opens a textarea popover for editing.

- **NUMBER**: Formatted number with unit (prefix/suffix). Click to edit inline (Number input). Respects decimal places and format settings.

- **DROPDOWN**: Selected value as colored badge. Click opens dropdown of configured options. Supports multiple selection if configured.

- **CHECKBOX**: Checkbox that toggles on click. No edit mode needed — direct interaction.

- **LINK**: Clickable link text (opens in new tab). Edit mode shows URL input.

- **TAGS**: Colored tag badges. Click opens tag picker with existing tags + create new.

- **FILES**: File count badge with paperclip icon (e.g., "3 files"). Click opens file list popover.

- **DEPENDENCY**: Count of dependencies (e.g., "2 deps"). Click opens dependency picker.

- **CONNECTED_ENTITY**: Entity name/link (e.g., "CASE-2025-001"). Click opens entity picker by type.

- **PROGRESS**: Progress bar with percentage. Auto-calculated or manual edit.

All cells handle:

- Read mode (display)
- Edit mode (inline editing on click)
- Empty state (dash or "—" for unset values)
- Loading state during update

**Update ProjectTaskTable.tsx** to integrate dynamic columns:

- After the hardcoded columns (checkbox, title, status, priority, assignee, due date), render custom columns from `useProjectColumns(projectId)`
- For each custom column, add a table header with:
  - Column name
  - Column type icon
  - Drag handle for column reorder (using @dnd-kit)
  - Resize handle (mouse drag to change column width)
  - Right-click context menu: Edit Column, Hide Column, Delete Column
- For each task row, render a DynamicColumnCell for each custom column
  - Value read from `task.customFields[column.id]`
  - onUpdate calls `useUpdateTask` to update the task's customFields
- Add a "+" button at the end of the header row that opens ColumnCenterDialog
- Column widths stored in column.width and resizable by dragging the header border
- Column reorder uses @dnd-kit on the header row, calls `useReorderColumns` on drag end
  </action>
  <verify>
  `cd apps/frontend && npx tsc --noEmit` passes.
  Custom columns appear in the task table.
  Each column type renders appropriate cell UI.
  Inline editing works for each column type.
  Column reorder and resize works.
  </verify>
  <done>DynamicColumnCell renders 15 column types with inline editing. ProjectTaskTable integrates custom columns with drag-to-reorder headers and resizable widths. Column center "+" button in table header.</done>
  </task>

</tasks>

<verification>
- `npx tsc --noEmit` passes from apps/frontend
- "+" button in table header opens column center dialog
- All 15 column types can be added to a project
- Each column type shows appropriate config settings
- Custom columns render in the task table with correct cell types
- Inline editing works for all column types
- Column reorder and resize works
</verification>

<success_criteria>

- Monday.com Column Center with 15 column types in 3 categories
- Type-specific configuration panels (status labels, dropdown options, number format, etc.)
- Dynamic cell rendering based on column type
- Inline editing for every column type
- Column reorder via drag-and-drop
- Column resize via drag on header border
- Project columns are persisted per-project via API
  </success_criteria>

<output>
After completion, create `.planning/phases/21-project-management/21-07-SUMMARY.md`
</output>
