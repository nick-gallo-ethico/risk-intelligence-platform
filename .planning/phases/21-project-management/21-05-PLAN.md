---
phase: 21-project-management
plan: 05
type: execute
wave: 5
depends_on: ["21-03", "21-04"]
files_modified:
  - apps/frontend/src/components/projects/ProjectBoardView.tsx
  - apps/frontend/src/components/projects/ProjectTimelineView.tsx
  - apps/frontend/src/components/projects/GanttChart.tsx
  - apps/frontend/src/app/(authenticated)/projects/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Kanban board view within project detail shows tasks grouped by status with drag-to-move"
    - "Timeline/Gantt view within project detail shows tasks on a time axis with start/end dates"
    - "Gantt chart shows dependency arrows between linked tasks"
    - "All three views (table, board, timeline) are switchable on project detail page"
    - "View mode persists in URL searchParams"
  artifacts:
    - path: "apps/frontend/src/components/projects/ProjectBoardView.tsx"
      provides: "Kanban board for tasks within a single project"
    - path: "apps/frontend/src/components/projects/ProjectTimelineView.tsx"
      provides: "Gantt-style timeline for project tasks with dependency arrows"
  key_links:
    - from: "ProjectBoardView.tsx"
      to: "use-project-detail.ts"
      via: "Hook for task data and mutations"
      pattern: "useProjectTasks|useBulkUpdateTasks"
    - from: "ProjectTimelineView.tsx"
      to: "GanttChart.tsx"
      via: "Wraps existing GanttChart with project task data"
      pattern: "GanttChart"
---

<objective>
Add Kanban board view and timeline/Gantt view to the project detail page. The board enables drag-to-move tasks between status columns. The timeline shows tasks on a Gantt chart with dependency arrows between linked tasks. This completes the three-view experience: table (Plan 04), board, and timeline.

Purpose: Provide multiple visual representations of project work — table for detail editing, board for status flow, timeline for scheduling and dependencies.
Output: Board and timeline views on project detail, fully integrated with view switching.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-project-management/21-04-SUMMARY.md
@apps/frontend/src/components/projects/GanttChart.tsx
@apps/frontend/src/components/views/BoardView.tsx
@apps/frontend/src/types/project.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build project board view with drag-to-move</name>
  <files>
    apps/frontend/src/components/projects/ProjectBoardView.tsx
  </files>
  <action>
**ProjectBoardView.tsx** — Kanban board for tasks within a project:

This is a project-specific board (not the module-level board from saved views). It shows columns for each ProjectTaskStatus:

- NOT_STARTED (gray header)
- IN_PROGRESS (blue header)
- STUCK (red header)
- DONE (green header)
- CANCELLED (gray header, collapsed by default)

Implementation using @dnd-kit:

- DndContext with closestCorners collision detection
- Each status column is a SortableContext with useDroppable
- Each task card is useDraggable
- On drag end: if dragged to different column, call useBulkUpdateTasks to change task status. If same column, call useReorderTasks.
- DragOverlay shows a preview card during drag

Task cards display:

- Title (bold)
- Priority icon (colored)
- Assignee avatar (small circle)
- Due date (if set, colored red if overdue)
- Subtask progress (e.g., "2/5" if subtasks exist)
- Group color indicator (thin left border matching group color)
- Update count bubble (if > 0, shows conversation activity)
- File count paperclip (if > 0)

Column header shows:

- Status name with colored dot
- Task count
- "+" button to add task in that status

Click on a card opens the TaskDetailPanel (same one from Plan 04). Use the same selectedTaskId state mechanism in the parent page.
</action>
<verify>
`cd apps/frontend && npx tsc --noEmit` passes.
Board view renders with task cards in status columns.
Drag-drop on board changes task status.
</verify>
<done>Board view with drag-to-move task cards between status columns. Cards show priority, assignee, due date, subtask progress, and activity indicators.</done>
</task>

<task type="auto">
  <name>Task 2: Build project timeline view with dependency arrows</name>
  <files>
    apps/frontend/src/components/projects/ProjectTimelineView.tsx
    apps/frontend/src/components/projects/GanttChart.tsx
    apps/frontend/src/app/(authenticated)/projects/[id]/page.tsx
  </files>
  <action>
**ProjectTimelineView.tsx** — Gantt-style timeline:

Wraps and adapts the existing GanttChart component to work with ProjectTask data:

- Maps ProjectTask[] to the format GanttChart expects (items with start, end, label, status, progress)
- Tasks without startDate use createdAt as start; tasks without dueDate don't show a bar (show as milestone dot)
- Color bars by task status (matching board colors: gray=not started, blue=in progress, red=stuck, green=done)
- Groups tasks by their ProjectGroup for the left-side label column
- Show today indicator line
- Zoom controls: week, month, quarter (already in GanttChart)

**Dependency arrows**: Extend GanttChart to render dependency arrows:

- Fetch dependencies from `useTaskDependencies` for all tasks in the project
- For each dependency, draw an SVG arrow from the end of the prerequisite task bar to the start of the dependent task bar
- Arrow style: small bezier curve with arrowhead
- Color: muted gray for normal, red if the dependency is violated (dependent task started before prerequisite finished)
- This uses the ProjectTaskDependency data from the API

If GanttChart doesn't accept dependency data, extend it:

- Add a `dependencies` prop: Array<{ fromTaskId, toTaskId, type }>
- Render dependency arrows as an SVG overlay on the chart
- Keep backward compat — don't break existing MilestoneTimeline usage

Click on a task bar opens TaskDetailPanel.

**Update project detail page** (`[id]/page.tsx`):

- Replace the placeholder board and timeline views with the real components
- Wire up view mode switching between 'table', 'board', 'timeline'
- Pass shared state: selectedTaskId, project data, mutation hooks
- Store viewMode in URL search param `?view=table|board|timeline` for persistence
  </action>
  <verify>
  `cd apps/frontend && npx tsc --noEmit` passes.
  Timeline view renders task bars on time axis.
  Dependency arrows show between linked tasks.
  View switching works between all three modes.
  </verify>
  <done>Timeline view shows tasks on Gantt chart grouped by project groups. Dependency arrows rendered between linked tasks. All three views (table, board, timeline) integrated into project detail page with URL-persisted switching.</done>
  </task>

</tasks>

<verification>
- `npx tsc --noEmit` passes from apps/frontend
- Three view modes work on project detail: table, board, timeline
- Board drag-drop changes task status
- Timeline shows task bars with date ranges
- Dependency arrows show on timeline between linked tasks
- View mode persists in URL
</verification>

<success_criteria>

- Kanban board within project shows tasks by status with drag-to-move
- Gantt/timeline view shows task scheduling with dependency arrows
- All three views share the same task detail panel
- View mode switchable and URL-persisted
- Task cards show activity indicators (update count, file count)
  </success_criteria>

<output>
After completion, create `.planning/phases/21-project-management/21-05-SUMMARY.md`
</output>
