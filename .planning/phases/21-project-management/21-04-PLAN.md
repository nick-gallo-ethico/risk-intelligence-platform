---
phase: 21-project-management
plan: 04
type: execute
wave: 4
depends_on: ["21-02", "21-03"]
files_modified:
  - apps/frontend/src/app/(authenticated)/projects/[id]/page.tsx
  - apps/frontend/src/components/projects/ProjectTaskTable.tsx
  - apps/frontend/src/components/projects/ProjectGroupHeader.tsx
  - apps/frontend/src/components/projects/TaskDetailPanel.tsx
  - apps/frontend/src/components/projects/AddTaskRow.tsx
  - apps/frontend/src/hooks/use-project-detail.ts
autonomous: true

must_haves:
  truths:
    - "Project detail page shows project header with name, status, progress, and actions"
    - "Tasks are displayed in a grouped table with group headers"
    - "Users can create tasks inline via add-task row at bottom of each group"
    - "Users can edit task fields inline (status, priority, assignee, due date)"
    - "Clicking a task opens a detail side panel with full task information"
    - "Users can create, rename, and delete groups"
    - "Task status changes update project progress in real-time"
  artifacts:
    - path: "apps/frontend/src/app/(authenticated)/projects/[id]/page.tsx"
      provides: "Project detail page with grouped task table"
    - path: "apps/frontend/src/components/projects/ProjectTaskTable.tsx"
      provides: "Grouped task table with inline editing"
    - path: "apps/frontend/src/components/projects/TaskDetailPanel.tsx"
      provides: "Side panel for task detail/editing"
    - path: "apps/frontend/src/hooks/use-project-detail.ts"
      provides: "Data fetching hooks for project detail"
  key_links:
    - from: "use-project-detail.ts"
      to: "/api/v1/projects/:id"
      via: "React Query"
      pattern: "apiClient.*projects"
    - from: "ProjectTaskTable.tsx"
      to: "use-project-detail.ts"
      via: "Hook consumption"
      pattern: "useProjectDetail"
---

<objective>
Build the project detail page - the primary workspace for managing project tasks. Features a Monday.com-style grouped table with inline editing, task creation, group management, and a task detail side panel.

Purpose: This is where users spend most of their time managing project tasks, so it needs to be fast and intuitive.
Output: Project detail page with grouped task table, inline editing, task panel, and group management.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-project-management/21-02-SUMMARY.md
@apps/frontend/src/types/project.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project detail hooks and page layout</name>
  <files>
    apps/frontend/src/hooks/use-project-detail.ts
    apps/frontend/src/app/(authenticated)/projects/[id]/page.tsx
  </files>
  <action>
**Create `hooks/use-project-detail.ts`**:

React Query hooks for project detail operations:

- `useProjectDetail(projectId)`: Fetches `GET /projects/${projectId}` returning project with groups, tasks, columns, task counts. Includes owner relation.
- `useProjectTasks(projectId, filters?)`: Fetches `GET /projects/${projectId}/tasks` with optional filters. Returns tasks with assignee, group, subtask count.
- `useCreateTask(projectId)`: Mutation for `POST /projects/${projectId}/tasks`. Invalidates project detail query on success.
- `useUpdateTask(projectId)`: Mutation for `PUT /projects/${projectId}/tasks/${taskId}`. Optimistic update on task list. Invalidates project detail for progress update.
- `useDeleteTask(projectId)`: Mutation for `DELETE /projects/${projectId}/tasks/${taskId}`.
- `useBulkUpdateTasks(projectId)`: Mutation for `PUT /projects/${projectId}/tasks/bulk`.
- `useReorderTasks(projectId)`: Mutation for `PUT /projects/${projectId}/tasks/reorder`.
- `useCreateGroup(projectId)`: Mutation for `POST /projects/${projectId}/groups`.
- `useUpdateGroup(projectId)`: Mutation for `PUT /projects/${projectId}/groups/${groupId}`.
- `useDeleteGroup(projectId)`: Mutation for `DELETE /projects/${projectId}/groups/${groupId}`.
- `useReorderGroups(projectId)`: Mutation for `PUT /projects/${projectId}/groups/reorder`.
- `useUpdateProject(projectId)`: Mutation for `PUT /projects/${projectId}`.

All use apiClient from `@/lib/api`. All invalidate `['project', projectId]` query key on success. Toast on error.

**Create `app/(authenticated)/projects/[id]/page.tsx`**:

Layout structure:

```
<div className="flex flex-col h-full">
  {/* Header */}
  <ProjectHeader project={project} onUpdate={...} />

  {/* View mode tabs: Table | Board | Timeline */}
  <div className="border-b px-6">
    <ViewModeTabs mode={viewMode} onChange={setViewMode} />
  </div>

  {/* Content based on view mode */}
  {viewMode === 'table' && <ProjectTaskTable project={project} />}
  {viewMode === 'board' && <ProjectBoardView project={project} />}
  {viewMode === 'timeline' && <ProjectTimelineView project={project} />}

  {/* Task detail side panel (slides in from right) */}
  {selectedTask && <TaskDetailPanel task={selectedTask} onClose={...} />}
</div>
```

**ProjectHeader component** (inline in page or extracted):

- Project name (editable on click, uses useUpdateProject)
- Status badge with dropdown to change status
- Progress bar showing progressPercent with "X of Y tasks complete"
- Owner avatar/name with change owner dropdown
- Target date with date picker
- Category badge
- Actions: "Add Group" button, "Settings" button (future)
- Breadcrumb: Projects > Project Name

**ViewModeTabs**: Simple tab bar with Table, Board, Timeline options. Store in URL searchParams or state. Default to 'table'.

For this plan, implement the table view only. Board and timeline views render placeholder components that say "Board view - see Plan 05" and "Timeline view - see Plan 05" respectively. The board view for tasks within a project will be added in Plan 05 alongside the Gantt/timeline view.
</action>
<verify>
`cd apps/frontend && npx tsc --noEmit` passes.
Page renders at /projects/[id] with header and view mode tabs.
</verify>
<done>Project detail page renders with header (name, status, progress, owner, target date). View mode tabs show. Table view placeholder ready for Task 2.</done>
</task>

<task type="auto">
  <name>Task 2: Build grouped task table with inline editing and task panel</name>
  <files>
    apps/frontend/src/components/projects/ProjectTaskTable.tsx
    apps/frontend/src/components/projects/ProjectGroupHeader.tsx
    apps/frontend/src/components/projects/AddTaskRow.tsx
    apps/frontend/src/components/projects/TaskDetailPanel.tsx
  </files>
  <action>
**ProjectTaskTable.tsx** - The main task table component:

Groups tasks by their groupId. For each group, renders:

1. ProjectGroupHeader (collapsible)
2. Task rows within the group
3. AddTaskRow at the bottom of each group
4. An "Ungrouped" section for tasks with no group

Each task row displays columns:

- Checkbox (for bulk select)
- Title (text, click to select task and open panel)
- Status (colored badge dropdown: NOT_STARTED gray, IN_PROGRESS blue, STUCK red, DONE green, CANCELLED gray-strikethrough)
- Priority (icon + label dropdown: LOW arrow-down gray, MEDIUM minus yellow, HIGH arrow-up orange, CRITICAL double-arrow-up red)
- Assignee (avatar + name, click to open user picker popover)
- Due Date (date text, click to open date picker popover)
- Subtask count (if > 0, show as "3 subtasks" badge)

**Inline editing pattern**: Each cell is a clickable element. On click, it transforms into the appropriate input:

- Status: shadcn/ui Select dropdown that closes on selection and calls useUpdateTask
- Priority: shadcn/ui Select dropdown
- Assignee: Popover with user search/select
- Due Date: Popover with Calendar component
- Title: On double-click, becomes an Input field. Enter to save, Escape to cancel.

All inline edits call `useUpdateTask` mutation and show toast on success.

Use @dnd-kit for drag-to-reorder tasks within a group (SortableContext, useSortable on each row). On drag end, call useReorderTasks.

**ProjectGroupHeader.tsx**:

- Renders group name with colored left border (group.color)
- Collapse/expand toggle (ChevronDown/ChevronRight icon)
- Task count badge ("12 tasks")
- Context menu (right-click or three-dot button): Rename, Change Color, Delete Group
- Rename inline: click name to edit, Enter to save via useUpdateGroup
- Delete: confirmation dialog, then useDeleteGroup

**AddTaskRow.tsx**:

- Rendered at bottom of each group
- Shows a muted "+ Add task" button/row
- On click, transforms into inline input for task title
- Enter creates task via useCreateTask with the group's ID pre-set
- Escape cancels
- After creation, input clears and stays ready for next task (rapid task entry)
- Default status: NOT_STARTED, default priority: MEDIUM

**TaskDetailPanel.tsx**:

- Sheet/Drawer that slides in from the right (shadcn/ui Sheet)
- Shows full task detail:
  - Title (editable)
  - Description (textarea, editable)
  - Status, Priority, Assignee, Due Date, Start Date (all editable via form controls)
  - Group (select to move between groups)
  - Subtasks section (list with add subtask button)
  - Custom fields (if any, render from customFields JSON)
  - Created date, last updated
- Delete task button with confirmation
- Close button
- All edits use useUpdateTask with individual field updates

State management: Use a `selectedTaskId` state in the page. When set, TaskDetailPanel opens. Task table row click sets it. Panel close clears it. URL searchParam `?task=taskId` for deep linking.
</action>
<verify>
`cd apps/frontend && npx tsc --noEmit` passes.
ProjectTaskTable renders grouped tasks.
Inline editing updates task via API.
AddTaskRow creates new tasks.
TaskDetailPanel opens on task click.
</verify>
<done>
Grouped task table renders with inline editing for status, priority, assignee, due date. Group headers with collapse/rename/delete. Add task row for rapid task creation. Task detail panel slides in from right with full editing.
</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- Project detail page at /projects/[id] shows project header and grouped task table
- Inline status/priority/assignee/date editing works
- Add task creates new tasks in correct group
- Task detail panel opens with full editing
- Group collapse/expand works
</verification>

<success_criteria>

- Monday.com-style grouped task table with colored group headers
- Inline editing for all key task fields
- Rapid task creation via add-task row
- Task detail side panel with full editing
- Group management (create, rename, delete, collapse)
- Progress updates on task status changes
  </success_criteria>

<output>
After completion, create `.planning/phases/21-project-management/21-04-SUMMARY.md`
</output>
