---
phase: 16-ai-integration-fix
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/16-ai-integration-fix/16-EXECUTION-NOTES.md
autonomous: true

must_haves:
  truths:
    - "Execution notes document clarifies which plans are skipped/modified due to Phase 15 overlap"
    - "Plans 02, 03, and 06 are marked with specific instructions for executors"
    - "Phase 15 ai-chat-panel.tsx is preserved, not replaced"
  artifacts:
    - path: ".planning/phases/16-ai-integration-fix/16-EXECUTION-NOTES.md"
      provides: "Executor guidance for Phase 16 execution"
      contains: "Phase 15 Overlap"
  key_links: []
---

<objective>
Create an execution notes document that clarifies the overlap between Phase 15's completed work and Phase 16 plans 01-06. This prevents executors from being confused by plans that instruct them to create components that already exist.

Purpose: Plans 02, 03, and 06 were created before Phase 15 completed and contain outdated instructions. This plan documents exactly what should be skipped, modified, or executed as-is.
Output: 16-EXECUTION-NOTES.md with clear guidance for each plan.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/16-ai-integration-fix/16-01-PLAN.md
@.planning/phases/16-ai-integration-fix/16-02-PLAN.md
@.planning/phases/16-ai-integration-fix/16-03-PLAN.md
@.planning/phases/16-ai-integration-fix/16-04-PLAN.md
@.planning/phases/16-ai-integration-fix/16-05-PLAN.md
@.planning/phases/16-ai-integration-fix/16-06-PLAN.md

Key Phase 15 files to reference:
@apps/frontend/src/components/cases/ai-chat-panel.tsx
@apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create execution notes documenting Phase 15 overlap</name>
  <files>.planning/phases/16-ai-integration-fix/16-EXECUTION-NOTES.md</files>
  <action>
Create a markdown document that provides clear guidance for each Phase 16 plan. Content:

```markdown
# Phase 16 Execution Notes

## Critical: Phase 15 Overlap

Phase 15 (Case Detail Page Overhaul) was completed AFTER plans 16-01 through 16-06 were created. This means several plans contain instructions that overlap with or duplicate work already done in Phase 15.

**Phase 15 Built:**

1. `apps/frontend/src/components/cases/ai-chat-panel.tsx` (638 lines) - Complete WebSocket streaming chat
2. `socket.io-client` installed in `apps/frontend/package.json`
3. Case detail page (`apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx`) has:
   - AI button in action row that opens Sheet overlay
   - `<AiChatPanel entityType="case" entityId={caseData.id} />`
   - `onActionComplete={fetchCase}` for refreshing after AI actions
4. WebSocket events working: text_delta, message_complete, tool_use, action_executed, error, stop
5. AI actions verified: change-status and add-case-note work with Zod 4.x compatibility fix

---

## Plan-by-Plan Execution Guidance

### 16-01: Backend REST chat endpoint + auth guard + context-loader fallback

**Status: EXECUTE AS-IS**

This plan adds backend robustness that Phase 15 did not cover:

- REST fallback endpoint (POST /ai/chat)
- OptionalJwtAuthGuard for graceful auth handling
- ContextLoaderService fallback for missing org/user

Execute all tasks as written.

---

### 16-02: AI panel context + useAiChat hook + rewrite ai-panel.tsx

**Status: SKIP ENTIRELY**

Phase 15 already built `ai-chat-panel.tsx` with:

- WebSocket streaming chat (more advanced than the REST-based useAiChat this plan creates)
- Entity context passed as props (entityType, entityId)
- Conversation history loading
- Connection status indicators
- Suggested prompts

DO NOT execute this plan. The Phase 15 implementation is superior and already integrated.

---

### 16-03: Install socket.io-client + useAiSocket + AiSocketProvider + useAiStreamingChat

**Status: SKIP ENTIRELY**

Phase 15 already:

- Installed `socket.io-client`
- Implemented WebSocket connection directly in `ai-chat-panel.tsx` with a module-level singleton pattern
- Handles text_delta, message_complete, tool_use, action_executed, error events

DO NOT execute this plan. The Phase 15 implementation is complete.

---

### 16-04: AI skill components (summarize, category-suggest, risk-score)

**Status: EXECUTE AS-IS**

This plan creates frontend components for AI skills that Phase 15 did not build:

- `useAiSkills` generic hook
- `AiSummaryButton` component
- `AiCategorySuggest` component
- `AiRiskScore` component

These are additive and do not conflict with Phase 15 work. Execute all tasks.

---

### 16-05: AI action preview components + useAiActions hook

**Status: PARTIAL EXECUTION**

Phase 15 built action execution but not the preview-then-execute pattern UI.

Execute:

- Task 1: Create useAiActions hook (preview, execute, undo, listActions)
- Task 2: Create AiActionPreview dialog component

Skip:

- Task 3: "Integrate action capabilities into AI panel" - ai-chat-panel.tsx has a different architecture. Actions are executed via WebSocket events, not via REST preview/execute flow. Integration would require refactoring the existing component.

---

### 16-06: Health check + case detail wiring + graceful degradation + AiSocketProvider

**Status: PARTIAL EXECUTION**

Execute:

- Task 1: Add AI health check endpoint (GET /api/v1/ai/health) - still needed

Skip:

- Task 2: Wire AI button on case detail page - ALREADY DONE in Phase 15
- Task 3: Add graceful degradation to AI panel - ai-chat-panel.tsx already handles connection errors
- Task 4: Add AiSocketProvider to app layout - Phase 15 uses a different pattern (module-level singleton)

---

## Summary

| Plan  | Status  | Reason                                                        |
| ----- | ------- | ------------------------------------------------------------- |
| 16-01 | EXECUTE | Backend robustness not covered by Phase 15                    |
| 16-02 | SKIP    | Phase 15 built ai-chat-panel.tsx                              |
| 16-03 | SKIP    | Phase 15 installed socket.io-client and implemented WebSocket |
| 16-04 | EXECUTE | Skill components are additive                                 |
| 16-05 | PARTIAL | Create hook/dialog, skip integration task                     |
| 16-06 | PARTIAL | Only health check endpoint needed                             |

## Recommended Execution Order

1. Execute 16-01 (Wave 1 - backend)
2. Execute 16-04 (Wave 1 - skill components, no backend dependency)
3. Execute 16-05 Tasks 1-2 only (Wave 1 - action components)
4. Execute 16-06 Task 1 only (Wave 1 - health check)
5. Execute 16-08 (verification - see Plan 16-08)
```

  </action>
  <verify>
The file exists at `.planning/phases/16-ai-integration-fix/16-EXECUTION-NOTES.md` with content covering all 6 plans.
  </verify>
  <done>
Execution notes document created with clear guidance for each plan, documenting Phase 15 overlap and providing skip/execute/partial recommendations.
  </done>
</task>

</tasks>

<verification>
1. 16-EXECUTION-NOTES.md exists in phase directory
2. Document covers all 6 existing plans with status (EXECUTE/SKIP/PARTIAL)
3. Phase 15 overlap is clearly documented with specific file references
4. Recommended execution order is provided
</verification>

<success_criteria>

- Executors have clear guidance on which plans to skip
- Phase 15 work is preserved and not duplicated
- Only additive work proceeds
  </success_criteria>

<output>
After completion, create `.planning/phases/16-ai-integration-fix/16-07-SUMMARY.md`
</output>
