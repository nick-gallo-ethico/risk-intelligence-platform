---
phase: 12-internal-operations-portal
plan: 10
type: execute
wave: 3
depends_on: ["12-05", "12-09"]
files_modified:
  - apps/backend/src/modules/operations/implementation/go-live.service.ts
  - apps/backend/src/modules/operations/implementation/dto/go-live.dto.ts
  - apps/backend/src/modules/operations/implementation/implementation.controller.ts
  - apps/backend/src/modules/operations/implementation/implementation.module.ts
autonomous: true

must_haves:
  truths:
    - "Go-live readiness score aggregates tasks, training, and blockers"
    - "Checklist engine validates all required items are complete"
    - "Sign-off workflow captures stakeholder approvals"
    - "Readiness report can be generated for client review"
  artifacts:
    - path: "apps/backend/src/modules/operations/implementation/go-live.service.ts"
      provides: "Readiness score calculation, checklist validation, sign-off workflow"
      exports: ["GoLiveService"]
  key_links:
    - from: "go-live.service.ts"
      to: "ChecklistService"
      via: "Task completion status"
      pattern: "checklistService\\."
    - from: "go-live.service.ts"
      to: "TrainingAdminService"
      via: "Training readiness check"
      pattern: "trainingService\\.checkGoLiveReadiness"
---

<objective>
Create the Go-Live Readiness service that aggregates all implementation requirements to determine if a client is ready to launch.

Purpose: Implementation team needs a single view of go-live readiness that combines task completion, training status, blocker resolution, and stakeholder sign-offs. This prevents premature go-lives and ensures consistent launch quality.

Output: GoLiveService with readiness calculation, checklist validation, sign-off workflow; extended controller endpoints.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-internal-operations-portal/12-05-SUMMARY.md
@.planning/phases/12-internal-operations-portal/12-09-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Go-Live DTOs</name>
  <files>apps/backend/src/modules/operations/implementation/dto/go-live.dto.ts</files>
  <action>
Create DTOs for go-live readiness:

```typescript
import { IsString, IsOptional, IsEnum, IsBoolean } from 'class-validator';

// Readiness categories
export enum ReadinessCategory {
  TASKS = 'TASKS',
  TRAINING = 'TRAINING',
  BLOCKERS = 'BLOCKERS',
  SIGN_OFFS = 'SIGN_OFFS',
  DATA_MIGRATION = 'DATA_MIGRATION',
  INTEGRATIONS = 'INTEGRATIONS',
}

// Readiness status per category
export interface CategoryReadiness {
  category: ReadinessCategory;
  name: string;
  isReady: boolean;
  score: number; // 0-100
  issues: string[];
  details?: Record<string, unknown>;
}

// Overall readiness report
export interface ReadinessReport {
  projectId: string;
  projectName: string;
  organizationName: string;
  goLiveDate?: Date;
  overallScore: number;
  isReady: boolean;
  categories: CategoryReadiness[];
  blockingIssues: string[];
  recommendations: string[];
  generatedAt: Date;
  generatedBy: string;
}

// Sign-off types
export enum SignOffType {
  CLIENT_ADMIN = 'CLIENT_ADMIN',
  CLIENT_EXECUTIVE = 'CLIENT_EXECUTIVE',
  IMPLEMENTATION_SPECIALIST = 'IMPLEMENTATION_SPECIALIST',
  IMPLEMENTATION_MANAGER = 'IMPLEMENTATION_MANAGER',
  PLATFORM_ADMIN = 'PLATFORM_ADMIN',
}

// Sign-off record
export interface SignOff {
  id: string;
  projectId: string;
  type: SignOffType;
  signedById: string;
  signedByName: string;
  signedByEmail: string;
  signedAt: Date;
  notes?: string;
}

// DTOs
export class RequestSignOffDto {
  @IsString()
  projectId: string;

  @IsEnum(SignOffType)
  type: SignOffType;

  @IsOptional()
  @IsString()
  notes?: string;
}

export class RecordSignOffDto {
  @IsString()
  projectId: string;

  @IsEnum(SignOffType)
  type: SignOffType;

  @IsOptional()
  @IsString()
  notes?: string;
}

export class RevokeSignOffDto {
  @IsString()
  signOffId: string;

  @IsString()
  reason: string;
}

export class GenerateReportDto {
  @IsString()
  projectId: string;

  @IsOptional()
  @IsBoolean()
  includeDetails?: boolean;
}

// Required sign-offs for go-live
export const REQUIRED_SIGN_OFFS: SignOffType[] = [
  SignOffType.CLIENT_ADMIN,
  SignOffType.IMPLEMENTATION_SPECIALIST,
];

// Recommended sign-offs
export const RECOMMENDED_SIGN_OFFS: SignOffType[] = [
  SignOffType.CLIENT_EXECUTIVE,
  SignOffType.IMPLEMENTATION_MANAGER,
];
```
  </action>
  <verify>npx tsc --noEmit compiles without errors</verify>
  <done>Go-live readiness DTOs and types defined</done>
</task>

<task type="auto">
  <name>Task 2: Create GoLiveService with readiness calculation</name>
  <files>apps/backend/src/modules/operations/implementation/go-live.service.ts</files>
  <action>
Create GoLiveService that aggregates all readiness factors:

1. **Inject dependencies:**
   - PrismaService
   - ChecklistService
   - TrainingAdminService
   - AuditService
   - Logger

2. **calculateReadiness(projectId: string):**
   - Get project with all relations
   - Calculate each category:
     ```typescript
     const categories: CategoryReadiness[] = [
       await this.calculateTaskReadiness(project),
       await this.calculateTrainingReadiness(project),
       await this.calculateBlockerReadiness(project),
       await this.calculateSignOffReadiness(project),
       await this.calculateMigrationReadiness(project),
       await this.calculateIntegrationReadiness(project),
     ];
     ```
   - Calculate overall score (weighted average)
   - Determine isReady (all required categories ready)
   - Return ReadinessReport

3. **calculateTaskReadiness(project):**
   - Get completed required tasks vs total required tasks
   - Score = (completed / total) * 100
   - Issues = list of incomplete required tasks
   - isReady = score === 100

4. **calculateTrainingReadiness(project):**
   - Call trainingService.checkGoLiveReadiness(projectId)
   - Score based on completion rate
   - Issues = incomplete required certifications
   - isReady = all required training complete

5. **calculateBlockerReadiness(project):**
   - Count unresolved blockers
   - Score = 100 if no blockers, else 100 - (blockers * 10)
   - Issues = list of unresolved blocker titles
   - isReady = no blockers

6. **calculateSignOffReadiness(project):**
   - Check REQUIRED_SIGN_OFFS are present
   - Score = (obtained / required) * 100
   - Issues = missing required sign-offs
   - isReady = all required sign-offs obtained

7. **calculateMigrationReadiness(project):**
   - Check if DATA_MIGRATION phase tasks complete
   - Or check if migration marked as N/A
   - Score based on completion
   - isReady if complete or N/A

8. **calculateIntegrationReadiness(project):**
   - Check INTEGRATIONS phase tasks
   - Score based on completion
   - isReady if complete

9. **recordSignOff(userId: string, dto: RecordSignOffDto):**
   - Create sign-off record (model to be added to schema)
   - Log to audit
   - Return sign-off

10. **revokeSignOff(userId: string, dto: RevokeSignOffDto):**
    - Mark sign-off as revoked with reason
    - Log to audit

11. **getSignOffs(projectId: string):**
    - Get all sign-offs for project
    - Group by type

12. **generateReport(dto: GenerateReportDto, generatorId: string):**
    - Calculate full readiness
    - Build report object
    - If includeDetails, add detailed breakdown
    - Return ReadinessReport
    - Optionally generate PDF (future enhancement)

13. **getReadinessSummary(projectId: string):**
    - Quick version without full details
    - Return { score, isReady, blockingIssues }
  </action>
  <verify>npx tsc --noEmit compiles without errors</verify>
  <done>GoLiveService calculates readiness from all categories with sign-off workflow</done>
</task>

<task type="auto">
  <name>Task 3: Add Prisma model and extend Implementation Controller</name>
  <files>
    apps/backend/prisma/schema.prisma
    apps/backend/src/modules/operations/implementation/implementation.controller.ts
    apps/backend/src/modules/operations/implementation/implementation.module.ts
  </files>
  <action>
**Add to schema.prisma:**
```prisma
model ImplementationSignOff {
  id          String      @id @default(uuid())
  projectId   String
  type        String      // SignOffType enum value
  signedById  String
  signedByName String
  signedByEmail String
  signedAt    DateTime    @default(now())
  notes       String?
  isRevoked   Boolean     @default(false)
  revokedAt   DateTime?
  revokedById String?
  revokedReason String?
  createdAt   DateTime    @default(now())

  project     ImplementationProject @relation(fields: [projectId], references: [id])

  @@index([projectId])
  @@index([projectId, type])
}
```

Also add relation to ImplementationProject:
```prisma
model ImplementationProject {
  // ... existing fields ...
  signOffs    ImplementationSignOff[]
}
```

**Update implementation.controller.ts - add go-live endpoints:**
```typescript
// Go-Live Readiness endpoints
@Get('projects/:id/readiness')
async getReadiness(@Param('id') id: string) {
  return this.goLiveService.calculateReadiness(id);
}

@Get('projects/:id/readiness/summary')
async getReadinessSummary(@Param('id') id: string) {
  return this.goLiveService.getReadinessSummary(id);
}

@Post('projects/:id/readiness/report')
async generateReport(
  @Param('id') id: string,
  @Body() dto: GenerateReportDto,
  @CurrentInternalUser() user: InternalUser,
) {
  return this.goLiveService.generateReport({ ...dto, projectId: id }, user.id);
}

// Sign-off endpoints
@Get('projects/:id/sign-offs')
async getSignOffs(@Param('id') id: string) {
  return this.goLiveService.getSignOffs(id);
}

@Post('projects/:id/sign-offs')
async recordSignOff(
  @Param('id') id: string,
  @Body() dto: RecordSignOffDto,
  @CurrentInternalUser() user: InternalUser,
) {
  return this.goLiveService.recordSignOff(user.id, { ...dto, projectId: id });
}

@Delete('sign-offs/:signOffId')
async revokeSignOff(
  @Param('signOffId') signOffId: string,
  @Body() body: { reason: string },
  @CurrentInternalUser() user: InternalUser,
) {
  return this.goLiveService.revokeSignOff(user.id, { signOffId, reason: body.reason });
}
```

**Update implementation.module.ts:**
- Add GoLiveService to providers
- Import TrainingModule
  </action>
  <verify>npx prisma validate; npm run lint; npx tsc --noEmit</verify>
  <done>Go-live readiness endpoints added with sign-off workflow</done>
</task>

</tasks>

<verification>
1. Run `npx prisma validate` - schema is valid
2. Run `npx tsc --noEmit` from apps/backend - TypeScript compiles
3. Run `npm run lint` - no lint errors
4. Verify readiness calculation includes all 6 categories
5. Verify REQUIRED_SIGN_OFFS must be complete for isReady=true
6. Verify sign-off revocation preserves audit trail
</verification>

<success_criteria>
- GoLiveService calculates readiness from tasks, training, blockers, sign-offs, migration, integrations
- Overall score is weighted average of category scores
- isReady requires all categories to be ready AND required sign-offs present
- Sign-off workflow supports record, get, and revoke operations
- Readiness report aggregates all information for client review
- ImplementationSignOff model preserves sign-off history including revocations
</success_criteria>

<output>
After completion, create `.planning/phases/12-internal-operations-portal/12-10-SUMMARY.md`
</output>
