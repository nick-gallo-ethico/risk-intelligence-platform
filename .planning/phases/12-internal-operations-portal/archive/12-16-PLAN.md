---
phase: 12-internal-operations-portal
plan: 16
type: execute
wave: 5
depends_on: ["12-09"]
files_modified:
  - apps/frontend/src/pages/internal/training/TrainingPortalPage.tsx
  - apps/frontend/src/pages/internal/training/CourseCatalog.tsx
  - apps/frontend/src/pages/internal/training/CertificationStatus.tsx
  - apps/frontend/src/pages/internal/training/ExamInterface.tsx
  - apps/frontend/src/pages/internal/training/TrackManager.tsx
  - apps/frontend/src/services/internal/training.api.ts
autonomous: true

must_haves:
  truths:
    - "Course catalog displays tracks grouped by type with progress indicators"
    - "Certification status shows completion percentage and remaining courses"
    - "Exam interface provides timed assessments with scoring"
    - "Track manager enables CRUD for certification tracks and courses"
    - "Progress updates reflect in real-time as courses complete"
  artifacts:
    - path: "apps/frontend/src/pages/internal/training/TrainingPortalPage.tsx"
      provides: "Main training portal with role-based views"
      exports: ["TrainingPortalPage"]
    - path: "apps/frontend/src/pages/internal/training/CourseCatalog.tsx"
      provides: "Course listing with filtering and enrollment"
      exports: ["CourseCatalog"]
    - path: "apps/frontend/src/pages/internal/training/ExamInterface.tsx"
      provides: "Exam taking UI with timer and scoring"
      exports: ["ExamInterface"]
  key_links:
    - from: "training.api.ts"
      to: "/api/v1/internal/training"
      via: "API calls"
      pattern: "/internal/training"
---

<objective>
Create the Training Portal UI that enables staff to view courses, complete training, take exams, and track certification progress. Also provides admin capabilities for managing tracks and courses.

Purpose: Implementation and support teams need training certifications as part of onboarding and ongoing development. This UI consumes the 12-09 backend service.

Output: TrainingPortalPage, CourseCatalog, CertificationStatus, ExamInterface, TrackManager components; API service.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-internal-operations-portal/12-09-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Training API service</name>
  <files>apps/frontend/src/services/internal/training.api.ts</files>
  <action>
Create API service for training operations:

```typescript
import { api } from '../api';

export type TrackType = 'INTERNAL' | 'CLIENT_ADMIN' | 'CLIENT_INVESTIGATOR' | 'CLIENT_EMPLOYEE';
export type CourseStatus = 'NOT_STARTED' | 'IN_PROGRESS' | 'COMPLETED' | 'FAILED';

export interface CertificationTrack {
  id: string;
  name: string;
  description?: string;
  type: TrackType;
  isActive: boolean;
  requiredForGoLive: boolean;
  estimatedHours?: number;
  coursesCount: number;
  requiredCoursesCount: number;
  createdAt: string;
}

export interface Course {
  id: string;
  trackId: string;
  name: string;
  description?: string;
  contentUrl?: string;
  estimatedMinutes?: number;
  sortOrder: number;
  isRequired: boolean;
  hasExam: boolean;
  passingScore?: number;
}

export interface CourseWithProgress extends Course {
  status: CourseStatus;
  startedAt?: string;
  completedAt?: string;
  examScore?: number;
  examAttempts: number;
}

export interface TrainingProgress {
  id: string;
  userId: string;
  trackId: string;
  track: CertificationTrack;
  status: CourseStatus;
  startedAt?: string;
  completedAt?: string;
  certificateUrl?: string;
  courseProgress: CourseWithProgress[];
  completedCourses: number;
  totalCourses: number;
  progressPercent: number;
}

export interface TrackWithProgress {
  id: string;
  name: string;
  type: TrackType;
  totalCourses: number;
  completedCourses: number;
  progressPercent: number;
  status: CourseStatus;
  isRequired: boolean;
}

export interface CertificationSummary {
  trackId: string;
  trackName: string;
  totalEnrolled: number;
  completed: number;
  inProgress: number;
  notStarted: number;
  completionRate: number;
}

export interface ExamQuestion {
  id: string;
  question: string;
  options: string[];
  correctIndex?: number; // Only returned after submission
}

export interface ExamSession {
  courseId: string;
  courseName: string;
  questions: ExamQuestion[];
  timeLimit: number; // minutes
  passingScore: number;
  attemptNumber: number;
}

export interface ExamResult {
  passed: boolean;
  score: number;
  passingScore: number;
  correctAnswers: number;
  totalQuestions: number;
  feedback?: { questionId: string; correct: boolean; explanation?: string }[];
}

export const trainingApi = {
  // Tracks
  listTracks: (params?: { type?: TrackType; isActive?: boolean; page?: number; limit?: number }) =>
    api.get<{ items: CertificationTrack[]; total: number }>('/internal/training/tracks', { params }),

  getTrack: (id: string) =>
    api.get<CertificationTrack & { courses: Course[] }>(`/internal/training/tracks/${id}`),

  createTrack: (data: Omit<CertificationTrack, 'id' | 'coursesCount' | 'requiredCoursesCount' | 'createdAt'>) =>
    api.post<CertificationTrack>('/internal/training/tracks', data),

  updateTrack: (id: string, data: Partial<CertificationTrack>) =>
    api.patch<CertificationTrack>(`/internal/training/tracks/${id}`, data),

  deleteTrack: (id: string) =>
    api.delete(`/internal/training/tracks/${id}`),

  // Courses
  createCourse: (data: Omit<Course, 'id'>) =>
    api.post<Course>('/internal/training/courses', data),

  updateCourse: (id: string, data: Partial<Course>) =>
    api.patch<Course>(`/internal/training/courses/${id}`, data),

  deleteCourse: (id: string) =>
    api.delete(`/internal/training/courses/${id}`),

  reorderCourses: (trackId: string, ids: string[]) =>
    api.post(`/internal/training/tracks/${trackId}/courses/reorder`, { ids }),

  // Enrollment & Progress
  enrollInTrack: (trackId: string) =>
    api.post<TrainingProgress>('/internal/training/enroll', { trackId }),

  getMyProgress: (trackId: string) =>
    api.get<TrainingProgress>(`/internal/training/progress/me/${trackId}`),

  getMyTracks: () =>
    api.get<TrackWithProgress[]>('/internal/training/progress/me'),

  startCourse: (courseProgressId: string) =>
    api.post(`/internal/training/course-progress/${courseProgressId}/start`),

  completeCourse: (courseProgressId: string) =>
    api.post(`/internal/training/course-progress/${courseProgressId}/complete`),

  // Exams
  startExam: (courseId: string) =>
    api.post<ExamSession>(`/internal/training/courses/${courseId}/exam/start`),

  submitExam: (courseId: string, answers: { questionId: string; selectedIndex: number }[]) =>
    api.post<ExamResult>(`/internal/training/courses/${courseId}/exam/submit`, { answers }),

  // Admin: View others' progress
  getUserProgress: (userId: string, trackId: string) =>
    api.get<TrainingProgress>(`/internal/training/progress/${userId}/${trackId}`),

  getTrackSummary: (trackId: string) =>
    api.get<CertificationSummary>(`/internal/training/tracks/${trackId}/summary`),

  // Project integration
  getProjectTrainingStatus: (projectId: string) =>
    api.get(`/internal/training/projects/${projectId}/status`),

  assignTrainingToProject: (projectId: string, data: { trackId: string; targetRole: string; requiredCompletions: number; dueDate?: string }) =>
    api.post(`/internal/training/projects/${projectId}/assign`, data),
};
```
  </action>
  <verify>npx tsc --noEmit compiles without errors</verify>
  <done>Training API service created with tracks, courses, progress, and exam endpoints</done>
</task>

<task type="auto">
  <name>Task 2: Create CourseCatalog and CertificationStatus components</name>
  <files>
    apps/frontend/src/pages/internal/training/CourseCatalog.tsx
    apps/frontend/src/pages/internal/training/CertificationStatus.tsx
  </files>
  <action>
**pages/internal/training/CourseCatalog.tsx:**
```typescript
import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { trainingApi, CertificationTrack, TrackType, Course } from '@/services/internal/training.api';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion';
import { BookOpen, Clock, CheckCircle2, Play, Award } from 'lucide-react';

interface CourseCatalogProps {
  onCourseSelect?: (courseId: string) => void;
  onExamStart?: (courseId: string) => void;
}

const trackTypeLabels: Record<TrackType, string> = {
  INTERNAL: 'Internal Staff',
  CLIENT_ADMIN: 'Client Administrators',
  CLIENT_INVESTIGATOR: 'Client Investigators',
  CLIENT_EMPLOYEE: 'Client Employees',
};

export function CourseCatalog({ onCourseSelect, onExamStart }: CourseCatalogProps) {
  const queryClient = useQueryClient();
  const [typeFilter, setTypeFilter] = useState<TrackType | ''>('');

  const { data: tracks, isLoading } = useQuery({
    queryKey: ['training-tracks', typeFilter],
    queryFn: () => trainingApi.listTracks({ type: typeFilter || undefined, isActive: true }),
  });

  const { data: myTracks } = useQuery({
    queryKey: ['my-training-tracks'],
    queryFn: () => trainingApi.getMyTracks(),
  });

  const enrollMutation = useMutation({
    mutationFn: trainingApi.enrollInTrack,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['my-training-tracks'] });
    },
  });

  const getMyProgress = (trackId: string) => {
    return myTracks?.find(t => t.id === trackId);
  };

  const isEnrolled = (trackId: string) => {
    return myTracks?.some(t => t.id === trackId);
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-xl font-semibold">Course Catalog</h2>
          <p className="text-gray-500">Browse and enroll in certification tracks</p>
        </div>
        <Select value={typeFilter} onValueChange={(v) => setTypeFilter(v as TrackType | '')}>
          <SelectTrigger className="w-48">
            <SelectValue placeholder="All Track Types" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="">All Track Types</SelectItem>
            {Object.entries(trackTypeLabels).map(([key, label]) => (
              <SelectItem key={key} value={key}>{label}</SelectItem>
            ))}
          </SelectContent>
        </Select>
      </div>

      {isLoading && <div>Loading tracks...</div>}

      <div className="space-y-4">
        {tracks?.items.map((track) => {
          const progress = getMyProgress(track.id);
          const enrolled = isEnrolled(track.id);

          return (
            <Card key={track.id}>
              <CardHeader>
                <div className="flex items-start justify-between">
                  <div>
                    <CardTitle className="flex items-center gap-2">
                      <Award className="h-5 w-5 text-blue-600" />
                      {track.name}
                    </CardTitle>
                    <CardDescription>{track.description}</CardDescription>
                  </div>
                  <div className="flex items-center gap-2">
                    <Badge variant="outline">{trackTypeLabels[track.type]}</Badge>
                    {track.requiredForGoLive && (
                      <Badge variant="destructive">Required for Go-Live</Badge>
                    )}
                  </div>
                </div>
              </CardHeader>
              <CardContent className="space-y-4">
                {/* Track Stats */}
                <div className="flex items-center gap-6 text-sm text-gray-500">
                  <div className="flex items-center gap-1">
                    <BookOpen className="h-4 w-4" />
                    {track.coursesCount} courses ({track.requiredCoursesCount} required)
                  </div>
                  {track.estimatedHours && (
                    <div className="flex items-center gap-1">
                      <Clock className="h-4 w-4" />
                      ~{track.estimatedHours} hours
                    </div>
                  )}
                </div>

                {/* Progress (if enrolled) */}
                {progress && (
                  <div className="space-y-2">
                    <div className="flex justify-between text-sm">
                      <span>Progress</span>
                      <span>{progress.completedCourses}/{progress.totalCourses} courses</span>
                    </div>
                    <Progress value={progress.progressPercent} />
                  </div>
                )}

                {/* Action */}
                <div className="flex justify-end">
                  {!enrolled ? (
                    <Button
                      onClick={() => enrollMutation.mutate(track.id)}
                      disabled={enrollMutation.isPending}
                    >
                      <Play className="h-4 w-4 mr-2" />
                      Enroll Now
                    </Button>
                  ) : progress?.status === 'COMPLETED' ? (
                    <Button variant="outline" disabled>
                      <CheckCircle2 className="h-4 w-4 mr-2 text-green-600" />
                      Completed
                    </Button>
                  ) : (
                    <Button onClick={() => onCourseSelect?.(track.id)}>
                      Continue Learning
                    </Button>
                  )}
                </div>
              </CardContent>
            </Card>
          );
        })}
      </div>
    </div>
  );
}
```

**pages/internal/training/CertificationStatus.tsx:**
```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { trainingApi, TrainingProgress, CourseStatus } from '@/services/internal/training.api';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { CheckCircle2, Circle, Play, FileText, Award, Clock } from 'lucide-react';
import { cn } from '@/lib/utils';

interface CertificationStatusProps {
  trackId: string;
  onStartCourse?: (courseProgressId: string, contentUrl?: string) => void;
  onStartExam?: (courseId: string) => void;
}

export function CertificationStatus({ trackId, onStartCourse, onStartExam }: CertificationStatusProps) {
  const queryClient = useQueryClient();

  const { data: progress, isLoading } = useQuery({
    queryKey: ['my-progress', trackId],
    queryFn: () => trainingApi.getMyProgress(trackId),
  });

  const startCourseMutation = useMutation({
    mutationFn: trainingApi.startCourse,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['my-progress', trackId] });
    },
  });

  const completeCourseMutation = useMutation({
    mutationFn: trainingApi.completeCourse,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['my-progress', trackId] });
    },
  });

  if (isLoading) return <div>Loading...</div>;
  if (!progress) return <div>Not enrolled in this track</div>;

  const getStatusIcon = (status: CourseStatus) => {
    switch (status) {
      case 'COMPLETED':
        return <CheckCircle2 className="h-5 w-5 text-green-600" />;
      case 'IN_PROGRESS':
        return <Clock className="h-5 w-5 text-blue-600" />;
      case 'FAILED':
        return <Circle className="h-5 w-5 text-red-600" />;
      default:
        return <Circle className="h-5 w-5 text-gray-300" />;
    }
  };

  const getStatusBadge = (status: CourseStatus) => {
    const variants: Record<CourseStatus, 'default' | 'secondary' | 'destructive' | 'outline'> = {
      COMPLETED: 'default',
      IN_PROGRESS: 'secondary',
      FAILED: 'destructive',
      NOT_STARTED: 'outline',
    };
    return <Badge variant={variants[status]}>{status.replace('_', ' ')}</Badge>;
  };

  return (
    <div className="space-y-6">
      {/* Overall Progress */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Award className="h-5 w-5 text-blue-600" />
            {progress.track.name}
          </CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="flex items-center gap-4">
            <div className="flex-1">
              <Progress value={progress.progressPercent} className="h-4" />
            </div>
            <span className="text-lg font-bold">{progress.progressPercent}%</span>
          </div>
          <div className="flex justify-between text-sm text-gray-500">
            <span>{progress.completedCourses} of {progress.totalCourses} courses completed</span>
            {getStatusBadge(progress.status)}
          </div>
          {progress.certificateUrl && (
            <Button variant="outline" asChild>
              <a href={progress.certificateUrl} target="_blank" rel="noopener noreferrer">
                <FileText className="h-4 w-4 mr-2" />
                View Certificate
              </a>
            </Button>
          )}
        </CardContent>
      </Card>

      {/* Course List */}
      <Card>
        <CardHeader>
          <CardTitle>Courses</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-3">
            {progress.courseProgress.map((course, index) => (
              <div
                key={course.id}
                className={cn(
                  "flex items-center gap-4 p-4 border rounded-lg",
                  course.status === 'COMPLETED' && "bg-green-50 border-green-200",
                  course.status === 'IN_PROGRESS' && "bg-blue-50 border-blue-200"
                )}
              >
                <div className="flex items-center gap-3 flex-1">
                  {getStatusIcon(course.status)}
                  <div>
                    <div className="font-medium">
                      {index + 1}. {course.name}
                      {course.isRequired && (
                        <Badge variant="outline" className="ml-2">Required</Badge>
                      )}
                    </div>
                    {course.description && (
                      <p className="text-sm text-gray-500">{course.description}</p>
                    )}
                    {course.estimatedMinutes && (
                      <p className="text-xs text-gray-400">{course.estimatedMinutes} min</p>
                    )}
                  </div>
                </div>

                <div className="flex items-center gap-2">
                  {course.hasExam && course.status === 'COMPLETED' && (
                    <Badge variant="secondary">
                      Score: {course.examScore}%
                    </Badge>
                  )}

                  {course.status === 'NOT_STARTED' && (
                    <Button
                      size="sm"
                      onClick={() => {
                        startCourseMutation.mutate(course.id);
                        onStartCourse?.(course.id, course.contentUrl);
                      }}
                    >
                      <Play className="h-4 w-4 mr-1" />
                      Start
                    </Button>
                  )}

                  {course.status === 'IN_PROGRESS' && !course.hasExam && (
                    <Button
                      size="sm"
                      onClick={() => completeCourseMutation.mutate(course.id)}
                    >
                      <CheckCircle2 className="h-4 w-4 mr-1" />
                      Mark Complete
                    </Button>
                  )}

                  {course.status === 'IN_PROGRESS' && course.hasExam && (
                    <Button
                      size="sm"
                      onClick={() => onStartExam?.(course.id)}
                    >
                      Take Exam
                    </Button>
                  )}

                  {course.status === 'FAILED' && course.hasExam && (
                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() => onStartExam?.(course.id)}
                    >
                      Retry Exam ({course.examAttempts} attempts)
                    </Button>
                  )}
                </div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```
  </action>
  <verify>npx tsc --noEmit compiles without errors</verify>
  <done>CourseCatalog and CertificationStatus components created</done>
</task>

<task type="auto">
  <name>Task 3: Create ExamInterface, TrackManager, and TrainingPortalPage</name>
  <files>
    apps/frontend/src/pages/internal/training/ExamInterface.tsx
    apps/frontend/src/pages/internal/training/TrackManager.tsx
    apps/frontend/src/pages/internal/training/TrainingPortalPage.tsx
  </files>
  <action>
**pages/internal/training/ExamInterface.tsx:**
```typescript
import { useState, useEffect } from 'react';
import { useMutation } from '@tanstack/react-query';
import { trainingApi, ExamSession, ExamResult, ExamQuestion } from '@/services/internal/training.api';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';
import { Label } from '@/components/ui/label';
import { Progress } from '@/components/ui/progress';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Clock, CheckCircle2, XCircle, AlertTriangle } from 'lucide-react';

interface ExamInterfaceProps {
  courseId: string;
  onComplete: (passed: boolean) => void;
  onCancel: () => void;
}

export function ExamInterface({ courseId, onComplete, onCancel }: ExamInterfaceProps) {
  const [session, setSession] = useState<ExamSession | null>(null);
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [answers, setAnswers] = useState<Record<string, number>>({});
  const [timeRemaining, setTimeRemaining] = useState(0);
  const [result, setResult] = useState<ExamResult | null>(null);

  // Start exam
  const startMutation = useMutation({
    mutationFn: () => trainingApi.startExam(courseId),
    onSuccess: (data) => {
      setSession(data);
      setTimeRemaining(data.timeLimit * 60); // Convert to seconds
    },
  });

  // Submit exam
  const submitMutation = useMutation({
    mutationFn: () => {
      const formattedAnswers = Object.entries(answers).map(([questionId, selectedIndex]) => ({
        questionId,
        selectedIndex,
      }));
      return trainingApi.submitExam(courseId, formattedAnswers);
    },
    onSuccess: (data) => {
      setResult(data);
      onComplete(data.passed);
    },
  });

  // Timer
  useEffect(() => {
    if (!session || timeRemaining <= 0) return;

    const timer = setInterval(() => {
      setTimeRemaining((prev) => {
        if (prev <= 1) {
          submitMutation.mutate();
          return 0;
        }
        return prev - 1;
      });
    }, 1000);

    return () => clearInterval(timer);
  }, [session, timeRemaining]);

  // Start on mount
  useEffect(() => {
    startMutation.mutate();
  }, []);

  const formatTime = (seconds: number) => {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return `${m}:${s.toString().padStart(2, '0')}`;
  };

  const handleAnswer = (questionId: string, index: number) => {
    setAnswers((prev) => ({ ...prev, [questionId]: index }));
  };

  const handleNext = () => {
    if (session && currentQuestion < session.questions.length - 1) {
      setCurrentQuestion((prev) => prev + 1);
    }
  };

  const handlePrevious = () => {
    if (currentQuestion > 0) {
      setCurrentQuestion((prev) => prev - 1);
    }
  };

  const handleSubmit = () => {
    if (Object.keys(answers).length < (session?.questions.length || 0)) {
      if (!confirm('You have unanswered questions. Submit anyway?')) return;
    }
    submitMutation.mutate();
  };

  // Loading state
  if (startMutation.isPending) {
    return <div className="p-8 text-center">Loading exam...</div>;
  }

  // Result state
  if (result) {
    return (
      <Card className="max-w-2xl mx-auto">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            {result.passed ? (
              <CheckCircle2 className="h-6 w-6 text-green-600" />
            ) : (
              <XCircle className="h-6 w-6 text-red-600" />
            )}
            Exam {result.passed ? 'Passed' : 'Failed'}
          </CardTitle>
        </CardHeader>
        <CardContent className="space-y-6">
          <div className="text-center">
            <div className="text-4xl font-bold mb-2">{result.score}%</div>
            <p className="text-gray-500">
              {result.correctAnswers} of {result.totalQuestions} correct
            </p>
            <p className="text-sm text-gray-400">
              Passing score: {result.passingScore}%
            </p>
          </div>

          {result.feedback && (
            <div className="space-y-2">
              <h4 className="font-medium">Question Feedback</h4>
              {result.feedback.map((fb, idx) => (
                <div
                  key={fb.questionId}
                  className={`p-2 rounded ${fb.correct ? 'bg-green-50' : 'bg-red-50'}`}
                >
                  <span className="font-medium">Q{idx + 1}:</span>{' '}
                  {fb.correct ? 'Correct' : 'Incorrect'}
                  {fb.explanation && <p className="text-sm text-gray-600">{fb.explanation}</p>}
                </div>
              ))}
            </div>
          )}

          <div className="flex justify-center gap-4">
            {result.passed ? (
              <Button onClick={() => onComplete(true)}>Continue</Button>
            ) : (
              <>
                <Button variant="outline" onClick={onCancel}>Back to Course</Button>
                <Button onClick={() => {
                  setResult(null);
                  setAnswers({});
                  setCurrentQuestion(0);
                  startMutation.mutate();
                }}>
                  Retry Exam
                </Button>
              </>
            )}
          </div>
        </CardContent>
      </Card>
    );
  }

  // Exam in progress
  if (!session) return null;

  const question = session.questions[currentQuestion];
  const progress = ((currentQuestion + 1) / session.questions.length) * 100;
  const isLowTime = timeRemaining < 60;

  return (
    <Card className="max-w-2xl mx-auto">
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle>{session.courseName} Exam</CardTitle>
          <div className={`flex items-center gap-2 ${isLowTime ? 'text-red-600' : ''}`}>
            <Clock className="h-5 w-5" />
            <span className="font-mono text-lg">{formatTime(timeRemaining)}</span>
          </div>
        </div>
        <Progress value={progress} className="mt-2" />
        <p className="text-sm text-gray-500">
          Question {currentQuestion + 1} of {session.questions.length}
        </p>
      </CardHeader>
      <CardContent className="space-y-6">
        <div className="space-y-4">
          <h3 className="text-lg font-medium">{question.question}</h3>
          <RadioGroup
            value={answers[question.id]?.toString()}
            onValueChange={(v) => handleAnswer(question.id, parseInt(v))}
          >
            {question.options.map((option, idx) => (
              <div key={idx} className="flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50">
                <RadioGroupItem value={idx.toString()} id={`option-${idx}`} />
                <Label htmlFor={`option-${idx}`} className="flex-1 cursor-pointer">
                  {option}
                </Label>
              </div>
            ))}
          </RadioGroup>
        </div>

        <div className="flex justify-between">
          <Button
            variant="outline"
            onClick={handlePrevious}
            disabled={currentQuestion === 0}
          >
            Previous
          </Button>
          <div className="flex gap-2">
            {currentQuestion < session.questions.length - 1 ? (
              <Button onClick={handleNext}>Next</Button>
            ) : (
              <Button onClick={handleSubmit} disabled={submitMutation.isPending}>
                Submit Exam
              </Button>
            )}
          </div>
        </div>

        {/* Question Navigation */}
        <div className="flex flex-wrap gap-2 pt-4 border-t">
          {session.questions.map((_, idx) => (
            <Button
              key={idx}
              variant={answers[session.questions[idx].id] !== undefined ? 'default' : 'outline'}
              size="sm"
              className="w-10 h-10"
              onClick={() => setCurrentQuestion(idx)}
            >
              {idx + 1}
            </Button>
          ))}
        </div>
      </CardContent>
    </Card>
  );
}
```

**pages/internal/training/TrackManager.tsx:**
- Admin view for CRUD operations on tracks and courses
- Track list with create/edit/delete buttons
- Course list with drag-drop reordering
- Form dialogs for track and course creation/editing
- Certification summary view showing enrollment stats

**pages/internal/training/TrainingPortalPage.tsx:**
```typescript
import { useState } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { CourseCatalog } from './CourseCatalog';
import { CertificationStatus } from './CertificationStatus';
import { ExamInterface } from './ExamInterface';
import { TrackManager } from './TrackManager';
import { useInternalUser } from '@/hooks/useInternalUser';
import { BookOpen, Award, Settings } from 'lucide-react';

export function TrainingPortalPage() {
  const { user } = useInternalUser();
  const [selectedTrackId, setSelectedTrackId] = useState<string | null>(null);
  const [examCourseId, setExamCourseId] = useState<string | null>(null);
  const [activeTab, setActiveTab] = useState('catalog');

  const isAdmin = user?.role === 'IMPLEMENTATION_MANAGER' || user?.role === 'PLATFORM_ADMIN';

  const handleCourseSelect = (trackId: string) => {
    setSelectedTrackId(trackId);
    setActiveTab('progress');
  };

  const handleStartExam = (courseId: string) => {
    setExamCourseId(courseId);
  };

  const handleExamComplete = (passed: boolean) => {
    setExamCourseId(null);
    // Refresh progress view
  };

  // Show exam interface if exam is in progress
  if (examCourseId) {
    return (
      <div className="p-6">
        <ExamInterface
          courseId={examCourseId}
          onComplete={handleExamComplete}
          onCancel={() => setExamCourseId(null)}
        />
      </div>
    );
  }

  return (
    <div className="p-6 space-y-6">
      <div>
        <h1 className="text-2xl font-bold">Training Portal</h1>
        <p className="text-gray-500">Certifications, courses, and professional development</p>
      </div>

      <Tabs value={activeTab} onValueChange={setActiveTab}>
        <TabsList>
          <TabsTrigger value="catalog" className="flex items-center gap-2">
            <BookOpen className="h-4 w-4" />
            Course Catalog
          </TabsTrigger>
          <TabsTrigger value="progress" className="flex items-center gap-2">
            <Award className="h-4 w-4" />
            My Progress
          </TabsTrigger>
          {isAdmin && (
            <TabsTrigger value="admin" className="flex items-center gap-2">
              <Settings className="h-4 w-4" />
              Manage Tracks
            </TabsTrigger>
          )}
        </TabsList>

        <TabsContent value="catalog" className="mt-6">
          <CourseCatalog
            onCourseSelect={handleCourseSelect}
            onExamStart={handleStartExam}
          />
        </TabsContent>

        <TabsContent value="progress" className="mt-6">
          {selectedTrackId ? (
            <CertificationStatus
              trackId={selectedTrackId}
              onStartCourse={(id, url) => {
                if (url) window.open(url, '_blank');
              }}
              onStartExam={handleStartExam}
            />
          ) : (
            <div className="text-center py-12 text-gray-500">
              Select a track from the catalog to view your progress
            </div>
          )}
        </TabsContent>

        {isAdmin && (
          <TabsContent value="admin" className="mt-6">
            <TrackManager />
          </TabsContent>
        )}
      </Tabs>
    </div>
  );
}
```
  </action>
  <verify>npm run lint passes; TypeScript compiles</verify>
  <done>ExamInterface, TrackManager, and TrainingPortalPage created</done>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit` from apps/frontend - TypeScript compiles
2. Run `npm run lint` - no lint errors
3. Verify exam timer counts down correctly
4. Verify course completion updates progress percentage
5. Verify admin-only tabs are hidden for non-admin users
</verification>

<success_criteria>
- CourseCatalog displays tracks grouped by type with enrollment buttons
- CertificationStatus shows course list with completion controls
- ExamInterface provides timed assessments with navigation and scoring
- TrackManager enables admin CRUD for tracks and courses
- TrainingPortalPage provides role-appropriate views
- All components use existing shadcn/ui patterns
</success_criteria>

<output>
After completion, create `.planning/phases/12-internal-operations-portal/12-16-SUMMARY.md`
</output>
