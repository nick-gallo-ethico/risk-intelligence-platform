---
phase: 12-internal-operations-portal
plan: 19
type: execute
wave: tech-debt
depends_on: []
files_modified:
  - apps/frontend/vite.config.ts
  - apps/frontend/src/App.tsx
  - apps/frontend/src/routes/index.tsx
  - apps/frontend/src/components/common/LazyComponent.tsx
  - apps/frontend/src/components/common/ErrorBoundary.tsx
  - apps/frontend/src/components/common/LoadingStates.tsx
  - apps/frontend/src/hooks/useFormState.ts
  - apps/frontend/src/styles/accessibility.css
autonomous: true

must_haves:
  truths:
    - "Route-based code splitting reduces initial bundle by 40%+"
    - "Non-critical components (charts, editors) lazy load"
    - "WCAG 2.1 AA compliance verified for all pages"
    - "Consolidated form state management with dirty tracking"
    - "Error boundaries at route and component level"
    - "Consistent skeleton loaders across all pages"
    - "All pages verified responsive on tablet and mobile"
  artifacts:
    - path: "apps/frontend/vite.config.ts"
      provides: "Optimized build configuration with code splitting"
      exports: []
    - path: "apps/frontend/src/components/common/ErrorBoundary.tsx"
      provides: "Reusable error boundary with fallback UI"
      exports: ["ErrorBoundary", "withErrorBoundary"]
    - path: "apps/frontend/src/hooks/useFormState.ts"
      provides: "Consolidated form state with dirty tracking"
      exports: ["useFormState"]
  key_links:
    - from: "routes/index.tsx"
      to: "React.lazy"
      via: "Dynamic imports"
      pattern: "React\\.lazy"
    - from: "ErrorBoundary.tsx"
      to: "All page components"
      via: "Route wrapping"
      pattern: "<ErrorBoundary>"
---

<objective>
Address accumulated frontend technical debt: bundle splitting for performance, lazy loading of heavy components, accessibility audit, form state consolidation, error boundaries, and mobile responsiveness.

Purpose: Ensure production-ready frontend with fast initial load, proper error handling, accessibility compliance, and good mobile experience.

Output: Optimized Vite config, lazy loading infrastructure, error boundaries, consolidated form hooks, accessibility fixes, and responsive layout improvements.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-internal-operations-portal/CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Bundle Splitting and Lazy Loading</name>
  <files>
    apps/frontend/vite.config.ts
    apps/frontend/src/routes/index.tsx
    apps/frontend/src/components/common/LazyComponent.tsx
  </files>
  <action>
**vite.config.ts:**
```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  plugins: [
    react(),
    // Bundle analyzer (run with ANALYZE=true)
    process.env.ANALYZE && visualizer({
      open: true,
      filename: 'dist/stats.html',
      gzipSize: true,
      brotliSize: true,
    }),
  ].filter(Boolean),

  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },

  build: {
    // Enable source maps for production debugging
    sourcemap: true,

    rollupOptions: {
      output: {
        // Manual chunk splitting for better caching
        manualChunks: {
          // Vendor chunks
          'vendor-react': ['react', 'react-dom', 'react-router-dom'],
          'vendor-ui': [
            '@radix-ui/react-dialog',
            '@radix-ui/react-dropdown-menu',
            '@radix-ui/react-tabs',
            '@radix-ui/react-select',
            '@radix-ui/react-accordion',
            'class-variance-authority',
            'clsx',
            'tailwind-merge',
          ],
          'vendor-query': ['@tanstack/react-query'],
          'vendor-forms': ['react-hook-form', '@hookform/resolvers', 'zod'],
          'vendor-charts': ['recharts'],
          'vendor-editor': ['@tiptap/react', '@tiptap/starter-kit', 'prosemirror-model'],
          'vendor-dnd': ['@hello-pangea/dnd'],
        },
      },
    },

    // Chunk size warning
    chunkSizeWarningLimit: 500,
  },

  // Optimize dependencies
  optimizeDeps: {
    include: [
      'react',
      'react-dom',
      'react-router-dom',
      '@tanstack/react-query',
    ],
  },
});
```

**routes/index.tsx:**
```typescript
import { Suspense, lazy } from 'react';
import { Routes, Route, Navigate } from 'react-router-dom';
import { ErrorBoundary } from '@/components/common/ErrorBoundary';
import { PageSkeleton } from '@/components/common/LoadingStates';

// Auth pages - not lazy (needed immediately)
import { LoginPage } from '@/pages/auth/LoginPage';
import { SsoCallbackPage } from '@/pages/auth/SsoCallbackPage';

// Layouts - not lazy
import { MainLayout } from '@/components/layouts/MainLayout';
import { InternalLayout } from '@/components/internal/InternalLayout';

// Lazy load all main pages
const DashboardPage = lazy(() => import('@/pages/dashboard/DashboardPage'));
const CaseListPage = lazy(() => import('@/pages/cases/CaseListPage'));
const CaseDetailPage = lazy(() => import('@/pages/cases/CaseDetailPage'));
const InvestigationDetailPage = lazy(() => import('@/pages/investigations/InvestigationDetailPage'));
const RiuListPage = lazy(() => import('@/pages/rius/RiuListPage'));
const CampaignListPage = lazy(() => import('@/pages/campaigns/CampaignListPage'));
const CampaignDetailPage = lazy(() => import('@/pages/campaigns/CampaignDetailPage'));
const ReportsPage = lazy(() => import('@/pages/reports/ReportsPage'));
const SettingsPage = lazy(() => import('@/pages/settings/SettingsPage'));

// Lazy load internal/admin pages
const SupportConsolePage = lazy(() => import('@/pages/internal/support/SupportConsolePage'));
const ImplementationDashboard = lazy(() => import('@/pages/internal/implementation/ImplementationDashboard'));
const HotlineOpsPage = lazy(() => import('@/pages/internal/hotline/HotlineOpsPage'));
const ClientSuccessDashboard = lazy(() => import('@/pages/internal/client-success/ClientSuccessDashboard'));
const TrainingPortalPage = lazy(() => import('@/pages/internal/training/TrainingPortalPage'));
const AdminSettingsPage = lazy(() => import('@/pages/internal/admin/AdminSettingsPage'));

// Lazy load portal pages
const EthicsPortalPage = lazy(() => import('@/pages/portals/ethics/EthicsPortalPage'));
const EmployeePortalPage = lazy(() => import('@/pages/portals/employee/EmployeePortalPage'));
const OperatorConsolePage = lazy(() => import('@/pages/portals/operator/OperatorConsolePage'));

// Suspense wrapper with error boundary
function LazyPage({ children }: { children: React.ReactNode }) {
  return (
    <ErrorBoundary>
      <Suspense fallback={<PageSkeleton />}>
        {children}
      </Suspense>
    </ErrorBoundary>
  );
}

export function AppRoutes() {
  return (
    <Routes>
      {/* Auth routes */}
      <Route path="/login" element={<LoginPage />} />
      <Route path="/sso/callback" element={<SsoCallbackPage />} />

      {/* Main app routes */}
      <Route path="/" element={<MainLayout />}>
        <Route index element={<Navigate to="/dashboard" replace />} />
        <Route path="dashboard" element={<LazyPage><DashboardPage /></LazyPage>} />
        <Route path="cases" element={<LazyPage><CaseListPage /></LazyPage>} />
        <Route path="cases/:id" element={<LazyPage><CaseDetailPage /></LazyPage>} />
        <Route path="investigations/:id" element={<LazyPage><InvestigationDetailPage /></LazyPage>} />
        <Route path="rius" element={<LazyPage><RiuListPage /></LazyPage>} />
        <Route path="campaigns" element={<LazyPage><CampaignListPage /></LazyPage>} />
        <Route path="campaigns/:id" element={<LazyPage><CampaignDetailPage /></LazyPage>} />
        <Route path="reports" element={<LazyPage><ReportsPage /></LazyPage>} />
        <Route path="settings/*" element={<LazyPage><SettingsPage /></LazyPage>} />
      </Route>

      {/* Internal operations routes */}
      <Route path="/internal" element={<InternalLayout />}>
        <Route path="support" element={<LazyPage><SupportConsolePage /></LazyPage>} />
        <Route path="implementation/*" element={<LazyPage><ImplementationDashboard /></LazyPage>} />
        <Route path="hotline" element={<LazyPage><HotlineOpsPage /></LazyPage>} />
        <Route path="client-success/*" element={<LazyPage><ClientSuccessDashboard /></LazyPage>} />
        <Route path="training/*" element={<LazyPage><TrainingPortalPage /></LazyPage>} />
        <Route path="admin" element={<LazyPage><AdminSettingsPage /></LazyPage>} />
      </Route>

      {/* Portal routes */}
      <Route path="/ethics/*" element={<LazyPage><EthicsPortalPage /></LazyPage>} />
      <Route path="/employee/*" element={<LazyPage><EmployeePortalPage /></LazyPage>} />
      <Route path="/operator/*" element={<LazyPage><OperatorConsolePage /></LazyPage>} />

      {/* 404 */}
      <Route path="*" element={<Navigate to="/dashboard" replace />} />
    </Routes>
  );
}
```

**components/common/LazyComponent.tsx:**
```typescript
import { Suspense, lazy, ComponentType } from 'react';
import { Skeleton } from '@/components/ui/skeleton';

interface LazyOptions {
  fallback?: React.ReactNode;
  delay?: number;
}

// Factory for lazy loading with loading state
export function createLazyComponent<T extends ComponentType<any>>(
  importFn: () => Promise<{ default: T }>,
  options: LazyOptions = {}
) {
  const LazyComponent = lazy(importFn);

  return function LazyWrapper(props: React.ComponentProps<T>) {
    return (
      <Suspense fallback={options.fallback || <ComponentSkeleton />}>
        <LazyComponent {...props} />
      </Suspense>
    );
  };
}

// Default component skeleton
function ComponentSkeleton() {
  return (
    <div className="space-y-4 p-4">
      <Skeleton className="h-8 w-48" />
      <Skeleton className="h-32 w-full" />
    </div>
  );
}

// Lazy load heavy components
export const LazyRichTextEditor = createLazyComponent(
  () => import('@/components/editor/RichTextEditor'),
  { fallback: <Skeleton className="h-64 w-full" /> }
);

export const LazyCharts = {
  AreaChart: createLazyComponent(() =>
    import('recharts').then((m) => ({ default: m.AreaChart as any }))
  ),
  BarChart: createLazyComponent(() =>
    import('recharts').then((m) => ({ default: m.BarChart as any }))
  ),
  LineChart: createLazyComponent(() =>
    import('recharts').then((m) => ({ default: m.LineChart as any }))
  ),
};

export const LazyDragDropContext = createLazyComponent(() =>
  import('@hello-pangea/dnd').then((m) => ({ default: m.DragDropContext }))
);

export const LazyDataGrid = createLazyComponent(
  () => import('@/components/data/DataGrid'),
  { fallback: <Skeleton className="h-96 w-full" /> }
);
```
  </action>
  <verify>npm run build produces smaller initial bundle; npm run analyze shows chunk distribution</verify>
  <done>Bundle splitting and lazy loading configured for 40%+ initial bundle reduction</done>
</task>

<task type="auto">
  <name>Task 2: Create Error Boundaries and Form State Management</name>
  <files>
    apps/frontend/src/components/common/ErrorBoundary.tsx
    apps/frontend/src/components/common/LoadingStates.tsx
    apps/frontend/src/hooks/useFormState.ts
  </files>
  <action>
**components/common/ErrorBoundary.tsx:**
```typescript
import { Component, ErrorInfo, ReactNode } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { AlertTriangle, RefreshCw, Home } from 'lucide-react';

interface ErrorBoundaryProps {
  children: ReactNode;
  fallback?: ReactNode;
  onError?: (error: Error, errorInfo: ErrorInfo) => void;
  resetKeys?: unknown[];
}

interface ErrorBoundaryState {
  hasError: boolean;
  error: Error | null;
}

export class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {
  constructor(props: ErrorBoundaryProps) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('ErrorBoundary caught an error:', error, errorInfo);
    this.props.onError?.(error, errorInfo);

    // Report to error tracking service
    if (typeof window !== 'undefined' && (window as any).Sentry) {
      (window as any).Sentry.captureException(error, { extra: errorInfo });
    }
  }

  componentDidUpdate(prevProps: ErrorBoundaryProps) {
    // Reset error state if resetKeys change
    if (this.state.hasError && this.props.resetKeys) {
      if (
        prevProps.resetKeys?.length !== this.props.resetKeys.length ||
        prevProps.resetKeys?.some((key, i) => key !== this.props.resetKeys?.[i])
      ) {
        this.setState({ hasError: false, error: null });
      }
    }
  }

  handleReset = () => {
    this.setState({ hasError: false, error: null });
  };

  render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback;
      }

      return (
        <div className="min-h-[400px] flex items-center justify-center p-6">
          <Card className="max-w-md w-full">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-red-600">
                <AlertTriangle className="h-5 w-5" />
                Something went wrong
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-4">
              <p className="text-gray-600">
                An unexpected error occurred. Please try again or contact support if the problem persists.
              </p>

              {process.env.NODE_ENV === 'development' && this.state.error && (
                <div className="p-3 bg-red-50 rounded-lg text-sm font-mono text-red-800 overflow-auto max-h-32">
                  {this.state.error.message}
                </div>
              )}

              <div className="flex gap-3">
                <Button onClick={this.handleReset} className="flex items-center gap-2">
                  <RefreshCw className="h-4 w-4" />
                  Try Again
                </Button>
                <Button variant="outline" onClick={() => window.location.href = '/'}>
                  <Home className="h-4 w-4 mr-2" />
                  Go Home
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      );
    }

    return this.props.children;
  }
}

// HOC for easy wrapping
export function withErrorBoundary<P extends object>(
  Component: React.ComponentType<P>,
  errorBoundaryProps?: Omit<ErrorBoundaryProps, 'children'>
) {
  return function WrappedComponent(props: P) {
    return (
      <ErrorBoundary {...errorBoundaryProps}>
        <Component {...props} />
      </ErrorBoundary>
    );
  };
}
```

**components/common/LoadingStates.tsx:**
```typescript
import { Skeleton } from '@/components/ui/skeleton';

// Page-level skeleton
export function PageSkeleton() {
  return (
    <div className="p-6 space-y-6">
      <div className="flex items-center justify-between">
        <Skeleton className="h-8 w-48" />
        <Skeleton className="h-10 w-32" />
      </div>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Skeleton className="h-32" />
        <Skeleton className="h-32" />
        <Skeleton className="h-32" />
      </div>
      <Skeleton className="h-64 w-full" />
    </div>
  );
}

// Table skeleton
export function TableSkeleton({ rows = 5 }: { rows?: number }) {
  return (
    <div className="space-y-3">
      <div className="flex gap-4">
        <Skeleton className="h-10 w-24" />
        <Skeleton className="h-10 w-32" />
        <Skeleton className="h-10 w-48" />
        <Skeleton className="h-10 w-20" />
      </div>
      {Array.from({ length: rows }).map((_, i) => (
        <div key={i} className="flex gap-4">
          <Skeleton className="h-12 w-24" />
          <Skeleton className="h-12 w-32" />
          <Skeleton className="h-12 w-48" />
          <Skeleton className="h-12 w-20" />
        </div>
      ))}
    </div>
  );
}

// Card skeleton
export function CardSkeleton() {
  return (
    <div className="border rounded-lg p-4 space-y-3">
      <Skeleton className="h-6 w-3/4" />
      <Skeleton className="h-4 w-full" />
      <Skeleton className="h-4 w-2/3" />
    </div>
  );
}

// Form skeleton
export function FormSkeleton({ fields = 4 }: { fields?: number }) {
  return (
    <div className="space-y-6">
      {Array.from({ length: fields }).map((_, i) => (
        <div key={i} className="space-y-2">
          <Skeleton className="h-4 w-24" />
          <Skeleton className="h-10 w-full" />
        </div>
      ))}
      <Skeleton className="h-10 w-32" />
    </div>
  );
}

// Detail page skeleton
export function DetailSkeleton() {
  return (
    <div className="p-6 space-y-6">
      <div className="flex items-center gap-4">
        <Skeleton className="h-12 w-12 rounded-full" />
        <div className="space-y-2">
          <Skeleton className="h-6 w-48" />
          <Skeleton className="h-4 w-32" />
        </div>
      </div>
      <div className="grid grid-cols-2 gap-6">
        <div className="space-y-4">
          <Skeleton className="h-32 w-full" />
          <Skeleton className="h-48 w-full" />
        </div>
        <div className="space-y-4">
          <Skeleton className="h-24 w-full" />
          <Skeleton className="h-24 w-full" />
          <Skeleton className="h-24 w-full" />
        </div>
      </div>
    </div>
  );
}
```

**hooks/useFormState.ts:**
```typescript
import { useState, useCallback, useEffect, useRef } from 'react';
import { useForm, UseFormReturn, FieldValues, DefaultValues } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { ZodSchema } from 'zod';
import { useBeforeUnload } from 'react-router-dom';

interface UseFormStateOptions<T extends FieldValues> {
  schema?: ZodSchema<T>;
  defaultValues?: DefaultValues<T>;
  onSubmit: (data: T) => Promise<void> | void;
  resetOnSuccess?: boolean;
  warnOnUnsavedChanges?: boolean;
}

interface UseFormStateReturn<T extends FieldValues> extends UseFormReturn<T> {
  isDirty: boolean;
  isSubmitting: boolean;
  submitError: string | null;
  handleFormSubmit: () => Promise<void>;
  resetForm: () => void;
  setFieldValue: <K extends keyof T>(field: K, value: T[K]) => void;
}

export function useFormState<T extends FieldValues>(
  options: UseFormStateOptions<T>
): UseFormStateReturn<T> {
  const {
    schema,
    defaultValues,
    onSubmit,
    resetOnSuccess = false,
    warnOnUnsavedChanges = true,
  } = options;

  const [submitError, setSubmitError] = useState<string | null>(null);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const initialValues = useRef(defaultValues);

  const form = useForm<T>({
    resolver: schema ? zodResolver(schema) : undefined,
    defaultValues,
    mode: 'onChange',
  });

  const { formState, reset, setValue, watch } = form;
  const isDirty = formState.isDirty;

  // Warn on navigation with unsaved changes
  useBeforeUnload(
    useCallback(
      (event) => {
        if (warnOnUnsavedChanges && isDirty) {
          event.preventDefault();
          event.returnValue = '';
        }
      },
      [warnOnUnsavedChanges, isDirty]
    )
  );

  // Also handle window beforeunload
  useEffect(() => {
    const handler = (event: BeforeUnloadEvent) => {
      if (warnOnUnsavedChanges && isDirty) {
        event.preventDefault();
        event.returnValue = '';
      }
    };

    window.addEventListener('beforeunload', handler);
    return () => window.removeEventListener('beforeunload', handler);
  }, [warnOnUnsavedChanges, isDirty]);

  const handleFormSubmit = useCallback(async () => {
    setSubmitError(null);
    setIsSubmitting(true);

    try {
      const isValid = await form.trigger();
      if (!isValid) {
        setIsSubmitting(false);
        return;
      }

      const values = form.getValues();
      await onSubmit(values);

      if (resetOnSuccess) {
        reset(initialValues.current);
      }
    } catch (error) {
      setSubmitError(error instanceof Error ? error.message : 'An error occurred');
    } finally {
      setIsSubmitting(false);
    }
  }, [form, onSubmit, reset, resetOnSuccess]);

  const resetForm = useCallback(() => {
    reset(initialValues.current);
    setSubmitError(null);
  }, [reset]);

  const setFieldValue = useCallback(
    <K extends keyof T>(field: K, value: T[K]) => {
      setValue(field as any, value, { shouldDirty: true, shouldValidate: true });
    },
    [setValue]
  );

  return {
    ...form,
    isDirty,
    isSubmitting,
    submitError,
    handleFormSubmit,
    resetForm,
    setFieldValue,
  };
}

// Utility hook for auto-save
export function useAutoSave<T extends FieldValues>(
  form: UseFormReturn<T>,
  onSave: (data: T) => Promise<void>,
  debounceMs = 2000
) {
  const timeoutRef = useRef<NodeJS.Timeout>();
  const values = form.watch();

  useEffect(() => {
    if (!form.formState.isDirty) return;

    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }

    timeoutRef.current = setTimeout(async () => {
      const isValid = await form.trigger();
      if (isValid) {
        await onSave(values);
      }
    }, debounceMs);

    return () => {
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current);
      }
    };
  }, [values, form, onSave, debounceMs]);
}
```
  </action>
  <verify>npm run typecheck passes; error boundary renders correctly on error</verify>
  <done>Error boundaries and consolidated form state management created</done>
</task>

<task type="auto">
  <name>Task 3: Accessibility Audit and Mobile Responsiveness</name>
  <files>
    apps/frontend/src/styles/accessibility.css
    apps/frontend/src/components/common/AccessibleDialog.tsx
    apps/frontend/src/components/common/SkipLink.tsx
  </files>
  <action>
**styles/accessibility.css:**
```css
/* Focus visible styles */
:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
}

/* Skip link for keyboard navigation */
.skip-link {
  position: absolute;
  left: -9999px;
  z-index: 9999;
  padding: 1rem;
  background: var(--background);
  border: 2px solid var(--primary);
  border-radius: 0.375rem;
}

.skip-link:focus {
  left: 1rem;
  top: 1rem;
}

/* Ensure minimum touch target size (44x44px) */
.touch-target {
  min-width: 44px;
  min-height: 44px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  :root {
    --primary: #0000ff;
    --background: #ffffff;
    --foreground: #000000;
  }

  button, a {
    border: 2px solid currentColor;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Screen reader only content */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Ensure readable text sizing */
html {
  font-size: 100%; /* Respect user's browser font size */
}

body {
  line-height: 1.5;
  letter-spacing: 0.01em;
}

/* Color contrast fixes */
.text-muted-foreground {
  color: hsl(var(--muted-foreground) / 0.9); /* Ensure 4.5:1 contrast */
}

/* Mobile-specific improvements */
@media (max-width: 768px) {
  /* Larger touch targets on mobile */
  button,
  [role="button"],
  input[type="checkbox"],
  input[type="radio"] {
    min-height: 48px;
  }

  /* Readable table on mobile */
  table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* Stack form labels on mobile */
  .form-field {
    flex-direction: column;
  }

  /* Full-width buttons on mobile */
  .btn-mobile-full {
    width: 100%;
  }

  /* Adjust padding for mobile */
  .page-container {
    padding: 1rem;
  }

  /* Hide non-essential columns in tables */
  .hide-on-mobile {
    display: none;
  }
}

/* Tablet adjustments */
@media (min-width: 769px) and (max-width: 1024px) {
  .page-container {
    padding: 1.5rem;
  }

  /* Two-column layout on tablet */
  .grid-responsive {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* Print styles */
@media print {
  .no-print {
    display: none !important;
  }

  .print-full-width {
    width: 100% !important;
  }

  a[href]::after {
    content: " (" attr(href) ")";
  }
}
```

**components/common/SkipLink.tsx:**
```typescript
export function SkipLink() {
  return (
    <a href="#main-content" className="skip-link">
      Skip to main content
    </a>
  );
}
```

**components/common/AccessibleDialog.tsx:**
```typescript
import { useEffect, useRef } from 'react';
import * as Dialog from '@radix-ui/react-dialog';
import { X } from 'lucide-react';
import { cn } from '@/lib/utils';

interface AccessibleDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  title: string;
  description?: string;
  children: React.ReactNode;
  className?: string;
}

export function AccessibleDialog({
  open,
  onOpenChange,
  title,
  description,
  children,
  className,
}: AccessibleDialogProps) {
  const closeButtonRef = useRef<HTMLButtonElement>(null);

  // Trap focus within dialog
  useEffect(() => {
    if (open) {
      // Focus first focusable element or close button
      const timer = setTimeout(() => {
        const firstFocusable = document.querySelector<HTMLElement>(
          '[data-dialog-content] button, [data-dialog-content] input, [data-dialog-content] textarea'
        );
        (firstFocusable || closeButtonRef.current)?.focus();
      }, 100);

      return () => clearTimeout(timer);
    }
  }, [open]);

  return (
    <Dialog.Root open={open} onOpenChange={onOpenChange}>
      <Dialog.Portal>
        <Dialog.Overlay className="fixed inset-0 bg-black/50 animate-fade-in" />
        <Dialog.Content
          data-dialog-content
          className={cn(
            "fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",
            "w-[90vw] max-w-md max-h-[85vh] overflow-auto",
            "bg-white rounded-lg shadow-lg p-6",
            "animate-scale-in",
            className
          )}
          aria-describedby={description ? 'dialog-description' : undefined}
        >
          <Dialog.Title className="text-lg font-semibold mb-2">
            {title}
          </Dialog.Title>

          {description && (
            <Dialog.Description id="dialog-description" className="text-sm text-gray-500 mb-4">
              {description}
            </Dialog.Description>
          )}

          {children}

          <Dialog.Close asChild>
            <button
              ref={closeButtonRef}
              className="absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary"
              aria-label="Close dialog"
            >
              <X className="h-4 w-4" />
            </button>
          </Dialog.Close>
        </Dialog.Content>
      </Dialog.Portal>
    </Dialog.Root>
  );
}
```

**Accessibility audit checklist to verify:**
1. All images have alt text
2. Form inputs have associated labels
3. Color contrast meets 4.5:1 minimum
4. Keyboard navigation works for all interactive elements
5. Focus order is logical
6. ARIA labels on icon-only buttons
7. Skip link present in layout
8. Dialogs trap focus and announce properly
9. Error messages are announced to screen readers
10. Tables have proper headers and scope

**Mobile responsiveness checklist:**
1. All pages work at 320px width minimum
2. Touch targets are at least 44x44px
3. Text is readable without zooming (16px minimum)
4. No horizontal scrolling on mobile
5. Forms are usable on mobile
6. Navigation adapts to mobile (hamburger menu)
7. Tables scroll horizontally or adapt to cards
8. Modals are properly sized on mobile
  </action>
  <verify>npx lighthouse-ci passes with 90+ accessibility score; manual test on mobile viewports</verify>
  <done>Accessibility and mobile responsiveness improvements complete</done>
</task>

</tasks>

<verification>
1. Run `npm run build` and verify bundle size reduced by 40%+ from baseline
2. Run `npm run build -- --analyze` to view chunk distribution
3. Run Lighthouse accessibility audit, target 90+ score
4. Test all pages on 320px, 768px, 1024px, 1440px viewports
5. Test keyboard navigation through entire application
6. Verify skip link works and focus management in dialogs
7. Test form dirty state warning on navigation
</verification>

<success_criteria>
- Initial bundle size reduced by 40%+ through code splitting
- All page components lazy loaded with Suspense
- Heavy components (charts, editors, dnd) lazy loaded
- Error boundaries catch and display errors gracefully
- Form state hook provides dirty tracking and unsaved changes warning
- WCAG 2.1 AA compliance verified (Lighthouse 90+)
- All pages responsive from 320px to 1440px
- Touch targets meet 44x44px minimum on mobile
- Skip link and focus management work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/12-internal-operations-portal/12-19-SUMMARY.md`
</output>
