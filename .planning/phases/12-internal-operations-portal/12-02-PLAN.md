---
phase: 12-internal-operations-portal
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/backend/src/modules/operations/entities/implementation-project.entity.ts
  - apps/backend/src/modules/operations/entities/implementation-task.entity.ts
  - apps/backend/src/modules/operations/entities/implementation-blocker.entity.ts
  - apps/backend/src/modules/operations/entities/implementation-activity.entity.ts
  - apps/backend/src/modules/operations/types/implementation.types.ts
  - apps/backend/prisma/schema.prisma
autonomous: true

must_haves:
  truths:
    - "Implementation projects can track client onboarding from discovery to go-live"
    - "Tasks belong to phases (Discovery, Configuration, Data Migration, UAT, Go-Live)"
    - "Blockers can be tracked with auto-escalation timing"
    - "Activity log captures emails, meetings, decisions, phase transitions"
  artifacts:
    - path: "apps/backend/prisma/schema.prisma"
      provides: "Implementation project models"
      contains: "model ImplementationProject"
    - path: "apps/backend/src/modules/operations/types/implementation.types.ts"
      provides: "Implementation enums and types"
      exports: ["ImplementationPhase", "ImplementationType", "TaskStatus", "BlockerCategory"]
  key_links:
    - from: "ImplementationProject"
      to: "Organization"
      via: "clientOrganizationId FK"
      pattern: "clientOrganizationId.*String"
---

<objective>
Create database models for implementation project tracking with phase-based checklists.

Purpose: Enable implementation specialists to track client onboarding with tasks, blockers, and activity logging. Supports both SMB Quick Start and Enterprise Full implementation templates per CONTEXT.md.

Output: Prisma schema for ImplementationProject, ImplementationTask, ImplementationBlocker, ImplementationActivity models with supporting enums.
</objective>

<execution_context>
@.claude/agents/gsd-executor.md
@.claude/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/12-internal-operations-portal/12-CONTEXT.md
@.planning/phases/12-internal-operations-portal/12-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Implementation Types and Enums</name>
  <files>
    apps/backend/src/modules/operations/types/implementation.types.ts
  </files>
  <action>
Define all implementation-related enums and types:

```typescript
/**
 * Implementation Portal Types
 *
 * Supports both PLG (self-serve) and Enterprise (guided) implementation tracks
 * per CONTEXT.md decisions.
 */

// Implementation type determines which checklist template to use
export enum ImplementationType {
  SMB_QUICK_START = 'SMB_QUICK_START',      // 1-2 week self-serve
  ENTERPRISE_FULL = 'ENTERPRISE_FULL',       // 6-8 week guided
  HEALTHCARE_HIPAA = 'HEALTHCARE_HIPAA',     // Industry-specific
  FINANCIAL_SOX = 'FINANCIAL_SOX',           // Industry-specific
  GENERAL_BUSINESS = 'GENERAL_BUSINESS',     // Standard business
}

// Phases for Enterprise implementation (per CONTEXT.md)
export enum ImplementationPhase {
  DISCOVERY = 'DISCOVERY',
  CONFIGURATION = 'CONFIGURATION',
  DATA_MIGRATION = 'DATA_MIGRATION',
  UAT = 'UAT',
  GO_LIVE = 'GO_LIVE',
  OPTIMIZATION = 'OPTIMIZATION',
}

// Phases for PLG/SMB implementation
export enum PlgPhase {
  SETUP = 'SETUP',
  FIRST_POLICY = 'FIRST_POLICY',
  FIRST_WORKFLOW = 'FIRST_WORKFLOW',
  INVITE_TEAM = 'INVITE_TEAM',
  ACTIVE = 'ACTIVE',
}

export enum ProjectStatus {
  NOT_STARTED = 'NOT_STARTED',
  IN_PROGRESS = 'IN_PROGRESS',
  AT_RISK = 'AT_RISK',
  ON_HOLD = 'ON_HOLD',
  COMPLETED = 'COMPLETED',
  CANCELLED = 'CANCELLED',
}

export enum TaskStatus {
  PENDING = 'PENDING',
  IN_PROGRESS = 'IN_PROGRESS',
  BLOCKED = 'BLOCKED',
  COMPLETED = 'COMPLETED',
  SKIPPED = 'SKIPPED',
}

// Blocker categories determine escalation timing per CONTEXT.md
export enum BlockerCategory {
  INTERNAL = 'INTERNAL',        // 3-day escalation
  CLIENT_SIDE = 'CLIENT_SIDE',  // 5-day escalation
  VENDOR = 'VENDOR',            // 5-day escalation
}

export enum BlockerStatus {
  OPEN = 'OPEN',
  SNOOZED = 'SNOOZED',
  RESOLVED = 'RESOLVED',
}

export enum ActivityType {
  EMAIL_SENT = 'EMAIL_SENT',
  EMAIL_RECEIVED = 'EMAIL_RECEIVED',
  MEETING = 'MEETING',
  DECISION = 'DECISION',
  PHASE_TRANSITION = 'PHASE_TRANSITION',
  NOTE = 'NOTE',
  TASK_COMPLETED = 'TASK_COMPLETED',
  BLOCKER_CREATED = 'BLOCKER_CREATED',
  BLOCKER_RESOLVED = 'BLOCKER_RESOLVED',
}

// Escalation timing by category (in days)
export const ESCALATION_TIMING = {
  [BlockerCategory.INTERNAL]: { reminder: 2, manager: 3, director: 7 },
  [BlockerCategory.CLIENT_SIDE]: { reminder: 2, manager: 5, director: 7 },
  [BlockerCategory.VENDOR]: { reminder: 2, manager: 5, director: 7 },
} as const;
```
  </action>
  <verify>TypeScript compiles: `cd apps/backend && npx tsc --noEmit`</verify>
  <done>All implementation enums defined with escalation timing constants</done>
</task>

<task type="auto">
  <name>Task 2: Create Implementation Project and Task Models</name>
  <files>
    apps/backend/src/modules/operations/entities/implementation-project.entity.ts
    apps/backend/src/modules/operations/entities/implementation-task.entity.ts
    apps/backend/prisma/schema.prisma
  </files>
  <action>
Add Prisma models for implementation tracking:

**ImplementationProject model:**
```prisma
enum ImplementationType {
  SMB_QUICK_START
  ENTERPRISE_FULL
  HEALTHCARE_HIPAA
  FINANCIAL_SOX
  GENERAL_BUSINESS
}

enum ImplementationPhase {
  DISCOVERY
  CONFIGURATION
  DATA_MIGRATION
  UAT
  GO_LIVE
  OPTIMIZATION
}

enum ProjectStatus {
  NOT_STARTED
  IN_PROGRESS
  AT_RISK
  ON_HOLD
  COMPLETED
  CANCELLED
}

model ImplementationProject {
  id                    String              @id @default(uuid())
  clientOrganizationId  String              // FK to Organization being implemented
  type                  ImplementationType
  status                ProjectStatus       @default(NOT_STARTED)
  currentPhase          ImplementationPhase @default(DISCOVERY)

  // Team assignment
  leadImplementerId     String              // FK to InternalUser (primary owner)
  assignedUserIds       String[]            // Multiple Ethico staff can collaborate

  // Timing
  kickoffDate           DateTime?
  targetGoLiveDate      DateTime?
  actualGoLiveDate      DateTime?

  // Health tracking
  healthScore           Int                 @default(100) // 0-100

  // Client visibility (per CONTEXT.md - clients can see their checklist)
  clientVisibleNotes    String?

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  // Relations
  organization          Organization        @relation(fields: [clientOrganizationId], references: [id])
  tasks                 ImplementationTask[]
  blockers              ImplementationBlocker[]
  activities            ImplementationActivity[]

  @@index([clientOrganizationId])
  @@index([leadImplementerId])
  @@index([status])
  @@map("implementation_projects")
}

model ImplementationTask {
  id              String              @id @default(uuid())
  projectId       String              // FK to ImplementationProject
  phase           ImplementationPhase
  name            String
  description     String?
  status          TaskStatus          @default(PENDING)
  isRequired      Boolean             @default(true)

  // Assignment (can be assigned to specific person)
  assignedToId    String?             // InternalUser or null

  // Timing
  dueDate         DateTime?
  completedAt     DateTime?
  completedById   String?

  // Ordering
  sortOrder       Int                 @default(0)

  // Notes
  notes           String?

  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  // Relations
  project         ImplementationProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([phase])
  @@index([status])
  @@map("implementation_tasks")
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  BLOCKED
  COMPLETED
  SKIPPED
}
```

Add relation to Organization model (in schema.prisma):
```prisma
// In Organization model
implementationProjects ImplementationProject[]
```
  </action>
  <verify>Prisma validates: `cd apps/backend && npx prisma validate`</verify>
  <done>ImplementationProject and ImplementationTask models in schema with all fields from CONTEXT.md</done>
</task>

<task type="auto">
  <name>Task 3: Create Blocker and Activity Models</name>
  <files>
    apps/backend/src/modules/operations/entities/implementation-blocker.entity.ts
    apps/backend/src/modules/operations/entities/implementation-activity.entity.ts
    apps/backend/prisma/schema.prisma
  </files>
  <action>
Add models for blocker tracking and activity logging:

**ImplementationBlocker model:**
```prisma
enum BlockerCategory {
  INTERNAL
  CLIENT_SIDE
  VENDOR
}

enum BlockerStatus {
  OPEN
  SNOOZED
  RESOLVED
}

model ImplementationBlocker {
  id              String          @id @default(uuid())
  projectId       String          // FK to ImplementationProject
  taskId          String?         // Optional FK to specific task

  title           String
  description     String?
  category        BlockerCategory
  status          BlockerStatus   @default(OPEN)

  // Auto-escalation tracking
  createdAt       DateTime        @default(now())
  snoozeUntil     DateTime?       // When snoozed
  snoozeReason    String?         // Required when snoozed (per CONTEXT.md)
  escalatedToManagerAt DateTime?
  escalatedToDirectorAt DateTime?

  // Resolution
  resolvedAt      DateTime?
  resolvedById    String?
  resolutionNotes String?

  updatedAt       DateTime        @updatedAt

  // Relations
  project         ImplementationProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([status])
  @@index([createdAt])
  @@map("implementation_blockers")
}
```

**ImplementationActivity model** (for email, meetings, decisions per CONTEXT.md):
```prisma
enum ActivityType {
  EMAIL_SENT
  EMAIL_RECEIVED
  MEETING
  DECISION
  PHASE_TRANSITION
  NOTE
  TASK_COMPLETED
  BLOCKER_CREATED
  BLOCKER_RESOLVED
}

model ImplementationActivity {
  id              String       @id @default(uuid())
  projectId       String       // FK to ImplementationProject
  type            ActivityType

  // Content
  subject         String?      // Email subject, meeting title
  content         String?      // Body text, notes

  // Meeting-specific
  attendees       String[]     // For meetings
  meetingDate     DateTime?

  // Decision-specific
  decisionRationale String?    // Why this decision was made

  // Email-specific (per CONTEXT.md - native email from portal)
  emailTo         String[]
  emailCc         String[]
  emailMessageId  String?      // For threading/BCC logging

  // Auto-logged
  isAutoLogged    Boolean      @default(false) // Phase transitions, etc.

  createdById     String       // InternalUser who created
  createdAt       DateTime     @default(now())

  // Relations
  project         ImplementationProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([type])
  @@index([createdAt])
  @@map("implementation_activities")
}
```

Run migration:
```bash
cd apps/backend && npx prisma migrate dev --name add_implementation_models
```
  </action>
  <verify>
1. `cd apps/backend && npx prisma migrate dev --name add_implementation_models` succeeds
2. `cd apps/backend && npm run lint` passes
  </verify>
  <done>ImplementationBlocker and ImplementationActivity models created with auto-escalation and email fields</done>
</task>

</tasks>

<verification>
1. `cd apps/backend && npx prisma validate` - Schema is valid
2. `cd apps/backend && npx prisma migrate dev` - Migration applies cleanly
3. `cd apps/backend && npx tsc --noEmit` - TypeScript compiles
4. Tables exist: implementation_projects, implementation_tasks, implementation_blockers, implementation_activities
</verification>

<success_criteria>
- ImplementationProject tracks client onboarding with type (SMB/Enterprise), phases, team assignment
- ImplementationTask belongs to phases with status, assignment, due dates
- ImplementationBlocker has category-based escalation timing (Internal 3d, Client/Vendor 5d)
- ImplementationActivity captures emails, meetings, decisions with proper fields
- All enums exported from types/implementation.types.ts
- Migration applied successfully
</success_criteria>

<output>
After completion, create `.planning/phases/12-internal-operations-portal/12-02-SUMMARY.md`
</output>
