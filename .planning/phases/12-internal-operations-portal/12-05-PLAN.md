---
phase: 12-internal-operations-portal
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/backend/src/modules/operations/entities/go-live-gate.entity.ts
  - apps/backend/src/modules/operations/entities/readiness-item.entity.ts
  - apps/backend/src/modules/operations/entities/go-live-signoff.entity.ts
  - apps/backend/src/modules/operations/types/go-live.types.ts
  - apps/backend/prisma/schema.prisma
autonomous: true

must_haves:
  truths:
    - "Hard gates are blocking requirements (auth configured, admin trained, terms signed)"
    - "Readiness items have weights for scoring (target 85%+)"
    - "Client sign-off required to proceed below threshold"
    - "Go-live readiness has three-tier system: hard gates, readiness score, sign-off"
  artifacts:
    - path: "apps/backend/prisma/schema.prisma"
      provides: "Go-live readiness models"
      contains: "model GoLiveGate"
    - path: "apps/backend/src/modules/operations/types/go-live.types.ts"
      provides: "Go-live types and constants"
      exports: ["HARD_GATES", "READINESS_ITEMS", "RECOMMENDED_SCORE"]
  key_links:
    - from: "GoLiveGate"
      to: "ImplementationProject"
      via: "projectId FK"
      pattern: "projectId.*String"
---

<objective>
Create database models for go-live readiness with hybrid gates.

Purpose: Implement three-tier go-live system per CONTEXT.md: hard gates (must pass), readiness score (recommended 85%+), and client sign-off for proceeding below threshold.

Output: Prisma schema for GoLiveGate, ReadinessItem, GoLiveSignoff models plus gate/item definitions.
</objective>

<execution_context>
@.claude/agents/gsd-executor.md
@.claude/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/12-internal-operations-portal/12-CONTEXT.md
@.planning/phases/12-internal-operations-portal/12-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Go-Live Types and Gate Definitions</name>
  <files>
    apps/backend/src/modules/operations/types/go-live.types.ts
  </files>
  <action>
Define go-live gate types and weighted readiness items per CONTEXT.md:

```typescript
/**
 * Go-Live Readiness Types
 *
 * Per CONTEXT.md hybrid gates:
 * - Hard gates (blockers - must pass)
 * - Readiness score (recommended 85%+)
 * - Client sign-off to proceed below threshold
 */

export const RECOMMENDED_SCORE = 85; // Recommended minimum readiness score

export enum GateStatus {
  PENDING = 'PENDING',
  PASSED = 'PASSED',
  FAILED = 'FAILED',
  WAIVED = 'WAIVED', // With sign-off
}

export enum SignoffType {
  CLIENT = 'CLIENT',     // Client acknowledges risk
  INTERNAL = 'INTERNAL', // Ethico approves exception
}

// Hard gates per CONTEXT.md - these MUST pass
export const HARD_GATES = [
  {
    id: 'auth_configured',
    name: 'Authentication configured',
    description: 'SSO or password authentication is set up and tested',
    order: 1,
  },
  {
    id: 'admin_trained',
    name: 'At least 1 admin trained/certified',
    description: 'Primary admin has completed Platform Fundamentals certification',
    order: 2,
  },
  {
    id: 'terms_signed',
    name: 'Terms & data processing agreement signed',
    description: 'Legal agreements are executed',
    order: 3,
  },
  {
    id: 'contact_designated',
    name: 'Primary contact designated',
    description: 'Escalation contact information is on file',
    order: 4,
  },
] as const;

// Readiness items with weights (must sum to 100)
export const READINESS_ITEMS = [
  {
    id: 'data_migration',
    name: 'Data migration completed',
    description: 'Historical data imported and verified',
    weight: 20,
    category: 'data',
  },
  {
    id: 'test_workflow',
    name: 'Test workflow executed',
    description: 'End-to-end workflow tested with sample data',
    weight: 15,
    category: 'testing',
  },
  {
    id: 'users_invited',
    name: 'Users invited',
    description: 'At least 50% of target users have accounts',
    weight: 15,
    category: 'users',
  },
  {
    id: 'branding_configured',
    name: 'Branding configured',
    description: 'Logo, colors, and portal customization complete',
    weight: 10,
    category: 'configuration',
  },
  {
    id: 'categories_configured',
    name: 'Categories configured',
    description: 'Category taxonomy set up for organization',
    weight: 10,
    category: 'configuration',
  },
  {
    id: 'integrations_tested',
    name: 'Integrations tested',
    description: 'HRIS, SSO, and other integrations verified',
    weight: 15,
    category: 'integrations',
  },
  {
    id: 'first_policy',
    name: 'First policy published',
    description: 'At least one policy is live',
    weight: 15,
    category: 'content',
  },
] as const;

// Calculate total weight for validation
export const TOTAL_WEIGHT = READINESS_ITEMS.reduce((sum, item) => sum + item.weight, 0); // Should be 100

export type HardGateId = typeof HARD_GATES[number]['id'];
export type ReadinessItemId = typeof READINESS_ITEMS[number]['id'];
```
  </action>
  <verify>TypeScript compiles: `cd apps/backend && npx tsc --noEmit`</verify>
  <done>Go-live types with hard gates, weighted readiness items (sum to 100)</done>
</task>

<task type="auto">
  <name>Task 2: Create Go-Live Gate and Readiness Models</name>
  <files>
    apps/backend/src/modules/operations/entities/go-live-gate.entity.ts
    apps/backend/src/modules/operations/entities/readiness-item.entity.ts
    apps/backend/prisma/schema.prisma
  </files>
  <action>
Add Prisma models for go-live tracking:

**GoLiveGate model** (hard gates status per project):
```prisma
enum GateStatus {
  PENDING
  PASSED
  FAILED
  WAIVED
}

model GoLiveGate {
  id              String     @id @default(uuid())
  projectId       String     // FK to ImplementationProject
  gateId          String     // From HARD_GATES (auth_configured, etc.)

  status          GateStatus @default(PENDING)
  checkedAt       DateTime?  // When last verified
  checkedById     String?    // InternalUser who verified

  // Waiver details
  waiverReason    String?
  waiverApprovedById String?
  waiverApprovedAt DateTime?

  notes           String?

  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  // Relations
  project         ImplementationProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, gateId])
  @@index([projectId])
  @@map("go_live_gates")
}

model ReadinessItem {
  id              String     @id @default(uuid())
  projectId       String     // FK to ImplementationProject
  itemId          String     // From READINESS_ITEMS

  isComplete      Boolean    @default(false)
  completedAt     DateTime?
  completedById   String?    // InternalUser who marked complete

  // Partial credit (0-100 for the item's portion)
  percentComplete Int        @default(0)

  notes           String?

  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  // Relations
  project         ImplementationProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, itemId])
  @@index([projectId])
  @@map("readiness_items")
}
```

Add relations to ImplementationProject:
```prisma
// In ImplementationProject model
goLiveGates     GoLiveGate[]
readinessItems  ReadinessItem[]
```
  </action>
  <verify>Prisma validates: `cd apps/backend && npx prisma validate`</verify>
  <done>GoLiveGate and ReadinessItem models with unique constraint per project</done>
</task>

<task type="auto">
  <name>Task 3: Create Go-Live Sign-off Model</name>
  <files>
    apps/backend/src/modules/operations/entities/go-live-signoff.entity.ts
    apps/backend/prisma/schema.prisma
  </files>
  <action>
Add sign-off model for proceeding below threshold:

**GoLiveSignoff model:**
```prisma
enum SignoffType {
  CLIENT
  INTERNAL
}

model GoLiveSignoff {
  id              String      @id @default(uuid())
  projectId       String      @unique // One sign-off per project
  type            SignoffType

  // Scores at time of sign-off
  readinessScoreAtSignoff Int
  gatesPassedAtSignoff    Int
  gatesTotalAtSignoff     Int

  // Acknowledgment
  acknowledgedRisks       String[]  // List of acknowledged risks
  signoffStatement        String    // "I acknowledge that..."

  // Signatures
  clientSignerName        String?
  clientSignerEmail       String?
  clientSignedAt          DateTime?

  internalApproverName    String?
  internalApproverId      String?   // InternalUser ID
  internalApprovedAt      DateTime?

  createdAt               DateTime  @default(now())

  // Relations
  project                 ImplementationProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("go_live_signoffs")
}
```

Add relation to ImplementationProject:
```prisma
// In ImplementationProject model
goLiveSignoff   GoLiveSignoff?
```

Run migration:
```bash
cd apps/backend && npx prisma migrate dev --name add_go_live_readiness_models
```
  </action>
  <verify>
1. `cd apps/backend && npx prisma migrate dev --name add_go_live_readiness_models` succeeds
2. `cd apps/backend && npm run lint` passes
  </verify>
  <done>GoLiveSignoff model with client/internal signatures and acknowledged risks</done>
</task>

</tasks>

<verification>
1. `cd apps/backend && npx prisma validate` - Schema is valid
2. `cd apps/backend && npx prisma migrate dev` - Migration applies cleanly
3. `cd apps/backend && npx tsc --noEmit` - TypeScript compiles
4. Tables exist: go_live_gates, readiness_items, go_live_signoffs
</verification>

<success_criteria>
- HARD_GATES array has 4 blocking gates from CONTEXT.md
- READINESS_ITEMS array has weighted items summing to 100
- GoLiveGate tracks status per gate per project with waiver support
- ReadinessItem tracks completion percentage per item
- GoLiveSignoff captures both client and internal approval with acknowledged risks
- RECOMMENDED_SCORE constant is 85 per CONTEXT.md
- All types exported from types/go-live.types.ts
</success_criteria>

<output>
After completion, create `.planning/phases/12-internal-operations-portal/12-05-SUMMARY.md`
</output>
