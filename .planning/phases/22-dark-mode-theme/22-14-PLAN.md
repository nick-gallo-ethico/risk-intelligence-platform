---
phase: 22-dark-mode-theme
plan: 14
type: checkpoint
wave: 5
depends_on: ["22-01", "22-02", "22-03", "22-04", "22-05", "22-06", "22-07", "22-08", "22-09", "22-10", "22-11", "22-12", "22-13"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "TypeScript compiles without errors"
    - "All 7 success criteria from the roadmap are verified"
    - "No hardcoded colors remain without dark variants across all page and component files"
  artifacts: []
  key_links: []
---

<objective>
Final verification checkpoint for Phase 22. Verify all 7 success criteria from the roadmap are met and that every page renders correctly in both light and dark modes.

Purpose: Gate the phase completion on actual verification, not just task completion.
Output: Verified dark mode implementation across the entire application.
</objective>

<tasks>

<task type="checkpoint:human-verify">
  <name>Task 1: TypeScript compilation and static analysis</name>
  <action>
Run TypeScript compilation and verify no errors were introduced by the dark mode migration:

```bash
cd apps/frontend && npx tsc --noEmit
```

Then scan for any remaining hardcoded colors that lack dark variants in page and component files:

```bash
# Check for bg-white without nearby dark: variant in same className
grep -rn "bg-white" apps/frontend/src/app/ apps/frontend/src/components/ --include="*.tsx" | grep -v "dark:" | grep -v node_modules

# Check for text-gray-* without dark variant
grep -rn "text-gray-" apps/frontend/src/app/ apps/frontend/src/components/ --include="*.tsx" | grep -v "dark:" | grep -v node_modules

# Check for border-gray-* without dark variant
grep -rn "border-gray-" apps/frontend/src/app/ apps/frontend/src/components/ --include="*.tsx" | grep -v "dark:" | grep -v node_modules
```

Any remaining occurrences should be in contexts where they are acceptable (e.g., inside conditional dark: classes on the same element, or in non-visual contexts).
  </action>
  <verify>
  - TypeScript compiles without errors
  - No unintended hardcoded colors remain
  </verify>
  <done>TypeScript compiles cleanly. Static analysis confirms no unthemed hardcoded colors remain.</done>
</task>

<task type="checkpoint:human-verify">
  <name>Task 2: Verify all 7 success criteria</name>
  <action>
Verify each success criterion from the roadmap:

**Criterion 1: Dark mode toggle accessible from user menu and settings**
- Open user menu dropdown (top-right avatar) — verify theme toggle is present
- Navigate to Settings page — verify theme preference option exists
- Toggle between Light, Dark, and System modes

**Criterion 2: All pages render correctly in dark mode**
- Navigate through all major page groups in dark mode:
  - Dashboard, Cases (list + detail), Investigations (list + detail)
  - Policies (list + detail), Disclosures, Campaigns
  - Analytics (dashboards, reports, report run)
  - Projects, Settings (all sub-pages), Notifications, Profile
  - Search, My Work
  - Ethics portal (with tenant branding)
  - Operator console (intake + QA queue)
  - Employee portal
  - Internal/implementation pages
- Verify: no unreadable text, no broken contrast, no missing backgrounds

**Criterion 3: Dark mode preference persists across sessions**
- Set dark mode, close browser tab, reopen — verify dark mode is still active
- Verify preference is stored (localStorage via next-themes)

**Criterion 4: System preference detection**
- Set theme to "System"
- Toggle OS dark mode setting — verify app follows OS preference
- Verify first-time users get the system default

**Criterion 5: Navigation bars consistent in both modes**
- Compare top nav in light vs dark mode — verify visual consistency
- Compare sidebar in light vs dark mode — verify visual consistency
- Verify mobile bottom nav adapts

**Criterion 6: Charts, tables, modals, and form elements respect theme**
- Open a Gantt chart in dark mode — verify colors are readable
- Open DataTable with frozen columns — verify shadow adapts
- Open any modal/dialog — verify background and text contrast
- Fill out a form — verify inputs, labels, help text contrast

**Criterion 7: No flash of wrong theme on page load**
- Set dark mode, hard refresh (Ctrl+F5) — verify no white flash
- Navigate between pages — verify no theme flicker
- Verify `suppressHydrationWarning` is on `<html>` element
  </action>
  <verify>
  - All 7 criteria pass
  - No visual regressions in light mode (verify light mode still works correctly)
  </verify>
  <done>All 7 success criteria verified. Phase 22 is complete.</done>
</task>

</tasks>

<verification>
- TypeScript compiles without errors
- All 7 success criteria from the roadmap are met
- Both light and dark modes render correctly across all pages
- No regressions in existing light mode styling
</verification>

<success_criteria>
- All 7 roadmap success criteria verified and passing
- No remaining hardcoded colors without dark variants
- Phase 22 can be marked complete
</success_criteria>

<output>
After verification passes, update `.planning/STATE.md` to mark Phase 22 as complete.
</output>
