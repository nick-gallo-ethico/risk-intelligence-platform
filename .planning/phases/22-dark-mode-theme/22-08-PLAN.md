---
phase: 22-dark-mode-theme
plan: 08
type: execute
wave: 3
depends_on: ["22-02", "22-03"]
files_modified:
  - apps/frontend/src/components/policies/policy-list.tsx
  - apps/frontend/src/components/policies/policy-detail-header.tsx
  - apps/frontend/src/components/policies/policy-editor.tsx
  - apps/frontend/src/components/policies/policy-filters.tsx
  - apps/frontend/src/components/policies/policy-version-history.tsx
  - apps/frontend/src/components/policies/policy-version-diff.tsx
  - apps/frontend/src/components/policies/policy-translations-panel.tsx
  - apps/frontend/src/components/policies/policy-attestations-panel.tsx
  - apps/frontend/src/components/policies/policy-cases-panel.tsx
  - apps/frontend/src/components/analytics/dashboards-list.tsx
  - apps/frontend/src/components/analytics/reports-list.tsx
  - apps/frontend/src/components/analytics/dashboard-template-picker.tsx
  - apps/frontend/src/components/projects/GanttChart.tsx
  - apps/frontend/src/components/projects/MilestoneTimeline.tsx
  - apps/frontend/src/lib/gantt-utils.ts
  - apps/frontend/src/components/rich-text/rich-text-editor.tsx
  - apps/frontend/src/components/rich-text/editor-toolbar.tsx
  - apps/frontend/src/components/rich-text/rich-text-display.tsx
  - apps/frontend/src/components/rich-text/character-count.tsx
autonomous: true

must_haves:
  truths:
    - "Policy pages (list, detail, editor) render correctly in dark mode"
    - "Policy version diff is readable in dark mode (additions green, deletions red)"
    - "Analytics dashboard and report list render correctly in dark mode"
    - "Gantt chart renders correctly in dark mode"
    - "Rich text editor content is readable in dark mode"
  artifacts:
    - path: "apps/frontend/src/lib/gantt-utils.ts"
      provides: "Dark-mode-aware Gantt status color functions"
    - path: "apps/frontend/src/components/policies/policy-version-diff.tsx"
      provides: "Dark-mode-compatible diff view"
  key_links:
    - from: "GanttChart.tsx"
      to: "gantt-utils.ts"
      via: "getStatusColor and getStatusBgColor"
      pattern: "getStatusColor"
---

<objective>
Theme policies, analytics, projects (Gantt chart), and rich text editor components. The Gantt chart is a special case — it uses hardcoded hex colors in inline styles that need migration to dark-mode-aware values.

Purpose: Complete dark mode coverage for the remaining high-traffic authenticated features. The Gantt chart hex color migration is the most technically complex task in the entire phase.
Output: Policies, analytics, Gantt chart, and rich text components fully dark-mode-compatible.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-dark-mode-theme/22-RESEARCH.md
@apps/frontend/src/lib/theme-colors.ts
@apps/frontend/src/lib/gantt-utils.ts
@apps/frontend/src/components/projects/GanttChart.tsx
@apps/frontend/src/components/policies/policy-version-diff.tsx
@apps/frontend/src/components/rich-text/rich-text-editor.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Theme policy and analytics components</name>
  <files>
    apps/frontend/src/components/policies/policy-list.tsx
    apps/frontend/src/components/policies/policy-detail-header.tsx
    apps/frontend/src/components/policies/policy-editor.tsx
    apps/frontend/src/components/policies/policy-filters.tsx
    apps/frontend/src/components/policies/policy-version-history.tsx
    apps/frontend/src/components/policies/policy-version-diff.tsx
    apps/frontend/src/components/policies/policy-translations-panel.tsx
    apps/frontend/src/components/policies/policy-attestations-panel.tsx
    apps/frontend/src/components/policies/policy-cases-panel.tsx
    apps/frontend/src/components/analytics/dashboards-list.tsx
    apps/frontend/src/components/analytics/reports-list.tsx
    apps/frontend/src/components/analytics/dashboard-template-picker.tsx
  </files>
  <action>
**Policy Components (9 files, ~40 hardcoded colors):**

Apply the standard color migration pattern:
- `bg-white` → `bg-card`, `bg-gray-50` → `bg-muted/50`, etc.
- Status badges: use `getStatusColor()` from theme-colors.ts
- `policy-detail-header.tsx` already has some `dark:` variants — verify and complete

**Policy Version Diff (`policy-version-diff.tsx`):**
- This component already has some `dark:` variants (3 occurrences)
- Additions: `bg-green-100` → `bg-green-100 dark:bg-green-900/30`, `text-green-800` → `text-green-800 dark:text-green-300`
- Deletions: `bg-red-100` → `bg-red-100 dark:bg-red-900/30`, `text-red-800` → `text-red-800 dark:text-red-300`
- Ensure strikethrough text is visible in dark mode
- Context lines: standard text colors

**Policy Editor (`policy-editor.tsx`):**
- Editor container: `bg-white` → `bg-card`
- Toolbar: `bg-gray-50` → `bg-muted`
- Border: `border-gray-200` → `border-border`

**Analytics Components (3 files):**

**dashboards-list.tsx & reports-list.tsx:**
- Card backgrounds: `bg-white` → `bg-card`
- Table styling: standard migration
- Action buttons: check hover states

**dashboard-template-picker.tsx:**
- Template cards use hardcoded colors per type: `bg-blue-50 text-blue-600 border-blue-200`, etc.
- Add dark variants: `dark:bg-blue-900/20 dark:text-blue-300 dark:border-blue-800`
- Apply to all template type colors (blue, green, amber, purple, etc.)
  </action>
  <verify>
  - `cd apps/frontend && npx tsc --noEmit` should compile without errors
  - Policy detail with version diff readable in dark mode
  - Analytics list pages themed correctly
  </verify>
  <done>All policy components (including version diff) and analytics components render correctly in dark mode.</done>
</task>

<task type="auto">
  <name>Task 2: Theme Gantt chart, milestones, and rich text editor</name>
  <files>
    apps/frontend/src/components/projects/GanttChart.tsx
    apps/frontend/src/components/projects/MilestoneTimeline.tsx
    apps/frontend/src/lib/gantt-utils.ts
    apps/frontend/src/components/rich-text/rich-text-editor.tsx
    apps/frontend/src/components/rich-text/editor-toolbar.tsx
    apps/frontend/src/components/rich-text/rich-text-display.tsx
    apps/frontend/src/components/rich-text/character-count.tsx
  </files>
  <action>
**Gantt Chart (`gantt-utils.ts` + `GanttChart.tsx`):**

The Gantt chart uses hardcoded hex colors in inline styles, which is the trickiest dark mode migration.

1. Update `gantt-utils.ts`:
   - Modify `getStatusColor()` and `getStatusBgColor()` to return BOTH light and dark variants as an object:

   ```typescript
   export function getStatusColorPair(status: string): { light: string; dark: string } {
     switch (status) {
       case 'COMPLETED': return { light: '#22c55e', dark: '#4ade80' };  // green-500 / green-400
       case 'IN_PROGRESS': return { light: '#3b82f6', dark: '#60a5fa' }; // blue-500 / blue-400
       case 'AT_RISK': return { light: '#f59e0b', dark: '#fbbf24' };     // amber-500 / amber-400
       case 'CANCELLED': return { light: '#6b7280', dark: '#9ca3af' };   // gray-500 / gray-400
       default: return { light: '#94a3b8', dark: '#cbd5e1' };            // slate-400 / slate-300
     }
   }

   export function getStatusBgColorPair(status: string): { light: string; dark: string } {
     switch (status) {
       case 'COMPLETED': return { light: '#dcfce7', dark: 'rgba(34, 197, 94, 0.2)' };
       case 'IN_PROGRESS': return { light: '#dbeafe', dark: 'rgba(59, 130, 246, 0.2)' };
       case 'AT_RISK': return { light: '#fef3c7', dark: 'rgba(245, 158, 11, 0.2)' };
       case 'CANCELLED': return { light: '#f3f4f6', dark: 'rgba(107, 114, 128, 0.2)' };
       default: return { light: '#f1f5f9', dark: 'rgba(148, 163, 184, 0.2)' };
     }
   }
   ```

   Keep the original `getStatusColor()` and `getStatusBgColor()` functions for backward compatibility but mark with `@deprecated` comment.

2. Update `GanttChart.tsx`:
   - Import `useTheme` from `next-themes`
   - Get `resolvedTheme` from `useTheme()` (resolvedTheme is 'light' or 'dark', never 'system')
   - Use the pair functions: `const colors = getStatusColorPair(status); const color = resolvedTheme === 'dark' ? colors.dark : colors.light`
   - Replace Tailwind hardcoded classes:
     - `bg-white` → `bg-card`
     - `bg-slate-50` → `bg-muted/50`
     - `bg-slate-100` → `bg-muted`
     - `border-slate-100` → `border-border`
     - `bg-blue-50/30` (today column) → `bg-blue-50/30 dark:bg-blue-900/10`
     - `bg-slate-50/50` (weekends) → `bg-muted/30`
     - `bg-red-500` (today line) → keep as-is (red indicator should stay visible)
   - Grid cell backgrounds that use inline `style`: use the theme-aware pair functions

**MilestoneTimeline (`MilestoneTimeline.tsx`):**
- Timeline line: `bg-slate-200` → `bg-border`
- Hover state: `hover:bg-slate-50` → `hover:bg-muted/50`
- Status icon backgrounds: add dark variants
  - `bg-slate-100` → `bg-slate-100 dark:bg-slate-800`
  - `bg-blue-100` → `bg-blue-100 dark:bg-blue-900/30`
  - `bg-amber-100` → `bg-amber-100 dark:bg-amber-900/30`
  - `bg-green-100` → `bg-green-100 dark:bg-green-900/30`
- Text colors: standard migration

**Rich Text Editor (4 files):**

`rich-text-editor.tsx`:
- Already has 4 `dark:` variants — verify and complete coverage
- Editor content area (`.ProseMirror`): ensure text is readable in dark mode
- Add to globals.css if needed: `.dark .ProseMirror { color: hsl(var(--foreground)); }`
- Placeholder text: should be `text-muted-foreground`
- Selected text highlight: verify visibility in dark mode

`editor-toolbar.tsx`:
- Toolbar background: `bg-gray-50` → `bg-muted`
- Button states: active/inactive visibility
- Separator: `border-gray-200` → `border-border`

`rich-text-display.tsx`:
- Content rendering: ensure prose text is readable
- Already has 1 `dark:` variant

`character-count.tsx`:
- Already has 1 `dark:` variant — verify coverage
- Warning state colors
  </action>
  <verify>
  - `cd apps/frontend && npx tsc --noEmit` should compile without errors
  - Gantt chart bars visible with correct colors in dark mode
  - Rich text editor content readable in dark mode
  </verify>
  <done>Gantt chart uses theme-aware color pairs. Rich text editor readable in dark mode. MilestoneTimeline themed.</done>
</task>

</tasks>

<verification>
- `cd apps/frontend && npx tsc --noEmit` passes
- Policy pages render correctly in dark mode
- Gantt chart bars have appropriate colors in dark mode
- Rich text editor content is readable in dark mode
- Analytics list/template pages themed
</verification>

<success_criteria>
- Charts, tables, modals, and form elements all respect the active theme (success criteria #6)
- Gantt chart hex colors migrated to dark-mode-aware system
- Policy version diff readable in both modes
- Rich text editor fully themed
</success_criteria>

<output>
After completion, create `.planning/phases/22-dark-mode-theme/22-08-SUMMARY.md`
</output>
