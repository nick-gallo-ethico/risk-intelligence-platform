---
phase: 06-case-management
plan: 14
type: execute
wave: 4
depends_on: ["06-01", "06-07"]
files_modified:
  - apps/frontend/src/pages/investigations/InvestigationDetailPage.tsx
  - apps/frontend/src/components/investigations/ChecklistPanel.tsx
  - apps/frontend/src/components/investigations/ChecklistItem.tsx
  - apps/frontend/src/components/investigations/TemplateSelector.tsx
  - apps/frontend/src/services/checklist.service.ts
autonomous: true

must_haves:
  truths:
    - "Investigation detail shows checklist with section progress"
    - "Items can be completed with notes and attachments"
    - "Template selector allows applying/swapping templates"
    - "Custom items can be added to sections"
  artifacts:
    - path: "apps/frontend/src/pages/investigations/InvestigationDetailPage.tsx"
      provides: "Investigation detail with checklist"
    - path: "apps/frontend/src/components/investigations/ChecklistPanel.tsx"
      provides: "Checklist UI with sections and progress"
  key_links:
    - from: "InvestigationDetailPage.tsx"
      to: "ChecklistPanel.tsx"
      via: "component import"
      pattern: "ChecklistPanel"
---

<objective>
Implement the Investigation detail page with checklist panel, template selector, and item completion workflow.

Purpose: Investigators need to track progress through investigation steps with evidence and notes while following templates.

Output: InvestigationDetailPage with ChecklistPanel, item completion, template management
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/06-case-management/06-01-SUMMARY.md
@.planning/phases/06-case-management/06-07-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Checklist Service</name>
  <files>apps/frontend/src/services/checklist.service.ts</files>
  <action>
**checklist.service.ts:**
```typescript
import { apiClient } from './api-client';

export interface ChecklistItemState {
  status: 'pending' | 'completed' | 'skipped';
  completedAt?: string;
  completedByName?: string;
  completionNotes?: string;
  attachmentIds?: string[];
}

export interface ChecklistProgress {
  id: string;
  investigationId: string;
  templateId: string;
  templateVersion: number;
  template: {
    name: string;
    sections: ChecklistSection[];
  };
  itemStates: Record<string, ChecklistItemState>;
  sectionStates: Record<string, SectionState>;
  customItems: CustomItem[];
  skippedItems: SkippedItem[];
  totalItems: number;
  completedItems: number;
  progressPercent: number;
}

export interface ChecklistSection {
  id: string;
  name: string;
  order: number;
  items: ChecklistItem[];
}

export interface ChecklistItem {
  id: string;
  text: string;
  order: number;
  required: boolean;
  evidenceRequired: boolean;
  guidance?: string;
  dependencies?: string[];
}

export interface SectionState {
  status: 'pending' | 'in_progress' | 'completed';
  completedItems: number;
  totalItems: number;
}

export interface CustomItem {
  id: string;
  sectionId: string;
  text: string;
}

export interface SkippedItem {
  itemId: string;
  reason: string;
}

export const checklistService = {
  getProgress: (investigationId: string) =>
    apiClient.get<ChecklistProgress>(`/investigation-checklists/by-investigation/${investigationId}`),

  applyTemplate: (investigationId: string, templateId: string) =>
    apiClient.post<ChecklistProgress>('/investigation-checklists/apply', {
      investigationId,
      templateId,
    }),

  completeItem: (investigationId: string, itemId: string, data: {
    completionNotes?: string;
    attachmentIds?: string[];
  }) =>
    apiClient.post<ChecklistProgress>(
      `/investigation-checklists/${investigationId}/items/${itemId}/complete`,
      data
    ),

  skipItem: (investigationId: string, itemId: string, reason: string) =>
    apiClient.post<ChecklistProgress>(
      `/investigation-checklists/${investigationId}/items/${itemId}/skip`,
      { reason }
    ),

  uncompleteItem: (investigationId: string, itemId: string) =>
    apiClient.post<ChecklistProgress>(
      `/investigation-checklists/${investigationId}/items/${itemId}/uncomplete`
    ),

  addCustomItem: (investigationId: string, sectionId: string, text: string) =>
    apiClient.post<ChecklistProgress>(
      `/investigation-checklists/${investigationId}/custom-items`,
      { sectionId, text }
    ),
};
```
  </action>
  <verify>Service provides API methods for checklist operations.</verify>
  <done>Checklist service handles all checklist API interactions.</done>
</task>

<task type="auto">
  <name>Task 2: Create ChecklistItem and ChecklistPanel Components</name>
  <files>
    apps/frontend/src/components/investigations/ChecklistItem.tsx
    apps/frontend/src/components/investigations/ChecklistPanel.tsx
  </files>
  <action>
**ChecklistItem.tsx:**
Create item component with:
1. Checkbox or completion indicator
2. Item text with required/evidence badges
3. Expand for guidance text
4. Completion dialog with notes and attachment upload
5. Skip dialog with reason
6. Completed state showing who/when/notes
7. Dependency indication (locked if deps incomplete)

**ChecklistPanel.tsx:**
Create panel component with:
1. Template name and version
2. Overall progress bar with percentage
3. Collapsible sections with individual progress
4. Items within sections
5. Add custom item button per section
6. View skipped items section
7. Template actions (swap, remove)
  </action>
  <verify>Components render checklist with interactive items.</verify>
  <done>ChecklistPanel provides complete checklist UI with sections and items.</done>
</task>

<task type="auto">
  <name>Task 3: Create Template Selector and Integrate into Detail Page</name>
  <files>
    apps/frontend/src/components/investigations/TemplateSelector.tsx
    apps/frontend/src/pages/investigations/InvestigationDetailPage.tsx
  </files>
  <action>
**TemplateSelector.tsx:**
Create component with:
1. Template dropdown organized by tier (Official, Team, Personal)
2. Template preview on hover/selection
3. Apply button
4. "No template" option
5. Loading state during apply

**InvestigationDetailPage.tsx:**
Update or create page with:
1. Investigation header (case reference, status, assignee)
2. ChecklistPanel when template applied
3. TemplateSelector when no template
4. Tabs: Checklist, Notes, Interviews, Files, Activity
5. Integration with existing investigation service
  </action>
  <verify>
Investigation detail shows checklist when template applied.
Template selector allows choosing and applying templates.
Items can be completed with notes.
  </verify>
  <done>InvestigationDetailPage integrates checklist workflow.</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` in apps/frontend succeeds
- [ ] Checklist panel shows sections with progress bars
- [ ] Items can be checked with completion notes
- [ ] Custom items can be added to sections
- [ ] Template selector shows categorized templates
- [ ] Dependency locking prevents out-of-order completion
</verification>

<success_criteria>
1. Investigation detail shows checklist with section progress
2. Items completed via dialog with notes and attachments
3. Skipped items tracked with reason
4. Custom items addable to sections
5. Template selector organized by tier
</success_criteria>

<output>
After completion, create `.planning/phases/06-case-management/06-14-SUMMARY.md`
</output>
