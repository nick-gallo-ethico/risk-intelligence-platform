---
phase: 06-case-management
plan: 15
type: execute
wave: 5
depends_on: ["06-12", "06-13", "06-14"]
files_modified:
  - apps/frontend/src/hooks/useKeyboardShortcuts.ts
  - apps/frontend/src/components/common/CommandPalette.tsx
  - apps/frontend/src/components/common/ShortcutsHelpDialog.tsx
  - apps/frontend/src/pages/cases/CaseListPage.tsx
  - apps/frontend/src/pages/cases/CaseDetailPage.tsx
  - apps/frontend/src/pages/investigations/InvestigationDetailPage.tsx
autonomous: true

must_haves:
  truths:
    - "Cmd+K opens global command palette for quick navigation"
    - "J/K navigate between list items in Case and RIU lists"
    - "? shows keyboard shortcuts help overlay"
    - "Shortcuts disabled when typing in inputs"
  artifacts:
    - path: "apps/frontend/src/hooks/useKeyboardShortcuts.ts"
      provides: "Reusable keyboard shortcut hook"
    - path: "apps/frontend/src/components/common/CommandPalette.tsx"
      provides: "Global command palette UI"
  key_links:
    - from: "CaseListPage.tsx"
      to: "useKeyboardShortcuts.ts"
      via: "hook import"
      pattern: "useKeyboardShortcuts"
---

<objective>
Implement keyboard shortcuts and command palette for power users across Case Management pages.

Purpose: Power users need efficient navigation and actions without reaching for the mouse. Keyboard shortcuts significantly improve workflow speed.

Output: useKeyboardShortcuts hook, CommandPalette component, ShortcutsHelpDialog, integration into Case and Investigation pages
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/06-case-management/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Keyboard Shortcuts Infrastructure</name>
  <files>
    apps/frontend/src/hooks/useKeyboardShortcuts.ts
    apps/frontend/src/components/common/ShortcutsHelpDialog.tsx
  </files>
  <action>
Install react-hotkeys-hook:
```bash
cd apps/frontend && npm install react-hotkeys-hook
```

**useKeyboardShortcuts.ts:**
```typescript
import { useHotkeys, Options } from 'react-hotkeys-hook';
import { useCallback } from 'react';

// Standard shortcut definitions
export const SHORTCUTS = {
  // Global
  COMMAND_PALETTE: 'mod+k',
  HELP: 'shift+?',

  // Navigation
  NEXT_ITEM: 'j',
  PREV_ITEM: 'k',
  OPEN_ITEM: 'enter',
  GO_BACK: 'mod+[',

  // Actions
  NEW_CASE: 'mod+shift+c',
  NEW_INVESTIGATION: 'mod+shift+i',
  SEARCH: '/',
  SAVE: 'mod+s',

  // List views
  SELECT_ALL: 'mod+a',
  DESELECT_ALL: 'escape',
} as const;

// Hook for list navigation
export function useListNavigation(
  items: { id: string }[],
  onSelect: (id: string) => void,
  onOpen?: (id: string) => void,
) {
  const [focusIndex, setFocusIndex] = useState(0);

  const focusNext = useCallback(() => {
    setFocusIndex(prev => Math.min(prev + 1, items.length - 1));
  }, [items.length]);

  const focusPrev = useCallback(() => {
    setFocusIndex(prev => Math.max(prev - 1, 0));
  }, []);

  const openCurrent = useCallback(() => {
    if (items[focusIndex] && onOpen) {
      onOpen(items[focusIndex].id);
    }
  }, [focusIndex, items, onOpen]);

  useHotkeys(SHORTCUTS.NEXT_ITEM, focusNext, { enableOnFormTags: false });
  useHotkeys(SHORTCUTS.PREV_ITEM, focusPrev, { enableOnFormTags: false });
  useHotkeys(SHORTCUTS.OPEN_ITEM, openCurrent, { enableOnFormTags: false });

  return { focusIndex, setFocusIndex };
}

// Hook for global shortcuts
export function useGlobalShortcuts(options: {
  onCommandPalette?: () => void;
  onHelp?: () => void;
  onSearch?: () => void;
}) {
  const opts: Options = { enableOnFormTags: false, preventDefault: true };

  useHotkeys(SHORTCUTS.COMMAND_PALETTE, (e) => {
    e.preventDefault();
    options.onCommandPalette?.();
  }, opts);

  useHotkeys(SHORTCUTS.HELP, () => {
    options.onHelp?.();
  }, opts);

  useHotkeys(SHORTCUTS.SEARCH, () => {
    options.onSearch?.();
  }, opts);
}
```

**ShortcutsHelpDialog.tsx:**
Create dialog component showing all available shortcuts organized by category:
- Global shortcuts (Cmd+K, ?)
- Navigation (J, K, Enter, Cmd+[)
- Actions (Cmd+Shift+C, Cmd+Shift+I)
- List operations (Cmd+A, Escape)

Style with MUI Dialog, display keyboard key badges.
  </action>
  <verify>npm run build in apps/frontend succeeds. Hook exports shortcuts constants.</verify>
  <done>Keyboard shortcuts infrastructure with reusable hooks and help dialog.</done>
</task>

<task type="auto">
  <name>Task 2: Create Command Palette Component</name>
  <files>apps/frontend/src/components/common/CommandPalette.tsx</files>
  <action>
**CommandPalette.tsx:**
Create command palette component (inspired by VS Code/Linear):

1. Modal dialog triggered by Cmd+K
2. Search input with instant filtering
3. Commands grouped by category:
   - Navigation: Go to Cases, Go to Investigations, Go to Dashboard
   - Actions: New Case, New Investigation, New Remediation Plan
   - Recent: Last 5 viewed items
   - Search: "Search for..." with entity type icons
4. Keyboard navigation within palette (arrow keys, Enter)
5. Fuzzy search matching
6. Command execution on selection
7. Close on Escape or click outside

```typescript
interface Command {
  id: string;
  label: string;
  category: 'navigation' | 'action' | 'recent' | 'search';
  icon?: React.ReactNode;
  shortcut?: string;
  action: () => void;
}

export function CommandPalette({ open, onClose }: CommandPaletteProps) {
  const [query, setQuery] = useState('');
  const [selectedIndex, setSelectedIndex] = useState(0);
  const commands = useCommands();

  const filtered = useMemo(() => {
    if (!query) return commands;
    return commands.filter(cmd =>
      cmd.label.toLowerCase().includes(query.toLowerCase())
    );
  }, [commands, query]);

  // Keyboard navigation within palette
  useHotkeys('up', () => setSelectedIndex(i => Math.max(0, i - 1)), { enableOnFormTags: true });
  useHotkeys('down', () => setSelectedIndex(i => Math.min(filtered.length - 1, i + 1)), { enableOnFormTags: true });
  useHotkeys('enter', () => {
    filtered[selectedIndex]?.action();
    onClose();
  }, { enableOnFormTags: true });

  // ... render modal with grouped commands
}
```
  </action>
  <verify>Command palette opens with Cmd+K, filters commands, executes on Enter.</verify>
  <done>CommandPalette provides quick navigation and action execution.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate Shortcuts into Case Management Pages</name>
  <files>
    apps/frontend/src/pages/cases/CaseListPage.tsx
    apps/frontend/src/pages/cases/CaseDetailPage.tsx
    apps/frontend/src/pages/investigations/InvestigationDetailPage.tsx
  </files>
  <action>
Update pages to use keyboard shortcuts:

**CaseListPage.tsx:**
1. Add useListNavigation for J/K navigation through case list
2. Add visual focus indicator (ring/highlight) on focused row
3. Enter opens focused case
4. Connect to global shortcuts context
5. Escape clears selection

**CaseDetailPage.tsx:**
1. Cmd+[ to go back to list
2. Tab sections navigable with number keys (1-6 for tabs)
3. Connect to command palette

**InvestigationDetailPage.tsx:**
1. Checklist item navigation with J/K
2. Space to toggle checklist item completion
3. E to edit notes on focused item
4. Connect to command palette

Add ShortcutsProvider at App level to manage:
- Command palette state
- Help dialog state
- Recent items tracking
  </action>
  <verify>
J/K navigates list items with visible focus indicator.
Cmd+K opens command palette on all pages.
? shows shortcuts help dialog.
  </verify>
  <done>Keyboard shortcuts integrated throughout Case Management UI.</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` in apps/frontend succeeds
- [ ] Cmd+K opens command palette globally
- [ ] J/K navigate list items with visual feedback
- [ ] ? shows shortcuts help overlay
- [ ] Shortcuts disabled when focused in input fields
- [ ] Command palette fuzzy search works
- [ ] Enter in palette executes selected command
</verification>

<success_criteria>
1. Command palette accessible via Cmd+K from any page
2. List navigation with J/K and visual focus indicator
3. Shortcuts help accessible via ?
4. Shortcuts correctly disabled in form inputs
5. Command palette supports fuzzy search and keyboard navigation
</success_criteria>

<output>
After completion, create `.planning/phases/06-case-management/06-15-SUMMARY.md`
</output>
