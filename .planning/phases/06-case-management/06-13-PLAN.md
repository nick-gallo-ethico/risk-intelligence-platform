---
phase: 06-case-management
plan: 13
type: execute
wave: 4
depends_on: []
files_modified:
  - apps/frontend/src/pages/cases/CaseDetailPage.tsx
  - apps/frontend/src/components/cases/LinkedRiuList.tsx
  - apps/frontend/src/components/cases/CaseDetailHeader.tsx
  - apps/frontend/src/components/cases/CaseTabs.tsx
autonomous: true

must_haves:
  truths:
    - "Case detail shows linked RIUs with association type"
    - "RIU summary expandable without navigation"
    - "Primary RIU highlighted distinctly"
    - "Case tabs organize Investigations, Messages, Files, Activity"
  artifacts:
    - path: "apps/frontend/src/pages/cases/CaseDetailPage.tsx"
      provides: "Case detail with linked RIUs"
    - path: "apps/frontend/src/components/cases/LinkedRiuList.tsx"
      provides: "RIU association display component"
  key_links:
    - from: "CaseDetailPage.tsx"
      to: "LinkedRiuList.tsx"
      via: "component import"
      pattern: "LinkedRiuList"
---

<objective>
Implement the Case detail page with linked RIU display, tabbed content organization, and header with key case information.

Purpose: Investigators need to see case context including all linked RIUs and navigate between investigations, messages, files, and activity.

Output: CaseDetailPage with header, linked RIUs, and tabbed sections
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Case Detail Header Component</name>
  <files>apps/frontend/src/components/cases/CaseDetailHeader.tsx</files>
  <action>
**CaseDetailHeader.tsx:**
Create component showing:
1. Reference number with copy button
2. Status badge (color-coded)
3. Pipeline stage with progress indicator
4. Severity chip
5. Category with icon
6. Created date and age
7. Assigned investigators avatars
8. SLA status indicator (on track/warning/breached)
9. Quick actions: Assign, Change Status, Merge
  </action>
  <verify>Component displays case header information with status badges.</verify>
  <done>CaseDetailHeader shows key case metadata at a glance.</done>
</task>

<task type="auto">
  <name>Task 2: Create Linked RIU List Component</name>
  <files>apps/frontend/src/components/cases/LinkedRiuList.tsx</files>
  <action>
**LinkedRiuList.tsx:**
```typescript
import React, { useState } from 'react';
import {
  List,
  ListItem,
  ListItemText,
  Collapse,
  Chip,
  IconButton,
  Typography,
  Paper,
  Box,
  Divider,
} from '@mui/material';
import { ExpandMore, ExpandLess, Link as LinkIcon } from '@mui/icons-material';

interface RiuAssociation {
  id: string;
  riuId: string;
  associationType: 'PRIMARY' | 'RELATED' | 'MERGED_FROM';
  riu: {
    id: string;
    referenceNumber: string;
    type: string;
    sourceChannel: string;
    summary?: string;
    details: string;
    createdAt: string;
    severity: string;
  };
}

interface LinkedRiuListProps {
  associations: RiuAssociation[];
  onRiuClick?: (riuId: string) => void;
}

export function LinkedRiuList({ associations, onRiuClick }: LinkedRiuListProps) {
  const [expanded, setExpanded] = useState<string | null>(null);

  const primary = associations.find(a => a.associationType === 'PRIMARY');
  const others = associations.filter(a => a.associationType !== 'PRIMARY');

  const renderRiu = (assoc: RiuAssociation, isPrimary: boolean) => {
    const isExpanded = expanded === assoc.id;

    return (
      <Paper
        key={assoc.id}
        variant="outlined"
        sx={{
          mb: 1,
          borderColor: isPrimary ? 'primary.main' : undefined,
          borderWidth: isPrimary ? 2 : 1,
        }}
      >
        <ListItem
          button
          onClick={() => setExpanded(isExpanded ? null : assoc.id)}
          secondaryAction={
            <IconButton edge="end">
              {isExpanded ? <ExpandLess /> : <ExpandMore />}
            </IconButton>
          }
        >
          <ListItemText
            primary={
              <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                <Typography variant="subtitle2">
                  {assoc.riu.referenceNumber}
                </Typography>
                {isPrimary && (
                  <Chip label="Primary" size="small" color="primary" />
                )}
                <Chip
                  label={assoc.associationType.replace('_', ' ')}
                  size="small"
                  variant="outlined"
                />
              </Box>
            }
            secondary={
              <>
                {assoc.riu.type} via {assoc.riu.sourceChannel} |{' '}
                {new Date(assoc.riu.createdAt).toLocaleDateString()}
              </>
            }
          />
        </ListItem>

        <Collapse in={isExpanded}>
          <Box sx={{ p: 2, pt: 0, bgcolor: 'grey.50' }}>
            <Typography variant="body2" sx={{ mb: 1 }}>
              <strong>Summary:</strong>{' '}
              {assoc.riu.summary || 'No summary available'}
            </Typography>
            <Typography
              variant="body2"
              sx={{
                maxHeight: 200,
                overflow: 'auto',
                whiteSpace: 'pre-wrap',
              }}
            >
              {assoc.riu.details}
            </Typography>
            {onRiuClick && (
              <Box sx={{ mt: 1 }}>
                <IconButton
                  size="small"
                  onClick={() => onRiuClick(assoc.riuId)}
                >
                  <LinkIcon fontSize="small" />
                </IconButton>
                <Typography variant="caption">View full RIU</Typography>
              </Box>
            )}
          </Box>
        </Collapse>
      </Paper>
    );
  };

  return (
    <Box>
      <Typography variant="subtitle1" sx={{ mb: 1 }}>
        Linked Reports ({associations.length})
      </Typography>

      {primary && renderRiu(primary, true)}

      {others.length > 0 && (
        <>
          <Divider sx={{ my: 2 }}>
            <Typography variant="caption" color="text.secondary">
              Related Reports
            </Typography>
          </Divider>
          {others.map(a => renderRiu(a, false))}
        </>
      )}

      {associations.length === 0 && (
        <Typography color="text.secondary" variant="body2">
          No linked reports
        </Typography>
      )}
    </Box>
  );
}
```
  </action>
  <verify>Component shows RIUs with expandable details and primary highlighting.</verify>
  <done>LinkedRiuList displays RIU associations with expand/collapse.</done>
</task>

<task type="auto">
  <name>Task 3: Create Case Tabs and Detail Page</name>
  <files>
    apps/frontend/src/components/cases/CaseTabs.tsx
    apps/frontend/src/pages/cases/CaseDetailPage.tsx
  </files>
  <action>
**CaseTabs.tsx:**
Create tabbed interface with:
1. Overview tab (linked RIUs, summary, key dates)
2. Investigations tab (list of investigations with status)
3. Messages tab (anonymous communication thread)
4. Files tab (attachments grid)
5. Activity tab (timeline from ActivityTimelineService)
6. Remediation tab (linked remediation plans)

Badge indicators on tabs showing counts (unread messages, active investigations).

**CaseDetailPage.tsx:**
Compose the detail page:
1. Load case data with associations
2. Render CaseDetailHeader
3. Render CaseTabs
4. Handle tab navigation via URL params
5. Error and loading states
  </action>
  <verify>Case detail page loads with tabs. Tab content renders correctly.</verify>
  <done>CaseDetailPage provides complete case view with tabbed navigation.</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` in apps/frontend succeeds
- [ ] Case header shows all key metadata
- [ ] Linked RIUs expand to show details inline
- [ ] Primary RIU visually distinguished
- [ ] Tabs navigate between content sections
- [ ] Activity tab loads timeline data
</verification>

<success_criteria>
1. Case detail shows linked RIUs with association types
2. RIU content expandable without full navigation
3. Primary RIU highlighted with distinct border
4. Tabbed interface organizes related content
5. Badge indicators show counts (messages, investigations)
</success_criteria>

<output>
After completion, create `.planning/phases/06-case-management/06-13-SUMMARY.md`
</output>
