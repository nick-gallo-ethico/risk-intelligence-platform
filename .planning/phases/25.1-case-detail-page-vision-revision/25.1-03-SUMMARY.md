---
phase: 25.1-case-detail-page-vision-revision
plan: 03
subsystem: frontend-ui
tags:
  [
    left-sidebar,
    record-header,
    actions-dropdown,
    collapsible-cards,
    property-panel,
  ]

dependency-graph:
  requires: [25.1-01]
  provides:
    [
      RecordHeader,
      ActionsDropdown,
      CollapsiblePropertyCard,
      left-sidebar-restructure,
    ]
  affects: [25.1-04, 25.1-05, 25.1-06]

tech-stack:
  added: []
  patterns: [collapsible-property-cards, config-driven-fields, inline-editing]

key-files:
  created:
    - apps/frontend/src/components/record-detail/RecordHeader.tsx
    - apps/frontend/src/components/record-detail/ActionsDropdown.tsx
    - apps/frontend/src/components/record-detail/CollapsiblePropertyCard.tsx
  modified:
    - apps/frontend/src/components/cases/case-properties-panel.tsx
    - apps/frontend/src/components/cases/case-detail-header.tsx
    - apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx
    - apps/frontend/src/components/cases/case-investigations-panel.tsx

decisions:
  - id: left-sidebar-hierarchy
    context: Needed clear visual hierarchy for left sidebar
    decision: RecordHeader at top, ActionsDropdown below, QuickActions, then 3 property cards
    rationale: Matches HubSpot spec Section 14 exactly

metrics:
  duration: 22 minutes
  completed: 2026-02-13
---

# Phase 25.1 Plan 03: Left Sidebar Restructure Summary

## One-liner

Restructured left sidebar with RecordHeader (case identity), ActionsDropdown (8 actions), and 3 CollapsiblePropertyCards (About, Intake, Classification).

## What Was Built

### Task 1: RecordHeader and ActionsDropdown

**RecordHeader.tsx** - Top of left sidebar showing case identity:

- Reference number with copy button (toast on copy)
- Status badge with color coding (NEW=blue, OPEN=yellow, CLOSED=gray, etc.)
- Severity badge with color coding (LOW=green, MEDIUM=yellow, HIGH=orange, CRITICAL=red)
- Category text display
- Open date (formatted)
- Case age text ("Open for 29 days" or "Closed after 14 days")
- Avatar stack for assigned investigators (+N overflow for >3)
- Loading skeleton state

**ActionsDropdown.tsx** - 8-action dropdown menu:

- Assign (opens modal)
- Change Status (opens modal)
- Merge (opens modal)
- Follow/Unfollow (toggle text, "Coming soon" toast)
- View All Properties ("Coming soon" toast)
- View Property History ("Coming soon" toast)
- Export Case ("Coming soon" toast)
- Delete (admin-only, destructive styling)

### Task 2: CollapsiblePropertyCard and Sidebar Restructure

**CollapsiblePropertyCard.tsx** - Reusable collapsible card:

- Animated chevron (rotates 90 degrees on expand)
- Optional settings gear icon (admin only)
- Accepts array of PropertyField objects
- Field types: text, select, date, tags, user, readonly
- Integrates with existing EditableField component for inline editing
- Supports custom renderValue for badges

**Refactored CasePropertiesPanel** into 3 cards per spec Sections 14.4-14.6:

1. **About This Case** (expanded by default, 10 fields):
   - Status, Severity, Priority, Case Type, Source Channel
   - Open Date, Target Close Date, SLA Due Date
   - Case Owner, Department

2. **Intake Information** (collapsed by default, 11 fields):
   - Reporter Type, Name, Email, Phone
   - Access Code, Incident Date/Location
   - Location City/State/Country, Intake Time

3. **Classification** (expanded by default):
   - Tags field (placeholder for Category in Plan 04)

**Updated page.tsx left sidebar structure:**

```
RecordHeader (case identity)
ActionsDropdown (8 actions)
ActionButtonRow (quick actions)
3 CollapsiblePropertyCards
```

**Simplified CaseDetailHeader** to breadcrumb-only (removed action buttons, status info - now in RecordHeader/ActionsDropdown).

## Commits

| Commit  | Description                                                                |
| ------- | -------------------------------------------------------------------------- |
| 384d246 | feat(25.1-03): create RecordHeader and ActionsDropdown components          |
| a55ebf1 | feat(25.1-03): create CollapsiblePropertyCard and restructure left sidebar |

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Missing SummaryTab import in case-tabs.tsx**

- Found during: Task 1 commit
- Issue: case-tabs.tsx referenced SummaryTab but didn't import it
- Fix: Added missing import
- Commit: 384d246

**2. [Rule 3 - Blocking] TypeScript errors in case-investigations-panel.tsx**

- Found during: Task 2 commit
- Issue: Code used fields that don't exist on Investigation type (priority, title, referenceNumber, summary, assignedTo.firstName)
- Fix: Changed to correct fields from Investigation type:
  - `priority` -> `slaStatus`
  - `title` -> `investigationNumber`
  - `referenceNumber` -> `investigationNumber`
  - `summary` -> `findingsSummary`
  - `assignedTo.firstName` -> `primaryInvestigator.firstName`
- Commit: a55ebf1

## Files Changed

### Created

- `apps/frontend/src/components/record-detail/RecordHeader.tsx` - Case identity header
- `apps/frontend/src/components/record-detail/ActionsDropdown.tsx` - 8-action dropdown
- `apps/frontend/src/components/record-detail/CollapsiblePropertyCard.tsx` - Reusable property card

### Modified

- `apps/frontend/src/components/cases/case-properties-panel.tsx` - Now uses 3 CollapsiblePropertyCards
- `apps/frontend/src/components/cases/case-detail-header.tsx` - Simplified to breadcrumb-only
- `apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx` - Integrated new components
- `apps/frontend/src/components/cases/case-investigations-panel.tsx` - Fixed TypeScript errors
- `apps/frontend/src/components/cases/case-tabs.tsx` - Added missing import

## Verification

- [x] Left sidebar shows RecordHeader at top (ref#, badges, category, date, case age, assigned)
- [x] ActionsDropdown opens with 8 items, Assign/Status/Merge trigger modals
- [x] Quick action buttons render below Actions dropdown
- [x] 3 collapsible cards with correct fields
- [x] About This Case expanded by default, Intake Information collapsed
- [x] Inline editing works on editable fields (via existing EditableField)
- [x] CaseDetailHeader simplified to breadcrumb only
- [x] `npm run typecheck` passes

## Next Phase Readiness

Ready for Plan 04 (CategorySelector) - the Classification card has a tags field placeholder waiting for category/subcategory selector implementation.

Dependencies delivered:

- RecordHeader - reusable for investigations/disclosures/policies
- ActionsDropdown - reusable with different action sets per record type
- CollapsiblePropertyCard - fully generic, config-driven property display
