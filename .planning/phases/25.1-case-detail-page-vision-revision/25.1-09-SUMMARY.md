---
phase: 25.1-case-detail-page-vision-revision
plan: 09
subsystem: ui
tags:
  [
    responsive,
    tailwind,
    shadcn-sheet,
    media-query,
    skeleton,
    error-boundary,
    localStorage,
    collapsible,
  ]

# Dependency graph
requires:
  - phase: 25.1-01
    provides: RecordDetailLayout three-column component, RecordDetailConfig types
  - phase: 25.1-03
    provides: CollapsiblePropertyCard, CasePropertiesPanel with 3 card sections
provides:
  - MobileSidebarDrawer component for responsive sidebar access
  - useBreakpoint hook for desktop/tablet/mobile detection
  - Responsive RecordDetailLayout (drawers on tablet/mobile)
  - loading.tsx skeleton for case detail page
  - error.tsx error boundary for case detail page
  - useCollapsibleState hook for localStorage-backed state persistence
  - Controlled mode support on CollapsiblePropertyCard
affects: [25.1-10, future-responsive-pages, investigation-detail-page]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "useBreakpoint hook pattern for responsive layout switching (desktop/tablet/mobile)"
    - "MobileSidebarDrawer pattern using shadcn Sheet for sidebar drawers"
    - "useCollapsibleState pattern for localStorage-backed UI state persistence"
    - "Controlled/uncontrolled mode pattern on CollapsiblePropertyCard"

key-files:
  created:
    - apps/frontend/src/components/record-detail/MobileSidebarDrawer.tsx
    - apps/frontend/src/app/(authenticated)/cases/[id]/loading.tsx
    - apps/frontend/src/app/(authenticated)/cases/[id]/error.tsx
    - apps/frontend/src/hooks/useCollapsibleState.ts
  modified:
    - apps/frontend/src/components/record-detail/RecordDetailLayout.tsx
    - apps/frontend/src/components/record-detail/CollapsiblePropertyCard.tsx
    - apps/frontend/src/components/cases/case-properties-panel.tsx
    - apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx

key-decisions:
  - "Used JS-based breakpoint detection (useBreakpoint hook) instead of CSS-only to conditionally render sidebars vs drawers"
  - "Added controlled mode to CollapsiblePropertyCard (isOpen/onOpenChange props) for external state management"
  - "Collapsible state scoped per case via storageKey format collapsible-{caseId}-{cardId}"

patterns-established:
  - "MobileSidebarDrawer: reusable Sheet wrapper for sidebar content on non-desktop"
  - "useCollapsibleState: localStorage hook with SSR-safe fallback for UI state persistence"

# Metrics
duration: 6min
completed: 2026-02-13
---

# Phase 25.1 Plan 09: Responsive Layout, Loading/Error States, Collapsible Persistence Summary

**Responsive drawer sidebars below 1280px, skeleton/error loading states, and localStorage-persisted collapsible card state for case detail page**

## Performance

- **Duration:** 6 min
- **Started:** 2026-02-14T00:19:26Z
- **Completed:** 2026-02-14T00:25:50Z
- **Tasks:** 2
- **Files modified:** 8

## Accomplishments

- Three-column layout collapses to single column with drawer toggle buttons below 1280px (xl breakpoint)
- MobileSidebarDrawer component wraps sidebar content in shadcn Sheet, 320px on tablet, full-width on mobile
- Loading skeleton matches three-column layout structure with proper responsive hiding
- Error boundary with AlertCircle icon, error message, Try Again and Go Back buttons
- Collapsible card state (About, Intake, Classification) persists via localStorage per case

## Task Commits

Each task was committed atomically:

1. **Task 1: Add responsive behavior to RecordDetailLayout** - `329ffd0` (feat)
2. **Task 2: Add loading/error states and collapsible persistence** - `ebc3e2f` (feat)

## Files Created/Modified

- `apps/frontend/src/components/record-detail/MobileSidebarDrawer.tsx` - Sheet-based slide-over drawer for sidebar content on tablet/mobile
- `apps/frontend/src/components/record-detail/RecordDetailLayout.tsx` - Added useBreakpoint hook, drawer state, toggle buttons, responsive grid
- `apps/frontend/src/app/(authenticated)/cases/[id]/loading.tsx` - Next.js loading state with three-column skeleton
- `apps/frontend/src/app/(authenticated)/cases/[id]/error.tsx` - Next.js error boundary with retry/go-back
- `apps/frontend/src/hooks/useCollapsibleState.ts` - localStorage-backed boolean state persistence hook
- `apps/frontend/src/components/record-detail/CollapsiblePropertyCard.tsx` - Added controlled mode (isOpen/onOpenChange props)
- `apps/frontend/src/components/cases/case-properties-panel.tsx` - Added collapsibleStates prop for external state control
- `apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx` - Wired useCollapsibleState for 3 property cards

## Decisions Made

- Used JavaScript-based breakpoint detection (useBreakpoint) instead of pure CSS media queries, because sidebars need to be conditionally rendered in drawers vs inline columns (not just hidden/shown)
- Added controlled mode to CollapsiblePropertyCard rather than moving state management into the hook directly, preserving backward compatibility for uncontrolled usage elsewhere
- Only one drawer can be open at a time on tablet/mobile, preventing overlapping drawers
- Drawers auto-close when resizing back to desktop width

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 2 - Missing Critical] Added controlled mode to CollapsiblePropertyCard**

- **Found during:** Task 2 (wiring useCollapsibleState into page.tsx)
- **Issue:** CollapsiblePropertyCard used internal useState only. To support external localStorage-backed state, it needed controlled mode props.
- **Fix:** Added optional `isOpen` and `onOpenChange` props. When provided, they override internal state. When absent, backward-compatible uncontrolled behavior.
- **Files modified:** CollapsiblePropertyCard.tsx, case-properties-panel.tsx
- **Verification:** TypeScript compiles, both controlled and uncontrolled modes work
- **Committed in:** ebc3e2f (Task 2 commit)

---

**Total deviations:** 1 auto-fixed (1 missing critical)
**Impact on plan:** Essential for connecting useCollapsibleState to the cards. No scope creep.

## Issues Encountered

None

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Responsive layout complete for case detail page
- MobileSidebarDrawer and useBreakpoint are reusable for investigation/disclosure detail pages
- useCollapsibleState is reusable for any collapsible UI that needs persistence
- All loading/error states in place for case detail route

---

_Phase: 25.1-case-detail-page-vision-revision_
_Completed: 2026-02-13_
