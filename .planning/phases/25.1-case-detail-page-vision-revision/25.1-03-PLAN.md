---
phase: 25.1-case-detail-page-vision-revision
plan: 03
type: execute
wave: 2
depends_on: [01]
files_modified:
  - apps/frontend/src/components/record-detail/ActionsDropdown.tsx
  - apps/frontend/src/components/record-detail/RecordHeader.tsx
  - apps/frontend/src/components/record-detail/CollapsiblePropertyCard.tsx
  - apps/frontend/src/components/cases/case-properties-panel.tsx
  - apps/frontend/src/components/cases/case-detail-header.tsx
  - apps/frontend/src/components/cases/case-info-summary.tsx
  - apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Left sidebar shows case header with reference number, status badge, severity badge, category, open date, case age, assigned-to"
    - "Actions dropdown below header has 8 menu items: Assign, Change Status, Merge, Follow, View Properties, View History, Export, Delete"
    - "Quick action buttons (Note, Email, Task, Document, Interview, More) render below Actions dropdown"
    - "3 collapsible property cards appear: About This Case, Intake Information, Classification"
    - "About This Case card has 10 editable fields per spec Section 14.4"
    - "Intake Information card has 14 fields per spec Section 14.5"
  artifacts:
    - path: "apps/frontend/src/components/record-detail/ActionsDropdown.tsx"
      provides: "Actions dropdown menu component"
      contains: "ActionsDropdown"
    - path: "apps/frontend/src/components/record-detail/RecordHeader.tsx"
      provides: "Left sidebar header with reference, badges, metadata"
      contains: "RecordHeader"
    - path: "apps/frontend/src/components/record-detail/CollapsiblePropertyCard.tsx"
      provides: "Reusable collapsible card with fields"
      contains: "CollapsiblePropertyCard"
  key_links:
    - from: "apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx"
      to: "RecordHeader"
      via: "left sidebar render"
      pattern: "RecordHeader"
    - from: "apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx"
      to: "ActionsDropdown"
      via: "left sidebar render"
      pattern: "ActionsDropdown"
---

<objective>
Restructure the entire left sidebar of the Case Detail Page: create RecordHeader (case identity), ActionsDropdown (8 actions), and refactor the flat properties panel into 3 collapsible cards (About This Case, Intake Information, Classification placeholder).

Purpose: The left sidebar is where investigators orient themselves — "what case is this?" (header), "what can I do?" (actions + quick actions), and "what are the details?" (property cards). This restructure matches spec Sections 14.1-14.6.
Output: RecordHeader.tsx, ActionsDropdown.tsx, CollapsiblePropertyCard.tsx, refactored properties panel, updated page.tsx left sidebar.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25.1-case-detail-page-vision-revision/25.1-RESEARCH.md
@.planning/phases/25.1-case-detail-page-vision-revision/25.1-01-SUMMARY.md

# Key source files

@apps/frontend/src/components/cases/case-info-summary.tsx
@apps/frontend/src/components/cases/case-detail-header.tsx
@apps/frontend/src/components/cases/case-properties-panel.tsx
@apps/frontend/src/components/cases/property-section.tsx
@apps/frontend/src/components/cases/editable-field.tsx
@apps/frontend/src/components/cases/action-button-row.tsx
@.planning/hubspot-view-system-spec.md (Sections 14.1-14.6)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RecordHeader and ActionsDropdown</name>
  <files>
    apps/frontend/src/components/record-detail/RecordHeader.tsx
    apps/frontend/src/components/record-detail/ActionsDropdown.tsx
  </files>
  <action>
1. Create `RecordHeader.tsx` — the top of the left sidebar per spec Section 14.1:

Props:

```typescript
interface RecordHeaderProps {
  referenceNumber: string;
  status: string;
  severity: string;
  category?: string;
  openDate: string;
  caseAge: string; // e.g., "Open for 29 days" or "Closed after 14 days"
  assignedTo: Array<{ id: string; name: string; avatarUrl?: string }>;
  onCopyReference?: () => void;
}
```

Layout (top to bottom):

- Reference number: large bold text + copy icon (Copy from lucide-react). Use toast("Copied!") on click.
- Status badge: colored pill using existing badge patterns. Map status to color.
- Severity badge: colored pill (LOW=green, MEDIUM=yellow, HIGH=orange, CRITICAL=red).
- Category: text if present.
- Open date: "Opened: {formatted date}".
- Case age: dynamic text from props.
- Assigned to: avatar stack. If multiple, show first 3 + "+N" overflow. Use Avatar from shadcn.

Refactor from `case-info-summary.tsx` — reuse its data display logic but restructure layout to match spec. CaseInfoSummary can be replaced by RecordHeader in page.tsx.

2. Create `ActionsDropdown.tsx` per spec Section 14.2:

Props:

```typescript
interface ActionsDropdownProps {
  onAssign: () => void;
  onChangeStatus: () => void;
  onMerge: () => void;
  onFollow: () => void;
  onViewProperties: () => void;
  onViewHistory: () => void;
  onExport: () => void;
  onDelete: () => void;
  isFollowing?: boolean;
  isAdmin?: boolean; // Controls Delete visibility
}
```

Use shadcn DropdownMenu:

- Trigger: Button variant="outline" with "Actions" text + ChevronDown icon
- Items: Assign, Change Status, Merge, Follow/Unfollow (toggle text), separator, View All Properties, View Property History, separator, Export Case, Delete (admin-only, destructive variant)

For now, Follow/Unfollow, View Properties, View History, and Export can show toast("Coming soon") since they aren't wired yet. Assign, Change Status, and Merge must call existing modal handlers.
</action>
<verify> - RecordHeader renders reference number with copy icon - Status and severity badges display with correct colors - ActionsDropdown opens with 8 menu items - Assign/Status/Merge items trigger their handlers - Delete item only visible when isAdmin=true - TypeScript compiles
</verify>
<done>RecordHeader displays case identity, ActionsDropdown has 8 actions with correct handlers</done>
</task>

<task type="auto">
  <name>Task 2: Create CollapsiblePropertyCard and restructure left sidebar</name>
  <files>
    apps/frontend/src/components/record-detail/CollapsiblePropertyCard.tsx
    apps/frontend/src/components/cases/case-properties-panel.tsx
    apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx
  </files>
  <action>
1. Create `CollapsiblePropertyCard.tsx` — a reusable collapsible card with inline-editable fields:

```typescript
interface PropertyField {
  key: string;
  label: string;
  value: any;
  type: "text" | "select" | "date" | "tags" | "user" | "readonly";
  options?: Array<{ value: string; label: string }>;
  editable?: boolean;
  onChange?: (value: any) => void;
}

interface CollapsiblePropertyCardProps {
  title: string;
  fields: PropertyField[];
  defaultCollapsed?: boolean;
  showSettingsGear?: boolean;
  onSettingsClick?: () => void;
}
```

The card uses shadcn Collapsible (same pattern as existing PropertySection). Layout:

- Header row: title text + collapse chevron (ChevronDown/ChevronRight) + optional gear icon (admin only)
- When expanded: list of fields using EditableField (existing component) for editable fields, or read-only display for readonly fields
- Long text fields (type = 'text' with long values): truncated to 3 lines with "Show more" link

Reuse the existing `editable-field.tsx` component for inline editing.

2. Refactor `case-properties-panel.tsx`:

The current panel has 6 flat sections (Status, Intake, Reporter, Location, Metadata, Attachments). Restructure into 3 cards:

**About This Case** (collapsedByDefault: false):

- Status, Severity, Priority, Case Type, Source Channel (readonly), Open Date (readonly), Target Close Date, SLA Due Date (readonly), Case Owner, Department

**Intake Information** (collapsedByDefault: true):

- Reporter Type (readonly), Reporter Name, Reporter Email, Reporter Phone, Anonymous Access Code (readonly), Incident Date, Incident Location, Location City, Location State, Location Country, Incident Description, Persons Involved, Witnesses, Supporting Details, Addendum

**Classification** (collapsedByDefault: false):

- This card is a placeholder for Plan 04 (CategorySelector). For now, show: Tags field using existing EditableField tags type.

Map existing case data fields to these card structures. Where case data doesn't have a field yet (e.g., priority, caseType), display "—" as placeholder.

3. Update page.tsx left sidebar section:

Replace the current left sidebar content with:

```
<RecordHeader ... />
<ActionsDropdown ... />
<ActionButtonRow ... /> (existing QuickActionGrid)
<CollapsiblePropertyCard title="About This Case" fields={aboutFields} />
<CollapsiblePropertyCard title="Intake Information" fields={intakeFields} defaultCollapsed />
<CollapsiblePropertyCard title="Classification" fields={classificationFields} />
```

Remove CaseInfoSummary usage (replaced by RecordHeader). Simplify CaseDetailHeader to breadcrumb-only (remove action buttons from header — they're now in ActionsDropdown).
</action>
<verify> - Left sidebar renders: RecordHeader, ActionsDropdown, QuickActions, 3 collapsible cards - About This Case card shows ~10 fields, expanded by default - Intake Information card is collapsed by default, expands on click - Classification card shows tags field - Inline editing works on editable fields (clicking field reveals edit input) - All existing modals (Assign, Status, Merge) still function via ActionsDropdown - `npm run typecheck` passes
</verify>
<done>Left sidebar restructured with RecordHeader, ActionsDropdown, 3 collapsible property cards</done>
</task>

</tasks>

<verification>
1. Left sidebar shows RecordHeader at top (ref#, badges, category, date, case age, assigned)
2. ActionsDropdown opens with 8 items, Assign/Status/Merge trigger modals
3. Quick action buttons render below Actions dropdown
4. 3 collapsible cards with correct fields
5. About This Case expanded by default, Intake Information collapsed
6. Inline editing works on editable fields
7. CaseDetailHeader simplified to breadcrumb only
8. `npm run typecheck` passes
</verification>

<success_criteria>

- Left sidebar matches spec Section 14 layout hierarchy
- All existing modal functionality preserved
- CollapsiblePropertyCard is reusable for any record type
- No regression in page functionality
  </success_criteria>

<output>
After completion, create `.planning/phases/25.1-case-detail-page-vision-revision/25.1-03-SUMMARY.md`
</output>
