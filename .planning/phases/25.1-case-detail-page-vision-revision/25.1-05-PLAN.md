---
phase: 25.1-case-detail-page-vision-revision
plan: 05
type: execute
wave: 2
depends_on: [01, 02]
files_modified:
  - apps/frontend/src/components/record-detail/DataHighlightsCard.tsx
  - apps/frontend/src/components/record-detail/EditableSummary.tsx
  - apps/frontend/src/components/record-detail/StatusHistoryTimeline.tsx
  - apps/frontend/src/components/cases/case-tabs.tsx
autonomous: true

must_haves:
  truths:
    - "Overview tab is the default tab when opening a case"
    - "Data Highlights card shows 6 key values in a grid at top of Overview"
    - "Editable Case Summary has inline edit mode and AI generate button"
    - "Case Details section is collapsible, collapsed by default"
    - "Status History shows vertical timeline with dots, dates, users, rationale"
    - "Recent Activities shows 3 most recent with View All link"
    - "Upcoming Tasks shows 3 nearest tasks with checkboxes"
  artifacts:
    - path: "apps/frontend/src/components/record-detail/DataHighlightsCard.tsx"
      provides: "4-6 key value grid"
      contains: "DataHighlightsCard"
    - path: "apps/frontend/src/components/record-detail/EditableSummary.tsx"
      provides: "Rich text summary with AI button"
      contains: "EditableSummary"
    - path: "apps/frontend/src/components/record-detail/StatusHistoryTimeline.tsx"
      provides: "Vertical status change timeline"
      contains: "StatusHistoryTimeline"
  key_links:
    - from: "apps/frontend/src/components/cases/case-tabs.tsx"
      to: "DataHighlightsCard"
      via: "Overview tab render"
      pattern: "DataHighlightsCard"
---

<objective>
Rebuild the Overview tab as the default landing tab with 6 sections: Data Highlights, Editable Summary with AI, Collapsible Case Details, Status History Timeline, Recent Activities, Upcoming Tasks. Wire PipelineStageBar above the tab bar.

Purpose: The Overview tab is now the default (was Activities). It answers "What do I need to know about this case?" at a glance. The Data Highlights card gives instant orientation. The editable summary provides context. Status History, Recent Activities, and Upcoming Tasks show trajectory.
Output: DataHighlightsCard, EditableSummary, StatusHistoryTimeline components, rebuilt Overview tab.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25.1-case-detail-page-vision-revision/25.1-RESEARCH.md
@.planning/phases/25.1-case-detail-page-vision-revision/25.1-01-SUMMARY.md
@.planning/phases/25.1-case-detail-page-vision-revision/25.1-02-SUMMARY.md

# Key source files

@apps/frontend/src/components/cases/case-tabs.tsx
@apps/frontend/src/components/cases/summary-tab.tsx
@apps/frontend/src/components/cases/case-activity-timeline.tsx
@.planning/hubspot-view-system-spec.md (Section 15.2, 16.1)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DataHighlightsCard, EditableSummary, StatusHistoryTimeline</name>
  <files>
    apps/frontend/src/components/record-detail/DataHighlightsCard.tsx
    apps/frontend/src/components/record-detail/EditableSummary.tsx
    apps/frontend/src/components/record-detail/StatusHistoryTimeline.tsx
  </files>
  <action>
1. **DataHighlightsCard** — per spec Section 16.1.A:

```typescript
interface DataHighlight {
  label: string;
  value: string | number;
  type?: "badge" | "text" | "sla" | "user";
  color?: string; // For badge types
  icon?: React.ReactNode;
}

interface DataHighlightsCardProps {
  highlights: DataHighlight[];
}
```

Renders a Card with a grid of 4-6 key values. Layout: 3 columns, 2 rows. Each cell has:

- Label: small muted text above
- Value: large bold text below, with optional Badge/color treatment
- SLA type: color-coded urgency (green=on track, yellow=approaching, red=overdue)
- User type: Avatar + name

Default highlights for cases (from CASES_DETAIL_CONFIG.dataHighlights):

- Severity (badge), Status (badge), Case Age (text), SLA Status (sla), Assigned To (user), Source Channel (text)

2. **EditableSummary** — per spec Section 16.1.B:

```typescript
interface EditableSummaryProps {
  summary: string;
  onSave: (newSummary: string) => void;
  onAiGenerate?: () => Promise<string>;
  isGenerating?: boolean;
}
```

Renders a Card with:

- Title: "Case Summary" with edit icon (Pencil) and AI button (Sparkles icon + "AI")
- Display mode: renders summary text (supports basic HTML/markdown)
- Edit mode (click edit icon): Textarea for editing, Save + Cancel buttons
- AI button: calls onAiGenerate, shows loading spinner, fills textarea with result, user can accept/edit/discard
- If summary is empty: show placeholder "No summary yet. Click edit to add one, or use AI to generate."

3. **StatusHistoryTimeline** — per spec Section 16.1.D:

```typescript
interface StatusChange {
  status: string;
  date: string;
  changedBy: string;
  rationale?: string;
}

interface StatusHistoryTimelineProps {
  changes: StatusChange[];
}
```

Renders a vertical timeline inside a Card titled "Status History":

- Each entry: colored dot + status name + date + "by {user}" + rationale quote
- Dots colored by status (map to pipeline stage colors)
- Most recent at top, oldest at bottom
- Connecting vertical line between dots
- If no history, show "No status changes recorded"

Use data from existing activity feed filtered for status_changed actions, or from a dedicated status history endpoint if available. For now, accept changes as props.
</action>
<verify> - DataHighlightsCard renders 6 highlights in a 3x2 grid - EditableSummary toggles between display and edit mode - AI button triggers generation and shows loading state - StatusHistoryTimeline renders vertical timeline with dots and lines - All components accept props (not hardcoded data) - TypeScript compiles
</verify>
<done>Three new Overview tab components created: DataHighlightsCard, EditableSummary, StatusHistoryTimeline</done>
</task>

<task type="auto">
  <name>Task 2: Rebuild Overview tab and wire PipelineStageBar</name>
  <files>apps/frontend/src/components/cases/case-tabs.tsx</files>
  <action>
1. **Change default tab from Activities to Overview:**
   - In case-tabs.tsx, change defaultTab from "activity" to "overview"
   - Remove URL state syncing for tabs (spec says no URL state). Remove any searchParams usage for tab state.
   - Change tab order to: Overview, Activities, Investigations, Messages, Files, Remediation (6 tabs total)
   - Remove the Summary tab entirely (content merged into Overview)
   - Remove icons from tab triggers (just text labels per spec)

2. **Rebuild the OverviewTab inline component** within case-tabs.tsx (or extract to a new file if the component is large):

Layout (top to bottom):
a. **DataHighlightsCard** — pass computed highlights from case data: - severity, status, caseAge (computed from createdAt), slaStatus (from slaDeadline), assignedTo, sourceChannel
b. **EditableSummary** — pass case.summary, onSave calls PATCH /cases/:id with summary, onAiGenerate calls AI summarize skill
c. **Case Details (Collapsible)** — use Collapsible from shadcn. Collapsed by default. When expanded, show comprehensive property list in two-column label:value layout. "View All Properties" link at bottom.
d. **StatusHistoryTimeline** — filter activities for status_changed type, map to StatusChange[], pass to component
e. **Recent Activities** — show 3 most recent activities from the case's activity feed (same data source as the Activities tab, filtered to most recent 3). "View all" link switches to Activities tab.
f. **Upcoming Tasks** — show 3 nearest-due open tasks with checkboxes. Task data comes from the `GET /api/cases/:id` response which includes associated tasks (same data used by Plan 08's TasksCard in the right sidebar). Reuse the same `CaseTask` interface and `onToggleComplete` handler pattern from Plan 08's TasksCard. If case data does not include tasks directly, filter activities for task-type entries. "View all" link.

3. **Remove pipeline visualization from Overview** — the pipeline is now the sticky PipelineStageBar in the center column header (above tabs), NOT inside the Overview tab content.

4. **Wire PipelineStageBar above the tab bar** in the center column:
   In page.tsx (or case-tabs.tsx wrapper), render:

   ```
   <div className="sticky top-0 z-10 bg-white border-b">
     <PipelineStageBar
       stages={pipelineStages}
       currentStageId={caseData.pipelineStage || 'new'}
       stageEnteredAt={caseData.stageEnteredAt}
       onStageTransition={handleStageTransition}
       canTransitionTo={canTransitionTo}
       isTransitioning={isTransitioning}
       daysInCurrentStage={daysInCurrentStage}
     />
   </div>
   <TabBar ... />
   <TabContent ... />
   ```

   Use the usePipeline hook from Plan 02 to get stage management functions.

5. **Merge summary-tab.tsx content** into Overview if not already done. The AI summary and case details from SummaryTab should now live in the Overview tab's EditableSummary and Case Details sections.

6. **Empty states for Overview sections:**
   - Status History: "No status changes recorded" with muted text
   - Recent Activities: "No activities yet. Use the quick actions above to log your first activity." with muted text
   - Upcoming Tasks: "No upcoming tasks. Create a task from the quick actions or right sidebar." with muted text
   - Editable Summary: "No summary yet. Click edit to add one, or use AI to generate." (already specified in EditableSummary component above)
     </action>
     <verify>
   - Overview tab is default (no URL param needed)
   - Tab order: Overview, Activities, Investigations, Messages, Files, Remediation (6 tabs)
   - Summary tab removed
   - No icons on tab triggers
   - No URL state for tabs
   - PipelineStageBar renders above tab bar (sticky)
   - Overview tab shows: Data Highlights, Summary, Case Details (collapsed), Status History, Recent Activities, Upcoming Tasks
   - Pipeline stage bar not duplicated inside Overview tab content
   - `npm run typecheck` passes
     </verify>
     <done>Overview tab rebuilt as default with 6 sections, PipelineStageBar wired above tabs, Summary tab removed, 6-tab configuration applied</done>
     </task>

</tasks>

<verification>
1. Overview is default tab on fresh page load
2. 6 tabs with text-only labels
3. PipelineStageBar sticky above tabs in center column
4. Data Highlights shows 6 values in grid
5. Editable Summary supports edit mode and AI generation
6. Case Details collapsed by default, expandable
7. Status History shows timeline of changes
8. Recent Activities shows 3 items with "View all" link
9. Upcoming Tasks shows 3 items with checkboxes
10. `npm run typecheck` passes
</verification>

<success_criteria>

- Overview tab is the primary landing experience
- All 6 sections render with real case data
- PipelineStageBar is sticky and interactive
- Summary tab content fully merged into Overview
- No URL state for tab selection
  </success_criteria>

<output>
After completion, create `.planning/phases/25.1-case-detail-page-vision-revision/25.1-05-SUMMARY.md`
</output>
