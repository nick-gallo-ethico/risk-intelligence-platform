---
phase: 25.1-case-detail-page-vision-revision
plan: 04
type: execute
wave: 3
depends_on: [03]
files_modified:
  - apps/frontend/src/components/record-detail/CategorySelector.tsx
  - apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Classification card has Primary Category dropdown populated from tenant categories"
    - "Selecting a primary category resets and populates the Subcategory dropdown with children"
    - "Tags field supports multi-select with chip/pill display"
    - "Risk Level dropdown shows Low, Medium, High, Critical"
    - "Regulatory Framework shows multi-select for applicable regulations"
  artifacts:
    - path: "apps/frontend/src/components/record-detail/CategorySelector.tsx"
      provides: "Dependent category/subcategory dropdowns"
      contains: "CategorySelector"
  key_links:
    - from: "apps/frontend/src/components/record-detail/CategorySelector.tsx"
      to: "useTenantCategories"
      via: "hook usage for fetching categories"
      pattern: "useTenantCategories"
---

<objective>
Build the Classification card content: CategorySelector with dependent category/subcategory dropdowns, Risk Level, Regulatory Framework, and Tags. Wire into the Classification CollapsiblePropertyCard.

Purpose: Classification is where compliance officers categorize cases. The dependent dropdown pattern (select category -> subcategories filter) is a core workflow. Categories are tenant-configurable via the admin settings.
Output: CategorySelector.tsx with dependent dropdowns, Classification card fully populated.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25.1-case-detail-page-vision-revision/25.1-RESEARCH.md
@.planning/phases/25.1-case-detail-page-vision-revision/25.1-03-SUMMARY.md

# Key source files

@apps/frontend/src/hooks/use-tenant-categories.ts
@apps/frontend/src/components/cases/editable-field.tsx
@.planning/hubspot-view-system-spec.md (Section 14.6 — Classification)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CategorySelector component</name>
  <files>apps/frontend/src/components/record-detail/CategorySelector.tsx</files>
  <action>
Create `apps/frontend/src/components/record-detail/CategorySelector.tsx`:

This component renders dependent dropdowns for Primary Category and Subcategory. It reuses the existing `useTenantCategories` hook which fetches categories from the public API and builds a tree structure.

```typescript
interface CategorySelectorProps {
  primaryCategoryId?: string;
  secondaryCategoryId?: string;
  onPrimaryCategoryChange: (categoryId: string | null) => void;
  onSecondaryCategoryChange: (categoryId: string | null) => void;
  disabled?: boolean;
}
```

Implementation:

1. Call `useTenantCategories()` to get the category tree.
2. Filter top-level categories (parentId === null or level === 0) for the Primary Category dropdown.
3. When Primary Category is selected, filter child categories (parentId === selectedPrimaryCategoryId) for the Subcategory dropdown.
4. When Primary Category changes, reset Subcategory to null and call both onChange handlers.
5. Use shadcn Select for both dropdowns.
6. If categories are loading, show a Skeleton placeholder.
7. If no categories exist, show "No categories configured" text.

Layout:

```
Primary Category
[HIPAA Violation          ▼]

Subcategory
[PHI Breach               ▼]
```

Labels above each dropdown. Subcategory dropdown disabled (dimmed) until a Primary Category is selected.
</action>
<verify> - CategorySelector renders two dropdowns - Primary dropdown populated with top-level categories - Selecting a primary category enables and populates subcategory dropdown - Changing primary category resets subcategory - TypeScript compiles
</verify>
<done>CategorySelector renders dependent category/subcategory dropdowns from tenant-configured categories</done>
</task>

<task type="auto">
  <name>Task 2: Wire Classification card with all fields</name>
  <files>apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx</files>
  <action>
Update the Classification CollapsiblePropertyCard (created in Plan 03) to include all 5 fields from spec Section 14.6:

1. **Primary Category + Subcategory**: Render CategorySelector component inside the card, passing current case primaryCategoryId and secondaryCategoryId.

2. **Tags**: Use existing EditableField with type="tags". The case data should already have a tags field.

3. **Risk Level**: Add a Select dropdown with options: Low, Medium, High, Critical. Map to case.riskLevel or similar field. If the field doesn't exist on the case type, show as editable dropdown that saves via PATCH /cases/:id.

4. **Regulatory Framework**: Add a multi-select field (or tags-style input) for regulatory frameworks. Predefined options: HIPAA, SOX, GDPR, OSHA, State Privacy Law, Other. If the backend doesn't have this field yet, render as UI-only with a TODO comment.

Wire onChange handlers for each field to PATCH /cases/:id with the updated values. Use optimistic updates where possible (update UI immediately, revert on error).

The Classification card should look like:

```
Classification (▼)
  Primary Category: [HIPAA Violation    ▼]
  Subcategory:      [PHI Breach         ▼]
  Tags:             [evidence] [billing] [+ Add]
  Risk Level:       [High               ▼]
  Regulatory:       [HIPAA] [State Privacy Law] [+ Add]
```

  </action>
  <verify>
    - Classification card renders CategorySelector with both dropdowns
    - Tags field displays existing tags and allows adding/removing
    - Risk Level dropdown shows 4 options
    - Regulatory Framework shows multi-select
    - Changing category calls PATCH /cases/:id
    - `npm run typecheck` passes
  </verify>
  <done>Classification card fully wired with 5 fields: category, subcategory, tags, risk level, regulatory framework</done>
</task>

</tasks>

<verification>
1. Classification card renders all 5 fields
2. Category/Subcategory dependent dropdowns work correctly
3. Changing primary category resets subcategory
4. Tags, Risk Level, and Regulatory Framework fields are interactive
5. Field changes persist to backend
6. `npm run typecheck` passes
</verification>

<success_criteria>

- Dependent category/subcategory dropdown pattern works correctly
- CategorySelector is reusable (not case-specific)
- All 5 Classification fields render and are interactive
- Changes save to backend via PATCH
  </success_criteria>

<output>
After completion, create `.planning/phases/25.1-case-detail-page-vision-revision/25.1-04-SUMMARY.md`
</output>
