---
phase: 25.1-case-detail-page-vision-revision
plan: 04
subsystem: frontend-ui
tags:
  [
    category-selector,
    dependent-dropdowns,
    classification,
    risk-level,
    regulatory-framework,
    collapsible-card,
  ]

dependency-graph:
  requires:
    - phase: 25.1-03
      provides: CollapsiblePropertyCard, CasePropertiesPanel with Classification card placeholder
  provides:
    [
      CategorySelector,
      Classification-card-5-fields,
      RiskLevel-type,
      RegulatoryFramework-type,
      CollapsiblePropertyCard-children-prop,
    ]
  affects: [25.1-05, 25.1-06, 25.1-07]

tech-stack:
  added: []
  patterns:
    [
      dependent-dropdown-pattern,
      custom-children-in-property-cards,
      color-coded-risk-badges,
    ]

key-files:
  created:
    - apps/frontend/src/components/record-detail/CategorySelector.tsx
  modified:
    - apps/frontend/src/types/case.ts
    - apps/frontend/src/components/record-detail/CollapsiblePropertyCard.tsx
    - apps/frontend/src/components/cases/case-properties-panel.tsx

key-decisions:
  - id: use-authenticated-categories-hook
    context: Plan referenced useTenantCategories (public API, requires tenantSlug) vs useAuthenticatedCategories (authenticated API, no slug needed)
    decision: Used useAuthenticatedCategories since case detail is an authenticated page
    rationale: Simpler API, no need to pass tenantSlug; user is already authenticated
  - id: children-before-fields
    context: CategorySelector is a custom component that does not fit the PropertyField pattern
    decision: Added children prop to CollapsiblePropertyCard, rendered before standard fields
    rationale: Category dropdowns must appear first in the Classification card per spec layout

patterns-established:
  - "Dependent dropdown pattern: CategorySelector uses two linked Select components where changing the first resets the second"
  - "CollapsiblePropertyCard children prop: Custom content can be injected before standard PropertyField rows"
  - "Color-coded Risk Level badges via RISK_LEVEL_COLORS map"

metrics:
  duration: 9min
  completed: 2026-02-13
---

# Phase 25.1 Plan 04: Classification Card Summary

**CategorySelector with dependent category/subcategory dropdowns plus Risk Level, Regulatory Framework, and Tags wired into Classification CollapsiblePropertyCard**

## Performance

- **Duration:** 9 min
- **Started:** 2026-02-14T00:07:25Z
- **Completed:** 2026-02-14T00:16:01Z
- **Tasks:** 2/2
- **Files modified:** 4

## Accomplishments

- Created CategorySelector component with dependent primary/subcategory dropdowns from tenant categories
- Wired Classification card with all 5 fields per spec Section 14.6
- Added RiskLevel and RegulatoryFramework types to Case type system
- Extended CollapsiblePropertyCard with children prop for custom content injection

## Task Commits

Each task was committed atomically:

1. **Task 1: Create CategorySelector component** - `78e3ecd` (feat)
2. **Task 2: Wire Classification card with all fields** - `5d5bf20` (feat)

## Files Created/Modified

- `apps/frontend/src/components/record-detail/CategorySelector.tsx` - Dependent category/subcategory dropdown pair using useAuthenticatedCategories hook
- `apps/frontend/src/types/case.ts` - Added RiskLevel, RegulatoryFramework types; added secondaryCategoryId, riskLevel, regulatoryFrameworks to Case interface
- `apps/frontend/src/components/record-detail/CollapsiblePropertyCard.tsx` - Added children prop, renders custom content before standard fields
- `apps/frontend/src/components/cases/case-properties-panel.tsx` - Classification card now has CategorySelector + Tags + Risk Level + Regulatory Framework fields

## Decisions Made

1. **Used `useAuthenticatedCategories` instead of `useTenantCategories`** - The case detail page is authenticated, so the authenticated API hook (which does not require a tenantSlug parameter) is simpler and more appropriate.

2. **Children rendered before fields in CollapsiblePropertyCard** - The CategorySelector needs to appear first in the Classification card, followed by Tags, Risk Level, and Regulatory Framework. Added a `children` prop that renders before the `fields` array.

3. **Added types optimistically** - `RiskLevel` (LOW/MEDIUM/HIGH/CRITICAL) and `RegulatoryFramework` (HIPAA/SOX/GDPR/OSHA/STATE_PRIVACY_LAW/OTHER) added to the frontend Case type. Backend may not have these fields yet; they will save via PATCH and the backend will either persist or ignore unknown fields.

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] React hooks called conditionally**

- **Found during:** Task 2 commit (pre-commit hook caught it)
- **Issue:** `handlePrimaryCategoryChange` and `handleSecondaryCategoryChange` useCallback hooks were defined after early return statements (`if (isLoading)`, `if (!caseData)`), violating React's rules of hooks
- **Fix:** Moved both useCallback definitions before the early return statements
- **Verification:** ESLint react-hooks/rules-of-hooks passes, TypeScript compiles clean
- **Committed in:** 5d5bf20 (part of Task 2 commit)

---

**Total deviations:** 1 auto-fixed (1 bug)
**Impact on plan:** Standard React hooks ordering fix. No scope creep.

## Issues Encountered

None beyond the hooks ordering fix caught by ESLint.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

Ready for subsequent plans. The Classification card is fully populated with:

- Primary Category + Subcategory (dependent dropdowns)
- Tags (multi-select with chip display)
- Risk Level (dropdown with color-coded badge)
- Regulatory Framework (multi-select tags)

Dependencies delivered:

- CategorySelector is reusable for any record type (investigations, disclosures)
- CollapsiblePropertyCard now supports custom children content alongside PropertyField rows
- RiskLevel and RegulatoryFramework types available for backend integration

---

_Phase: 25.1-case-detail-page-vision-revision_
_Completed: 2026-02-13_
