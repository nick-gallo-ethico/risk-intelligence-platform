---
phase: 25.1-case-detail-page-vision-revision
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/src/components/record-detail/RecordDetailLayout.tsx
  - apps/frontend/src/config/casesDetailConfig.ts
  - apps/frontend/src/types/record-detail.ts
  - apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx
  - apps/frontend/src/components/cases/case-detail-layout.tsx
autonomous: true

must_haves:
  truths:
    - "Case detail page renders using config-driven RecordDetailLayout"
    - "CASES_DETAIL_CONFIG object defines all tabs, sidebar cards, actions, and activity types"
    - "RecordDetailLayout accepts a config and renders three-column grid"
    - "Dead case-detail-layout.tsx is removed from codebase"
  artifacts:
    - path: "apps/frontend/src/components/record-detail/RecordDetailLayout.tsx"
      provides: "Config-driven three-column layout wrapper"
      contains: "RecordDetailLayout"
    - path: "apps/frontend/src/config/casesDetailConfig.ts"
      provides: "CASES_DETAIL_CONFIG object"
      contains: "CASES_DETAIL_CONFIG"
    - path: "apps/frontend/src/types/record-detail.ts"
      provides: "RecordDetailConfig, PipelineStage, PipelineConfig types"
      contains: "RecordDetailConfig"
  key_links:
    - from: "apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx"
      to: "RecordDetailLayout"
      via: "import and render"
      pattern: "RecordDetailLayout.*config.*CASES_DETAIL_CONFIG"
    - from: "apps/frontend/src/config/casesDetailConfig.ts"
      to: "apps/frontend/src/types/record-detail.ts"
      via: "type import"
      pattern: "RecordDetailConfig"
---

<objective>
Create the config-driven foundation for the Case Detail Page rebuild: RecordDetailLayout component, CASES_DETAIL_CONFIG object, TypeScript types, and restructured page.tsx. Delete dead code.

Purpose: The config-driven architecture is the backbone of Phase 25.1. Every subsequent plan renders within RecordDetailLayout and reads from CASES_DETAIL_CONFIG. Building this first enables parallel development of left sidebar, center column, and right sidebar.
Output: RecordDetailLayout.tsx, casesDetailConfig.ts, record-detail.ts types, refactored page.tsx, deleted case-detail-layout.tsx.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25.1-case-detail-page-vision-revision/25.1-RESEARCH.md

# Key source files

@apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx
@apps/frontend/src/components/cases/case-detail-layout.tsx
@apps/frontend/src/types/case.ts
@.planning/hubspot-view-system-spec.md (Sections 12, 21)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create record-detail types and CASES_DETAIL_CONFIG</name>
  <files>
    apps/frontend/src/types/record-detail.ts
    apps/frontend/src/config/casesDetailConfig.ts
  </files>
  <action>
1. Create `apps/frontend/src/types/record-detail.ts` with these types:

```typescript
import { ComponentType } from "react";

export interface PipelineStage {
  id: string;
  name: string;
  order: number;
  color: string;
  isClosed: boolean;
  allowedTransitions: string[];
  description?: string;
}

export interface PipelineConfig {
  id: string;
  tenantId?: string;
  moduleType: "cases" | "investigations" | "disclosures";
  name: string;
  stages: PipelineStage[];
  isDefault: boolean;
}

export interface TabConfig {
  id: string;
  label: string;
  component: ComponentType<any>;
  isDefault?: boolean;
}

export interface SidebarCardConfig {
  id: string;
  type?: string;
  label?: string;
  collapsedByDefault?: boolean;
  component?: ComponentType<any>;
  props?: Record<string, any>;
}

export interface RecordDetailConfig {
  moduleType: string;
  primaryDisplayProperty: string;
  statusProperty: string;
  severityProperty: string;
  pipeline: {
    enabled: boolean;
    configEndpoint?: string;
    defaultStages: PipelineStage[];
  };
  tabs: TabConfig[];
  leftSidebar: {
    cards: SidebarCardConfig[];
  };
  rightSidebar: {
    cards: SidebarCardConfig[];
  };
  quickActions: string[];
  actionsMenu: string[];
  activityTypes: string[];
  dataHighlights: string[];
}
```

2. Create `apps/frontend/src/config/casesDetailConfig.ts`:

```typescript
import type { RecordDetailConfig, PipelineStage } from "@/types/record-detail";

export const DEFAULT_CASE_PIPELINE: PipelineStage[] = [
  {
    id: "new",
    name: "New",
    order: 0,
    color: "#6B7280",
    isClosed: false,
    allowedTransitions: ["assigned"],
  },
  {
    id: "assigned",
    name: "Assigned",
    order: 1,
    color: "#3B82F6",
    isClosed: false,
    allowedTransitions: ["active", "new"],
  },
  {
    id: "active",
    name: "Active",
    order: 2,
    color: "#8B5CF6",
    isClosed: false,
    allowedTransitions: ["review", "assigned"],
  },
  {
    id: "review",
    name: "Review",
    order: 3,
    color: "#F59E0B",
    isClosed: false,
    allowedTransitions: ["active", "closed"],
  },
  {
    id: "closed",
    name: "Closed",
    order: 4,
    color: "#10B981",
    isClosed: true,
    allowedTransitions: ["remediation", "active"],
  },
  {
    id: "remediation",
    name: "Remediation",
    order: 5,
    color: "#EF4444",
    isClosed: false,
    allowedTransitions: ["archived", "closed"],
  },
  {
    id: "archived",
    name: "Archived",
    order: 6,
    color: "#9CA3AF",
    isClosed: true,
    allowedTransitions: [],
  },
];

// Tab and sidebar component imports will be lazy — for now use placeholder references.
// Actual component wiring happens in Plans 03-08 when each component is built/refactored.

export const CASES_DETAIL_CONFIG: RecordDetailConfig = {
  moduleType: "cases",
  primaryDisplayProperty: "referenceNumber",
  statusProperty: "status",
  severityProperty: "severity",
  pipeline: {
    enabled: true,
    configEndpoint: "/api/pipelines",
    defaultStages: DEFAULT_CASE_PIPELINE,
  },
  tabs: [
    {
      id: "overview",
      label: "Overview",
      component: () => null,
      isDefault: true,
    },
    { id: "activities", label: "Activities", component: () => null },
    { id: "investigations", label: "Investigations", component: () => null },
    { id: "messages", label: "Messages", component: () => null },
    { id: "files", label: "Files", component: () => null },
    { id: "remediation", label: "Remediation", component: () => null },
  ],
  leftSidebar: {
    cards: [
      {
        id: "about",
        type: "about",
        label: "About This Case",
        collapsedByDefault: false,
      },
      {
        id: "intake",
        type: "intake",
        label: "Intake Information",
        collapsedByDefault: true,
      },
      {
        id: "classification",
        type: "classification",
        label: "Classification",
        collapsedByDefault: false,
      },
    ],
  },
  rightSidebar: {
    cards: [
      { id: "workflow" },
      { id: "people" },
      { id: "rius" },
      { id: "related-cases" },
      { id: "policies" },
      { id: "documents" },
      { id: "tasks" },
      { id: "remediation-status" },
      { id: "ai" },
    ],
  },
  quickActions: ["note", "email", "task", "document", "interview"],
  actionsMenu: [
    "assign",
    "change_status",
    "merge",
    "follow",
    "view_properties",
    "view_history",
    "export",
    "delete",
  ],
  activityTypes: [
    "note",
    "email",
    "call",
    "task",
    "interview",
    "document_upload",
    "status_change",
    "assignment_change",
    "system_event",
  ],
  dataHighlights: [
    "severity",
    "status",
    "caseAge",
    "slaStatus",
    "assignedTo",
    "sourceChannel",
  ],
};
```

Note: Tab component references are placeholder `() => null` for now. Plans 05-07 will wire actual tab components as they are built/refactored. This avoids circular dependencies.
</action>
<verify> - `apps/frontend/src/types/record-detail.ts` exists with RecordDetailConfig, PipelineStage, PipelineConfig exports - `apps/frontend/src/config/casesDetailConfig.ts` exports CASES_DETAIL_CONFIG and DEFAULT_CASE_PIPELINE - TypeScript compilation passes for these files
</verify>
<done>RecordDetailConfig types defined, CASES_DETAIL_CONFIG created with 7 default pipeline stages, 6 tabs, 3 left sidebar cards, 9 right sidebar cards</done>
</task>

<task type="auto">
  <name>Task 2: Create RecordDetailLayout and restructure page.tsx</name>
  <files>
    apps/frontend/src/components/record-detail/RecordDetailLayout.tsx
    apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx
    apps/frontend/src/components/cases/case-detail-layout.tsx
  </files>
  <action>
1. Create `apps/frontend/src/components/record-detail/RecordDetailLayout.tsx`:

```typescript
'use client';

import React, { useState, ReactNode } from 'react';
import type { RecordDetailConfig } from '@/types/record-detail';

interface RecordDetailLayoutProps {
  config: RecordDetailConfig;
  leftSidebar: ReactNode;
  centerColumn: ReactNode;
  rightSidebar: ReactNode;
  breadcrumb?: ReactNode;
}

/**
 * Config-driven three-column layout for record detail pages.
 * Renders left sidebar (300px), center column (flexible), right sidebar (300px).
 * Each column scrolls independently.
 */
export function RecordDetailLayout({
  config,
  leftSidebar,
  centerColumn,
  rightSidebar,
  breadcrumb,
}: RecordDetailLayoutProps) {
  return (
    <div className="flex flex-col h-full">
      {/* Breadcrumb bar above columns */}
      {breadcrumb && (
        <div className="flex-shrink-0 border-b bg-white px-4 py-2">
          {breadcrumb}
        </div>
      )}

      {/* Three-column layout */}
      <div className="flex-1 grid grid-cols-[300px_1fr_300px] min-h-0">
        {/* Left sidebar - independently scrollable */}
        <div className="border-r overflow-y-auto bg-white">
          {leftSidebar}
        </div>

        {/* Center column - independently scrollable */}
        <div className="overflow-y-auto bg-gray-50">
          {centerColumn}
        </div>

        {/* Right sidebar - independently scrollable */}
        <div className="border-l overflow-y-auto bg-white">
          {rightSidebar}
        </div>
      </div>
    </div>
  );
}
```

2. Restructure `apps/frontend/src/app/(authenticated)/cases/[id]/page.tsx`:

Read the existing page.tsx first. It currently manages the three-column grid directly with all modal state. Restructure it to:

a. Import `RecordDetailLayout` and `CASES_DETAIL_CONFIG`
b. Keep ALL existing modal state and handlers (do not break modals)
c. Wrap the content in `<RecordDetailLayout>` passing:

- `config={CASES_DETAIL_CONFIG}`
- `leftSidebar={/* existing left column content */}`
- `centerColumn={/* existing center column with CaseTabs */}`
- `rightSidebar={/* existing right column content */}`
- `breadcrumb={/* breadcrumb from CaseDetailHeader */}`
  d. Remove the inline CSS grid definition (the grid now comes from RecordDetailLayout)
  e. Keep the CaseDetailHeader for now (it will be refactored in Plan 03)

The key change is wrapping existing content in RecordDetailLayout without breaking functionality. This is a structural refactor — the visible output should look identical.

3. DELETE `apps/frontend/src/components/cases/case-detail-layout.tsx` (239 lines of dead code confirmed in research).

IMPORTANT: Do NOT change any modal logic, API calls, or state management in page.tsx. Only restructure the JSX to use RecordDetailLayout as the outer wrapper.
</action>
<verify> - `RecordDetailLayout.tsx` exists in `components/record-detail/` - `case-detail-layout.tsx` is deleted (dead code removed) - Case detail page still renders with three-column layout - All modals (Assign, Status, Merge, Note, Email, Interview, Document, Task, Call) still open and function - TypeScript compilation: `npm run typecheck`
</verify>
<done>RecordDetailLayout wraps page.tsx content, dead code removed, all existing functionality preserved</done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes
2. Case detail page renders three-column layout
3. All 10 modals still function (Assign, StatusChange, Merge, AddNote, EmailLog, LogInterview, AttachDocument, CreateTask, LogCall, AddPerson)
4. `CASES_DETAIL_CONFIG` exports correctly with 7 pipeline stages, 6 tabs, 3 left sidebar cards, 9 right sidebar cards
5. `case-detail-layout.tsx` no longer exists
6. Breadcrumb still visible above columns
</verification>

<success_criteria>

- Config-driven architecture established with types + config + layout component
- Page.tsx uses RecordDetailLayout as its outer structure
- Dead code removed
- Zero regression in existing functionality
  </success_criteria>

<output>
After completion, create `.planning/phases/25.1-case-detail-page-vision-revision/25.1-01-SUMMARY.md`
</output>
