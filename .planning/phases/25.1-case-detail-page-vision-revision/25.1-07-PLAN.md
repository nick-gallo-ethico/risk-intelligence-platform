---
phase: 25.1-case-detail-page-vision-revision
plan: 07
type: execute
wave: 2
depends_on: [01]
files_modified:
  - apps/frontend/src/components/cases/case-tabs.tsx
  - apps/frontend/src/components/cases/messages-tab.tsx
  - apps/frontend/src/components/cases/files-tab.tsx
  - apps/frontend/src/components/cases/case-investigations-panel.tsx
  - apps/frontend/src/config/casesDetailConfig.ts
autonomous: true

must_haves:
  truths:
    - "Tab bar shows 6 tabs: Overview, Activities, Investigations, Messages, Files, Remediation"
    - "Tab state is NOT persisted in URL (always opens to Overview on fresh load)"
    - "Messages tab shows reporter communication thread and email correspondence sections"
    - "Files tab has upload, search, sort, file cards with download/preview/delete"
    - "Investigations tab has Create Investigation and Link Existing buttons"
  artifacts:
    - path: "apps/frontend/src/components/cases/case-tabs.tsx"
      provides: "6-tab configuration with Overview default, no URL state"
      contains: "Overview"
    - path: "apps/frontend/src/components/cases/messages-tab.tsx"
      provides: "Messages tab with reporter + email sections"
      contains: "Reporter Communication"
  key_links:
    - from: "apps/frontend/src/config/casesDetailConfig.ts"
      to: "apps/frontend/src/components/cases/case-tabs.tsx"
      via: "tab configuration"
      pattern: "tabs.*overview.*activities"
---

<objective>
Clean up tab configuration (6 tabs, Overview default, no URL state) and review/enhance Messages, Files, and Investigations tabs to match the spec. Wire tab component references into CASES_DETAIL_CONFIG.

Purpose: The tab system needs to be aligned with the spec: 6 tabs (not 7), Overview default (not Activities), no URL state, and each remaining tab reviewed against the spec for completeness.
Output: Clean 6-tab configuration, enhanced Messages/Files/Investigations tabs, config wiring.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25.1-case-detail-page-vision-revision/25.1-RESEARCH.md

# Key source files

@apps/frontend/src/components/cases/case-tabs.tsx
@apps/frontend/src/components/cases/messages-tab.tsx
@apps/frontend/src/components/cases/files-tab.tsx
@apps/frontend/src/components/cases/case-investigations-panel.tsx
@apps/frontend/src/components/cases/remediation-tab.tsx
@.planning/hubspot-view-system-spec.md (Sections 16.3, 16.4, 16.5, 16.6)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean up tab configuration and remove URL state</name>
  <files>
    apps/frontend/src/components/cases/case-tabs.tsx
    apps/frontend/src/config/casesDetailConfig.ts
  </files>
  <action>
1. **In case-tabs.tsx, enforce 6-tab configuration:**
   - Remove the Summary tab entirely (if Plan 05 hasn't already done this)
   - Tab order: Overview, Activities, Investigations, Messages, Files, Remediation
   - Overview is default (defaultTab = "overview")
   - Remove icons from tab triggers — text-only labels

2. **Remove URL state syncing for tabs:**
   - Remove any useSearchParams() usage for tab state
   - Remove any router.push() or router.replace() calls that update URL with tab parameter
   - Tab state should be local React state only (useState)
   - On fresh page load, always show Overview (no reading tab from URL)

3. **Wire actual tab components into CASES_DETAIL_CONFIG:**
   Update `apps/frontend/src/config/casesDetailConfig.ts`:
   - Import actual tab components (OverviewTab, ActivitiesTab, etc.) instead of `() => null` placeholders
   - If individual tab components are inline in case-tabs.tsx, that's fine — the config references are for future extraction

4. **Ensure tab switching works smoothly:**
   - Active tab has clear visual indicator (underline or bold or colored bottom border)
   - Switching tabs is instant (no loading state between tab clicks)
   - Tab content area scrolls independently from left/right sidebars
     </action>
     <verify>
   - 6 tabs render: Overview, Activities, Investigations, Messages, Files, Remediation
   - No Summary tab exists
   - Overview is default on fresh page load
   - No URL params for tab state
   - Tab triggers are text-only (no icons)
   - TypeScript compiles
     </verify>
     <done>6-tab configuration enforced, URL state removed, config wired</done>
     </task>

<task type="auto">
  <name>Task 2: Enhance Messages, Files, and Investigations tabs</name>
  <files>
    apps/frontend/src/components/cases/messages-tab.tsx
    apps/frontend/src/components/cases/files-tab.tsx
    apps/frontend/src/components/cases/case-investigations-panel.tsx
  </files>
  <action>
1. **Messages tab** (spec Section 16.4):

Review existing messages-tab.tsx. Enhance to show two sections:

a. **Reporter Communication section** — if case has linked RIU with reporter messages:

- Chat-like thread layout: reporter messages on left (incoming arrow), team responses on right (outgoing arrow)
- Show reporter type label: "Anonymous Reporter (via Hotline Access Code)" or "Identified Reporter: {name}"
- "Reply to Reporter" button at bottom of thread
- If no reporter messages, show "No reporter communications"

b. **Email Correspondence section** — emails logged to the case:

- List of email cards: icon, direction (to/from), subject, preview, date
- "Show full" expand for long email bodies
- "Compose Message" button at top right of tab

c. Add a count badge in the section headers: "Reporter Communication (3)", "Email Correspondence (5)"

If the existing messages-tab.tsx already handles some of this, enhance rather than rewrite. Add the two-section layout and visual polish.

2. **Files tab** (spec Section 16.5):

Review existing files-tab.tsx. Ensure it has:

- Upload button + drag-and-drop zone at bottom
- Search bar to filter files by name or tag
- Sort dropdown: by date (newest/oldest), name (A-Z/Z-A), size
- File cards with: file name, size, uploader, date, tags, Download/Preview/Delete actions
- Tag display as colored chips
- If these features mostly exist, add any missing ones (search, sort, tagging)

3. **Investigations tab** (spec Section 16.3):

Review existing case-investigations-panel.tsx. Ensure it has:

- Top bar with count badge "Investigations (N)", "+ Create Investigation" button, "Link Existing" button
- Investigation cards that are expandable (collapsed shows ref#, title, status, assignee, date)
- Expanded state shows: Details section, Findings section (editable), Notes section with "Add Note" and "View all" links
- "Open Full Investigation" link navigating to /cases/{caseId}/investigations/{invId}
- "Unlink from Case" action

If the existing implementation is close, add the missing elements. If it's far off, restructure.

4. **Empty states for each tab:**
   - Messages tab: If no reporter communications and no emails, show "No messages" with muted text "Reporter communications and email correspondence will appear here." and a Compose Message button.
   - Files tab: If no files attached, show "No files attached" with muted text "Drag and drop files here or click upload to attach documents." and an Upload button.
   - Investigations tab: If no investigations linked, show "No investigations linked" with muted text "Create a new investigation or link an existing one to this case." and the Create/Link buttons.
     </action>
     <verify>
   - Messages tab shows two sections: Reporter Communication and Email Correspondence
   - Files tab has upload, search, sort, file cards with actions
   - Investigations tab has Create/Link buttons and expandable cards
   - All tabs render without errors
   - `npm run typecheck` passes
     </verify>
     <done>Messages, Files, and Investigations tabs enhanced to match spec sections 16.3-16.5</done>
     </task>

</tasks>

<verification>
1. 6 tabs in correct order, Overview default, no URL state
2. Messages tab: reporter communication thread + email correspondence
3. Files tab: upload, search, sort, tags, file cards
4. Investigations tab: create/link buttons, expandable cards
5. Remediation tab: review that it matches spec Section 16.6 (should already be close from Phase 25)
6. All tabs switch cleanly without errors
7. `npm run typecheck` passes
</verification>

<success_criteria>

- All 6 tabs functional with spec-aligned content
- Messages tab clearly separates reporter communications from email
- Files tab supports search and sort
- Investigations tab supports inline expansion
- No URL state for tabs
  </success_criteria>

<output>
After completion, create `.planning/phases/25.1-case-detail-page-vision-revision/25.1-07-SUMMARY.md`
</output>
