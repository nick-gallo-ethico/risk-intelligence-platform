---
phase: 14-critical-bug-fixes-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/src/components/layout/top-nav.tsx
  - apps/frontend/src/components/layout/app-sidebar.tsx
  - apps/frontend/src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "User dropdown shows actual logged-in user name and role (not hardcoded 'Sarah Chen')"
    - "Clicking 'Log out' in user dropdown logs the user out and redirects to /login"
    - "Ethico SVG logo displays in sidebar (not plain text 'E')"
    - "Top navigation bar has dark background matching sidebar styling"
    - "All text and icons in top nav are readable (light colors on dark background)"
  artifacts:
    - path: "apps/frontend/src/components/layout/top-nav.tsx"
      provides: "Top nav with auth context, working logout, dark styling"
      contains: "useAuth"
    - path: "apps/frontend/src/components/layout/app-sidebar.tsx"
      provides: "Sidebar with Ethico SVG logo"
      contains: "ethico-icon"
  key_links:
    - from: "top-nav.tsx"
      to: "auth-context.tsx"
      via: "useAuth() hook"
      pattern: "useAuth\\(\\)"
    - from: "top-nav.tsx logout button"
      to: "/login"
      via: "logout() then router.push"
      pattern: "logout.*router\\.push"
---

<objective>
Fix the top navigation bar and sidebar to use real auth data, working logout, Ethico branding, and dark professional styling.

Purpose: These are the most visible bugs — every page shows the wrong user name, broken logout, placeholder logo, and mismatched nav colors. Fixing them immediately makes the app look polished.

Output: Updated top-nav.tsx, app-sidebar.tsx, and globals.css with real auth integration, working logout, SVG logo, and unified dark nav theme.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-critical-bug-fixes-navigation/14-RESEARCH.md
@apps/frontend/src/components/layout/top-nav.tsx
@apps/frontend/src/components/layout/app-sidebar.tsx
@apps/frontend/src/contexts/auth-context.tsx
@apps/frontend/src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace hardcoded user data with auth context and wire logout</name>
  <files>apps/frontend/src/components/layout/top-nav.tsx</files>
  <action>
  In top-nav.tsx, make these changes:

1. **Import useAuth:** Add `import { useAuth } from "@/contexts/auth-context";` at the top with other imports. Also ensure `useRouter` from `next/navigation` is imported.

2. **Replace mock user data (lines ~59-65):** Remove the hardcoded object:

   ```tsx
   const user = {
     name: "Sarah Chen",
     email: "sarah.chen@acmecorp.com",
     role: "Chief Compliance Officer",
     avatar: null,
   };
   ```

   Replace with:

   ```tsx
   const { user: authUser, logout } = useAuth();
   const router = useRouter();
   const displayName = authUser
     ? `${authUser.firstName} ${authUser.lastName}`
     : "User";
   const displayEmail = authUser?.email ?? "";
   const displayRole = authUser?.role
     ? authUser.role.replace(/_/g, " ").replace(/\b\w/g, (c) => c.toUpperCase())
     : "";
   const displayInitials = authUser
     ? `${authUser.firstName?.[0] ?? ""}${authUser.lastName?.[0] ?? ""}`
     : "U";
   ```

3. **Update all references to `user.name`** in the template to use `displayName`. Update `user.email` to `displayEmail`. Update `user.role` to `displayRole`. Update any avatar fallback text to `displayInitials`.

4. **Wire logout button (~line 294):** Find the Log out DropdownMenuItem and add onClick:

   ```tsx
   <DropdownMenuItem
     className="cursor-pointer text-destructive focus:text-destructive"
     onClick={async () => {
       await logout();
       router.push("/login");
     }}
   >
     <LogOut className="mr-2 h-4 w-4" />
     <span>Log out</span>
   </DropdownMenuItem>
   ```

5. **Fix user menu links:**
   - Change `/profile` link to `/settings` (profile page doesn't exist, settings does)
   - Keep `/my-work` link (will be created by plan 14-02)
   - Keep `/settings` link as-is

Do NOT change the dark styling yet — that's Task 2.
</action>
<verify>
Run `cd apps/frontend && npx tsc --noEmit` to verify no TypeScript errors.
Grep for "Sarah Chen" in top-nav.tsx — should return zero results.
Grep for "useAuth" in top-nav.tsx — should find the import and usage.
</verify>
<done>
top-nav.tsx uses useAuth() for user data. No hardcoded "Sarah Chen". Logout button calls logout() and redirects to /login. Profile link goes to /settings.
</done>
</task>

<task type="auto">
  <name>Task 2: Replace text logo with Ethico SVG and apply dark nav theme</name>
  <files>apps/frontend/src/components/layout/app-sidebar.tsx, apps/frontend/src/components/layout/top-nav.tsx, apps/frontend/src/app/globals.css</files>
  <action>
  **app-sidebar.tsx — Logo replacement:**

1. Add `import Image from 'next/image';` at the top.

2. Find the placeholder logo div (~lines 35-37):

   ```tsx
   <div className="flex aspect-square size-8 items-center justify-center rounded-lg bg-blue-600 text-white">
     <span className="font-bold text-sm">E</span>
   </div>
   ```

   Replace with:

   ```tsx
   <Image
     src="/ethico-icon.svg"
     alt="Ethico"
     width={32}
     height={32}
     className="rounded-lg"
   />
   ```

3. If there's a text label next to the logo ("Ethico" or similar), keep it but update if needed.

**top-nav.tsx — Dark theme:**

1. Find the `<header>` element (line ~103). It currently has:

   ```tsx
   className =
     "sticky top-0 z-40 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60";
   ```

   Replace with:

   ```tsx
   className =
     "sticky top-0 z-40 w-full border-b border-white/10 bg-[hsl(227,36%,13%)] text-white";
   ```

2. Update ALL child elements that use dark text colors to use light colors:
   - Replace `text-muted-foreground` with `text-white/70` inside the header
   - Replace `text-foreground` with `text-white` inside the header
   - Replace `text-primary` with `text-white` for the Ethico brand text
   - Update search input: border and background should use white/10 variants, placeholder text white/50
   - Update notification bell icon to use `text-white/80 hover:text-white`
   - Update user avatar/initials background to use `bg-white/20` or similar
   - Update dropdown trigger to not conflict with dark background

3. If top-nav has its own "Ethico" brand text/logo, replace with the SVG:
   ```tsx
   <Image src="/ethico-logo-light.svg" alt="Ethico" width={100} height={28} />
   ```
   Or use `ethico-icon.svg` for a compact icon.

**globals.css — Sidebar dark theme:**

4. Find the `:root` CSS variables for sidebar. Update:

   ```css
   --sidebar-background: 227 36% 13%;
   --sidebar-foreground: 0 0% 100%;
   --sidebar-border: 0 0% 100% / 0.1;
   --sidebar-accent: 0 0% 100% / 0.1;
   --sidebar-accent-foreground: 0 0% 100%;
   ```

   This makes the sidebar dark navy to match the top nav.

5. Also update the `.dark` theme sidebar variables if they exist, to ensure consistency in both modes.

IMPORTANT: After changing to dark nav, visually verify that ALL interactive elements (buttons, dropdowns, badges) remain visible and readable. The notification count badge should still be visible (red on dark). The search input should have visible borders.
</action>
<verify>
Run `cd apps/frontend && npx tsc --noEmit` to verify no TypeScript errors.
Grep for "bg-blue-600" in app-sidebar.tsx — should return zero results (logo replaced).
Grep for "ethico-icon" in app-sidebar.tsx — should find the Image component.
Grep for "hsl(227" in top-nav.tsx — should find the dark background.
</verify>
<done>
Sidebar shows Ethico SVG icon (not text "E"). Top nav has dark navy background (hsl 227 36% 13%). Sidebar CSS variables updated to dark navy. All text/icons in top nav are light-colored for readability on dark background.
</done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `cd apps/frontend && npx tsc --noEmit` passes
2. No "Sarah Chen" hardcoded anywhere in layout components
3. useAuth() imported and used in top-nav.tsx
4. Logout handler exists with router.push('/login')
5. ethico-icon.svg referenced in app-sidebar.tsx
6. Top nav uses dark background class
7. Sidebar CSS variables set to dark navy
</verification>

<success_criteria>

- User dropdown shows dynamic name from auth context (changes when different user logs in)
- Logout button logs out and redirects to /login
- Ethico SVG logo visible in sidebar
- Top nav and sidebar both have matching dark navy backgrounds
- All text readable on dark backgrounds
  </success_criteria>

<output>
After completion, create `.planning/phases/14-critical-bug-fixes-navigation/14-01-SUMMARY.md`
</output>
