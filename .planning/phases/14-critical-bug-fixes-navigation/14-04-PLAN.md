---
phase: 14-critical-bug-fixes-navigation
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/src/app/(authenticated)/dashboard/page.tsx
  - apps/frontend/src/components/dashboard/my-tasks.tsx
  - apps/frontend/src/components/dashboard/my-assignments.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard page loads within 2 seconds (My Active Cases does not hang)"
    - "Clicking a task in My Tasks navigates to the correct entity detail page"
    - "Clicking a case in My Active Cases navigates to the correct case detail page"
    - "Audit Log link in sidebar navigates to /settings/audit (which exists)"
  artifacts:
    - path: "apps/frontend/src/app/(authenticated)/dashboard/page.tsx"
      provides: "Dashboard with optimized case fetching (limit reduced)"
    - path: "apps/frontend/src/components/dashboard/my-tasks.tsx"
      provides: "My Tasks with verified navigation URLs"
    - path: "apps/frontend/src/components/dashboard/my-assignments.tsx"
      provides: "My Active Cases with correct case detail navigation"
  key_links:
    - from: "dashboard/page.tsx"
      to: "/api/v1/cases"
      via: "useQuery with reduced limit"
      pattern: "limit.*25"
    - from: "my-tasks.tsx task click"
      to: "task.url"
      via: "router.push"
      pattern: "router\\.push.*task\\.url"
---

<objective>
Fix dashboard performance (reduce case fetch limit) and verify task/case navigation links work correctly. Also verify the audit log route is accessible.

Purpose: The dashboard is the landing page — slow loading and broken task links create a terrible first impression. Reducing the cases fetch from 100 to 25 immediately improves load time.

Output: Optimized dashboard fetch, verified task navigation, and confirmed audit log accessibility.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-critical-bug-fixes-navigation/14-RESEARCH.md
@apps/frontend/src/app/(authenticated)/dashboard/page.tsx
@apps/frontend/src/components/dashboard/my-tasks.tsx
@apps/frontend/src/components/dashboard/my-assignments.tsx
@apps/frontend/src/lib/navigation.ts
@apps/frontend/src/app/(authenticated)/settings/audit/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Optimize dashboard case fetching and fix task navigation</name>
  <files>apps/frontend/src/app/(authenticated)/dashboard/page.tsx, apps/frontend/src/components/dashboard/my-tasks.tsx, apps/frontend/src/components/dashboard/my-assignments.tsx</files>
  <action>
  **dashboard/page.tsx — Reduce fetch limit:**

1. Find the cases API call (line ~37-41 area). It currently fetches with `limit: 100`:

   ```tsx
   const response = await casesApi.list({
     limit: 100,
     sortBy: "createdAt",
     sortOrder: "desc",
   });
   ```

2. Reduce `limit` from 100 to 25:

   ```tsx
   const response = await casesApi.list({
     limit: 25,
     sortBy: "createdAt",
     sortOrder: "desc",
   });
   ```

3. If the StatsCards component uses the full cases array for calculations (counts by status, etc.), verify it still works with 25 items. If StatsCards needs accurate counts, consider:
   - Adding a separate lightweight stats query if a stats endpoint exists (check for `GET /api/v1/cases/stats` or similar)
   - Or accepting approximate counts from the limited dataset (acceptable for MVP)
   - The simplest fix is just reducing the limit — if stats become inaccurate, that's a future optimization

**my-tasks.tsx — Verify task navigation:**

4. Read `my-tasks.tsx` to understand the task click handler. It uses `router.push(task.url || '#')`.

5. The `task.url` comes from the backend `GET /api/v1/my-work` response. The `TaskAggregatorService` builds URLs. Verify the URL patterns generated are correct routes:
   - Cases: `/cases/{id}` — this route EXISTS
   - Investigations: `/investigations/{id}` — check if this route exists
   - Approvals: may point to different entity types

6. If `task.url` can be null/undefined/empty, ensure the fallback `'#'` doesn't cause navigation issues. Better fallback:

   ```tsx
   onClick={() => {
     if (task.url) {
       router.push(task.url);
     }
   }}
   ```

7. Check the backend `task-aggregator.service.ts` (read it) to verify the URL building logic. If URLs reference routes that don't exist (e.g., `/investigations/{id}`), note this but DON'T create those pages here — they'll be addressed in Phase 15. Instead, ensure the URLs at least don't cause errors.

**my-assignments.tsx — Verify case navigation:**

8. Read `my-assignments.tsx`. It navigates to `/cases/${caseItem.id}`. The route `/cases/[id]` EXISTS, so this should work. Verify the `caseItem.id` is a valid UUID and the navigation pattern is correct.

9. If `my-assignments.tsx` receives cases from the parent dashboard component (which now fetches 25 instead of 100), verify the component still works with the reduced dataset. It shows max 5 items, so 25 is more than enough.

**Audit log verification (Issue 14.1):**

10. Read `lib/navigation.ts` and confirm the Audit Log link points to `/settings/audit`. Read `settings/audit/page.tsx` and confirm it exists and is functional. Check the `adminItems` array for the audit log entry and verify `requiredRoles` includes the demo user's role.

11. If the audit log link is only visible to SYSTEM_ADMIN and COMPLIANCE_OFFICER roles, verify the demo user seed data assigns one of these roles. Check `apps/backend/prisma/seeds/` for the demo user configuration. If the demo user (Sarah Chen / CCO) has `COMPLIANCE_OFFICER` role, the link should appear.

12. If there are any other places in the app that link to audit log at a WRONG URL (e.g., `/audit-log` or `/audit` instead of `/settings/audit`), fix those links. Search the codebase:
    `bash
 grep -rn '"/audit' apps/frontend/src/ --include="*.tsx" --include="*.ts" | grep -v settings/audit | grep -v node_modules
 `
    Fix any mismatched URLs to point to `/settings/audit`.
    </action>
    <verify>
    Run `cd apps/frontend && npx tsc --noEmit` to verify no TypeScript errors.
    Grep for `limit: 100` in dashboard/page.tsx — should return zero results.
    Grep for `limit: 25` in dashboard/page.tsx — should find the reduced limit.
    Verify settings/audit/page.tsx exists: `ls apps/frontend/src/app/\(authenticated\)/settings/audit/page.tsx`
    </verify>
    <done>
    Dashboard fetches 25 cases instead of 100 (faster load). My Tasks click handler correctly navigates to task.url. My Active Cases correctly navigates to /cases/{id}. Audit log route confirmed at /settings/audit with correct sidebar link.
    </done>
    </task>

</tasks>

<verification>
1. TypeScript compilation passes: `cd apps/frontend && npx tsc --noEmit`
2. Dashboard cases fetch uses limit: 25 (not 100)
3. my-tasks.tsx navigates to task.url safely (handles null/empty)
4. my-assignments.tsx navigates to /cases/{id}
5. Audit log page exists at /settings/audit
6. No stale audit log links pointing to wrong URLs
</verification>

<success_criteria>

- Dashboard loads noticeably faster (under 2 seconds)
- Clicking a task in My Tasks navigates to the correct detail page
- Clicking a case in My Active Cases navigates to the correct case detail page
- Audit Log is accessible via sidebar link at /settings/audit
  </success_criteria>

<output>
After completion, create `.planning/phases/14-critical-bug-fixes-navigation/14-04-SUMMARY.md`
</output>
