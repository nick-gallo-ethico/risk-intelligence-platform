---
phase: 18-reports-data-management
plan: 04
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - apps/backend/prisma/seeds/acme-phase-18.ts
  - apps/backend/prisma/seeds/index.ts
autonomous: true

must_haves:
  truths:
    - "Pre-built compliance report templates exist for common reporting needs"
    - "Templates cover case volume, time-to-close, SLA compliance, disclosure rates, and more"
    - "Templates are seeded as isTemplate=true SavedReport records for the demo tenant"
  artifacts:
    - path: "apps/backend/prisma/seeds/acme-phase-18.ts"
      provides: "Seed script for pre-built report templates and sample saved reports"
      exports: ["seedPhase18"]
  key_links:
    - from: "acme-phase-18.ts"
      to: "prisma.savedReport"
      via: "Prisma createMany for template reports"
      pattern: "prisma\\.savedReport\\.createMany"
---

<objective>
Create pre-built compliance report templates and seed demo data for the Acme Co. tenant.

Purpose: Users need starter templates so they don't have to build every report from scratch. Compliance teams need standard reports (case volume by category, SLA trends, etc.) ready to use. Demo tenant needs sample reports for sales demonstrations.

Output: 10 pre-built report templates + 5 sample user-created reports seeded for Acme Co.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/18-reports-data-management/18-RESEARCH.md
@apps/backend/prisma/seeds/acme-phase-02.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Pre-built report templates seeder</name>
  <files>
    apps/backend/prisma/seeds/acme-phase-18.ts
    apps/backend/prisma/seeds/index.ts
  </files>
  <action>
Create acme-phase-18.ts seed script following the existing pattern from acme-phase-02.ts (PrismaClient injection, org lookup, idempotent upsert).

Seed 10 pre-built report TEMPLATES (isTemplate: true). Each template needs a complete report configuration that will actually work when run:

1. **Case Volume by Category** (bar chart, monthly)
   - entityType: 'cases', visualization: 'bar'
   - columns: ['categoryName', 'status', 'createdAt']
   - groupBy: ['categoryId'], aggregation: { function: 'count' }
   - templateCategory: 'compliance'

2. **Time-to-Close Trends** (line chart, by month)
   - entityType: 'cases', visualization: 'line'
   - columns: ['createdAt', 'outcomeAt', 'categoryName']
   - filters: [{ field: 'status', operator: 'eq', value: 'CLOSED' }]
   - groupBy: ['createdAt'] with monthly date truncation
   - templateCategory: 'compliance'

3. **SLA Compliance Rate** (kpi)
   - entityType: 'cases', visualization: 'kpi'
   - columns: ['status', 'severity', 'slaDueAt']
   - templateCategory: 'compliance'

4. **Disclosure Completion Rates** (stacked_bar, by campaign)
   - entityType: 'campaigns', visualization: 'stacked_bar'
   - columns: ['name', 'status', 'totalAssignments', 'completedAssignments']
   - filters: [{ field: 'type', operator: 'in', value: ['DISCLOSURE'] }]
   - templateCategory: 'compliance'

5. **Open Cases by Priority** (bar)
   - entityType: 'cases', visualization: 'bar'
   - columns: ['severity', 'status', 'pipelineStage']
   - filters: [{ field: 'status', operator: 'in', value: ['NEW', 'IN_PROGRESS', 'PENDING'] }]
   - groupBy: ['severity'], aggregation: { function: 'count' }
   - templateCategory: 'operations'

6. **Anonymous vs Named Reports** (pie)
   - entityType: 'rius', visualization: 'pie'
   - columns: ['reporterType', 'createdAt']
   - groupBy: ['reporterType'], aggregation: { function: 'count' }
   - templateCategory: 'compliance'

7. **Cases by Location/Region** (bar)
   - entityType: 'cases', visualization: 'bar'
   - columns: ['locationName', 'businessUnitName', 'status']
   - groupBy: ['businessUnitName'], aggregation: { function: 'count' }
   - templateCategory: 'operations'

8. **Investigator Workload** (bar)
   - entityType: 'investigations', visualization: 'bar'
   - columns: ['assigneeName', 'status', 'createdAt']
   - filters: [{ field: 'status', operator: 'in', value: ['PENDING', 'IN_PROGRESS'] }]
   - groupBy: ['assigneeId'], aggregation: { function: 'count' }
   - templateCategory: 'operations'

9. **RIU Intake Trends** (line)
   - entityType: 'rius', visualization: 'line'
   - columns: ['type', 'sourceChannel', 'createdAt']
   - groupBy: ['createdAt'] with monthly date truncation
   - templateCategory: 'compliance'

10. **Quarterly Board Summary** (table)
    - entityType: 'cases', visualization: 'table'
    - columns: ['referenceNumber', 'title', 'categoryName', 'status', 'severity', 'outcome', 'assigneeName', 'createdAt', 'outcomeAt']
    - sortBy: 'createdAt', sortOrder: 'desc'
    - templateCategory: 'executive'

All templates: visibility = 'EVERYONE', isTemplate = true.

Also seed 5 sample SAVED REPORTS for the demo CCO user (not templates, regular reports):

1. "My Open Cases" - cases, table, filter: status IN [NEW, IN_PROGRESS], assigned to demo CCO
2. "Q4 2025 Harassment Cases" - cases, table, filter: category=harassment, date range Q4 2025
3. "Monthly RIU Volume" - rius, line, groupBy month
4. "Top 10 Repeat Subjects" - persons, table, filter on association count (approximate)
5. "Campaign Compliance Score" - campaigns, bar, group by status

Use the Acme Co. organization ID lookup pattern. Use upsert with unique constraint on (organizationId, name) or check existence before creating to make the seed idempotent.

Update index.ts to import and call seedPhase18 in the seed orchestration sequence.
</action>
<verify>
`cd apps/backend && npx tsc --noEmit --pretty` compiles the seed file without errors.
The seed file exports a function that can be called with PrismaClient.
</verify>
<done>10 pre-built report templates and 5 sample user reports seeded for Acme Co. Templates cover case volume, time-to-close, SLA, disclosures, anonymous vs named, location, workload, intake trends, and board summary.</done>
</task>

</tasks>

<verification>
- 10 template reports with isTemplate=true exist after seeding
- 5 sample user reports exist for demo CCO user
- Each template has complete, valid configuration (entityType, columns, filters, visualization)
- Seed is idempotent (running twice doesn't create duplicates)
- TypeScript compiles without errors
</verification>

<success_criteria>

1. Seed script creates 10 report templates covering all templateCategory values
2. Seed script creates 5 sample user reports for demo CCO
3. Each template has a complete report configuration that could be run
4. Seed is idempotent
5. TypeScript compiles without errors
   </success_criteria>

<output>
After completion, create `.planning/phases/18-reports-data-management/18-04-SUMMARY.md`
</output>
