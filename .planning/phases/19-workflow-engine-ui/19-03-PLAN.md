---
phase: 19-workflow-engine-ui
plan: 03
type: execute
wave: 2
depends_on: ["19-01", "19-02"]
files_modified:
  - apps/frontend/src/app/(authenticated)/settings/workflows/page.tsx
  - apps/frontend/src/components/workflows/workflow-list-table.tsx
  - apps/frontend/src/components/workflows/workflow-list-filters.tsx
  - apps/frontend/src/components/workflows/create-workflow-dialog.tsx
autonomous: true

must_haves:
  truths:
    - "User navigates to /settings/workflows and sees a table of all workflow templates"
    - "Table shows columns: Name, Entity Type, Version, Status (active badge), Default (star), Instances count, Updated date"
    - "User can filter by entity type dropdown and active/inactive toggle"
    - "User can click 'Create Workflow' to open a dialog, select entity type and name, then navigate to /settings/workflows/new?entityType=X&name=Y"
    - "User can click Clone, Delete, Set as Default from row action menu"
    - "Delete shows confirmation dialog and only works if instance count is 0"
  artifacts:
    - path: "apps/frontend/src/app/(authenticated)/settings/workflows/page.tsx"
      provides: "Workflow list page route"
    - path: "apps/frontend/src/components/workflows/workflow-list-table.tsx"
      provides: "Table component with columns, row actions, pagination"
    - path: "apps/frontend/src/components/workflows/workflow-list-filters.tsx"
      provides: "Filter bar with entity type and status filters"
    - path: "apps/frontend/src/components/workflows/create-workflow-dialog.tsx"
      provides: "Dialog for creating new workflow with name and entity type"
  key_links:
    - from: "workflow-list-table.tsx"
      to: "hooks/use-workflows.ts"
      via: "useWorkflowTemplates hook"
      pattern: "useWorkflowTemplates"
    - from: "page.tsx"
      to: "/settings/workflows/[id]"
      via: "router.push on row click"
      pattern: "router\\.push.*settings/workflows"
---

<objective>
Build the workflow list page at /settings/workflows showing all workflow templates with filtering, actions, and navigation to create/edit workflows.

Purpose: This is the entry point for workflow management. Compliance officers need to see all workflows, their types, versions, and active instance counts. They need quick actions (clone, delete, set default) and the ability to create new workflows.

Output: Fully functional workflow list page with table, filters, row actions, and create dialog.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-workflow-engine-ui/19-RESEARCH.md
@.planning/phases/19-workflow-engine-ui/19-02-SUMMARY.md

@apps/frontend/src/types/workflow.ts
@apps/frontend/src/services/workflows.ts
@apps/frontend/src/hooks/use-workflows.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create workflow list page and table</name>
  <files>
    apps/frontend/src/app/(authenticated)/settings/workflows/page.tsx
    apps/frontend/src/components/workflows/workflow-list-table.tsx
    apps/frontend/src/components/workflows/workflow-list-filters.tsx
  </files>
  <action>
1. Create `settings/workflows/page.tsx`:
   - Page header: "Workflows" title with description "Manage workflow templates for cases, policies, and disclosures"
   - "Create Workflow" button in header (opens create dialog)
   - WorkflowListFilters component
   - WorkflowListTable component
   - State for filters: entityType (undefined = all), isActive (undefined = all)

2. Create `workflow-list-filters.tsx`:
   - Entity type dropdown using shadcn Select: All Types, Case, Investigation, Disclosure, Policy, Campaign
   - Status toggle group: All, Active, Inactive (using shadcn ToggleGroup)
   - Filters update parent state via onChange callbacks

3. Create `workflow-list-table.tsx`:
   - Uses useWorkflowTemplates(entityType, isActive) hook
   - Columns using @tanstack/react-table:
     - Name (link to /settings/workflows/:id)
     - Entity Type (badge with color per type: Case=blue, Policy=purple, Disclosure=amber, Investigation=green, Campaign=cyan)
     - Version (v{number})
     - Status (green "Active" badge or gray "Inactive" badge)
     - Default (star icon if isDefault, clickable to set as default)
     - Instances (\_instanceCount number, links to /settings/workflows/:id/instances)
     - Updated (relative date using date-fns formatDistanceToNow)
   - Row action dropdown menu (shadcn DropdownMenu):
     - Edit -> navigate to /settings/workflows/:id
     - Clone -> calls useCloneTemplate mutation, shows toast on success
     - View Instances -> navigate to /settings/workflows/:id/instances
     - Set as Default / Unset Default -> calls useUpdateTemplate with isDefault toggle
     - Divider
     - Delete -> confirmation AlertDialog, calls useDeleteTemplate. Disabled if \_instanceCount > 0 with tooltip "Cannot delete template with active instances"
   - Loading skeleton while fetching
   - Empty state: "No workflow templates found. Create your first workflow to get started."
     </action>
     <verify>
     Navigate to /settings/workflows in the browser. Page should render without errors.
     Run `cd apps/frontend && npx tsc --noEmit` to verify compilation.
     </verify>
     <done>Workflow list page renders table with all columns, filters change the displayed data, row actions (clone, delete, set default) work with toast feedback.</done>
     </task>

<task type="auto">
  <name>Task 2: Create workflow creation dialog</name>
  <files>
    apps/frontend/src/components/workflows/create-workflow-dialog.tsx
    apps/frontend/src/app/(authenticated)/settings/workflows/page.tsx
  </files>
  <action>
1. Create `create-workflow-dialog.tsx`:
   - Dialog component (shadcn Dialog) with:
     - Title: "Create New Workflow"
     - Form with two fields:
       - Name (text input, required, min 3 chars, max 100 chars)
       - Entity Type (Select dropdown: Case, Investigation, Disclosure, Policy, Campaign)
     - Cancel button
     - "Create & Edit" button -> calls useCreateTemplate with a minimal template:
       - name from form
       - entityType from form
       - stages: one initial stage { id: 'new', name: 'New', steps: [], isTerminal: false, display: { color: '#3b82f6', sortOrder: 0 } }
       - transitions: [] (empty)
       - initialStage: 'new'
     - On success: navigate to /settings/workflows/:newId (the workflow builder page)
     - Use react-hook-form with zod validation
   - Props: open, onOpenChange

2. Wire dialog into page.tsx:
   - State: isCreateOpen
   - "Create Workflow" button sets isCreateOpen = true
   - <CreateWorkflowDialog open={isCreateOpen} onOpenChange={setIsCreateOpen} />
       </action>
       <verify>
         Click "Create Workflow" button. Dialog opens with form. Fill name and entity type, click "Create & Edit". Verify template is created via API call and user is navigated to the builder page (which will 404 until Plan 04 - that's fine).
         Run `cd apps/frontend && npx tsc --noEmit`.
       </verify>
       <done>Create workflow dialog opens from the list page, validates input, creates a minimal template via API, and navigates to the builder page.</done>
     </task>

</tasks>

<verification>
- /settings/workflows renders a table of workflow templates
- Filters work for entity type and active/inactive status
- Row actions: Clone creates a copy, Delete removes (with confirmation), Set Default toggles
- Create dialog validates input and creates template via API
- TypeScript compiles
</verification>

<success_criteria>

- Workflow list page is the admin's primary view of all workflow configurations
- All CRUD actions accessible from this page (create, edit via navigate, clone, delete, set default)
- Filters narrow the template list by entity type and status
  </success_criteria>

<output>
After completion, create `.planning/phases/19-workflow-engine-ui/19-03-SUMMARY.md`
</output>
