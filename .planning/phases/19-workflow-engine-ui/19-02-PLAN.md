---
phase: 19-workflow-engine-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/package.json
  - apps/frontend/src/types/workflow.ts
  - apps/frontend/src/services/workflows.ts
  - apps/frontend/src/hooks/use-workflows.ts
  - apps/frontend/src/lib/navigation.ts
autonomous: true

must_haves:
  truths:
    - "@xyflow/react is installed and importable"
    - "TypeScript types match backend WorkflowTemplate, WorkflowInstance, WorkflowStage, WorkflowStep, WorkflowTransition, StageGate models"
    - "API service covers all workflow endpoints (templates CRUD, instances CRUD, clone, versions)"
    - "React Query hooks exist for list templates, get template, list instances, mutations"
    - "Workflows nav item appears in admin sidebar for SYSTEM_ADMIN and COMPLIANCE_OFFICER"
  artifacts:
    - path: "apps/frontend/src/types/workflow.ts"
      provides: "All workflow TypeScript interfaces"
    - path: "apps/frontend/src/services/workflows.ts"
      provides: "API client functions for all workflow endpoints"
    - path: "apps/frontend/src/hooks/use-workflows.ts"
      provides: "React Query hooks for workflow data fetching"
    - path: "apps/frontend/src/lib/navigation.ts"
      provides: "Workflows admin nav item"
  key_links:
    - from: "services/workflows.ts"
      to: "/api/v1/workflows"
      via: "apiClient fetch calls"
      pattern: "apiClient\\.(get|post|patch|delete).*workflows"
    - from: "hooks/use-workflows.ts"
      to: "services/workflows.ts"
      via: "React Query wrapping service calls"
      pattern: "useQuery.*workflowsApi"
---

<objective>
Install @xyflow/react and create the frontend foundation for the Workflow Engine UI: TypeScript types, API service, React Query hooks, and navigation entry.

Purpose: All subsequent workflow UI plans depend on these foundational pieces. Types ensure type safety, the API service abstracts backend calls, hooks provide cached data fetching, and navigation makes the section discoverable.

Output: Installable dependency, complete type definitions, full API service, React Query hooks, and sidebar navigation entry.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-workflow-engine-ui/19-RESEARCH.md

@apps/frontend/src/lib/api.ts
@apps/frontend/src/lib/navigation.ts
@apps/frontend/src/services/policies.ts
@apps/backend/src/modules/workflow/types/workflow.types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @xyflow/react and create TypeScript types</name>
  <files>
    apps/frontend/package.json
    apps/frontend/src/types/workflow.ts
  </files>
  <action>
1. Install @xyflow/react:
   ```
   cd apps/frontend && npm install @xyflow/react
   ```

2. Create `src/types/workflow.ts` with interfaces mirroring the backend types:
   - `WorkflowEntityType` = 'CASE' | 'INVESTIGATION' | 'DISCLOSURE' | 'POLICY' | 'CAMPAIGN'
   - `WorkflowInstanceStatus` = 'ACTIVE' | 'COMPLETED' | 'CANCELLED' | 'PAUSED'
   - `SlaStatus` = 'ON_TRACK' | 'WARNING' | 'OVERDUE'
   - `WorkflowStage` { id, name, description?, steps: WorkflowStep[], slaDays?, gates?: StageGate[], isTerminal?, display?: { color?, icon?, sortOrder? } }
   - `WorkflowStep` { id, name, type: 'manual' | 'automatic' | 'approval' | 'notification', config?, assigneeStrategy?, timeoutHours?, onTimeout?: 'pause' | 'skip' | 'escalate', isOptional?, description? }
   - `StageGate` { type: 'required_fields' | 'approval' | 'condition' | 'time', config: Record<string, unknown>, errorMessage? }
   - `WorkflowTransition` { from, to, conditions?: TransitionCondition[], actions?: TransitionAction[], label?, allowedRoles?: string[], requiresReason? }
   - `TransitionCondition` { type: 'field' | 'approval' | 'time' | 'expression', config: Record<string, unknown> }
   - `TransitionAction` { type: 'notification' | 'assignment' | 'field_update' | 'webhook', config: Record<string, unknown> }
   - `AssigneeStrategy` = { type: 'specific_user', userId: string } | { type: 'round_robin', teamId: string } | ... (all 7 types)
   - `WorkflowTemplate` { id, organizationId, name, description?, entityType: WorkflowEntityType, version, isActive, isDefault, stages: WorkflowStage[], transitions: WorkflowTransition[], initialStage, defaultSlaDays?, slaConfig?, sourceTemplateId?, tags: string[], createdById, createdAt, updatedAt, \_instanceCount?: number }
   - `WorkflowInstance` { id, organizationId, templateId, templateVersion, entityType, entityId, currentStage, currentStep?, status: WorkflowInstanceStatus, stepStates: Record<string, StepState>, dueDate?, slaStatus?: SlaStatus, slaBreachedAt?, completedAt?, outcome?, startedById, createdAt, updatedAt }
   - `StepState` { status: 'pending' | 'in_progress' | 'completed' | 'skipped' | 'failed', completedAt?, completedBy?, result? }
   - DTOs: `CreateWorkflowTemplateDto`, `UpdateWorkflowTemplateDto`, `StartWorkflowDto`, `TransitionDto`
   - Response types: `PaginatedResponse<T>` = { data: T[], total: number, page: number, limit: number }
     </action>
     <verify>Run `cd apps/frontend && npx tsc --noEmit` to verify types compile.</verify>
     <done>@xyflow/react installed. All workflow types defined and compile without errors.</done>
     </task>

<task type="auto">
  <name>Task 2: Create API service, React Query hooks, and add navigation</name>
  <files>
    apps/frontend/src/services/workflows.ts
    apps/frontend/src/hooks/use-workflows.ts
    apps/frontend/src/lib/navigation.ts
  </files>
  <action>
1. Create `src/services/workflows.ts` following the policies.ts pattern:
   - `listTemplates(entityType?, isActive?)` -> GET /workflows/templates with query params
   - `getTemplate(id)` -> GET /workflows/templates/:id
   - `getDefaultTemplate(entityType)` -> GET /workflows/templates/default/:entityType
   - `createTemplate(dto)` -> POST /workflows/templates
   - `updateTemplate(id, dto)` -> PATCH /workflows/templates/:id
   - `deleteTemplate(id)` -> DELETE /workflows/templates/:id
   - `cloneTemplate(id)` -> POST /workflows/templates/:id/clone
   - `getTemplateVersions(id)` -> GET /workflows/templates/:id/versions
   - `listInstances(filters?)` -> GET /workflows/instances with query params (templateId, status, entityType, page, limit)
   - `getInstance(id)` -> GET /workflows/instances/:id
   - `getInstanceByEntity(entityType, entityId)` -> GET /workflows/entity/:entityType/:entityId
   - `getAllowedTransitions(instanceId)` -> GET /workflows/instances/:id/transitions
   - `startWorkflow(dto)` -> POST /workflows/instances
   - `transitionInstance(id, dto)` -> POST /workflows/instances/:id/transition
   - `completeInstance(id, outcome?)` -> POST /workflows/instances/:id/complete
   - `cancelInstance(id, reason?)` -> POST /workflows/instances/:id/cancel
   - `pauseInstance(id, reason?)` -> POST /workflows/instances/:id/pause
   - `resumeInstance(id)` -> POST /workflows/instances/:id/resume
   - Export as `workflowsApi` object (same pattern as policiesApi).

2. Create `src/hooks/use-workflows.ts` with React Query hooks:
   - `useWorkflowTemplates(entityType?, isActive?)` - useQuery with key ['workflow-templates', entityType, isActive]
   - `useWorkflowTemplate(id)` - useQuery with key ['workflow-template', id], enabled: !!id
   - `useWorkflowTemplateVersions(id)` - useQuery with key ['workflow-template-versions', id], enabled: !!id
   - `useWorkflowInstances(filters?)` - useQuery with key ['workflow-instances', filters]
   - `useWorkflowInstance(id)` - useQuery with key ['workflow-instance', id], enabled: !!id
   - `useCreateTemplate()` - useMutation, invalidates ['workflow-templates']
   - `useUpdateTemplate()` - useMutation, invalidates ['workflow-templates'] and ['workflow-template', id]
   - `useDeleteTemplate()` - useMutation, invalidates ['workflow-templates']
   - `useCloneTemplate()` - useMutation, invalidates ['workflow-templates']

3. Update `src/lib/navigation.ts`:
   - Import `GitBranch` (or `Workflow`) from lucide-react
   - Add to adminItems array BEFORE "Settings": { title: 'Workflows', url: '/settings/workflows', icon: GitBranch, requiredRoles: ['SYSTEM_ADMIN', 'COMPLIANCE_OFFICER'] }
     </action>
     <verify>Run `cd apps/frontend && npx tsc --noEmit` to verify everything compiles.</verify>
     <done>API service covers all workflow endpoints. React Query hooks provide cached data fetching with proper invalidation. Workflows appears in admin sidebar navigation.</done>
     </task>

</tasks>

<verification>
- `@xyflow/react` in package.json dependencies
- TypeScript compiles without errors
- Types match backend model shapes
- API service has functions for all workflow endpoints
- React Query hooks wrap all read operations and key mutations
- Navigation sidebar shows "Workflows" for admin users
</verification>

<success_criteria>

- Frontend foundation complete: types, API service, hooks, navigation
- @xyflow/react installed for use in workflow builder (Plan 04)
- All subsequent UI plans can import from these files without additional setup
  </success_criteria>

<output>
After completion, create `.planning/phases/19-workflow-engine-ui/19-02-SUMMARY.md`
</output>
