---
phase: 14.1-data-config-fixes
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/backend/prisma/seeders/case.seeder.ts
autonomous: true

must_haves:
  truths:
    - "Demo users have cases appearing in My Tasks"
    - "At least 20 open cases per demo investigator/CCO user"
    - "Case createdById field matches demo user IDs for assigned cases"
  artifacts:
    - path: "apps/backend/prisma/seeders/case.seeder.ts"
      provides: "Case seeder with demo user assignment"
      contains: "demo-"
  key_links:
    - from: "apps/backend/src/modules/analytics/my-work/task-aggregator.service.ts"
      to: "apps/backend/prisma/seeders/case.seeder.ts"
      via: "createdById field matches demo users"
      pattern: "createdById"
---

<objective>
Fix task aggregation by ensuring demo users are the createdById on some cases.

Purpose: The TaskAggregatorService.fetchCaseAssignments queries by `createdById: userId`. Currently cases are created with random userIds, so demo users see 0 tasks. Need to ensure demo users "own" some open cases.
Output: 20+ open cases per demo investigator/CCO user for My Tasks display.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@apps/backend/prisma/seeders/case.seeder.ts (case seeder)
@apps/backend/prisma/seeders/user.seeder.ts (demo user definitions)
@apps/backend/src/modules/analytics/my-work/task-aggregator.service.ts (queries createdById)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add demo user case assignment to case seeder</name>
  <files>apps/backend/prisma/seeders/case.seeder.ts</files>
  <action>
Modify the case seeder to ensure demo users (CCO, Investigators, Triage) have open cases assigned to them via createdById.

1. Add demo user email constants at top of file:
   ```typescript
   const DEMO_CASE_OWNERS = [
     'demo-cco@acme.local',
     'demo-investigator@acme.local',
     'demo-investigator2@acme.local',
     'demo-triage@acme.local',
   ];
   ```

2. In the seedCases function, after getting userIds, identify demo user IDs:
   ```typescript
   // Get demo user IDs for case ownership
   const demoUsers = await prisma.user.findMany({
     where: {
       organizationId,
       email: { in: DEMO_CASE_OWNERS },
     },
     select: { id: true, email: true },
   });
   const demoUserIdMap = new Map(demoUsers.map(u => [u.email, u.id]));
   ```

3. Reserve first 80-100 open cases (NEW or OPEN status) for demo users:
   - Cases 0-24: demo-cco@acme.local
   - Cases 25-49: demo-investigator@acme.local
   - Cases 50-74: demo-investigator2@acme.local
   - Cases 75-99: demo-triage@acme.local

4. Modify the case generation loop to assign createdById to demo users for reserved indices:
   ```typescript
   // In the loop where cases are generated
   let createdById: string;
   const openCaseIndex = caseBatch.filter(c =>
     c.status === CaseStatus.NEW || c.status === CaseStatus.OPEN
   ).length;

   if (openCaseIndex < 25 && demoUserIdMap.has('demo-cco@acme.local')) {
     createdById = demoUserIdMap.get('demo-cco@acme.local')!;
   } else if (openCaseIndex < 50 && demoUserIdMap.has('demo-investigator@acme.local')) {
     createdById = demoUserIdMap.get('demo-investigator@acme.local')!;
   } else if (openCaseIndex < 75 && demoUserIdMap.has('demo-investigator2@acme.local')) {
     createdById = demoUserIdMap.get('demo-investigator2@acme.local')!;
   } else if (openCaseIndex < 100 && demoUserIdMap.has('demo-triage@acme.local')) {
     createdById = demoUserIdMap.get('demo-triage@acme.local')!;
   } else {
     createdById = pickRandom(userIds);
   }
   ```

Note: The exact implementation may vary based on the current structure. The key is that open cases get assigned to demo users via createdById field, since TaskAggregatorService queries by createdById.
  </action>
  <verify>
TypeScript compiles: `cd apps/backend && npx tsc --noEmit`
Grep for DEMO_CASE_OWNERS in case.seeder.ts confirms addition
  </verify>
  <done>
case.seeder.ts assigns open cases to demo users via createdById field
  </done>
</task>

<task type="auto">
  <name>Task 2: Add logging for demo case assignment</name>
  <files>apps/backend/prisma/seeders/case.seeder.ts</files>
  <action>
Add logging at end of seedCases to show how many cases were assigned to demo users:

```typescript
// After main case creation loop, before return
const demoOwnershipStats = {
  cco: caseBatch.filter(c => c.createdById === demoUserIdMap.get('demo-cco@acme.local')).length,
  inv1: caseBatch.filter(c => c.createdById === demoUserIdMap.get('demo-investigator@acme.local')).length,
  inv2: caseBatch.filter(c => c.createdById === demoUserIdMap.get('demo-investigator2@acme.local')).length,
  triage: caseBatch.filter(c => c.createdById === demoUserIdMap.get('demo-triage@acme.local')).length,
};
console.log(`  Demo user case ownership: CCO=${demoOwnershipStats.cco}, INV1=${demoOwnershipStats.inv1}, INV2=${demoOwnershipStats.inv2}, Triage=${demoOwnershipStats.triage}`);
```

This helps verify the fix is working during seed runs.
  </action>
  <verify>
Grep for "Demo user case ownership" in case.seeder.ts
TypeScript compiles
  </verify>
  <done>
case.seeder.ts logs demo user case assignment counts
  </done>
</task>

</tasks>

<verification>
1. `cd apps/backend && npx tsc --noEmit` - no TypeScript errors
2. `grep -n "DEMO_CASE_OWNERS" apps/backend/prisma/seeders/case.seeder.ts` - shows constant
3. `grep -n "demo-cco@acme.local" apps/backend/prisma/seeders/case.seeder.ts` - shows assignment logic
</verification>

<success_criteria>
- case.seeder.ts reserves 20+ open cases per demo investigator/CCO user
- createdById is set to demo user IDs for reserved cases
- TypeScript compiles without errors
- Logging shows demo user case assignment counts
</success_criteria>

<output>
After completion, create `.planning/phases/14.1-data-config-fixes/14.1-03-SUMMARY.md`
</output>
