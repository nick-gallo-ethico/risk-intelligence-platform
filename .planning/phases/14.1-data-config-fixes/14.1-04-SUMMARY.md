---
phase: 14.1-data-config-fixes
plan: 04
subsystem: database, testing
tags: [prisma, postgresql, seeder, demo-data, verification]

# Dependency graph
requires:
  - phase: 14.1-01
    provides: Notification seeder for demo users
  - phase: 14.1-02
    provides: Activity seeder wiring into orchestrator
  - phase: 14.1-03
    provides: Demo user case ownership for My Tasks
provides:
  - Verification that all Phase 14.1 seeders execute successfully
  - Fixed PostgreSQL table/column name mismatch in search vector update
  - Demo environment ready for sales demonstrations
affects: [phase-15, phase-16, sales-demos]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Raw SQL must use @@map table names (snake_case), not Prisma model names"

key-files:
  created: []
  modified:
    - apps/backend/prisma/seeders/case.seeder.ts

key-decisions:
  - "PostgreSQL table names follow @@map directives (cases, not Case)"
  - "Column names in raw SQL must match database schema (snake_case)"

patterns-established:
  - "Raw SQL: Always use @@map table names, not Prisma model names"

# Metrics
duration: 27min
completed: 2026-02-09
---

# Phase 14.1 Plan 04: Verification Checkpoint Summary

**Database seed completes successfully with 721 notifications, 35k audit entries, and 100 demo user cases - human verification pending**

## Performance

- **Duration:** 27 min
- **Started:** 2026-02-09T20:55:11Z
- **Completed:** 2026-02-09T21:21:49Z
- **Tasks:** 1/2 (Task 2 is human verification checkpoint)
- **Files modified:** 1

## Accomplishments

- Fixed PostgreSQL table name mismatch in case seeder search vector update
- Seed completes successfully with all Phase 14.1 data:
  - 721 notifications for 9 demo users
  - 35,094 audit log entries
  - Demo user case ownership: CCO=25, INV1=25, INV2=25, Triage=25
  - 4,500 cases with populated search vectors
  - 16 default saved views

## Seed Output Summary

```
Organization: Acme Corporation
Categories: 64
Locations: 52
Employees: 19,950
Demo Users: 9
RIUs: 5,000
Cases: 4,500
Investigations: 4,902
Audit Log Entries: 35,094
Notifications: 721
Saved Views: 16
```

## Task Commits

1. **Task 1: Re-run database seed** - `75a5576` (fix)
   - Fixed raw SQL to use 'cases' table name instead of 'Case'
   - Fixed column names to snake_case (reference_number, ai_summary, organization_id)

2. **Task 2: Human verification checkpoint** - PENDING
   - Awaiting manual testing of 5 verification items

## Files Modified

- `apps/backend/prisma/seeders/case.seeder.ts` - Fixed PostgreSQL table and column names in raw SQL UPDATE statement

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Fixed PostgreSQL table name in search vector update**

- **Found during:** Task 1 (Database seed)
- **Issue:** Raw SQL used `"Case"` but actual table is `cases` per @@map directive
- **Fix:** Changed `UPDATE "Case"` to `UPDATE cases` and all column names to snake_case
- **Files modified:** apps/backend/prisma/seeders/case.seeder.ts
- **Verification:** Seed completes successfully with search vectors populated
- **Committed in:** 75a5576 (Task 1 commit)

---

**Total deviations:** 1 auto-fixed (1 bug)
**Impact on plan:** Essential fix for seed to complete. No scope creep.

## Issues Encountered

- PostgreSQL connection was intermittently failing during seed runs
  - Resolution: Restarted PostgreSQL Docker container, waited for healthy status
  - Root cause: Likely connection pool exhaustion from rapid db push + seed sequences

## Human Verification Pending

The following 5 items require manual verification in the browser:

1. **Notifications Page**
   - Log in as demo-admin@acme.local (Password123!)
   - Click notification bell icon in top nav
   - Click "View All" to go to /notifications
   - Expected: Page shows list of notification records (not empty)

2. **Search Results**
   - Use global search bar in top nav
   - Type "harassment" or a case reference number
   - Expected: Search shows results (requires Elasticsearch running)

3. **Category Dropdowns**
   - Navigate to Dashboard -> Create Case (or /cases/new)
   - Expected: Category dropdown shows Harassment, Fraud, COI, Safety, etc.

4. **My Tasks**
   - Navigate to Dashboard (/)
   - Look at "My Tasks" widget
   - Expected: Shows 20+ tasks for demo-admin or demo-cco

5. **Audit Log**
   - Navigate to Settings -> Audit Log
   - Expected: Page loads (not "Failed to Load")
   - Shows activity entries for case creation, status changes, etc.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Phase 14.1 data fixes complete (pending verification)
- Demo environment ready for sales demonstrations once verified
- Ready for Phase 15 (Case Detail Page Overhaul) or Phase 16 (AI Integration Fix)

---

_Phase: 14.1-data-config-fixes_
_Plan: 04_
_Completed: 2026-02-09 (pending human verification)_
