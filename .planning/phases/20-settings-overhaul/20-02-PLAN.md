---
phase: 20
plan: 02
name: User Notification Preferences Page
wave: 1
autonomous: true
---

# Plan 20-02: User Notification Preferences Page

## Objective

Build the "Your Preferences > Notifications" page where users control per-event-type notifications (email and in-app), matching HubSpot's notification settings pattern.

## What Already Exists

- Backend `PreferencesController` at `/api/v1/notifications/preferences` with GET/PUT endpoints
- Backend `PreferenceService` with per-user, per-category preference storage
- `NotificationCategory` types: ASSIGNMENT, DEADLINE, STATUS_CHANGE, MENTION, COMMENT, APPROVAL, SLA_BREACH, ESCALATION, CASE_ACTIVITY, INTERVIEW, CAMPAIGN
- `NotificationChannel` types: EMAIL, IN_APP, DIGEST
- Org-level notification settings in `/settings/organization?tab=notifications`
- No user-level notification preferences UI exists

## Tasks

### Task 1: Create Notification Preferences API Client

**File:** `apps/frontend/src/services/notification-preferences.ts`

Create API client for notification preference endpoints:

- `getMyPreferences()` — GET /api/v1/notifications/preferences/me
- `updateMyPreferences(dto)` — PUT /api/v1/notifications/preferences/me
- `getOooStatus()` — GET /api/v1/notifications/preferences/me/ooo
- `updateOooStatus(dto)` — PUT /api/v1/notifications/preferences/me/ooo

### Task 2: Create Notification Preferences Types

**File:** `apps/frontend/src/types/notification-preferences.ts`

Define TypeScript types:

- `NotificationCategory` — enum of all categories
- `NotificationChannel` — EMAIL | IN_APP
- `CategoryPreference` — { category, email: boolean, inApp: boolean, digest: boolean }
- `NotificationPreferences` — { categories: CategoryPreference[], quietHours, ooo }
- `OutOfOffice` — { enabled, startDate, endDate, backupUserId }

### Task 3: Build Notification Preferences Page

**File:** `apps/frontend/src/app/(authenticated)/settings/notifications/page.tsx`

HubSpot-style notification preferences with sections:

1. **Communication Preferences** — Grid with categories as rows, channels (Email, In-App) as columns with toggle switches
   - Group categories: "Urgent" (Assignment, Deadline, SLA Breach, Escalation), "Activity" (Status Change, Comment, Case Activity), "Collaboration" (Mention, Approval, Interview, Campaign)
2. **Quiet Hours** — Start/end time pickers, timezone display
3. **Out of Office** — Toggle with date range and backup user selector
4. **Email Digest** — Enable/disable daily digest, preferred time

Each toggle saves immediately via mutation (no Save button needed — HubSpot pattern).

## Success Criteria

- [ ] `/settings/notifications` renders notification preference grid
- [ ] Toggle switches update backend preferences via API
- [ ] Categories grouped into Urgent/Activity/Collaboration sections
- [ ] Quiet hours configuration with time pickers
- [ ] Out of office toggle with date range and backup user
- [ ] TypeScript compiles without errors
