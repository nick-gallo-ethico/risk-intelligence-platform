---
phase: 08-portals
plan: 16
type: execute
wave: 6
depends_on: ["08-09", "08-07"]
files_modified:
  - apps/frontend/src/app/operator/qa-queue/page.tsx
  - apps/frontend/src/components/operator/qa-queue-list.tsx
  - apps/frontend/src/components/operator/qa-review-panel.tsx
  - apps/frontend/src/components/operator/qa-edit-form.tsx
  - apps/frontend/src/hooks/useQaQueue.ts
autonomous: true

must_haves:
  truths:
    - "QA queue shows items sorted by severity with high-risk first"
    - "QA reviewers can claim items for review"
    - "QA reviewers can edit summary, category, and severity"
    - "Released items proceed to case creation"
  artifacts:
    - path: "apps/frontend/src/app/operator/qa-queue/page.tsx"
      provides: "QA queue page route"
      exports: ["default"]
    - path: "apps/frontend/src/components/operator/qa-queue-list.tsx"
      provides: "Queue list with priority sorting"
      exports: ["QaQueueList"]
    - path: "apps/frontend/src/components/operator/qa-review-panel.tsx"
      provides: "Panel for reviewing and editing QA items"
      exports: ["QaReviewPanel"]
  key_links:
    - from: "QaQueueList"
      to: "/api/v1/operator/qa-queue"
      via: "fetch call"
      pattern: "fetch.*qa-queue"
    - from: "QaReviewPanel"
      to: "/api/v1/operator/qa-queue/:id/release"
      via: "POST request"
      pattern: "fetch.*release.*POST"
---

<objective>
Create the Operator Console QA Queue UI - the queue interface where QA reviewers process pending RIUs, make edits, and release them for case creation.

Purpose: QA reviewers need to efficiently process high-priority items and ensure quality before case creation.
Output: QA queue page with list, review panel, and edit capabilities.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-portals/08-CONTEXT.md
@.planning/phases/08-portals/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create QA queue hook and list component</name>
  <files>
    apps/frontend/src/hooks/useQaQueue.ts
    apps/frontend/src/components/operator/qa-queue-list.tsx
    apps/frontend/src/components/operator/qa-queue-item.tsx
  </files>
  <action>
Create src/hooks/useQaQueue.ts:
- useQaQueue(filters: QaQueueFilters) hook
- Fetches from /api/v1/operator/qa-queue with filters
- State: items, total, isLoading, error
- Methods:
  - refresh(): Reload queue
  - claim(riuId): POST to claim endpoint
  - getDetail(riuId): GET full item detail
- Auto-refresh every 30 seconds
- Returns: { items, total, isLoading, claim, refresh }

Create src/components/operator/qa-queue-item.tsx:
- Props: item (QaQueueItem), onClaim, isClaiming
- Card or row display:
  - Reference number
  - Category with icon
  - Severity badge (color-coded: red/orange/yellow/green)
  - Client name
  - Operator name
  - Time in queue
  - Flags: high_severity, keyword_trigger, client_priority
- Claim button (disabled if already claimed)
- "Being reviewed by [name]" if claimed by another reviewer
- Click row to view detail

Create src/components/operator/qa-queue-list.tsx:
- Props: onSelectItem
- Filter controls:
  - Client dropdown
  - Severity minimum slider
  - Operator dropdown
  - Date range picker
- Sort options: Severity (default), Queue time, Client
- Queue items list with QaQueueItem components
- Pagination controls
- Empty state: "No items in queue"
- Queue stats header: Total, High severity count, Avg wait time
  </action>
  <verify>npm run build -- --filter=frontend</verify>
  <done>QA queue list with filtering created</done>
</task>

<task type="auto">
  <name>Task 2: Create QA review panel with detail view</name>
  <files>
    apps/frontend/src/components/operator/qa-review-panel.tsx
    apps/frontend/src/components/operator/qa-item-detail.tsx
    apps/frontend/src/hooks/useQaItem.ts
  </files>
  <action>
Create src/hooks/useQaItem.ts:
- useQaItem(riuId: string) hook
- Fetches full detail from /api/v1/operator/qa-queue/:id
- State: item, isLoading, error
- Methods:
  - release(edits?: QaEditsDto): Release from QA
  - reject(reason: string): Reject to operator
  - abandon(): Abandon claim
- Returns: { item, isLoading, release, reject, abandon }

Create src/components/operator/qa-item-detail.tsx:
- Props: item (QaItemDetail)
- Sections:
  - Header: Reference number, client, operator, submitted time
  - Category and severity
  - Content: Full notes/description with formatting
  - Attachments: File list with preview capability
  - Subject: Subject person info if present
  - Caller: Anonymity tier, contact info if provided
  - Edit history: List of prior edits if any
- Read-only view of intake data
- Scrollable content area

Create src/components/operator/qa-review-panel.tsx:
- Props: riuId, onComplete, onClose
- Slide-over or modal panel
- Loads QaItemDetail for selected item
- Action bar at top:
  - "Release" button (primary)
  - "Reject" button (secondary)
  - "Edit" button (opens edit mode)
  - "Abandon" button (returns to queue)
- Keyboard shortcuts: R (release), E (edit), Esc (close)
- Confirmation dialog for release and reject
  </action>
  <verify>npm run build -- --filter=frontend</verify>
  <done>QA review panel with detail view created</done>
</task>

<task type="auto">
  <name>Task 3: Create QA edit form and queue page</name>
  <files>
    apps/frontend/src/components/operator/qa-edit-form.tsx
    apps/frontend/src/app/operator/qa-queue/page.tsx
  </files>
  <action>
Create src/components/operator/qa-edit-form.tsx:
- Props: item, onSave, onCancel
- Editable fields (per backend QaEditsDto):
  - Summary: Rich text editor
  - Category: Dropdown selector
  - Severity: Slider or select (1-5 scale)
  - Edit notes: Required text field (explain why changes made)
- Show original values alongside edited values
- Track what changed (highlight modified fields)
- Validate: edit notes required if any changes
- Save button applies edits via release endpoint
- Cancel returns to read-only view

Create src/app/operator/qa-queue/page.tsx:
- Require QA_REVIEWER or SYSTEM_ADMIN role
- Layout: List on left (40%), Detail panel on right (60%)
- QaQueueList on left with filters
- When item selected: show QaReviewPanel on right
- When no item selected: show placeholder with instructions
- Quick stats at top: queue size, your claims, released today
- Responsive: on mobile, list and detail are separate views

State management:
- selectedItemId: string | null
- isEditing: boolean
- Optimistic updates on claim/release
- Refetch queue after release/reject
  </action>
  <verify>npm run build -- --filter=frontend</verify>
  <done>QA edit form and queue page created</done>
</task>

</tasks>

<verification>
1. Run `npm run build -- --filter=frontend` to verify compilation
2. Verify queue list shows items sorted by severity
3. Verify claim prevents other reviewers from claiming
4. Verify edits are applied on release
5. Verify reject returns item to queue with reason
</verification>

<success_criteria>
- QA queue shows items sorted by severity (high first)
- Filters work for client, severity, operator
- Claiming locks item for reviewer
- Edit form allows summary, category, severity changes
- Release proceeds to case creation, reject returns to operator
</success_criteria>

<output>
After completion, create `.planning/phases/08-portals/08-16-SUMMARY.md`
</output>
