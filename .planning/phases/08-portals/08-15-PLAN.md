---
phase: 08-portals
plan: 15
type: execute
wave: 6
depends_on: ["08-09"]
files_modified:
  - apps/frontend/src/components/operator/intake-form.tsx
  - apps/frontend/src/components/operator/category-questions.tsx
  - apps/frontend/src/components/operator/subject-selector.tsx
  - apps/frontend/src/components/operator/ai-note-cleanup.tsx
  - apps/frontend/src/hooks/useIntake.ts
autonomous: true

must_haves:
  truths:
    - "Intake form captures RIU type, category, and content"
    - "Category-specific questions load dynamically"
    - "Subject can be searched via HRIS or entered manually"
    - "AI note cleanup transforms bullet points into narrative"
  artifacts:
    - path: "apps/frontend/src/components/operator/intake-form.tsx"
      provides: "Main hotline intake form"
      exports: ["IntakeForm"]
    - path: "apps/frontend/src/components/operator/ai-note-cleanup.tsx"
      provides: "AI-powered note cleanup component"
      exports: ["AiNoteCleanup"]
  key_links:
    - from: "IntakeForm"
      to: "/api/v1/operator/intake"
      via: "POST request"
      pattern: "fetch.*operator/intake.*POST"
    - from: "AiNoteCleanup"
      to: "AI skill service"
      via: "skill execution"
      pattern: "skills.*note-cleanup"
---

<objective>
Create the Operator Console intake form UI - the form operators use during calls to capture report details with AI-assisted note cleanup and HRIS subject lookup.

Purpose: Operators need to efficiently capture caller information during live calls with AI assistance.
Output: IntakeForm with category-specific questions, subject search, and AI note cleanup.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-portals/08-CONTEXT.md
@.planning/phases/05-ai-infrastructure/05-07-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create base intake form and RIU type selection</name>
  <files>
    apps/frontend/src/components/operator/intake-form.tsx
    apps/frontend/src/components/operator/riu-type-selector.tsx
    apps/frontend/src/hooks/useIntake.ts
  </files>
  <action>
Create src/hooks/useIntake.ts:
- useIntake(clientId: string) hook
- State: intakeData, isDirty, isSaving, saveError
- Methods:
  - updateField(field, value): Update single field
  - updateContent(content): Update notes content
  - save(): POST/PUT to /api/v1/operator/intake
  - submit(): POST to /api/v1/operator/intake/:id/submit-qa
  - reset(): Clear form for new intake
- Auto-save every 30 seconds when dirty
- Return: { intakeData, updateField, updateContent, save, submit, isSaving, saveError }

Create src/components/operator/riu-type-selector.tsx:
- Props: selected, onSelect, disabled
- Three large buttons:
  - REPORT: "Report" - Creates case for investigation
  - REQUEST_FOR_INFO: "Request for Information" - Non-issue inquiry
  - WRONG_NUMBER: "Wrong Number" - Log and end call
- Icon for each type
- Selection changes subsequent form fields

Create src/components/operator/intake-form.tsx:
- Props: clientProfile, onComplete
- Form sections:
  1. RIU Type (RiuTypeSelector)
  2. Category (for REPORT type only)
  3. Content/Notes (always visible, never hidden)
  4. Caller Info (anonymity tier, phone number optional)
  5. Subject (for REPORT type, optional)
  6. Urgency and attachments
- Content section always visible per CONTEXT.md: "notes always visible"
- Large text area for notes (min 200px height)
- Form persists via useIntake hook
- Submit button states: Save Draft, Submit to QA, or Save & Close (for WRONG_NUMBER)
  </action>
  <verify>npm run build -- --filter=frontend</verify>
  <done>Base intake form with RIU type selection created</done>
</task>

<task type="auto">
  <name>Task 2: Create category-specific questions and subject selector</name>
  <files>
    apps/frontend/src/components/operator/category-questions.tsx
    apps/frontend/src/components/operator/subject-selector.tsx
    apps/frontend/src/hooks/useHrisSearch.ts
  </files>
  <action>
Create src/hooks/useHrisSearch.ts:
- useHrisSearch(clientId: string) hook
- Methods:
  - search(query: string): Search HRIS for employees
  - Returns: results (HrisEmployee[]), isSearching
- Debounced search (300ms)
- Min 2 characters to search
- Returns: { search, results, isSearching, clearResults }

Create src/components/operator/category-questions.tsx:
- Props: categoryId, clientId, values, onChange
- Fetch category-specific questions from /api/v1/operator/clients/:id/categories/:categoryId/questions
- Render dynamic form fields based on question schema
- Question types: text, select, date, checkbox, radio
- Mark required questions
- Validation on blur
- Category-aware prompts (per CONTEXT.md: questions trigger on category selection)

Create src/components/operator/subject-selector.tsx:
- Props: clientId, selectedSubject, onSelect, onManualEntry
- Two modes: Search HRIS, Manual Entry
- HRIS Search mode:
  - Search input with typeahead
  - Results show: name, job title, department, manager
  - Click to select
  - Show org chart context for selected person
- Manual Entry mode:
  - First name, Last name fields
  - Job title (optional)
  - Department (optional)
  - Relationship to organization (dropdown)
- Toggle between modes
- "Subject Unknown" option
  </action>
  <verify>npm run build -- --filter=frontend</verify>
  <done>Category-specific questions and subject selector created</done>
</task>

<task type="auto">
  <name>Task 3: Create AI note cleanup component</name>
  <files>
    apps/frontend/src/components/operator/ai-note-cleanup.tsx
    apps/frontend/src/hooks/useAiNoteCleanup.ts
  </files>
  <action>
Create src/hooks/useAiNoteCleanup.ts:
- useAiNoteCleanup() hook
- Methods:
  - cleanup(content: string, style: 'light' | 'full'): Promise<CleanupResult>
- Calls /api/v1/ai/skills/note-cleanup endpoint (from Phase 5)
- Returns: { cleanup, cleanedContent, isProcessing, error }
- Handles rate limiting gracefully

Create src/components/operator/ai-note-cleanup.tsx:
- Props: originalContent, onApply
- Two modes per CONTEXT.md:
  1. Live suggestions: As operator types, show inline suggestions
  2. Post-call cleanup: Button to clean up after call ends

- Post-call cleanup mode (primary):
  - "Clean Up Notes" button below text area
  - Style selector: "Light" (preserves voice) vs "Full" (formal rewrite)
  - Show processing spinner when running
  - Display cleaned version in comparison view:
    - Side-by-side or diff view
    - Original on left, cleaned on right
    - Highlight changes
  - Actions: "Apply Changes", "Keep Original", "Edit Cleaned"
  - Apply inserts cleaned content, marks as AI-cleaned for audit

- Live suggestions mode (optional toggle):
  - Subtle underlines for grammar suggestions
  - Hover to see suggestion
  - Click to accept
  - Less intrusive during active call

- Error handling:
  - Rate limit exceeded: show message, disable button temporarily
  - AI unavailable: show message, allow manual editing
  </action>
  <verify>npm run build -- --filter=frontend</verify>
  <done>AI note cleanup component with comparison view created</done>
</task>

</tasks>

<verification>
1. Run `npm run build -- --filter=frontend` to verify compilation
2. Verify RIU type selection changes available fields
3. Verify category-specific questions load on category selection
4. Verify HRIS search returns and displays results
5. Verify AI cleanup shows comparison view
</verification>

<success_criteria>
- Intake form captures RIU type with appropriate fields
- Category selection triggers category-specific questions
- Subject can be searched via HRIS or entered manually
- AI note cleanup shows before/after comparison
- Notes area is always visible during intake
</success_criteria>

<output>
After completion, create `.planning/phases/08-portals/08-15-SUMMARY.md`
</output>
