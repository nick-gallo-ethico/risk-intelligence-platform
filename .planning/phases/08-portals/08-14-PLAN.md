---
phase: 08-portals
plan: 14
type: execute
wave: 5
depends_on: ["08-06"]
files_modified:
  - apps/frontend/src/app/employee/proxy-report/page.tsx
  - apps/frontend/src/components/employee/proxy-report-form.tsx
  - apps/frontend/src/components/employee/team-member-selector.tsx
  - apps/frontend/src/components/employee/proxy-confirmation.tsx
autonomous: true

must_haves:
  truths:
    - "Managers can select a team member for proxy reporting"
    - "Proxy reason is required and displayed"
    - "Employee contact info is auto-filled from HRIS"
    - "Access code goes to employee, not manager"
  artifacts:
    - path: "apps/frontend/src/app/employee/proxy-report/page.tsx"
      provides: "Proxy report submission page"
      exports: ["default"]
    - path: "apps/frontend/src/components/employee/proxy-report-form.tsx"
      provides: "Form for submitting proxy reports"
      exports: ["ProxyReportForm"]
  key_links:
    - from: "ProxyReportForm"
      to: "/api/v1/employee/proxy-report"
      via: "POST request"
      pattern: "fetch.*proxy-report.*POST"
    - from: "TeamMemberSelector"
      to: "/api/v1/employee/team"
      via: "fetch call"
      pattern: "fetch.*employee/team"
---

<objective>
Create the Manager Proxy Reporting UI - enabling managers to submit reports on behalf of their team members with proper attribution and audit trail.

Purpose: Managers need to facilitate reporting when employees cannot submit themselves (language barriers, technical issues, etc.).
Output: Proxy report page with team member selection, reason input, and confirmation with access code delivery info.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-portals/08-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create team member selector component</name>
  <files>
    apps/frontend/src/components/employee/team-member-selector.tsx
    apps/frontend/src/hooks/useTeamMembers.ts
  </files>
  <action>
Create src/hooks/useTeamMembers.ts:
- useTeamMembers() hook
- Fetches from /api/v1/employee/team
- Returns: teamMembers (TeamMember[]), isLoading, error
- Handles empty team (not a manager) gracefully

Create src/components/employee/team-member-selector.tsx:
- Props: selectedId, onSelect, error
- Search input with typeahead
- List of team members:
  - Avatar
  - Name
  - Job title
  - Department
  - Email
- Selected member highlighted
- Click to select
- Keyboard navigation support
- Empty state if no team members
- Error state if selection required

Member display:
- Show reporting chain depth if available (direct report, skip-level)
- Filter by name, email, job title
- Sort alphabetically or by department
  </action>
  <verify>npm run build -- --filter=frontend</verify>
  <done>Team member selector with search created</done>
</task>

<task type="auto">
  <name>Task 2: Create proxy report form</name>
  <files>
    apps/frontend/src/components/employee/proxy-report-form.tsx
    apps/frontend/src/components/employee/proxy-reason-selector.tsx
  </files>
  <action>
Create src/components/employee/proxy-reason-selector.tsx:
- Props: selected, onSelect, customReason, onCustomReasonChange
- Predefined reason options per backend enum:
  - REQUESTED_BY_EMPLOYEE: "Employee requested I submit on their behalf"
  - LANGUAGE_BARRIER: "Employee has language barriers"
  - TECHNICAL_DIFFICULTY: "Employee has technical difficulties"
  - OTHER: "Other reason" (requires custom text)
- Radio button group
- If OTHER selected, show text input for custom reason
- Required field validation

Create src/components/employee/proxy-report-form.tsx:
- Multi-step form:
  1. Select team member (TeamMemberSelector)
  2. Select proxy reason (ProxyReasonSelector)
  3. Report details (reuse ReportForm components from Ethics Portal)
  4. Review and confirm

- Step 1: Show selected employee's info preview after selection
- Step 2: Reason is required
- Step 3: Category selection, description, attachments
  - Auto-fill reporter demographics from selected employee
- Step 4: Review summary with:
  - Employee name (reporter)
  - Manager name (proxy submitter)
  - Reason for proxy
  - Report content summary
  - Notice: "Access code will be sent to [employee email]"

- Form validation:
  - Employee selection required
  - Reason required
  - Report content required
- Progress stepper at top
  </action>
  <verify>npm run build -- --filter=frontend</verify>
  <done>Proxy report form with steps created</done>
</task>

<task type="auto">
  <name>Task 3: Create proxy report page and confirmation</name>
  <files>
    apps/frontend/src/app/employee/proxy-report/page.tsx
    apps/frontend/src/components/employee/proxy-confirmation.tsx
  </files>
  <action>
Create src/components/employee/proxy-confirmation.tsx:
- Props: result (ProxySubmissionResult)
- Success message: "Report submitted on behalf of [employee name]"
- Reference number display
- Key notice: "The access code has been provided to [employee name] so they can check the status of their report."
- Manager does NOT see the access code (per CONTEXT.md)
- Actions:
  - "Submit another proxy report"
  - "Return to dashboard"
- Audit acknowledgment: "This proxy submission has been logged for compliance purposes"

Create src/app/employee/proxy-report/page.tsx:
- Require authentication
- Check if user is a manager (redirect if not)
- Breadcrumb: Dashboard > Submit Proxy Report
- Page title and instructions
- ProxyReportForm component
- Submit handler:
  - POST to /api/v1/employee/proxy-report
  - On success: show ProxyConfirmation
  - On error: show error message, allow retry

Access control:
- Only managers can access this page
- Redirect non-managers to dashboard with message

Add link to proxy report from:
- My Team tab (action dropdown on each member)
- Dashboard quick actions (for managers only)
  </action>
  <verify>npm run build -- --filter=frontend</verify>
  <done>Proxy report page with confirmation created</done>
</task>

</tasks>

<verification>
1. Run `npm run build -- --filter=frontend` to verify compilation
2. Verify only managers can access proxy report page
3. Verify team member selector shows correct team members
4. Verify proxy reason is required
5. Verify confirmation shows that access code went to employee
</verification>

<success_criteria>
- Only managers can access proxy report page
- Team member selector shows direct and indirect reports
- Proxy reason is required with predefined options
- Employee info auto-filled from selected team member
- Confirmation clearly states access code went to employee
</success_criteria>

<output>
After completion, create `.planning/phases/08-portals/08-14-SUMMARY.md`
</output>
