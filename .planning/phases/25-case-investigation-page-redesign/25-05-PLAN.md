---
phase: 25-case-investigation-page-redesign
plan: 05
type: execute
wave: 4
depends_on: ["25-04"]
files_modified:
  - apps/frontend/src/app/(authenticated)/investigations/[id]/page.tsx
  - apps/frontend/src/components/investigations/investigation-activity-timeline.tsx
  - apps/frontend/src/components/investigations/investigation-interviews-tab.tsx
  - apps/frontend/src/components/investigations/investigation-files-tab.tsx
autonomous: true

must_haves:
  truths:
    - "Activities tab is the default tab on investigation detail page"
    - "Activity timeline shows real activity data from API (not placeholder)"
    - "Activity timeline has search, upcoming section, and date grouping"
    - "Interviews tab shows real interview list (not placeholder)"
    - "Files tab shows real file list (not placeholder)"
  artifacts:
    - path: "apps/frontend/src/components/investigations/investigation-activity-timeline.tsx"
      provides: "Investigation activity timeline component"
      exports: ["InvestigationActivityTimeline"]
      min_lines: 100
    - path: "apps/frontend/src/components/investigations/investigation-interviews-tab.tsx"
      provides: "Interviews tab with interview list and actions"
      exports: ["InvestigationInterviewsTab"]
      min_lines: 100
    - path: "apps/frontend/src/components/investigations/investigation-files-tab.tsx"
      provides: "Files tab with evidence/file management"
      exports: ["InvestigationFilesTab"]
      min_lines: 80
  key_links:
    - from: "apps/frontend/src/components/investigations/investigation-activity-timeline.tsx"
      to: "/activity/INVESTIGATION/"
      via: "API fetch"
      pattern: "apiClient.get.*activity.*INVESTIGATION"
---

<objective>
Implement the investigation center column: make Activities the default tab with a real activity timeline component, and implement the Interviews and Files tabs that are currently placeholders.

Purpose: The activity timeline is the most-used view for investigators. Real implementations of Interviews and Files tabs complete the investigation detail experience.
Output: Investigation activity timeline, interviews tab, files tab - all with real data.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@docs/CASE-INVESTIGATION-PAGE-REDESIGN.md

# Key source files

@apps/frontend/src/app/(authenticated)/investigations/[id]/page.tsx
@apps/frontend/src/components/cases/case-activity-timeline.tsx
@apps/frontend/src/lib/date-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create investigation activity timeline and set Activities as default</name>
  <files>
    apps/frontend/src/components/investigations/investigation-activity-timeline.tsx
    apps/frontend/src/app/(authenticated)/investigations/[id]/page.tsx
  </files>
  <action>
1. Create InvestigationActivityTimeline component following the same pattern as CaseActivityTimeline:

```typescript
"use client";

import { useState, useEffect, useMemo, useCallback } from "react";
import { Search, Clock, Filter } from "lucide-react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Skeleton } from "@/components/ui/skeleton";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Tabs, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { ActivityEntry } from "@/components/cases/activity-entry";
import { groupActivitiesByDate } from "@/lib/date-utils";
import { apiClient } from "@/lib/api";
import type { Activity, ActivityFilterType } from "@/types/activity";

interface TimelineResponse {
  entries: Array<{
    id: string;
    entityType: string;
    entityId: string;
    action: string;
    actionDescription: string;
    actorUserId: string | null;
    actorName: string | null;
    createdAt: string;
    isRelatedEntity: boolean;
    changes?: Record<string, { old: unknown; new: unknown }> | null;
    context?: Record<string, unknown> | null;
  }>;
  total: number;
  hasMore: boolean;
}

interface InvestigationActivityTimelineProps {
  investigationId: string;
  isLoading?: boolean;
}

const FILTER_TYPES: { id: ActivityFilterType; label: string }[] = [
  { id: "all", label: "All" },
  { id: "notes", label: "Notes" },
  { id: "status", label: "Status" },
  { id: "files", label: "Evidence" },
];

export function InvestigationActivityTimeline({
  investigationId,
  isLoading: parentLoading,
}: InvestigationActivityTimelineProps) {
  const [activities, setActivities] = useState<Activity[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [searchQuery, setSearchQuery] = useState("");
  const [activeFilter, setActiveFilter] = useState<ActivityFilterType>("all");
  const [userFilter, setUserFilter] = useState<string>("all");

  // Fetch activities
  const fetchActivities = useCallback(async () => {
    if (!investigationId) return;

    setLoading(true);
    setError(null);

    try {
      const response = await apiClient.get<TimelineResponse>(
        `/activity/INVESTIGATION/${investigationId}?includeRelated=true&limit=100`
      );

      const transformed: Activity[] = response.entries.map((entry) => ({
        id: entry.id,
        entityType: entry.entityType as Activity["entityType"],
        entityId: entry.entityId,
        action: entry.action as Activity["action"],
        actionDescription: entry.actionDescription,
        changes: entry.changes || null,
        actorUserId: entry.actorUserId,
        actorType: entry.actorUserId ? "USER" : "SYSTEM",
        actorName: entry.actorName,
        createdAt: entry.createdAt,
        context: entry.context,
      }));

      setActivities(transformed);
    } catch (err) {
      console.error("Failed to fetch investigation activities:", err);
      setError("Failed to load activities");
      setActivities([]);
    } finally {
      setLoading(false);
    }
  }, [investigationId]);

  useEffect(() => {
    fetchActivities();
  }, [fetchActivities]);

  // Upcoming items (tasks, SLA deadlines)
  const upcomingItems = useMemo(() => {
    const now = new Date();
    return activities
      .filter((a) => {
        if (a.action === "task_created" || a.action === "task_assigned") {
          const dueDate = a.context?.dueDate;
          if (dueDate && new Date(dueDate as string) > now) return true;
        }
        if (a.action === "interview_scheduled") {
          const scheduledDate = a.context?.scheduledAt;
          if (scheduledDate && new Date(scheduledDate as string) > now) return true;
        }
        return false;
      })
      .sort((a, b) => {
        const dateA = a.context?.dueDate || a.context?.scheduledAt || a.createdAt;
        const dateB = b.context?.dueDate || b.context?.scheduledAt || b.createdAt;
        return new Date(dateA as string).getTime() - new Date(dateB as string).getTime();
      });
  }, [activities]);

  // Unique users for filter
  const uniqueUsers = useMemo(() => {
    const users = new Map<string, string>();
    activities.forEach((a) => {
      if (a.actorUserId && a.actorName) {
        users.set(a.actorUserId, a.actorName);
      }
    });
    return Array.from(users.entries()).map(([id, name]) => ({ id, name }));
  }, [activities]);

  // Filtered activities
  const filteredActivities = useMemo(() => {
    let filtered = activities;

    // Type filter
    if (activeFilter !== "all") {
      filtered = filtered.filter((a) => {
        switch (activeFilter) {
          case "notes":
            return a.action === "commented" || a.action === "note_added";
          case "status":
            return a.action === "status_changed";
          case "files":
            return a.action === "file_uploaded" || a.action === "evidence_added";
          default:
            return true;
        }
      });
    }

    // Search filter
    if (searchQuery.trim()) {
      const query = searchQuery.toLowerCase();
      filtered = filtered.filter(
        (a) =>
          a.actionDescription?.toLowerCase().includes(query) ||
          a.actorName?.toLowerCase().includes(query)
      );
    }

    // User filter
    if (userFilter !== "all") {
      filtered = filtered.filter((a) => a.actorUserId === userFilter);
    }

    return filtered;
  }, [activities, activeFilter, searchQuery, userFilter]);

  // Grouped by date
  const groupedActivities = useMemo(
    () => groupActivitiesByDate(filteredActivities),
    [filteredActivities]
  );

  if (parentLoading || loading) {
    return (
      <div className="p-6 space-y-4">
        <Skeleton className="h-10 w-full" />
        <Skeleton className="h-8 w-3/4" />
        <Skeleton className="h-24 w-full" />
        <Skeleton className="h-24 w-full" />
      </div>
    );
  }

  if (error) {
    return (
      <div className="p-6 text-center">
        <p className="text-red-600 mb-4">{error}</p>
        <Button variant="outline" onClick={fetchActivities}>
          Retry
        </Button>
      </div>
    );
  }

  return (
    <div className="h-full flex flex-col">
      {/* Search bar */}
      <div className="p-4 border-b">
        <div className="relative">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
          <Input
            placeholder="Search activities..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="pl-9"
          />
        </div>
      </div>

      {/* Filters */}
      <div className="px-4 py-2 border-b flex items-center justify-between gap-4">
        <Tabs value={activeFilter} onValueChange={(v) => setActiveFilter(v as ActivityFilterType)}>
          <TabsList className="h-8">
            {FILTER_TYPES.map((f) => (
              <TabsTrigger key={f.id} value={f.id} className="text-xs px-3 h-7">
                {f.label}
              </TabsTrigger>
            ))}
          </TabsList>
        </Tabs>

        <Select value={userFilter} onValueChange={setUserFilter}>
          <SelectTrigger className="w-[150px] h-8">
            <SelectValue placeholder="All users" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">All users</SelectItem>
            {uniqueUsers.map((user) => (
              <SelectItem key={user.id} value={user.id}>
                {user.name}
              </SelectItem>
            ))}
          </SelectContent>
        </Select>
      </div>

      {/* Filter count */}
      <div className="px-4 py-1 text-xs text-gray-500 border-b">
        Showing {filteredActivities.length} of {activities.length} activities
      </div>

      {/* Timeline content */}
      <div className="flex-1 overflow-y-auto p-4">
        {/* Upcoming section */}
        {upcomingItems.length > 0 && (
          <div className="border-b pb-4 mb-4">
            <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3 flex items-center gap-2">
              <Clock className="h-4 w-4" />
              Upcoming
            </h3>
            <div className="space-y-2">
              {upcomingItems.map((item) => (
                <ActivityEntry key={`upcoming-${item.id}`} activity={item} />
              ))}
            </div>
          </div>
        )}

        {/* Date-grouped history */}
        {groupedActivities.length === 0 ? (
          <div className="text-center py-12">
            <p className="text-gray-500">No activities found</p>
          </div>
        ) : (
          groupedActivities.map((group) => (
            <div key={group.label} className="mb-6">
              <h4 className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3">
                {group.label}
              </h4>
              <div className="space-y-3">
                {group.items.map((activity) => (
                  <ActivityEntry key={activity.id} activity={activity} />
                ))}
              </div>
            </div>
          ))
        )}
      </div>
    </div>
  );
}
```

2. In the investigation page.tsx, update:

a. Change default tab from "checklist" to "activity":

```typescript
const [activeTab, setActiveTab] = useState("activity");
```

b. Update the TABS array order:

```typescript
const TABS = [
  "activity",
  "checklist",
  "notes",
  "interviews",
  "files",
  "findings",
];
```

c. Replace the activity tab placeholder with InvestigationActivityTimeline:

```tsx
<TabsContent value="activity" className="mt-0 h-full">
  <InvestigationActivityTimeline investigationId={investigation.id} />
</TabsContent>
```

d. Import the new component:

```typescript
import { InvestigationActivityTimeline } from "@/components/investigations/investigation-activity-timeline";
```

  </action>
  <verify>
    - Activities tab is selected by default when opening investigation
    - Activity timeline fetches real data from /activity/INVESTIGATION/{id}
    - Timeline has search bar, filter tabs, user dropdown
    - Timeline shows "Upcoming" section for scheduled interviews/tasks
    - Timeline shows date-grouped activity history
    - Filter count shows "Showing X of Y activities"
  </verify>
  <done>Investigation activity timeline implemented with search, filters, and date grouping</done>
</task>

<task type="auto">
  <name>Task 2: Implement Interviews tab</name>
  <files>apps/frontend/src/components/investigations/investigation-interviews-tab.tsx</files>
  <action>
Replace the interviews placeholder with a real implementation:

```typescript
"use client";

import { useState, useEffect, useCallback } from "react";
import {
  Plus,
  Calendar,
  Clock,
  User,
  FileText,
  MoreHorizontal,
  CheckCircle2,
  XCircle,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Card, CardContent } from "@/components/ui/card";
import { Skeleton } from "@/components/ui/skeleton";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { apiClient } from "@/lib/api";

interface Interview {
  id: string;
  investigationId: string;
  intervieweeType: "PERSON" | "EXTERNAL" | "ANONYMOUS";
  intervieweeName: string | null;
  intervieweeEmail: string | null;
  scheduledAt: string | null;
  completedAt: string | null;
  duration: number | null; // minutes
  status: "SCHEDULED" | "IN_PROGRESS" | "COMPLETED" | "CANCELLED";
  conductedById: string | null;
  conductedBy?: {
    firstName: string;
    lastName: string;
  };
  notes: string | null;
  hasTranscript: boolean;
  createdAt: string;
}

interface InvestigationInterviewsTabProps {
  investigationId: string;
  onScheduleInterview?: () => void;
}

const STATUS_COLORS: Record<string, string> = {
  SCHEDULED: "bg-blue-100 text-blue-800",
  IN_PROGRESS: "bg-yellow-100 text-yellow-800",
  COMPLETED: "bg-green-100 text-green-800",
  CANCELLED: "bg-gray-100 text-gray-800",
};

const INTERVIEWEE_TYPE_LABELS: Record<string, string> = {
  PERSON: "Person",
  EXTERNAL: "External",
  ANONYMOUS: "Anonymous",
};

export function InvestigationInterviewsTab({
  investigationId,
  onScheduleInterview,
}: InvestigationInterviewsTabProps) {
  const [interviews, setInterviews] = useState<Interview[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  const fetchInterviews = useCallback(async () => {
    setLoading(true);
    setError(null);

    try {
      const response = await apiClient.get<Interview[]>(
        `/investigations/${investigationId}/interviews`
      );
      setInterviews(response || []);
    } catch (err) {
      console.error("Failed to fetch interviews:", err);
      // Graceful fallback - endpoint might not exist yet
      setInterviews([]);
    } finally {
      setLoading(false);
    }
  }, [investigationId]);

  useEffect(() => {
    fetchInterviews();
  }, [fetchInterviews]);

  if (loading) {
    return (
      <div className="p-6 space-y-4">
        <div className="flex justify-end">
          <Skeleton className="h-9 w-40" />
        </div>
        <Skeleton className="h-24 w-full" />
        <Skeleton className="h-24 w-full" />
      </div>
    );
  }

  return (
    <div className="p-6">
      {/* Header */}
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-lg font-semibold text-gray-900">Interviews</h2>
        <Button onClick={onScheduleInterview}>
          <Plus className="h-4 w-4 mr-2" />
          Schedule Interview
        </Button>
      </div>

      {/* Interview list */}
      {interviews.length === 0 ? (
        <div className="text-center py-12 border rounded-lg bg-gray-50">
          <User className="h-12 w-12 mx-auto text-gray-400" />
          <h3 className="mt-4 text-lg font-medium text-gray-900">
            No interviews yet
          </h3>
          <p className="mt-1 text-sm text-gray-500">
            Schedule interviews with subjects, witnesses, or other parties.
          </p>
          <Button className="mt-4" onClick={onScheduleInterview}>
            <Plus className="h-4 w-4 mr-2" />
            Schedule First Interview
          </Button>
        </div>
      ) : (
        <div className="space-y-4">
          {interviews.map((interview) => (
            <Card key={interview.id} className="shadow-sm">
              <CardContent className="p-4">
                <div className="flex items-start justify-between">
                  {/* Left: Interview info */}
                  <div className="flex items-start gap-3">
                    <div className="p-2 bg-gray-100 rounded-full">
                      <User className="h-5 w-5 text-gray-600" />
                    </div>
                    <div>
                      <div className="flex items-center gap-2">
                        <span className="font-medium text-gray-900">
                          {interview.intervieweeName || "Unknown"}
                        </span>
                        <Badge variant="outline" className="text-xs">
                          {INTERVIEWEE_TYPE_LABELS[interview.intervieweeType]}
                        </Badge>
                      </div>

                      {/* Schedule/Completion info */}
                      <div className="mt-1 flex items-center gap-4 text-sm text-gray-500">
                        {interview.status === "COMPLETED" ? (
                          <>
                            <span className="flex items-center gap-1">
                              <CheckCircle2 className="h-3 w-3 text-green-500" />
                              Completed{" "}
                              {new Date(interview.completedAt!).toLocaleDateString()}
                            </span>
                            {interview.duration && (
                              <span className="flex items-center gap-1">
                                <Clock className="h-3 w-3" />
                                {interview.duration} min
                              </span>
                            )}
                          </>
                        ) : interview.status === "CANCELLED" ? (
                          <span className="flex items-center gap-1">
                            <XCircle className="h-3 w-3 text-gray-400" />
                            Cancelled
                          </span>
                        ) : (
                          interview.scheduledAt && (
                            <span className="flex items-center gap-1">
                              <Calendar className="h-3 w-3" />
                              Scheduled:{" "}
                              {new Date(interview.scheduledAt).toLocaleDateString(
                                "en-US",
                                {
                                  month: "short",
                                  day: "numeric",
                                  year: "numeric",
                                  hour: "numeric",
                                  minute: "2-digit",
                                }
                              )}
                            </span>
                          )
                        )}
                      </div>

                      {/* Status badge */}
                      <Badge
                        className={`mt-2 ${STATUS_COLORS[interview.status]}`}
                      >
                        {interview.status}
                      </Badge>

                      {/* Conductor info */}
                      {interview.conductedBy && (
                        <p className="mt-2 text-xs text-gray-500">
                          Conducted by: {interview.conductedBy.firstName}{" "}
                          {interview.conductedBy.lastName}
                        </p>
                      )}

                      {/* Notes excerpt */}
                      {interview.notes && interview.status === "COMPLETED" && (
                        <p className="mt-2 text-sm text-gray-600 line-clamp-2 italic">
                          &ldquo;{interview.notes}&rdquo;
                        </p>
                      )}
                    </div>
                  </div>

                  {/* Right: Actions */}
                  <div className="flex items-center gap-2">
                    {interview.hasTranscript && (
                      <Button variant="outline" size="sm">
                        <FileText className="h-4 w-4 mr-1" />
                        Transcript
                      </Button>
                    )}
                    <Button variant="outline" size="sm">
                      View Details
                    </Button>
                    <DropdownMenu>
                      <DropdownMenuTrigger asChild>
                        <Button variant="ghost" size="sm" className="h-8 w-8 p-0">
                          <MoreHorizontal className="h-4 w-4" />
                        </Button>
                      </DropdownMenuTrigger>
                      <DropdownMenuContent align="end">
                        <DropdownMenuItem>Edit</DropdownMenuItem>
                        {interview.status === "SCHEDULED" && (
                          <DropdownMenuItem>Reschedule</DropdownMenuItem>
                        )}
                        {interview.status === "SCHEDULED" && (
                          <DropdownMenuItem className="text-red-600">
                            Cancel
                          </DropdownMenuItem>
                        )}
                      </DropdownMenuContent>
                    </DropdownMenu>
                  </div>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      )}
    </div>
  );
}
```

In the investigation page, replace the interviews placeholder tab content:

```tsx
<TabsContent value="interviews" className="mt-6">
  <InvestigationInterviewsTab
    investigationId={investigation.id}
    onScheduleInterview={() => setInterviewModalOpen(true)}
  />
</TabsContent>
```

Import the component at the top.
</action>
<verify> - Interviews tab shows real interview data (or empty state if none) - Each interview card shows interviewee name, type badge, status badge - Scheduled interviews show date/time - Completed interviews show completion date and duration - "View Transcript" button appears for interviews with transcripts - "Schedule Interview" button available in header and empty state
</verify>
<done>Interviews tab implemented with interview list and actions</done>
</task>

<task type="auto">
  <name>Task 3: Implement Files tab</name>
  <files>apps/frontend/src/components/investigations/investigation-files-tab.tsx</files>
  <action>
Replace the files placeholder with a real implementation:

```typescript
"use client";

import { useState, useEffect, useCallback } from "react";
import {
  Plus,
  Upload,
  File,
  FileText,
  FileImage,
  FileVideo,
  Download,
  Eye,
  Trash2,
  MoreHorizontal,
  Grid,
  List,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Card, CardContent } from "@/components/ui/card";
import { Skeleton } from "@/components/ui/skeleton";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { cn } from "@/lib/utils";
import { apiClient } from "@/lib/api";

interface InvestigationFile {
  id: string;
  filename: string;
  originalFilename: string;
  mimeType: string;
  size: number; // bytes
  fileType: "EVIDENCE" | "SUPPORTING_DOCUMENT" | "TRANSCRIPT" | "PHOTO" | "OTHER";
  uploadedById: string;
  uploadedBy?: {
    firstName: string;
    lastName: string;
  };
  createdAt: string;
  url?: string;
}

interface InvestigationFilesTabProps {
  investigationId: string;
  onUploadFile?: () => void;
}

const FILE_TYPE_COLORS: Record<string, string> = {
  EVIDENCE: "bg-red-100 text-red-800",
  SUPPORTING_DOCUMENT: "bg-blue-100 text-blue-800",
  TRANSCRIPT: "bg-purple-100 text-purple-800",
  PHOTO: "bg-green-100 text-green-800",
  OTHER: "bg-gray-100 text-gray-800",
};

function getFileIcon(mimeType: string) {
  if (mimeType.startsWith("image/")) return FileImage;
  if (mimeType.startsWith("video/")) return FileVideo;
  if (mimeType.includes("pdf")) return FileText;
  return File;
}

function formatFileSize(bytes: number): string {
  if (bytes < 1024) return `${bytes} B`;
  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
}

export function InvestigationFilesTab({
  investigationId,
  onUploadFile,
}: InvestigationFilesTabProps) {
  const [files, setFiles] = useState<InvestigationFile[]>([]);
  const [loading, setLoading] = useState(true);
  const [viewMode, setViewMode] = useState<"grid" | "list">("list");

  const fetchFiles = useCallback(async () => {
    setLoading(true);

    try {
      const response = await apiClient.get<InvestigationFile[]>(
        `/investigations/${investigationId}/files`
      );
      setFiles(response || []);
    } catch (err) {
      console.error("Failed to fetch files:", err);
      // Graceful fallback
      setFiles([]);
    } finally {
      setLoading(false);
    }
  }, [investigationId]);

  useEffect(() => {
    fetchFiles();
  }, [fetchFiles]);

  const handleDownload = (file: InvestigationFile) => {
    if (file.url) {
      window.open(file.url, "_blank");
    }
  };

  if (loading) {
    return (
      <div className="p-6 space-y-4">
        <div className="flex justify-between">
          <Skeleton className="h-9 w-40" />
          <Skeleton className="h-9 w-24" />
        </div>
        <Skeleton className="h-48 w-full" />
      </div>
    );
  }

  return (
    <div className="p-6">
      {/* Header */}
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-lg font-semibold text-gray-900">
          Files & Evidence
          {files.length > 0 && (
            <span className="ml-2 text-sm font-normal text-gray-500">
              ({files.length})
            </span>
          )}
        </h2>
        <div className="flex items-center gap-2">
          {/* View toggle */}
          <div className="flex items-center border rounded-md">
            <Button
              variant={viewMode === "list" ? "secondary" : "ghost"}
              size="sm"
              className="h-8 px-2 rounded-r-none"
              onClick={() => setViewMode("list")}
            >
              <List className="h-4 w-4" />
            </Button>
            <Button
              variant={viewMode === "grid" ? "secondary" : "ghost"}
              size="sm"
              className="h-8 px-2 rounded-l-none"
              onClick={() => setViewMode("grid")}
            >
              <Grid className="h-4 w-4" />
            </Button>
          </div>
          <Button onClick={onUploadFile}>
            <Upload className="h-4 w-4 mr-2" />
            Upload File
          </Button>
        </div>
      </div>

      {/* Files content */}
      {files.length === 0 ? (
        <div className="text-center py-12 border rounded-lg bg-gray-50 border-dashed">
          <File className="h-12 w-12 mx-auto text-gray-400" />
          <h3 className="mt-4 text-lg font-medium text-gray-900">
            No files uploaded
          </h3>
          <p className="mt-1 text-sm text-gray-500">
            Upload evidence, documents, or transcripts for this investigation.
          </p>
          <Button className="mt-4" onClick={onUploadFile}>
            <Upload className="h-4 w-4 mr-2" />
            Upload First File
          </Button>
        </div>
      ) : viewMode === "grid" ? (
        /* Grid view */
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          {files.map((file) => {
            const Icon = getFileIcon(file.mimeType);
            return (
              <Card key={file.id} className="shadow-sm hover:shadow-md transition-shadow">
                <CardContent className="p-4">
                  <div className="flex flex-col items-center text-center">
                    <div className="p-3 bg-gray-100 rounded-lg mb-3">
                      <Icon className="h-8 w-8 text-gray-600" />
                    </div>
                    <p className="font-medium text-sm text-gray-900 truncate w-full">
                      {file.originalFilename}
                    </p>
                    <p className="text-xs text-gray-500 mt-1">
                      {formatFileSize(file.size)}
                    </p>
                    <Badge
                      className={`mt-2 ${FILE_TYPE_COLORS[file.fileType]}`}
                    >
                      {file.fileType.replace("_", " ")}
                    </Badge>
                    <div className="flex items-center gap-1 mt-3">
                      <Button
                        variant="ghost"
                        size="sm"
                        className="h-8 w-8 p-0"
                        onClick={() => handleDownload(file)}
                      >
                        <Download className="h-4 w-4" />
                      </Button>
                      <Button variant="ghost" size="sm" className="h-8 w-8 p-0">
                        <Eye className="h-4 w-4" />
                      </Button>
                    </div>
                  </div>
                </CardContent>
              </Card>
            );
          })}
        </div>
      ) : (
        /* List view */
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>Name</TableHead>
              <TableHead>Type</TableHead>
              <TableHead>Size</TableHead>
              <TableHead>Uploaded By</TableHead>
              <TableHead>Date</TableHead>
              <TableHead className="w-[100px]">Actions</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {files.map((file) => {
              const Icon = getFileIcon(file.mimeType);
              return (
                <TableRow key={file.id}>
                  <TableCell>
                    <div className="flex items-center gap-2">
                      <Icon className="h-4 w-4 text-gray-400" />
                      <span className="font-medium">{file.originalFilename}</span>
                    </div>
                  </TableCell>
                  <TableCell>
                    <Badge className={FILE_TYPE_COLORS[file.fileType]}>
                      {file.fileType.replace("_", " ")}
                    </Badge>
                  </TableCell>
                  <TableCell className="text-gray-500">
                    {formatFileSize(file.size)}
                  </TableCell>
                  <TableCell className="text-gray-500">
                    {file.uploadedBy
                      ? `${file.uploadedBy.firstName} ${file.uploadedBy.lastName}`
                      : "Unknown"}
                  </TableCell>
                  <TableCell className="text-gray-500">
                    {new Date(file.createdAt).toLocaleDateString()}
                  </TableCell>
                  <TableCell>
                    <div className="flex items-center gap-1">
                      <Button
                        variant="ghost"
                        size="sm"
                        className="h-8 w-8 p-0"
                        onClick={() => handleDownload(file)}
                      >
                        <Download className="h-4 w-4" />
                      </Button>
                      <DropdownMenu>
                        <DropdownMenuTrigger asChild>
                          <Button variant="ghost" size="sm" className="h-8 w-8 p-0">
                            <MoreHorizontal className="h-4 w-4" />
                          </Button>
                        </DropdownMenuTrigger>
                        <DropdownMenuContent align="end">
                          <DropdownMenuItem>Preview</DropdownMenuItem>
                          <DropdownMenuItem>Rename</DropdownMenuItem>
                          <DropdownMenuItem className="text-red-600">
                            Delete
                          </DropdownMenuItem>
                        </DropdownMenuContent>
                      </DropdownMenu>
                    </div>
                  </TableCell>
                </TableRow>
              );
            })}
          </TableBody>
        </Table>
      )}
    </div>
  );
}
```

In the investigation page, replace the files placeholder tab content:

```tsx
<TabsContent value="files" className="mt-6">
  <InvestigationFilesTab
    investigationId={investigation.id}
    onUploadFile={() => setEvidenceModalOpen(true)}
  />
</TabsContent>
```

Import the component at the top.
</action>
<verify> - Files tab shows real file data (or empty state if none) - List/Grid view toggle works - Files show icon based on mime type - Files show type badge (Evidence, Supporting Document, etc.) - Files show size in human-readable format - Download and action buttons functional - "Upload File" button available in header and empty state
</verify>
<done>Files tab implemented with grid/list views and file management</done>
</task>

</tasks>

<verification>
1. Activities tab is default when opening investigation detail
2. Activity timeline shows real data from /activity/INVESTIGATION/{id}
3. Activity timeline has search, filter tabs, user dropdown, filter count
4. Activity timeline has "Upcoming" section for scheduled items
5. Activity timeline groups by descriptive date labels
6. Interviews tab shows real interview list or empty state
7. Interviews show status badges, scheduled dates, durations
8. Files tab shows real files or empty state
9. Files tab has grid/list view toggle
10. All tabs integrated into the investigation page
11. TypeScript compilation passes: `npm run typecheck`
</verification>

<success_criteria>

- Activities is the default investigation tab
- Activity timeline matches case activity timeline features
- Interviews tab is functional (not placeholder)
- Files tab is functional with grid/list toggle (not placeholder)
- Empty states provide clear guidance
- API gracefully handles missing endpoints
  </success_criteria>

<output>
After completion, create `.planning/phases/25-case-investigation-page-redesign/25-05-SUMMARY.md`
</output>
