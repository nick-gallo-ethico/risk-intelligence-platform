---
phase: 25-case-investigation-page-redesign
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/src/components/shared/quick-action-grid.tsx
  - apps/frontend/src/components/cases/action-button-row.tsx
  - apps/frontend/src/components/cases/log-call-modal.tsx
  - apps/frontend/src/components/cases/case-properties-panel.tsx
autonomous: true

must_haves:
  truths:
    - "Quick action buttons display as horizontal icon+label grid (not vertical stack)"
    - "Grid shows icons on top with labels beneath in 4-column layout"
    - "Call action type exists and opens LogCallModal"
    - "Properties panel sections have gear icons and chevron toggles"
  artifacts:
    - path: "apps/frontend/src/components/shared/quick-action-grid.tsx"
      provides: "Reusable horizontal icon+label grid component"
      exports: ["QuickActionGrid"]
      min_lines: 40
    - path: "apps/frontend/src/components/cases/log-call-modal.tsx"
      provides: "Modal for logging phone calls"
      exports: ["LogCallModal"]
      min_lines: 80
    - path: "apps/frontend/src/components/cases/action-button-row.tsx"
      provides: "Case quick actions using QuickActionGrid"
      contains: "QuickActionGrid"
  key_links:
    - from: "apps/frontend/src/components/cases/action-button-row.tsx"
      to: "apps/frontend/src/components/shared/quick-action-grid.tsx"
      via: "import"
      pattern: "import.*QuickActionGrid"
---

<objective>
Convert quick action buttons from vertical ghost stack to horizontal icon+label grid layout matching HubSpot pattern, create reusable QuickActionGrid component, add LogCallModal, and polish properties panel with gear icons and chevron toggles.

Purpose: HubSpot's quick actions are a compact icon grid that takes less vertical space and provides visual scanning. The grid layout supports more actions without scrolling.
Output: Shared QuickActionGrid component, refactored ActionButtonRow, new LogCallModal, enhanced CasePropertiesPanel.
</objective>

<execution_context>
@C:\Users\cu0718\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cu0718\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@docs/CASE-INVESTIGATION-PAGE-REDESIGN.md

# Key source files

@apps/frontend/src/components/cases/action-button-row.tsx
@apps/frontend/src/components/cases/case-properties-panel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared QuickActionGrid component</name>
  <files>apps/frontend/src/components/shared/quick-action-grid.tsx</files>
  <action>
Create a new shared component for horizontal icon+label grid layout. This will be reused by both case and investigation pages.

```typescript
"use client";

import { LucideIcon, MoreHorizontal } from "lucide-react";
import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { cn } from "@/lib/utils";

export interface QuickAction {
  id: string;
  label: string;
  icon: LucideIcon;
  onClick: () => void;
  /** If true, action appears in "More" overflow menu instead of grid */
  overflow?: boolean;
}

interface QuickActionGridProps {
  actions: QuickAction[];
  /** Number of columns in the grid (default 4) */
  columns?: 3 | 4;
  className?: string;
}

/**
 * HubSpot-style horizontal icon+label grid for quick actions.
 *
 * Displays main actions as icon buttons with labels beneath,
 * and overflow actions in a "More" dropdown.
 */
export function QuickActionGrid({
  actions,
  columns = 4,
  className,
}: QuickActionGridProps) {
  const mainActions = actions.filter((a) => !a.overflow);
  const overflowActions = actions.filter((a) => a.overflow);

  return (
    <div className={cn("p-4", className)}>
      <h3 className="text-xs font-medium text-gray-500 uppercase tracking-wide mb-3">
        Quick Actions
      </h3>
      <div
        className={cn(
          "grid gap-2",
          columns === 3 ? "grid-cols-3" : "grid-cols-4"
        )}
      >
        {mainActions.map((action) => (
          <Button
            key={action.id}
            variant="outline"
            className="flex flex-col items-center justify-center h-16 p-2 gap-1 hover:bg-gray-50"
            onClick={action.onClick}
          >
            <action.icon className="h-5 w-5 text-gray-600" />
            <span className="text-xs text-gray-700 font-medium">
              {action.label}
            </span>
          </Button>
        ))}

        {/* More dropdown for overflow actions */}
        {overflowActions.length > 0 && (
          <DropdownMenu>
            <DropdownMenuTrigger asChild>
              <Button
                variant="outline"
                className="flex flex-col items-center justify-center h-16 p-2 gap-1 hover:bg-gray-50"
              >
                <MoreHorizontal className="h-5 w-5 text-gray-600" />
                <span className="text-xs text-gray-700 font-medium">More</span>
              </Button>
            </DropdownMenuTrigger>
            <DropdownMenuContent align="end" className="w-48">
              {overflowActions.map((action) => (
                <DropdownMenuItem
                  key={action.id}
                  onClick={action.onClick}
                  className="flex items-center gap-2"
                >
                  <action.icon className="h-4 w-4" />
                  {action.label}
                </DropdownMenuItem>
              ))}
            </DropdownMenuContent>
          </DropdownMenu>
        )}
      </div>
    </div>
  );
}
```

Create the directory if needed: `apps/frontend/src/components/shared/`
</action>
<verify> - File exists at apps/frontend/src/components/shared/quick-action-grid.tsx - Component exports QuickActionGrid - Grid renders icons above labels in columns - Overflow actions appear in "More" dropdown
</verify>
<done>QuickActionGrid component created with icon+label grid layout and overflow support</done>
</task>

<task type="auto">
  <name>Task 2: Create LogCallModal and refactor ActionButtonRow</name>
  <files>
    apps/frontend/src/components/cases/log-call-modal.tsx
    apps/frontend/src/components/cases/action-button-row.tsx
  </files>
  <action>
1. Create LogCallModal for logging phone calls:

```typescript
"use client";

import { useState } from "react";
import { Phone, Calendar, Clock, User } from "lucide-react";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { apiClient } from "@/lib/api";

interface LogCallModalProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  caseId: string;
  onSuccess?: () => void;
}

type CallDirection = "INBOUND" | "OUTBOUND";
type CallOutcome = "CONNECTED" | "VOICEMAIL" | "NO_ANSWER" | "BUSY" | "WRONG_NUMBER";

export function LogCallModal({
  open,
  onOpenChange,
  caseId,
  onSuccess,
}: LogCallModalProps) {
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [direction, setDirection] = useState<CallDirection>("OUTBOUND");
  const [outcome, setOutcome] = useState<CallOutcome>("CONNECTED");
  const [contactName, setContactName] = useState("");
  const [phoneNumber, setPhoneNumber] = useState("");
  const [duration, setDuration] = useState("");
  const [notes, setNotes] = useState("");

  const handleSubmit = async () => {
    if (!notes.trim()) return;

    setIsSubmitting(true);
    try {
      // Log call as activity
      await apiClient.post(`/cases/${caseId}/activity`, {
        action: "call_logged",
        actionDescription: `${direction === "INBOUND" ? "Received" : "Made"} call ${
          contactName ? `with ${contactName}` : ""
        } - ${outcome.replace("_", " ").toLowerCase()}`,
        context: {
          direction,
          outcome,
          contactName: contactName || null,
          phoneNumber: phoneNumber || null,
          durationMinutes: duration ? parseInt(duration) : null,
        },
        notes,
      });

      // Reset form
      setDirection("OUTBOUND");
      setOutcome("CONNECTED");
      setContactName("");
      setPhoneNumber("");
      setDuration("");
      setNotes("");
      onOpenChange(false);
      onSuccess?.();
    } catch (error) {
      console.error("Failed to log call:", error);
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <DialogTitle className="flex items-center gap-2">
            <Phone className="h-5 w-5" />
            Log Call
          </DialogTitle>
          <DialogDescription>
            Record details of a phone call related to this case.
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-4 py-4">
          {/* Direction and Outcome */}
          <div className="grid grid-cols-2 gap-4">
            <div className="space-y-2">
              <Label>Direction</Label>
              <Select value={direction} onValueChange={(v) => setDirection(v as CallDirection)}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="OUTBOUND">Outbound</SelectItem>
                  <SelectItem value="INBOUND">Inbound</SelectItem>
                </SelectContent>
              </Select>
            </div>
            <div className="space-y-2">
              <Label>Outcome</Label>
              <Select value={outcome} onValueChange={(v) => setOutcome(v as CallOutcome)}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="CONNECTED">Connected</SelectItem>
                  <SelectItem value="VOICEMAIL">Voicemail</SelectItem>
                  <SelectItem value="NO_ANSWER">No Answer</SelectItem>
                  <SelectItem value="BUSY">Busy</SelectItem>
                  <SelectItem value="WRONG_NUMBER">Wrong Number</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>

          {/* Contact Info */}
          <div className="grid grid-cols-2 gap-4">
            <div className="space-y-2">
              <Label htmlFor="contactName">
                <User className="h-3 w-3 inline mr-1" />
                Contact Name
              </Label>
              <Input
                id="contactName"
                placeholder="John Smith"
                value={contactName}
                onChange={(e) => setContactName(e.target.value)}
              />
            </div>
            <div className="space-y-2">
              <Label htmlFor="phoneNumber">
                <Phone className="h-3 w-3 inline mr-1" />
                Phone Number
              </Label>
              <Input
                id="phoneNumber"
                placeholder="+1 (555) 123-4567"
                value={phoneNumber}
                onChange={(e) => setPhoneNumber(e.target.value)}
              />
            </div>
          </div>

          {/* Duration */}
          <div className="space-y-2">
            <Label htmlFor="duration">
              <Clock className="h-3 w-3 inline mr-1" />
              Duration (minutes)
            </Label>
            <Input
              id="duration"
              type="number"
              min="0"
              placeholder="15"
              value={duration}
              onChange={(e) => setDuration(e.target.value)}
            />
          </div>

          {/* Notes */}
          <div className="space-y-2">
            <Label htmlFor="notes">Call Notes *</Label>
            <Textarea
              id="notes"
              placeholder="Summary of the conversation..."
              value={notes}
              onChange={(e) => setNotes(e.target.value)}
              rows={4}
            />
          </div>
        </div>

        <DialogFooter>
          <Button variant="outline" onClick={() => onOpenChange(false)}>
            Cancel
          </Button>
          <Button onClick={handleSubmit} disabled={isSubmitting || !notes.trim()}>
            {isSubmitting ? "Saving..." : "Log Call"}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

2. Refactor ActionButtonRow to use QuickActionGrid:

```typescript
"use client";

import { StickyNote, Mic, FileText, CheckSquare, Mail, Phone } from "lucide-react";
import { QuickActionGrid, type QuickAction } from "@/components/shared/quick-action-grid";

export type ActionType = "note" | "call" | "interview" | "document" | "task" | "email";

interface ActionButtonRowProps {
  caseId: string;
  onAction: (action: ActionType) => void;
  className?: string;
}

/**
 * Quick action buttons for the case detail left column.
 * Uses HubSpot-style horizontal icon+label grid.
 */
export function ActionButtonRow({
  caseId,
  onAction,
  className,
}: ActionButtonRowProps) {
  const actions: QuickAction[] = [
    { id: "note", label: "Note", icon: StickyNote, onClick: () => onAction("note") },
    { id: "email", label: "Email", icon: Mail, onClick: () => onAction("email") },
    { id: "call", label: "Call", icon: Phone, onClick: () => onAction("call") },
    { id: "interview", label: "Interview", icon: Mic, onClick: () => onAction("interview") },
    { id: "document", label: "Document", icon: FileText, onClick: () => onAction("document") },
    { id: "task", label: "Task", icon: CheckSquare, onClick: () => onAction("task") },
  ];

  return <QuickActionGrid actions={actions} columns={4} className={className} />;
}
```

3. In the case page.tsx, add state and handler for LogCallModal and include "call" in the action switch:

In the handleAction function, add:

```typescript
case "call":
  setCallModalOpen(true);
  break;
```

Add state:

```typescript
const [callModalOpen, setCallModalOpen] = useState(false);
```

Add LogCallModal to the JSX:

```tsx
<LogCallModal
  open={callModalOpen}
  onOpenChange={setCallModalOpen}
  caseId={caseId}
  onSuccess={handleActivityRefresh}
/>
```

Import LogCallModal from the new file.
</action>
<verify> - ActionButtonRow renders as horizontal icon grid (not vertical stack) - 6 actions visible: Note, Email, Call, Interview, Document, Task - Each button shows icon on top, label below - Clicking Call opens LogCallModal - LogCallModal submits call log to activity endpoint
</verify>
<done>QuickActionGrid used by ActionButtonRow, LogCallModal created and wired</done>
</task>

<task type="auto">
  <name>Task 3: Add gear icons and chevron toggles to properties panel</name>
  <files>apps/frontend/src/components/cases/case-properties-panel.tsx</files>
  <action>
1. Read the current CasePropertiesPanel and locate the section headers.

2. Modify each collapsible section header to include:
   - Chevron icon (ChevronRight/ChevronDown) that rotates on toggle
   - Gear icon (Settings2) on the right for future customization

3. Update the section header pattern. Find the pattern used for section headers and update:

```tsx
// Section header with chevron + gear
<button
  onClick={() => toggleSection(sectionId)}
  className="w-full flex items-center justify-between py-2 px-1 hover:bg-gray-50 rounded"
>
  <div className="flex items-center gap-2">
    <ChevronRight
      className={cn(
        "h-4 w-4 text-gray-500 transition-transform",
        isExpanded && "rotate-90",
      )}
    />
    <h3 className="text-sm font-semibold text-gray-900">{sectionTitle}</h3>
  </div>
  <Settings2
    className="h-4 w-4 text-gray-400 hover:text-gray-600"
    onClick={(e) => {
      e.stopPropagation();
      // Future: open property customization dialog
    }}
  />
</button>
```

4. Import ChevronRight and Settings2 from lucide-react.

5. Ensure the chevron rotation uses CSS transition for smooth animation:
   - Add `transition-transform` to the chevron icon
   - Add `rotate-90` class when section is expanded

6. If PropertySection component is used, modify it to accept and render gear icon. If sections are rendered inline, update each section header.

Example structure after modification:

```tsx
<div className="border-b last:border-0">
  <button
    onClick={() => toggleSection("status")}
    className="w-full flex items-center justify-between py-3 px-1 hover:bg-gray-50 rounded-t"
  >
    <div className="flex items-center gap-2">
      <ChevronRight
        className={cn(
          "h-4 w-4 text-gray-500 transition-transform duration-200",
          expandedSections.includes("status") && "rotate-90",
        )}
      />
      <span className="text-sm font-semibold text-gray-900">
        Status & Classification
      </span>
    </div>
    <Settings2
      className="h-4 w-4 text-gray-400 hover:text-gray-600"
      onClick={(e) => e.stopPropagation()}
    />
  </button>
  {expandedSections.includes("status") && (
    <div className="px-1 pb-3">{/* Section content */}</div>
  )}
</div>
```

  </action>
  <verify>
    - Each properties panel section has a chevron icon that rotates when expanded/collapsed
    - Chevron rotation is animated smoothly
    - Each section header has a gear icon on the right
    - Gear icon click is separate from section toggle (doesn't collapse section)
    - Clicking the section header toggles the section
  </verify>
  <done>Properties panel sections have animated chevron toggles and gear icons</done>
</task>

</tasks>

<verification>
1. Quick action buttons appear as a 4-column grid with icons above labels
2. Actions: Note, Email, Call, Interview, Document, Task visible in grid
3. Clicking Call opens LogCallModal with direction, outcome, contact, duration, notes fields
4. LogCallModal submits and logs activity
5. Properties panel sections have chevron icons that rotate on toggle
6. Properties panel sections have gear icons (non-functional for now)
7. TypeScript compilation passes: `npm run typecheck`
</verification>

<success_criteria>

- Quick actions use horizontal icon+label grid (not vertical ghost buttons)
- Call action type added and functional
- LogCallModal allows logging calls with metadata
- Properties panel visually enhanced with chevron toggles and gear icons
- Grid layout is responsive (wraps appropriately on smaller screens)
  </success_criteria>

<output>
After completion, create `.planning/phases/25-case-investigation-page-redesign/25-02-SUMMARY.md`
</output>
